<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j"
    template="/layout/template_new.xhtml">

<ui:define name="body">    
<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/phone/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/commons/commons.css"/>
<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/style.css"/>
<link href="#{request.contextPath}/asset/css/homePage/rollScreen.css" rel="stylesheet" />
<script type="text/javascript" src="#{request.contextPath}/asset/js/jquery.nicescroll.min.js"></script>
<style>

</style>
        	<!--#{welComeHome.myName()} #{welComeHome.getApplyToolList()}-->
<td valign="top">
            <div class="right_c">
            	<!-- 面包屑导航 -->
            	<div class="breadNav_wap clear" style="border-bottom:0;">
                    <div class="breadNav_lt"><span style="color:#333; font-size:14px;">当前位置：</span>个人中心<span>&gt;</span>宣传工具</div>
                </div>
				<!-- 内容开始 -->
				<table width="100%" cellpaadding="0" cellspacing="0">
					<tr>
						<td width="70%">
							<div class="rollBox">
								<h4 class="roll1">易拉宝</h4>
								<s:fragment rendered="#{not empty welComeHome.getPropagandaTools(573)}">
									<div class="inner" id="carsouel1">
										<ol class="btns clear">
											<li class="leftBtn"></li>
											<li class="rightBtn"></li>
										</ol>
										<ul class="imageList clear">
											<a4j:repeat value="#{welComeHome.getPropagandaTools(573)}" var="_tool">
												<li>
													<div class="pic" data-toggle="modal" data-target="#request" onclick="addTool('#{_tool.id}','#{_tool.toolName}','#{_tool.imgUrl}');">
														<img src="#{_tool.imgUrl}@244w_354h_1e_1c.src" alt=""/>
													</div>
													<p class="rollName">#{_tool.toolName}</p>
												</li>
											</a4j:repeat>
										</ul>
									</div>
								</s:fragment>
							</div>
							<div class="rollBox rollBox2">
								<h4 class="roll2">名片</h4>
								<s:fragment rendered="#{not empty welComeHome.getPropagandaTools(574)}">
									<div class="inner" id="carsouel2">
										<ol class="btns clear">
											<li class="leftBtn"></li>
											<li class="rightBtn"></li>
										</ol>
										<ul class="imageList clear">
											<a4j:repeat value="#{welComeHome.getPropagandaTools(574)}" var="_tool">
												<li>
													<div class="pic" data-toggle="modal" data-target="#request" onclick="addTool('#{_tool.id}','#{_tool.toolName}','#{_tool.imgUrl}');">
														<img src="#{_tool.imgUrl}@244w_192h_1e_1c.src" alt=""/>
													</div>
													<p class="rollName">#{_tool.toolName}</p>
												</li>
											</a4j:repeat>										
										</ul>
									</div>	
								</s:fragment>
							</div>
							<div class="rollBox rollBox2">
								<h4 class="roll3">室外宣传牌</h4>
								<s:fragment rendered="#{not empty welComeHome.getPropagandaTools(575)}">
									<div class="inner" id="carsouel3">
										<ol class="btns clear">
											<li class="leftBtn"></li>
											<li class="rightBtn"></li>
										</ol>
										<ul class="imageList clear">
											<a4j:repeat value="#{welComeHome.getPropagandaTools(575)}" var="_tool">
												<li>
													<div class="pic" data-toggle="modal" data-target="#request" onclick="addTool('#{_tool.id}','#{_tool.toolName}','#{_tool.imgUrl}');">
														<img src="#{_tool.imgUrl}@244w_192h_1e_1c.src" alt=""/>
													</div>
													<p class="rollName">#{_tool.toolName}</p>
												</li>
											</a4j:repeat>
										</ul>
									</div>
								</s:fragment>	
							</div>
							<div class="rollBox">
								<h4 class="roll4">展架</h4>
								<s:fragment rendered="#{not empty welComeHome.getPropagandaTools(576)}">
									<div class="inner" id="carsouel4">
										<ol class="btns clear">
											<li class="leftBtn"></li>
											<li class="rightBtn"></li>
										</ol>
										<ul class="imageList clear">
											<a4j:repeat value="#{welComeHome.getPropagandaTools(576)}" var="_tool">
											<li>
												<div class="pic" data-toggle="modal" data-target="#request" onclick="addTool('#{_tool.id}','#{_tool.toolName}','#{_tool.imgUrl}');">
													<img src="#{_tool.imgUrl}@244w_354h_1e_1c.src" alt=""/>
												</div>
												<p class="rollName">#{_tool.toolName}</p>
											</li>
											</a4j:repeat>
										</ul>
									</div>
								</s:fragment>	
							</div>
							<div class="rollBox">
								<h4 class="roll5">X展架</h4>
								<s:fragment rendered="#{not empty welComeHome.getPropagandaTools(577)}">
									<div class="inner" id="carsouel5">
										<ol class="btns clear">
											<li class="leftBtn"></li>
											<li class="rightBtn"></li>
										</ol>
										<ul class="imageList clear">
											<a4j:repeat value="#{welComeHome.getPropagandaTools(577)}" var="_tool">
												<li>
													<div class="pic" data-toggle="modal" data-target="#request" onclick="addTool('#{_tool.id}','#{_tool.toolName}','#{_tool.imgUrl}');">
														<img src="#{_tool.imgUrl}@244w_354h_1e_1c.src" alt=""/>
													</div>
													<p class="rollName">#{_tool.toolName}</p>
												</li>
											</a4j:repeat>
										</ul>
									</div>	
								</s:fragment>
							</div>
						</td>
						<td width="30%" style="vertical-align:top;">
							<div class="rightBox">
								<div class="keeper">
									<div class="headPic">
										<img src="#{welComeHome.picture}" style="display:#{welComeHome.picture ne null and welComeHome.picture ne ''?'':'none;'}"/>
                            			<img src="/asset/images/welcome_noperson.png" style="display:#{welComeHome.picture eq null or welComeHome.picture eq ''?'':'none;'}"/>
									</div>
									<p class="name">#{welComeHome.user.nickname}<span>#{welComeHome.user.levelId.name}</span></p>
								</div>
								
								<s:div styleClass="request" id="applyDiv">
									<div class="myTitle"><span></span> 我的请求</div>
									<!-- 没有请求 -->
									<s:fragment rendered="#{empty welComeHome.applyPropagandaToolList}">
										<div class="noBox">
											<img src="#{request.contextPath}/asset/images/homePage/request.png" alt=""/>
											<p>暂无请求！</p>
										</div>
									</s:fragment>
									<!-- 有请求 -->
									<s:fragment rendered="#{not empty welComeHome.applyPropagandaToolList}">
										<div class="hasBox">
											<table width="100%" cellpadding="0" cellspacing="0">
												<a4j:repeat value="#{welComeHome.applyPropagandaToolList}" var="_apt">
													<tr>
														<td class="time">
															<h:outputText value="#{_apt.insertTime}">
											            		<s:convertDateTime type="both" pattern="yyyy-MM-dd" />
											            	</h:outputText>
											            </td>
														<td class="center">
															<img src="#{request.contextPath}/asset/images/homePage/circle.png" />
															<span></span>
														</td>
														<td class="goods">#{_apt.propagandaTool.toolName}<span class="#{_apt.statusType?'green':'blue'}">#{_apt.statusType?'已处理':'等待处理'}</span></td>
													</tr>
												</a4j:repeat>											
											</table>
										</div>
									</s:fragment>
								</s:div>
							</div>
						</td>
					</tr>
				</table>
				<p class="copyRight"></p>
				<!-- 弹窗 -->
				<div class="modal fade" id="request" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			      <div class="modal-dialog rollPop">
			        <div class="modal-content">
			          <div class="modal-header">
			            <button type="button" class="close" data-dismiss="modal" style="margin-top:0;"><span aria-hidden="true">&times;</span></button>
			            <h4 class="modal-title" id="myModalLabel">易拉宝模板1</h4>
			          </div>
			          <div class="modal-body clear">
			            <div class="popLeft fl">
			            	<img id="toolImg" src="#{request.contextPath}/asset/images/homePage/roll1.jpg" />
			            </div>
			            <div class="popRight fr">
			            	<p class="tips clear">
			            		<img class="fl" src="#{request.contextPath}/asset/images/homePage/tip.png" />
			            		<span class="fl">喜欢这个模板？请在下方添加您的联系方式，我们的客服会与您联系！</span>
			            	</p>
			            	<div class="item clear">
			            		<span class="fl">称呼</span>
			            		<input type="text" class="form-control fl" id="applyer" value=""/>
			            	</div>
			            	<div class="item clear">
			            		<span class="fl">联系方式</span>
			            		<input type="text" class="form-control fl" id="contact" value=""/>
			            	</div>
			            	<div class="item clear">
			            		<span class="fl">备注</span>
			            		<textarea class="form-control fl" id="remarks" rows="3"></textarea>
			            	</div>
			            </div>
			          </div>
			          <div class="modal-footer" style="text-align:center;">
			          	<input type="hidden" id="toolId"/>
			          	<button type="button" class="btn btn-primary" onclick="submitApplyTool();">提交请求</button>
			            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			          </div>
			        </div>
			      </div>
			    </div>
            </div>
            <!-- 内容结束 -->
             <a4j:form>
			 		<a4j:queue requestDelay="10" ignoreDupResponses="true"/>
			        <a4j:jsFunction name="applyPropaganda"  action="#{welComeHome.applyPropaganda()}"  reRender="applyDiv" oncomplete="applyComplete()">
			        	<a4j:actionparam name="toolId" assignTo="#{welComeHome.toolId}"/>
			        	<a4j:actionparam name="applyer" assignTo="#{welComeHome.applyer}"/>
			        	<a4j:actionparam name="contact" assignTo="#{welComeHome.contact}"/>
			        	<a4j:actionparam name="remarks" assignTo="#{welComeHome.remarks}"/>
			        </a4j:jsFunction>        
			 </a4j:form>
            </td>    
<div class="clear"></div>
<!--content结束-->


<script>
//<![CDATA[
	var nowimg=[0,0,0,0,0];
	jQuery(document).ready(function() {
		slider("#carsouel1",0);
		slider("#carsouel2",1);
		slider("#carsouel3",2);
		slider("#carsouel4",3);
		slider("#carsouel5",4);
		setTimeout(function(){
			jQuery(".hasBox").niceScroll({cursorcolor:"#fff",cursorwidth:8});	
		},500);
	});
	function slider (name,index) {
		var jQueryid = jQuery(name).find('.imageList');
		var jQuerybtn = jQuery(name).find('.btns');
		var w = jQuery('.inner').width(); //父盒子宽
		var num = jQueryid.children('li').length; //图片个数
		jQueryid.children('li').width(w/3); //一个li的宽度
		var liWidth = w/3;
		jQueryid.width(num*liWidth); //图片总和(ul)的宽度
		jQueryid.css( 'left' , -(w*nowimg[index]));
		// 按钮显隐
		if(num<=3){
			jQuerybtn.hide();
		}else{
			jQuerybtn.show();
			jQuerybtn.children('.rightBtn').css("background","url(#{request.contextPath}/asset/images/homePage/right2.png) no-repeat");
		}
		jQuerybtn.children('.leftBtn').unbind();
		jQuerybtn.children('.rightBtn').unbind(); 
		jQuerybtn.children('.leftBtn').click(function(){
			if( nowimg[index] <=0 ){
				nowimg[index] =0;					
			}else{				
				nowimg[index]--;	
			}
			//是否可以向左右翻页，翻页图标变化
			if(nowimg[index]<=0){
				jQuery(this).css("background","url(#{request.contextPath}/asset/images/homePage/left1.png) no-repeat");
			}else{
				jQuery(this).css("background","url(#{request.contextPath}/asset/images/homePage/left2.png) no-repeat");
			}
			if( nowimg[index] >= (Math.ceil(num/3)-1)){	
				jQuerybtn.children('.rightBtn').css("background","url(#{request.contextPath}/asset/images/homePage/right1.png) no-repeat");	
			}else{
				jQuerybtn.children('.rightBtn').css("background","url(#{request.contextPath}/asset/images/homePage/right2.png) no-repeat");			
			}
			jQueryid.css( 'left' , -(w*nowimg[index]));
		});	
		jQuerybtn.children('.rightBtn') .click(function(){
			var width=0;						
			if( nowimg[index] >= (Math.ceil(num/3)-1)){		
				nowimg[index] = Math.ceil(num/3)-1;												
				width=-(w*nowimg[index]);				
			}else{				
				nowimg[index]++;
				width=-(w*nowimg[index]);
			}
			//是否可以向左右翻页，翻页图标变化
			if( nowimg[index] >= (Math.ceil(num/3)-1)){	
				jQuery(this).css("background","url(#{request.contextPath}/asset/images/homePage/right1.png) no-repeat");	
			}else{
				jQuery(this).css("background","url(#{request.contextPath}/asset/images/homePage/right2.png) no-repeat");			
			}
			if(nowimg[index]>0){
				jQuerybtn.children('.leftBtn').css("background","url(#{request.contextPath}/asset/images/homePage/left2.png) no-repeat");
			}
			jQueryid.css( 'left' ,width );
		});	
	}
	jQuery(window).resize(function() {
		nowimg=[0,0,0,0,0];
		slider("#carsouel1",0);
		slider("#carsouel2",1);
		slider("#carsouel3",2);	
		slider("#carsouel4",3);
		slider("#carsouel5",4);
	});
	
  	function addTool(id,name,img){
		jQuery(".modal-title").html(name);
		jQuery("#toolImg").attr("src",img+"@266w_228h_1e_1c.src");
		jQuery("#toolId").val(id);

  		jQuery("#applyer").val("");
  		jQuery("#contact").val("");
  		jQuery("#remarks").val("");
  	}
  	var telChe = /^[\d,-]+$/;
  	function submitApplyTool(){
  		var toolId=jQuery("#toolId").val();
  		var applyer=jQuery("#applyer").val();
  		var contact=jQuery("#contact").val();
  		var remarks=jQuery("#remarks").val();
  		if(applyer==""){
			alert("称呼不能为空！");
			return;
  	  	}else if(applyer.length>15){
	  	  	alert("称呼不能大于15字！");
			return;
  	  	}
  		if(contact==""){
			alert("联系方式不能为空！");
			return;
  	  	}else if(!telChe.test(contact)){
	  	  	alert("请输入正确的联系方式！");
			return;
  	  	}else if(contact.length>20){
	  	  	alert("联系方式长度不能超过20！");
			return;
  	  	}
  		if(remarks.length>100){
			alert("备注长度不能超过100字！");
			return;
  	  	}
  		applyPropaganda(toolId,applyer,contact,remarks);
  	}
  	function applyComplete(){
  		jQuery(".modal-title").html("");
		jQuery("#toolImg").attr("src","");
  		jQuery("#toolId").val("");
  		jQuery("#applyer").val("");
  		jQuery("#contact").val("");
  		jQuery("#remarks").val("");
  		jQuery('#request').modal('hide');
  		jQuery(".hasBox").niceScroll({cursorcolor:"#b2b2b2",cursorwidth:8});	
  	}
//]]>
</script>




</ui:define>

</ui:composition>
