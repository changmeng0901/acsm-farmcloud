<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jstl/core"
    template="/layout/template.xhtml">

<ui:define name="body">
<style>
.ui-selectmenu{*position:static;}

.skc_cs_s{margin-left:15px; min-width:105px; display:inline-block;}
.ts_div2{width:240px; height: 125px; border: 1px solid #81C5E9; margin: 0px auto; padding: 0 15px 15px;  background: url(#{request.contextPath}/asset/images/tck_bg_14.jpg) #ffffff repeat-x scroll center top;}
</style>
<td valign="top" width="100%">
<!-- #{aliasesHomeFour.works()} -->
                <div class="right_c">
                	<div class="r_title">
                    	<div class="r_t_l">
						<s:link propagation="none"  view="#{sessionTake.urlTemp}" style="text-decoration:none;color:black;" value="工作 ">
                        </s:link>
						&#160;&gt;&#160;&#160;<font size="3">库存管理</font></div>
						<div class="r_t_r">
							<ul>
								<li >
									<a href="#{request.contextPath}/product/GoodsStorageTypeList.seam" style="text-decoration:none;color:black;" >
				                 		<img src="#{request.contextPath}/asset/images/wuliao.png" width="12" height="10" />
				                 		
				              			物料管理
				              		</a>
			        			</li>
								<li style="border-right:1px solid #ccc;">
									 <a href="#{request.contextPath}/storage/StorageTypeList.seam" style="text-decoration:none;color:black;" >
									<img src="#{request.contextPath}/asset/images/cangku.png" width="13" height="10" />
			                      	 库房管理
			                      	</a>
			                    </li>
			     			</ul>
						</div>
                    </div>
					<div class="yuleng">
						<a href="#{request.contextPath}/inOut/StockRecord.seam"><img src="#{request.contextPath}/asset/images/jx_03.jpg" width="106" height="74" /></a>
 						<a href="#{request.contextPath}/materialsall/GoodsBatchList.seam"><img src="#{request.contextPath}/asset/images/jx_05.jpg" width="106" height="74" /></a>
 						<a href="#{request.contextPath}/materialsall/StorageChangeFormList.seam"><img src="#{request.contextPath}/asset/images/jx_07.jpg" width="106" height="74" /></a>
 						<a href="#{request.contextPath}/storage/EnterOf.seam"><img src="#{request.contextPath}/asset/images/jx_09.jpg" width="106" height="74" /></a>
 						<a href="#{request.contextPath}/materialsall/InventoryList.seam"><img src="#{request.contextPath}/asset/images/jx_11.jpg" width="106" height="74" /></a>
						<a href="#{request.contextPath}/storage/OutOf.seam"><img src="#{request.contextPath}/asset/images/jx_13.jpg" width="106" height="74" /></a>
					</div>
                    	<div class="clear"></div>
                    </div>  
                    
                    <h:form id="goodsInfoSearch">
                    <rich:modalPanel id="products" autosized="true" height="125"
								width="240" headerClass="modalHeader">
								<div class="ts_div2" id="div2">
								<div class="tck_ti"><a href="#"> <h:outputLink value="#"
									onclick="#{rich:component('products')}.hide(); return false;">
									<img src="#{request.contextPath}/asset/images/close_17.jpg"  onclick="return closeMethod()"
										width="20" height="20"/>
								</h:outputLink> </a></div>
				
								<table
									style="width: 100%; margin-top: 25px; table-layout: fixed; margin-left: 15px;">
									<tr>
										<td width="46" align="left"><img
											src="#{request.contextPath}/asset/images/tstc.jpg" width="46"
											height="46" /></td>
										<td align="left"
											style="font-family: '宋体'; color: #000000; font-size: 12px; padding-left: 15px;">
										<span id="productMsg">*号部分为必填项！</span></td>
									</tr>
								</table>
								</div>
					</rich:modalPanel>
                    <div class="z_r_ser">
                    	<table cellpadding="0" cellspacing="0" class="cxtja">
                        	<tr>
                        		<td width="80" style="font-size:14px;">查询条件：<h:inputHidden value="#{aliasesHomeFour.tag}" /></td>
                                <td width="340">
                                <h:inputText value="#{aliasesHomeFour.searchName}" styleClass="z_r_ser_i"/>
                                </td>
                                <td width="70" align="left">
                                <h:commandButton id="search" action="/inOut/StockRecord.xhtml" onclick="return checkSearch();" styleClass="list_search"/>
                                </td>
                                <td width="65" height="30" align="right" valign="bottom">
                                <h:inputHidden id="flag" value="#{aliasesHomeFour.flag}"/>
                                <a class="gjss_a gjtop" href="javascript:" onclick="op(this)" aa="#{aliasesHomeFour.flag=='2'?'2':'1'}">高级搜索</a></td>
                           </tr>
                       </table>                          
                    </div>
                  
                     <div class="gjs" style="#{aliasesHomeFour.flag=='1'?'display:none;':''}">
                         <div class="gjss_con">
                         <div class="gjss_w gjss_w1w" >
                                    <table>
                                        <tr>
                                            <td class="all_te">物料编码：</td>
                                            <td>
                                            <h:inputText id="wname1" styleClass="gjss1"  value="#{aliasesHomeFour.wcode}" />
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="gjss_w gjss_w1w" >
                                    <table>
                                        <tr>
                                            <td class="all_te">名称：</td>
                                            <td>
                                            <h:inputText id="wname" styleClass="gjss1"  value="#{aliasesHomeFour.wname}" />
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="gjss_w gjss_w2" >
                                    <table>
                                        <tr>
                                            <td class="all_te">库存量：</td>
                                            <td>
                                                <h:inputText id="cstart" styleClass="gjss1"  value="#{aliasesHomeFour.cstart}" />
                                            </td>
                                            <td>—</td>
                                            <td>
                                                <h:inputText id="cend" styleClass="gjss1"  value="#{aliasesHomeFour.cend}" />
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="gjss_w gjss_w2" style="width:350px">
                                    <table>
                                        <tr>
                                            <td class="all_te">采购时间：</td>
                                            <td>
                                                <rich:calendar id="start" value="#{aliasesHomeFour.start}"  datePattern="yyyy-MM-dd" />
                                            </td>
                                            <td>—</td>
                                            <td>
                                                <rich:calendar id="end" value="#{aliasesHomeFour.end}" datePattern="yyyy-MM-dd" />
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="gjss_w gjss_w3" >
                                    <table width="100%">
                                        <tr>
                                            <td class="all_te">类型：</td>
                                            <td>
                                            <h:selectOneMenu  styleClass="small3" id = "goodsTypeInfo" value="#{aliasesHomeFour.goodsTypeInfo}">
												<f:selectItem itemLabel="请选择" itemValue="0" />
												<f:selectItem itemLabel="原料" itemValue="1" />
												<f:selectItem itemLabel="半成品" itemValue="3" />
												<f:selectItem itemLabel="成品" itemValue="2" />
											</h:selectOneMenu>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                               <div class="clear"></div> 
                         </div>
                    	<div class="clear"></div>
                    </div>
                    </h:form>
                    <div class="right_c">
<rich:modalPanel id="product" autosized="true" height="166" width="450" headerClass="modalHeader" >
		<div class="tck_div">
       <div class="tck_ti">
       <h:outputLink value="#"
                onclick="#{rich:component('product')}.hide(); return false;">
                    <img src="../images/close_17.jpg" width="20" height="20"/>
                </h:outputLink>
                </div>
       <h:form id="productform" enctype="multipart/form-data">
               	<table class="tck_table">
                    <tr>
                    	<td width="130" class="font_td" align="right">名称：</td>
                        <td width="240">
				  	 <h:inputText id="productName" styleClass="ge_file" style="height:15px;margin-left: 8px;" size="20" maxlength="45" value="#{aliasesHomeFour.instance.name}">
	                </h:inputText>
	                <font color="#FF0000">*</font>
                        </td>
                    </tr>
                    <tr>
                    	<td align="right" class="font_td">物料：</td>
                        <td  >
						  	<rich:pickList sourceListWidth="120px" targetListWidth="120px"  listsHeight="120px" id="roleResult"   
						value="#{aliasesHomeFour.roleResult}" copyAllControlLabel="全部选择"
						removeAllControlLabel="全部清除" copyControlLabel="选择"
						removeControlLabel="清除">
						<f:selectItems value="#{aliasesHomeFour.roleResult2}" />
					</rich:pickList>  
                        </td>
                    </tr>
                    <tr>
                    	<td colspan="2" align="center" valign="bottom">
		                <a4j:commandButton value="添加" style="width:74px;height:26px" image="../images/safe.jpg"  
		                action="#{aliasesHomeFour.persist}"
		                	reRender="urls"
		                	oncomplete="#{rich:component('product')}.hide();document.getElementById('productform:productName').value='';" onclick="if(!checkSubmit()) return false;"
		                	/>
		                	&#160;<h:outputLink value="#"
                onclick="#{rich:component('product')}.hide(); return false;"><img class="er_buttton" src="../images/button_17.jpg" width="74" height="26" />
                </h:outputLink>
                        </td>
                    </tr>
                </table>
               
       </h:form>
       </div>
   </rich:modalPanel>
  			<a4j:form>
               <a4j:jsFunction name="clearOperate" reRender="product" action="#{aliasesHomeFour.clearOperate()}" oncomplete="#{rich:component('product')}.show();">
  			   </a4j:jsFunction>
  			</a4j:form>
					<!--商品分类开始-->
                    <div class="tree_dis">
                     <h:panelGroup id="urls">
                    	<ul class="tree_ul">
                    		<li id="sel0" class="sel #{aliasesHomeFour.tag==0?'current':''}" ><a href="#{request.contextPath}/inOut/StockRecord.seam?&#38;tag=0" title="">全部</a></li>
                    	<a4j:repeat rendered="#{not empty aliasesHomeFour.aliasesList}" value="#{aliasesHomeFour.aliasesList}" var="_var" rowKeyVar="_index">
                            <li id="sel#{_index+1}" class="sel #{aliasesHomeFour.tag==_var.id?'current':''}" ><a href="#{request.contextPath}/inOut/StockRecord.seam?&#38;tag=#{_var.id}" title="">#{_var.name}</a></li>
                        </a4j:repeat>
                            <li style="border:none;"><a style="background:none;" href="#" onclick="clearOperate();return false;"><img style="position:relative; top:8px;" src="#{request.contextPath}/asset/images/jh_22.jpg" width="21" height="19" /></a></li>
                    	</ul>
                    </h:panelGroup>
                        <div class="box2">
                        	<!--全部开始-->
                        	<div>
                                <table width="100%" cellpadding="0" cellspacing="0" class="tr_tab_b2" style="border-top:1px solid #ddd;">
                                    <tr>
                                        <td class="tree_th" width="15%">批次编码</td>
                                        <td class="tree_th" width="15%">名称</td>
                                        <td class="tree_th" width="10%">规格</td>
                                        <td class="tree_th" width="10%">库存数量</td>
                                        <td class="tree_th" width="10%">采购时间</td>
                                        <td class="tree_th" width="10%">采购人</td>
                                        <td class="tree_th" width="10%">操作</td>
                                    </tr>
                                </table>
                        	<!--第一个table开始-->
                                <table width="100%" cellpadding="0" cellspacing="0" class="tr_tab_b">
                                <a4j:repeat value="#{aliasesHomeFour.objList}" var="obj" rendered="#{not empty aliasesHomeFour.objList}" rowKeyVar="index">
                                    <tr class="nottt">
                                        <td height="48" colspan="7" style="border-bottom:1px solid #ddd;">
                                        	<span class="skc_cs_s"><font color="#71aae1">物料编码：</font><font color="#717171">#{obj[1]}</font></span>
                                        	<span class="skc_cs_s"><font color="#71aae1">名称：</font><font color="#717171">#{obj[2]}</font></span>
                                        	<span class="skc_cs_s"><font color="#71aae1">类型：</font><font color="#717171">
	                                        	<h:outputText value="原料" rendered="#{obj[5] eq 1}"/>
	                                        	<h:outputText value="成品" rendered="#{obj[5] eq 2}"/>
	                                        	<h:outputText value="半成品" rendered="#{obj[5] eq 3}"/>
                                        	</font></span>
                                        	<span class="skc_cs_s"><font color="#71aae1">库存总量：</font><font color="#717171">#{empty obj[3]?0:obj[3]}</font></span>
                                        	<span class="skc_cs_s"><font color="#71aae1">冻结总量：</font><font color="#717171">#{aliasesHomeFour.getGoodsInfuNum(obj[0])}</font></span>
                                        	<span class="skc_cs_s"><font color="#71aae1">剩余总量：</font><font color="#717171">#{obj[3] - aliasesHomeFour.getGoodsInfuNum(obj[0])}</font></span>
                                        	<span class="skc_cs_s"><font color="#71aae1">规格：</font><font color="#717171">#{obj[4]}</font></span>
                                        </td>
                                    </tr>
                                    <a4j:repeat value="#{aliasesHomeFour.getGoodsBatchById(obj[0])}" var="_obj"  rowKeyVar="_index">
                                    <tr>
                                        <td class="tree_td" width="15%">#{_obj[1]}</td>
                                        <td class="tree_td" width="15%">#{obj[2]}</td>
                                        <td class="tree_td" width="10%">#{obj[4]}</td>
                                        <td class="tree_td" width="10%">#{_obj[2]}</td>
                                        <td class="tree_td" width="10%">
                            <h:outputText value="#{_obj[4]}">
								<s:convertDateTime type="both" dateStyle="short" pattern="yyyy-MM-dd" />
						    </h:outputText></td>
                                        <td class="tree_td" width="10%">#{_obj[3]}</td>
                                        <td class="tree_td" width="10%">
                                            <s:link propagation="none"  view="/materialsall/MaterialsView.xhtml" styleClass="list_view">
                                            	<f:param name="batchId" value="#{_obj[0]}"/>
                                            </s:link>
                                        </td>
                                    </tr>
                                    </a4j:repeat>
                                    </a4j:repeat>
                                </table>
                                <table style="height:30px; margin:40px auto 0 auto;" cellpadding="0" cellspacing="0">
                    	<tr>
                    	<s:div rendered="#{not empty aliasesHomeFour.objList}">
			                <s:decorate rendered="#{!aliasesHomeFour.previousExists }">
			                <td><img src="#{request.contextPath}/asset/images/page_68.jpg" width="4" height="30" /></td>
			                </s:decorate>
			                 <s:decorate rendered="#{aliasesHomeFour.previousExists }">
			                <td><img src="#{request.contextPath}/asset/images/page_67.jpg" width="4" height="30" /></td>
			                </s:decorate>
			                <s:decorate rendered="#{aliasesHomeFour.previousExists }">
	                            <td class="td_t_b">
		                            <s:link propagation="none"  view="/inOut/StockRecord.xhtml" >首页
		                            	<f:param name="pageNum" value="0" />
		                            </s:link>
	                            </td>
	                            <td class="td_t_b td_t_t" style="padding:0; width:30px;">
		                            <s:link propagation="none"  view="/inOut/StockRecord.xhtml"  styleClass="no_n" >
		                            	<f:param name="pageNum" value="#{aliasesHomeFour.previousFirstResult}"/>&lt;
		                            </s:link>
	                            </td>
	                        </s:decorate>
					       <a4j:repeat var="_page" value="#{aliasesHomeFour.pageList}" rowKeyVar="_index">
								<td class="td_t_b #{aliasesHomeFour.previousExists or _index >0 ?'td_t_t':''} #{_page eq aliasesHomeFour.pageNum?'onp':''}">
									<s:link propagation="none"  view="/inOut/StockRecord.xhtml" value="#{_page}" id="previousPage">
										<f:param name="pageNum" value="#{_page}" />
									</s:link>
								</td>
							</a4j:repeat>
							<s:decorate rendered="#{aliasesHomeFour.nextExists}">
                            <td class="td_t_b td_t_t">
	                            <s:link propagation="none"  view="/inOut/StockRecord.xhtml"   styleClass="no_d" >
	                            	<f:param name="pageNum" value="#{aliasesHomeFour.nextFirstResult}" />&gt;
	                            </s:link>
                            </td>
                            <td class="td_t_b td_t_t">
								 <s:link propagation="none"  view="/inOut/StockRecord.xhtml" >尾页
								 	<f:param name="pageNum" value="#{aliasesHomeFour.PAGE_COUNT}" />
								 </s:link>
							</td>
							</s:decorate>
							<td class="td_t_b td_t_t" style=" color:#9a9a9c;">共#{aliasesHomeFour.PAGE_COUNT}页</td>
                            <td ><img src="#{request.contextPath}/asset/images/page_70.jpg" width="4" height="30" /></td>
                            </s:div>
                    	</tr>
                    </table>
                                <!--第一个table结束-->
                        	
                                    </div>
                                <!--叶类结束-->    
                        <div class="clear"></div>
                        </div>
                    	<div class="clear"></div>
                    </div>

					<!--商品分类结束-->
                    <div class="clear"></div>
                </div><!--right_c结束-->
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/superfish.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/supersubs.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/hoverIntent.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/jquery.flot.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/jquery-ui.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/jquery-ui-select.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/customInput.jquery.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/jquery.dataTables.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/jquery.fancybox-1.3.4.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/jquery.filestyle.mini.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/jquery-ui-timepicker-addon.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/jquery.treeview.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/jquery.tipsy.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/jquery.wysiwyg.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/inline.js"></script>
                <script type="text/javascript">
            	jquery(".rich-calendar-input").addClass("gjss1");
            	jquery(".rich-calendar-input").removeClass("rich-calendar-input");
op = function(ind){
	if(ind.getAttribute("aa")=="1"){
		jquery(".gjs").slideDown(800);
		jquery(".gjss_a").attr("aa",2).removeClass("gjtop").addClass("gjbottom");
		
		document.getElementById("goodsInfoSearch:flag").value="2";
	}else{
		jquery(".gjs").slideUp(800);
		jquery(".gjss_a").attr("aa",1).removeClass("gjbottom").addClass("gjtop");
		document.getElementById("goodsInfoSearch:wname").value="";
		document.getElementById("goodsInfoSearch:cstart").value="";
		document.getElementById("goodsInfoSearch:cend").value="";
		document.getElementById("goodsInfoSearch:startInputDate").value="";
		document.getElementById("goodsInfoSearch:endInputDate").value="";
		document.getElementById("goodsInfoSearch:flag").value="1";
	}
}

function checkInteger(obj,str){
	if(obj.value!=""){
		var v = obj.value;
		var reg = /^[1-9]+[0-9]*]*$/; 
		if (!reg.test(v)){
			obj.focus();
			return false;
		}
	}
	return true;
}
          checkSearch = function(){
              if(jquery(".gjss_a").attr("aa")==2){
        	  var a = checkInteger(document.getElementById("goodsInfoSearch:cstart"),"请填写正确的数字");
        	  if(!a)
            	  return false;
        	  var b = checkInteger(document.getElementById("goodsInfoSearch:cend"),"请填写正确的数字");
        	  if(!b)
            	  return false;
              }
          }      
se = function(obj){
	jquery(".sel").each(function(){
		jquery(this).removeClass("current");
	});
	jquery("#sel"+obj).addClass("current");

	jquery(".box2 > div").each(function(index,domEle){
		if(index==obj){
			jquery(domEle).css("display","block");
		}else{
			jquery(domEle).css("display","none");
		}
	});
}

function checkSubmit(){
	   var productName = document.getElementById("productform:productName").value; 
	   var a = document.getElementById("productform:roleResulttlContentBox").value;
	   if(productName == ""){
			document.getElementById("productMsg").innerHTML = "名称不能为空";
			#{rich:component('products')}.show();
			return false;
		}
		if(a == ""){
			document.getElementById("productMsg").innerHTML = "请选择物料";
			#{rich:component('products')}.show();
			return false;
		}

		return true;
}

function closeMethod(){
	   var productName = document.getElementById("productform:productName").value; 
	   if(productName == ""){
		   document.getElementById("productform:productName").focus();
		   return false;
		}
}
</script>
            </td>
<style>
 .dr-mpnl-pnl{padding:0;}
 .dr-mpnl-pnl-b{color:none;padding:0; font-family:"微软雅黑";}
 .dr-insldr td{padding:0;}
 .font_td{font-size:14px;}
 .dr-insldr{width:255px!important;}
</style>
</ui:define>
	</ui:composition>

