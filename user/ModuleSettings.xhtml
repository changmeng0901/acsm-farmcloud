<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template_new.xhtml"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:a4j="http://richfaces.org/a4j">
	<ui:define name="body">
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/commons/commons.css" />
    <link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/module/ModuleSetup.css" />
    <link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/settings/EnterpriseSettings.css" />  
    <script type="text/javascript" src="#{request.contextPath}/asset/js/EnterpriseLeftMenu.js"></script>
    <link href="#{request.contextPath}/asset/css/menuHelpTip/introjs.css" rel="stylesheet" />
	<script type="text/javascript" src="#{request.contextPath}/asset/js/menuHelpTip/intro.js"> </script> 
		
	<style>
	.introjs-step3_btn{
		text-align: right;
	    margin-right: -20px;
	    margin-top:10px;
	    cursor: pointer;
	 }
	 .introjs-step4_btn{
		text-align: right;
	    margin-right: -30px;
	    margin-top:10px;
	    cursor: pointer;
	 }
	</style>		
		<!-- 
			#{moduleSettingsHome.init()}
			#{welComeHome.getMenuTips()}
		 -->
		<td valign="top">
                <div class="inbentory_file_main">
                <!--左侧二级导航 -->
                <div class="inbentory_level_wap">
                    <div class="inbentory_level">
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_rkgl"></i>基础设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/user/UpdateEnterpriseSettings.seam?enterpriseId=#{sessionTake.enterpriseInfoId}','_self')" >
                            	<i class="icon_sed"></i>企业设置                   	
                            </li>
                            <!-- 管理版和以前的版本（标准、白金...)显示 -->
                            <h:panelGroup rendered="#{sessionTake.nowVersionService.basicService.basicServiceId==10 or sessionTake.nowVersionService.basicService.serviceType eq 1}">
                           		 <li class="sed_item sed_cur" onclick="window.open('#{request.contextPath}/user/ModuleSettings.seam','_self')" ><i class="icon_sed"></i>模块配置</li>
                            </h:panelGroup>                           
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/dictionary/DataDicinfoList.seam','_self')" ><i class="icon_sed"></i>字段管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/user/EnterpriseCommunityList.seam','_self')" ><i class="icon_sed"></i>角色管理</li>
                            <s:fragment rendered="#{enterpriseInfoHome.enterpriseInfo.govState}">
	                        	<li class="sed_item" onclick="window.open('#{request.contextPath}/user/AuditInformationList.seam','_self')" ><i class="icon_sed"></i>审核信息</li>
	                        </s:fragment>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/system/RecycleInfoList_1.seam','_self')" ><i class="icon_sed"></i>回收站</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_ckgl"></i>生产管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <h:panelGroup rendered="#{s:hasRole('certification')}">
                            	<li class="sed_item" onclick="window.open('#{request.contextPath}/map/CertificationList.seam','_self')" ><i class="icon_sed"></i>认证信息</li>
                            </h:panelGroup>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/message/TunnelGroupList.seam','_self')" ><i class="icon_sed"></i>分组管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/InputsInfoList.seam?goodsTypeInfoId=5','_self')" ><i class="icon_sed"></i>投入品信息</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_zkgl"></i>销售管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/GoodsInfoList.seam','_self')"><i class="icon_sed"></i>物料信息</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/ProductInfoList.seam','_self')" ><i class="icon_sed"></i>商品信息</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_pdgl"></i>硬件管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/device/DeviceList.seam','_self')"><i class="icon_sed"></i>设备管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/device/VideoList.seam','_self')" ><i class="icon_sed"></i>视频管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/farming/AmRfidInfoList.seam','_self')" ><i class="icon_sed"></i>RFID卡管理</li>
                        </ol>
                    </div>
                    <i class="collapse_btn"></i>
                </div>
                <!--左侧二级导航 -->
				<!--右侧 -->
                <div class="inbentory_content">
            <div class="right_c" style="min-height:30px; padding-bottom:15px; padding-top:15px;">
            	<!-- 面包屑导航 开始 -->
                <div class="breadNav_wap mb15 clear">
                    <div class="breadNav_lt"><strong>模块配置</strong></div>
                </div>
                <!-- 模块配置主体 开始 -->
                <div class="module_block mb20"  id="setup_item">
                	<div class="module_title">
                    	<h3>已选模块</h3>
                    </div>
                    <a4j:repeat value="#{moduleSettingsHome.firstMenuList}" var="_fm" rowKeyVar="fm_index">
                    	<dl class="setup_item" id="setup_item_div#{_fm.firstMenuId}" style="display:#{not empty moduleSettingsHome.moduleMap.get(_fm.firstMenuId)? '':'none'}">
	                        <dt class="text_title"><img src="#{request.contextPath}#{_fm.imgUrl}" />#{_fm.menuName}</dt>
	                        <dd class="dl_dd clear" item="#{_fm.firstMenuId}">
	                        	<a4j:repeat value="#{moduleSettingsHome.moduleMap.get(_fm.firstMenuId)}" var="_ms" rowKeyVar="ms_index">
	                        	<div class="setup_li col-lg-3 col-md-4 col-sm-6 col-xs-6" menu-id="#{_fm.firstMenuId},#{_ms.secondMenuId.secondMenuId}">
	                            	<div class="li_block #{_ms.secondMenuId.defaultFalg ?'li_default':'li_delete'}"  data-toggle="tooltip" title="#{_ms.secondMenuId.tipText}">
	                                	<img class="icon_img" src="#{request.contextPath}#{_ms.secondMenuId.imgUrl}" />#{_ms.secondMenuId.menuName}
	                                    <i class="icon_btn"></i>
	                                </div>	                               
	                            </div>
	                            </a4j:repeat>
	                        </dd>
	                    </dl>
                    </a4j:repeat>
                                       
                </div>
                <!-- 可选模块 -->
                <div class="module_block">
                	<div class="module_title">
                    	<h3>可选模块</h3>
                    </div>
                    <dl class="setup_item" style="padding-top:20px;" >
                        <dd class="dl_dd clear"  id="select_item">
                        	<a4j:repeat value="#{moduleSettingsHome.secondMenuList}" var="_ms">
                        		<!-- 航拍-->
                        		<s:fragment rendered="#{_ms[0] eq 29 and moduleSettingsHome.valueAddedEnterprise.aerialVideoService eq 1 or 
                        			moduleSettingsHome.valueAddedEnterprise.aerialVideoService eq 3}">
                        			<div class="setup_li col-lg-3 col-md-4 col-sm-6 col-xs-6" item="#{_ms[3]}" menu-id="#{_ms[3]},#{_ms[0]}">
		                                <div class="li_block" data-toggle="tooltip" title="#{_ms[5]}">
		                                    <img class="icon_img" src="#{request.contextPath}#{_ms[2]}" />#{_ms[1]}
		                                    <i class="icon_btn"></i>
		                                </div>
		                            </div>
                        		</s:fragment> 
                        		<!-- 四季田景 -->
                        		<s:fragment rendered="#{_ms[0] eq 28 and (moduleSettingsHome.valueAddedEnterprise.streetService eq 1 or 
                        			moduleSettingsHome.valueAddedEnterprise.streetService eq 3)}">
                        			<div class="setup_li col-lg-3 col-md-4 col-sm-6 col-xs-6" item="#{_ms[3]}" menu-id="#{_ms[3]},#{_ms[0]}">
		                                <div class="li_block" data-toggle="tooltip" title="#{_ms[5]}">
		                                    <img class="icon_img" src="#{request.contextPath}#{_ms[2]}" />#{_ms[1]}
		                                    <i class="icon_btn"></i>
		                                </div>
		                            </div>
                        		</s:fragment>
                        		<!-- 会员秀 -->
                        		<s:fragment rendered="#{_ms[0] eq 31 and (moduleSettingsHome.valueAddedEnterprise.memberShow eq 1 or 
								moduleSettingsHome.valueAddedEnterprise.memberShow eq 3)}">
                        			<div class="setup_li col-lg-3 col-md-4 col-sm-6 col-xs-6" item="#{_ms[3]}" menu-id="#{_ms[3]},#{_ms[0]}">
		                                <div class="li_block" data-toggle="tooltip" title="#{_ms[5]}">
		                                    <img class="icon_img" src="#{request.contextPath}#{_ms[2]}" />#{_ms[1]}
		                                    <i class="icon_btn"></i>
		                                </div>
		                            </div>
                        		</s:fragment>
                        		<!-- 一键购买 -->
                        		<s:fragment rendered="#{_ms[0] eq 36 and (moduleSettingsHome.valueAddedEnterprise.purchaseService eq 1 or moduleSettingsHome.valueAddedEnterprise.purchaseService eq 3)}">
                        			<div class="setup_li col-lg-3 col-md-4 col-sm-6 col-xs-6" item="#{_ms[3]}" menu-id="#{_ms[3]},#{_ms[0]}">
		                                <div class="li_block" data-toggle="tooltip" title="#{_ms[5]}">
		                                    <img class="icon_img" src="#{request.contextPath}#{_ms[2]}" />#{_ms[1]}
		                                    <i class="icon_btn"></i>
		                                </div>
		                            </div>
                        		</s:fragment>
                        		<s:fragment rendered="#{_ms[0] ne 28 and _ms[0] ne 29 and _ms[0] ne 31 and _ms[0] ne 36}">
                        			<div class="setup_li col-lg-3 col-md-4 col-sm-6 col-xs-6" item="#{_ms[3]}" menu-id="#{_ms[3]},#{_ms[0]}">
		                                <div class="li_block" data-toggle="tooltip" title="#{_ms[5]}">
		                                    <img class="icon_img" src="#{request.contextPath}#{_ms[2]}" />#{_ms[1]}
		                                    <i class="icon_btn"></i>
		                                </div>
		                            </div>
                        		</s:fragment>
                        	</a4j:repeat>                            
                        </dd>
                    </dl>
                </div>
                <h:form id="menuForm">
                	<h:inputHidden value="#{moduleSettingsHome.selectMenuIds}" id="selectMenuIds"/>
                	<div style="padding:50px 0;text-align:center;">
	                	<h:commandButton id="persist" value="保存" styleClass="btn btn-primary" onclick="if(!saveSettings())return false;" action="#{moduleSettingsHome.moduleSettings()}"/>
	                	<a href="#" class="btn btn-default">取消</a>
	                </div>
                </h:form>
                
                <!-- 模块配置主体 结束 -->
            </div>
            </div>
            </div>
            <a4j:form>
	            <a4j:jsFunction name="updateMenuHelpTips" eventsQueue="mainQueue" action="#{welComeHome.updateMenuHelpTips}">
				</a4j:jsFunction>
            </a4j:form>
            
            </td>     
            <script type="text/javascript">
          //<![CDATA[   
           function moduleInit(){
        	// (1)tooltip工具提示
				jquery("[data-toggle='tooltip']").tooltip(); 
				jquery('#select_item ').on('click','.li_block .icon_btn', function(){
					var item=jquery(this).parent().parent().attr("item");
					jquery("#setup_item_div"+item).show();
					jquery(this).parent().addClass("li_delete");
					jquery(this).parent().parent().removeAttr("item");
					jquery(this).parent().removeAttr("aria-describedby");
					jquery(".tooltip").remove();
					jquery("#setup_item [item="+item+"]").append(jquery(this).parent().parent().prop("outerHTML"));
					jquery(this).parent().parent().remove();
					jquery("[data-toggle='tooltip']").tooltip(); 
				}); 
				jquery("#setup_item").on('click','.li_delete .icon_btn', function(){	
					var item=jquery(this).parent().parent().parent().attr("item");
					jquery(this).parent().parent().attr("item",item);
					jquery(this).parent().removeClass("li_delete");
					jquery(this).parent().removeAttr("aria-describedby");
					jquery(".tooltip").remove();
					jquery("#select_item").append(jquery(this).parent().parent().prop("outerHTML"));			
					jquery(this).parent().parent().remove();
					var length=jquery("#setup_item_div"+item+" .setup_li").length;
					if(length<=0){
						jquery("#setup_item_div"+item).hide();
					}
					jquery("[data-toggle='tooltip']").tooltip(); 
				});
            }       
	        jquery(function(){						
				//新手指导
				var isAdmin =#{sessionTake.admin};
				var menuHelpTips = #{welComeHome.menuHelpTips};
				var fromPage='#{moduleSettingsHome.fromPage}'
				var showHelpMenuId='#{moduleSettingsHome.showHelpMenuId}';
				jquery('#setup_item_div'+showHelpMenuId+' .li_block').eq(0).attr("id","step3");
				var selectLength=jquery('#select_item .li_block').length;			
				
				if(fromPage=="welcome" && isAdmin && menuHelpTips){
					//可选模块没有时，只到第三步
					if(selectLength>0){
						jquery('#select_item .li_block').eq(0).attr("id","step4");
						startIntro();
					}else{
						startIntro1();
					}					
				}else{
					moduleInit();
				}
			});  
			
			function saveSettings(){
				var ids="";
				jquery("#setup_item .dl_dd .setup_li").each(function(i){
					ids+=jquery(this).attr("menu-id")+"@";
				});
				if(ids.length>0){
					ids=ids.substring(0, ids.length-1);
				}
				jquery("#menuForm\\:selectMenuIds").val(ids);
				return true;
			}
			var stepPosition='top';
			var now_step;//end时结束  其它：进入第三步
			var divHeight=jQuery("#setup_item").height();
			
			if(divHeight<260){
				stepPosition='right';
			}
			function startIntro(){
			    var intro = introJs();
			      intro.setOptions({
					showStepNumbers: !1,
					showProgress: !1,
					showBullets: !1,
					keyboardNavigation: !1,
					showButtons: !1,
					exitOnEsc: !1,
			        exitOnOverlayClick: !1,
			        scrollToElement: !0,
					tooltipClass: "introjs-tooltip-menu",
					arrowLayer:"introjs-arrow-menu",
			        steps: [
			          {
			            element: '#step3',
			            intro: "<div><img src='/asset/images/menuHelpTip/menu_help_3.png' /><div class='introjs-step3_btn'><img src='/asset/images/menuHelpTip/menu_help_btn2.png' onclick='next_step(\"pre2\");'/><img src='/asset/images/menuHelpTip/menu_help_btn3.png' onclick='next_step(\"next4\");' style='margin-left:10px;'/></div></div>",
			            position: stepPosition            
			          },
			          {
			            element: '#step4',
			            intro: "<div><img src='/asset/images/menuHelpTip/menu_help_4.png' /><div class='introjs-step4_btn'><img src='/asset/images/menuHelpTip/menu_help_btn2.png' onclick='next_step(\"pre3\");'/><img src='/asset/images/menuHelpTip/menu_help_btn4.png' onclick='next_step(\"end\");' style='margin-left:10px;'/></div></div>",
			            position: stepPosition
			          }
			        ]
			      });
			      intro.start();
			    //点击任意位置进入下一步
			      jquery(".introjs-overlay").click(function(){
			  			if(now_step=='end'){
			  				jquery(".introjs-skipbutton").click();
					    	 updateMenuHelpTips();
					    	 moduleInit();
			  	  		}else{
			  	  			jquery(".introjs-nextbutton").click();
			  	  			now_step='end';
			  	  		}
			  	  });
			  }

			function startIntro1(){
			    var intro = introJs();
			      intro.setOptions({
					showStepNumbers: !1,
					showProgress: !1,
					showBullets: !1,
					keyboardNavigation: !1,
					showButtons: !1,
					exitOnEsc: !1,
			        exitOnOverlayClick: !1,
			        scrollToElement: !0,
					tooltipClass: "introjs-tooltip-menu",
					arrowLayer:"introjs-arrow-menu",
			        steps: [
			          {
			            element: '#step3',
			            intro: "<div><img src='/asset/images/menuHelpTip/menu_help_3.png' /><div class='introjs-step3_btn'><img src='/asset/images/menuHelpTip/menu_help_btn2.png' onclick='next_step(\"pre2\");'/><img src='/asset/images/menuHelpTip/menu_help_btn4.png' onclick='next_step(\"end\");' style='margin-left:10px;'/></div></div>",
			            position: stepPosition             
			          }
			        ]
			      });
			      intro.start();
			      //点击任意位置进入下一步
			      jquery(".introjs-overlay").click(function(){
			  			if(now_step=='end'){
			  				jquery(".introjs-skipbutton").click();
					    	 updateMenuHelpTips();
					    	 moduleInit();
			  	  		}else{
			  	  			jquery(".introjs-nextbutton").click();
			  	  			now_step='end';
			  	  		}
			  	  });
			  }
			  function next_step(stepNum){
				 now_step=stepNum;
				 if(stepNum=='pre2'){
					 window.open('#{request.contextPath}#{sessionTake.urlTemp}?fromPage=module','_self');
			     }else if(stepNum=='next4'){
			    	 jquery(".introjs-nextbutton").click();
			     }else if(stepNum=='pre3'){
					 jquery(".introjs-prevbutton").click();
			     }else if(stepNum=='end'){				    	
			    	 jquery(".introjs-skipbutton").click();
			    	 updateMenuHelpTips();
			    	 moduleInit();
			     }					  
			 }
          //]]>
			</script>
	</ui:define>

</ui:composition>
