<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template_new.xhtml">

	<ui:define name="body">
	<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/checkBox/skinBlue.css"/>
	<script type="text/javascript" src="#{request.contextPath}/asset/js/checkBox/icheck.js"></script>
	<td valign="top" width="210" style=" border-right:1px solid #e1e4eb;">
	<script type="text/javascript">
		jquery = jQuery.noConflict();
		  window.onload = function () {
		    jquery('.selectpicker').selectpicker();
		  };
		</script>
	<style>
		.form-control{
			float:left;
		}
	</style>
	
	<!-- #{userHome.work()} -->
                <div class="left_c2">
                	<ul class="lt_c_ul">
                    	<li>
                        	<a href="#{request.contextPath}/user/EnterpriseInfoList.seam" ><img class="tbimg" src="#{request.contextPath}/asset/images/enterpriseInfo_10.png"/>&#160;企业管理</a>
                        </li>
                    	<li><a href="#{request.contextPath}/user/UserList.seam"  class="fon_07" ><strong><img class="tbimg" src="#{request.contextPath}/asset/images/user_17.png"/>&#160;用户管理</strong></a></li>
                    	<li><a href="#{request.contextPath}/user/EnterpriseGroupList.seam"><img class="tbimg" src="#{request.contextPath}/asset/images/en.png"/>&#160;企业组管理</a></li>
                    	<li><a href="#{request.contextPath}/user/CommunityList.seam"><img class="tbimg" src="#{request.contextPath}/asset/images/community_23.png"/>&#160;角色管理</a></li>
                    	<li>
                        	<a href="#{request.contextPath}/user/RoleList.seam"><img class="tbimg" src="#{request.contextPath}/asset/images/role.png"/>&#160;权限管理</a>
                        </li>
                        <li>
                        	<a href="#{request.contextPath}/user/AdministratorList.seam" ><img class="tbimg" src="#{request.contextPath}/asset/images/userqie.png"/>&#160;用户切换管理</a>
                        </li>
                        <li>
                        	<a href="#{request.contextPath}/user/DataDicList.seam"><img class="tbimg" src="#{request.contextPath}/asset/images/dataDic.png"/>&#160;字典管理</a>
                        </li>
                         <li>
                        	<a href="#{request.contextPath}/user/DeviceTypeList.seam"><img class="tbimg" src="#{request.contextPath}/asset/images/shebei.png"/>&#160;设备类型</a>
                        </li>
                        <li>
                        	<a href="#{request.contextPath}/user/SkinInfoList.seam" ><img class="tbimg" src="#{request.contextPath}/asset/images/pifu.png"/>&#160;皮肤管理</a>
                        </li>
                        <li>
                        	<a href="#{request.contextPath}/user/LoginMessageList.seam"><img class="tbimg" src="#{request.contextPath}/asset/images/denglu.png"/>&#160;登录统计</a>
                        </li>
                        <li>
                        	<a href="#{request.contextPath}/user/BugInfoList.seam"><img class="tbimg" src="#{request.contextPath}/asset/images/shouji.png"/>&#160;手机日志管理</a>
                        </li>
                        <li>
                        	<a href="#{request.contextPath}/system/RecycleInfoList_1.seam"><img class="tbimg" src="#{request.contextPath}/asset/images/huishouzhantupian.png"/>&#160;回收站</a>
                        </li>
                    </ul>
                	<div class="clear"></div>
                </div>
            </td>
            
            <!--右边开始-->
            <td valign="top">
            <h:form id="user">
           <!-- Modal -->
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal" class="modal fade in w600na" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="spanValue">*号部分为必填项！</span>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
      </div>
    </div>
  </div>
</div>
                <div class="right_c">
                	<div class="r_title">
                    	<div class="r_t_l"><font size="4">用户管理</font></div>
                    </div>
				<!--入库订单列表开始-->
                	<div class="all_d3">
                    	<div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">用户名：</td>
                                    <td>
                                       <h:inputText styleClass="form-control nw221" id="name" value="#{userHome.instance.name}"/>
                                       <span class="finput" style="color:#ff0000;">*</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    	<div class="all_da all_w01">
                        	<table>
                            	<tr>
                                	<td class="all_te">昵称：</td>
                                    <td><h:inputText styleClass="form-control nw221" id="nickname" value="#{userHome.instance.nickname}" />
                                    <span class="finput" style="color:#ff0000;">*</span></td>
                            	</tr>
                            </table>
                        </div>
                        <s:div styleClass="all_da all_w01" rendered="#{sessionTake.levelId eq 1}">
                        	<table width="100%">
                                <tr>
                                    <td class="all_te">用户类型：</td>
                                    <td>
                                        <h:selectOneMenu styleClass="selectpicker" id = "levelId" style="width:146px;" value="#{userHome.instance.levelId}" valueChangeListener="#{userHome.getCommunityByLevel}">
											<s:selectItems value="#{userHome.levList}" var="level" label="#{level.name}"  />
											<a4j:support event="onchange" reRender="idObj2" eventsQueue="default" ajaxSingle="true" bypassUpdates="true" data="#{userHome.levelId}" oncomplete="jquery('.selectpicker').selectpicker();showInfo(data);"/>
											<s:convertEntity />
										</h:selectOneMenu>
                                    </td>
                                </tr>
                            </table>
                        </s:div>
                        
                         <s:div styleClass="all_da all_w01" rendered="#{sessionTake.levelId eq 2}">
                        	<table width="100%">
                                <tr>
                                    <td class="all_te">用户类型：</td>
                                    <td align="left">
                                    <h:outputText value="#{userHome.enterpriseName}" />
                                    </td>
                                </tr>
                            </table>
                        </s:div>
                    	<div class="all_da all_w01">
                        	<table width="100%">
                                <tr>
                                    <td class="all_te">用户权限：</td>
                                    <td align="left">
                                    <h:panelGroup id="idObj2">
                                        <h:selectOneMenu styleClass="selectpicker" immediate="true" id="communityId" style="width:146px;" value="#{userHome.instance.fkCommunityId}">
											<s:selectItems value="#{userHome.comList}" var="community"
												label="#{community.name}"/>
											<s:convertEntity />
										</h:selectOneMenu>
									</h:panelGroup>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    	<div class="all_da all_w01" style="display: none;" id="userManager">
                        	<table width="100%">
                                <tr>
                                    <td class="all_te">管理用户组：</td>
                                    <td>
                                        <h:selectOneMenu styleClass="selectpicker" id = "enterpriseGroupId" style="width:146px;" value="#{userHome.instance.enterpriseGroupId}">
											<s:selectItems value="#{userHome.enGroupList}" var="eginfo" label="#{eginfo.name}"  />
											<s:convertEntity />
										</h:selectOneMenu>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01" style="display: none;" id = "ofEnterprise">
                        	<table width="100%">
                                <tr>
                                    <td class="all_te">所属企业：</td>
                                    <td>
                                        <h:outputText value="#{userHome.instance.enterpriseInfoId.name}" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">是否启用：<input type="hidden" name="check" value="" id="check"/></td>
                                    <td align="left" id="checkone2">
                                 	 <input type="checkbox" name="iCheck"/>
                                    <h:inputHidden id="checkHide" value="#{userHome.enable}" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                         <div style="padding: 10px 0px; font-size: 14px;">
                  		 <img id="gtdaImg" src="../asset/images/gtda_07.jpg" style="margin-bottom: 3px;cursor:pointer; width:20px;" aa="1" onclick="changeImg(this)"/>附加信息</div>
                  		 <h:panelGroup id="fujia">
	                  		 <div class="all_da all_w01">
	                        	<table>
	                                <tr>
	                                    <td class="all_te">手机号：</td>
	                                    <td>
	                                     <h:inputText id="userPhone"  value="#{userHome.instance.phone}"
							styleClass="form-control nw221" />
	                                    </td>
	                                </tr>
	                            </table>
	                        </div>
	                    	<div class="all_da all_w01">
	                        	<table>
	                                <tr>
	                                    <td class="all_te">邮箱：</td>
	                                    <td align="left"><h:inputText id="userEmail"  value="#{userHome.instance.email}"
							styleClass="form-control nw221" /></td>
	                                </tr>
	                            </table>
	                        </div>
	                        <div class="all_da all_w01" style="width:724px;">
	                        	<table>
	                                <tr>
								<td class="all_te">附注：</td>
								<td>
									<h:inputTextarea id="comment" styleClass="form-control nw420" rows="3" value="#{userHome.instance.comment}" />
	                            </td>
							</tr>
	                            </table>
	                        </div>
                        </h:panelGroup>
                        <div class="clear"></div>
                   </div>
                    
                         <table width="180" style="margin:35px auto 0 auto;">
						<tr>
							<td>
						<h:commandButton id="persist" styleClass="btn btn-primary" value="提交" action="#{userHome.persist}" rendered="#{!userHome.managed}"  onclick="return checkSubmit1()"/>
		            	<h:commandButton id="update" styleClass="btn btn-primary" value="提交" action="#{userHome.update}" rendered="#{userHome.managed}"   onclick="return checkSubmit1()"/>
		    			&#160;<s:button view="/user/UserList.xhtml" styleClass="btn btn-default" value="返回" id="bn_left6" style="margin-left:10px" >
		    					<f:param name="pageNum" value="#{userHome.pageNum}" />
		    					</s:button>
                            </td>
						</tr>
                   </table> 

				<!--入库订单列表结束-->
                    <div class="clear"></div>
                </div><!--right_c结束-->
                <div class="clear"></div>
    <!--右边结束-->
    
    </h:form>
<script type="text/javascript">
//<![CDATA[
           var m3="#{userHome.chongfu}";

           
			if(m3!="" && m3 != "0"){
				document.getElementById("spanValue").innerHTML = m3;
				   jquery("#myModal").modal('show');
			}
           che2 = function(value){
               if(value == "true"){
            	   document.getElementById("check").value="1";
               }else{
            	   document.getElementById("check").value="2";
               }
           }
           function checkInteger(obj){
     		  if(obj.value!=""){
     			var v = obj.value;
     			var reg = /^[1-9]+[0-9]*]*$/; 
     				if (!reg.test(v)){
     					return false;
     				}
     		  }
     					return true;
     		}
           function checkSubmit1(){
			   var a1 =  document.getElementById("user:name").value;
               var b1 =  document.getElementById("user:nickname").value;
				var phone = document.getElementById("user:userPhone").value;
				var email = document.getElementById("user:userEmail").value;
				var emailReg = /^([a-z0-9A-Z]+[_-|\.]?)+[a-z0-9A-Z]@([a-z0-9A-Z]+(-[a-z0-9A-Z]+)?\.)+[a-zA-Z]{2,}$/;
				var passChe1 = /^[a-zA-Z0-9]+$/;
				var passChe2 = /(^(.*\d+.*[a-zA-Z]+.*)$)|(^(.*[a-zA-Z]+.*\d+.*)$)/;
				var re= /^(13[0-9]|15[012356789]|18[0236789]|14[57])[0-9]{8}$/;
        	   if(a1==""){
        		   document.getElementById("spanValue").innerHTML = "用户名不能为空";
        		   jquery("#myModal").modal('show');return false;
        	   }else if(!passChe1.test(a1)){
        		   document.getElementById("spanValue").innerHTML = "用户名只能由字母或者数字组成!";
					jquery("#myModal").modal('show');
					return false;
					
        	   }else if(a1.length > 20){
   				document.getElementById("spanValue").innerHTML = "用户名长度不能大于20!";
				jquery("#myModal").modal('show');
				return false;
			  }
        	   if(b1==""){
        		   document.getElementById("spanValue").innerHTML = "昵称不能为空";
        		   jquery("#myModal").modal('show');return false;
        	   }
				if(phone != "" && !re.test(phone)){
					document.getElementById("spanValue").innerHTML = "请输入正确的手机号";
					jquery("#gtdaImg").attr("src","../asset/images/gtda_07.jpg");
					jquery("#gtdaImg").attr("aa","1");
					jquery("#user\\:fujia").show();
					jquery("#myModal").modal('show');
					return false;
				}
				if(email != "" && !emailReg.test(email)){
					document.getElementById("spanValue").innerHTML = "请输入正确的电子邮件地址";
					jquery("#gtdaImg").attr("src","../asset/images/gtda_07.jpg");
					jquery("#gtdaImg").attr("aa","1");
					jquery("#user\\:fujia").show();
					jquery("#myModal").modal('show');
					return false;
				}
				
		}
		 function closeMethod(){
        	   var a2 =  document.getElementById("user:name");
               var b2 =  document.getElementById("user:nickname");
				var phone = document.getElementById("user:userPhone");
				var email = document.getElementById("user:userEmail");
				var emailReg = /^([a-z0-9A-Z]+[_-|\.]?)+[a-z0-9A-Z]@([a-z0-9A-Z]+(-[a-z0-9A-Z]+)?\.)+[a-zA-Z]{2,}$/;
        	   if(a2.value==""){
        	   		a2.focus();
        	   }else if(b2.value==""){
        		   b2.focus();
        	   }else if(phone.value.length > 12){
				   phone.focus();
			   }else if(email != "" && !emailReg.test(email)){
				   email.focus();
			   }
           }
		 jquery(document).ready(function(){
			 	var enable = "#{userHome.enable}";
			 	if(enable == 1){
			 		jquery("input[name='iCheck']").iCheck("check"); 
				 	}
				jquery('input[name=iCheck]').iCheck({
				    checkboxClass: 'icheckbox_minimal-blue',
				    radioClass: 'iradio_minimal-blue',
				    increaseArea: '20%' // optional
				  });
				jquery('input[name=iCheck]').on("ifClicked", function(event){
					if(this.checked){
						jquery("#user\\:checkHide").val(0);
					}else{
						jquery("#user\\:checkHide").val(1);
					}
				});

				var obj = "#{userHome.levelId}";
				if(obj == 2){//组管理员
					jquery("#userManager").show();
					jquery("#ofEnterprise").hide();
				}else if(obj == 3){//企业管理员
					jquery("#userManager").hide();
					jquery("#ofEnterprise").show();
				}else{
					jquery("#userManager").hide();
					jquery("#ofEnterprise").hide();
				}
		});

		 function showInfo(obj){
				if(obj == 2){//组管理员
					jquery("#userManager").show();
					jquery("#ofEnterprise").hide();
				}else if(obj == 3){//企业管理员
					jquery("#userManager").hide();
					jquery("#ofEnterprise").show();
				}else{
					jquery("#userManager").hide();
					jquery("#ofEnterprise").hide();
				}
			}
		function changeImg(obj){
			if(jquery(obj).attr("aa") == "1"){
				jquery(obj).attr("src","../asset/images/gtda_08.jpg");
				jquery(obj).attr("aa","2");
				jquery("#user\\:fujia").hide();
			}else{
				jquery(obj).attr("src","../asset/images/gtda_07.jpg");
				jquery(obj).attr("aa","1");
				jquery("#user\\:fujia").show();
			}
		}
	//]]>
</script>
            </td> 
	</ui:define>

</ui:composition>
