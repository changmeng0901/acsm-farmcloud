<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	template="/layout/template_new.xhtml">

	<ui:define name="body">
	
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/user/juesegl.css"/>
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/settings/EnterpriseSettings.css" />
    <script type="text/javascript" src="#{request.contextPath}/asset/js/EnterpriseLeftMenu.js"></script>
    
	<td valign="top">
<!-- 	<a4j:status id="ajaxStatus" forceId="true" onstart="" onstop="" /> -->
	<a4j:status id="ajaxStatus" forceId="true" onstart="jquery('#login').show()" onstop="jquery('#login').hide()" />
                <div class="inbentory_file_main">
                <!--左侧二级导航 -->
                <div class="inbentory_level_wap">
                    <div class="inbentory_level">
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_rkgl"></i>基础设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/user/UpdateEnterpriseSettings.seam?enterpriseId=#{sessionTake.enterpriseInfoId}','_self')" >
                            	<i class="icon_sed"></i>企业设置                   	
                            </li>
                            <!-- 管理版和以前的版本（标准、白金...)显示 -->
                            <h:panelGroup rendered="#{sessionTake.nowVersionService.basicService.basicServiceId==10 or sessionTake.nowVersionService.basicService.serviceType eq 1}">
                            	<li class="sed_item" onclick="window.open('#{request.contextPath}/user/ModuleSettings.seam','_self')" ><i class="icon_sed"></i>模块配置</li>
                            </h:panelGroup>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/dictionary/DataDicinfoList.seam','_self')" ><i class="icon_sed"></i>字段管理</li>
                            <li class="sed_item sed_cur" onclick="window.open('#{request.contextPath}/user/EnterpriseCommunityList.seam','_self')" ><i class="icon_sed"></i>角色管理</li>
                            <s:fragment rendered="#{enterpriseInfoHome.enterpriseInfo.govState}">
	                        	<li class="sed_item" onclick="window.open('#{request.contextPath}/user/AuditInformationList.seam','_self')" ><i class="icon_sed"></i>审核信息</li>
	                        </s:fragment>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/system/RecycleInfoList_1.seam','_self')" ><i class="icon_sed"></i>回收站</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_ckgl"></i>生产管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <h:panelGroup rendered="#{s:hasRole('certification')}">
                            	<li class="sed_item" onclick="window.open('#{request.contextPath}/map/CertificationList.seam','_self')" ><i class="icon_sed"></i>认证信息</li>
                            </h:panelGroup>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/message/TunnelGroupList.seam','_self')" ><i class="icon_sed"></i>分组管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/InputsInfoList.seam?goodsTypeInfoId=5','_self')" ><i class="icon_sed"></i>投入品信息</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_zkgl"></i>销售管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/GoodsInfoList.seam','_self')"><i class="icon_sed"></i>物料信息</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/ProductInfoList.seam','_self')" ><i class="icon_sed"></i>商品信息</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_pdgl"></i>硬件管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/device/DeviceList.seam','_self')"><i class="icon_sed"></i>设备管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/device/VideoList.seam','_self')" ><i class="icon_sed"></i>视频管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/farming/AmRfidInfoList.seam','_self')" ><i class="icon_sed"></i>RFID卡管理</li>
                        </ol>
                    </div>
                    <i class="collapse_btn"></i>
                </div>
                <!--左侧二级导航 -->
				<!--右侧 -->
                <div class="inbentory_content">
		 		<div class="right_c clear" style="min-height:30px;">
                	<div class="r_title clear">
                    	<div class="r_t_l"><font size="3">角色管理</font></div>
                    </div>
                </div>   
                <!-- 公用搜索 开始 -->
                <div class="public-searchWap clear">
                     <h:form id="storageTypeSearch" style="float:left;">
                     <div class="public-search">
                        <span class="octicon-search02"></span>
                        <h:inputText id="searchStr" styleClass="form-control nw300 srarchfont" value="#{communityList.searchStr}"/>
                     </div>
<!--                    		<button class="btn btn-primary" type="button" style="height:34px;">搜索</button> -->
                      <h:commandButton id="search" styleClass="btn btn-primary" value="搜索" action="/user/EnterpriseCommunityList.xhtml">                                	
	                    </h:commandButton>
                    </h:form>
                  
                    <a class="btn btn-success fr" data-toggle="modal" data-target="#myModal_cjjs"  href="#" onclick="addView();" >创建角色</a>
                    <a class="btn-success2" data-toggle="modal" data-target="#myModal_cjjs"  ></a>
                </div>
                <!-- 公用搜索 结束 -->
                
              <a4j:outputPanel id="showPanel" style="margin:0; border:none; padding: 0;">
               
              <!-- 角色管理 开始 -->
                <div class="right_c mt20 clear">
                <table class="ze_table" width="100%" cellpadding="0" cellspacing="0">
                <tr class="alt">
                    <td height="4" width="5"><img src="#{request.contextPath}/asset/images/table_d_40.jpg" height="4" width="5" /></td>
                    <td colspan="4" style="border-top:1px solid #e1e1e1; background:#f0f5fb;"></td>
                    <td height="4" width="5"><img src="#{request.contextPath}/asset/images/table_d_43.jpg" height="4" width="5" /></td>
                </tr>
                <tr class="">
                 <th class="ze_bg ze_bt_le" height="4" width="5"></th>
                    <th class="ze_bg" width="15%">角色ID</th>
                    <th class="ze_bg" width="30%">角色名称</th>
                    <th class="ze_bg" width="35%">描述</th>
                    <th class="ze_bg" width="20%">操作</th>
                    <th class="ze_bg ze_bt_ri" height="4" width="5"></th>
                </tr>
                <ui:repeat value="#{communityList.resultList}" var="_community" rendered="#{not empty communityList.resultList}" rowKeyVar="_index">
                <tr class="alt">
                    <td class="ze_bg2 ze_bt_le" height="4" width="5"></td>
                    <td class="ze_bg2"><h:outputText value="#{_community.communityId}"/></td>
                    <td class="ze_bg2">#{_community.name}</td>
                    <td class="ze_bg2"><h:outputText value="#{stringUtil.shortString(_community.description,25)}"/></td>                  		
                    <td class="ze_bg2">
             			<s:link propagation="none"  view="/#{empty from ? 'user/EnterpriseCommunityRole' : from}.xhtml" styleClass="list_view"  title="查看" id="communityViewId">
							<f:param name="communityId2" value="#{_community.communityId}" />
							<f:param name="pageNum" value="#{communityList.pageNum}" />
						</s:link>&#160;
						<ui:fragment rendered ="#{empty from}">
						   <a class="list_edit" id="communityEdit"  title="编辑"  onclick="editView('#{_community.communityId}','#{_community.name}','#{_community.farmerTypeId.levelId}','#{_community.description}');" ></a>
						</ui:fragment>
                         &#160;
						<s:link propagation="none"  view="/user/EnterpriseCommunityRoleEdit.xhtml"  styleClass="list_edit4"   title="分配权限">			
				          	<f:param name="communityId2" value="#{_community.communityId}" />
				            <f:param name="pageNum" value="#{communityList.pageNum}" />
	                    </s:link>&#160;
	                    <ui:fragment rendered ="#{empty from}">
						   <a class="list_delete" id="communityDelete"  title="删除"  onclick="return removeCheck('#{_community.communityId}','#{communityList.pageNum}');" ></a>
						</ui:fragment>
<!-- 						<s:link propagation="none"   styleClass="list_delete"  title="删除" onclick="return removeCheck('#{_community.communityId}','#{communityList.pageNum}');" id="communityDelete" rendered="#{empty from}" /> -->
                    </td>
                    <td class="ze_bg2 ze_bt_ri" height="4" width="5"></td>
                </tr>  
                </ui:repeat>
                </table>
                </div>
                <!-- 角色管理 结束 -->
                 <!--翻页开始-->
                    <table style="height:30px; margin:40px auto 0 auto;" cellpadding="0" cellspacing="0">
                    	<tr>
                    	<ui:fragment rendered="#{not empty communityList.resultList}">
			               <ui:fragment rendered="#{!communityList.previousExists }">
			                <td><img src="#{request.contextPath}/asset/images/page_68.jpg" width="4" height="30" /></td>
			                </ui:fragment>
			                <ui:fragment rendered="#{communityList.previousExists }">
			                <td><img src="#{request.contextPath}/asset/images/page_67.jpg" width="4" height="30" /></td>
			               	</ui:fragment>
			                <ui:fragment rendered="#{communityList.previousExists }">
	                            <td class="td_t_b">
		                            <s:link propagation="none"  view="/user/EnterpriseCommunityList.xhtml" >首页
		                            	<f:param name="pageNum" value="0" />
		                            </s:link>
	                            </td>
	                            <td class="td_t_b td_t_t" style="padding:0; width:30px;">
		                            <s:link propagation="none"  view="/user/EnterpriseCommunityList.xhtml"  styleClass="no_n" >
		                            	<f:param name="pageNum" value="#{communityList.previousFirstResult}"/>&lt;
		                            </s:link>
	                            </td>
	                        </ui:fragment>
					       <a4j:repeat var="_page" value="#{communityList.pageList}" rowKeyVar="_index">
								<td class="td_t_b #{communityList.previousExists or _index >0 ?'td_t_t':''} #{_page eq communityList.pageNum?'onp':''}">
									<s:link propagation="none"  view="/user/EnterpriseCommunityList.xhtml" value="#{_page}" id="previousPage">
										<f:param name="pageNum" value="#{_page}" />
									</s:link>
								</td>
							</a4j:repeat>
							<ui:fragment rendered="#{communityList.nextExists}">
                            <td class="td_t_b td_t_t">
	                            <s:link propagation="none"  view="/user/EnterpriseCommunityList.xhtml"   styleClass="no_d" >
	                            	<f:param name="pageNum" value="#{communityList.nextFirstResult}" />&gt;
	                            </s:link>
                            </td>
                            <td class="td_t_b td_t_t">
								 <s:link propagation="none"  view="/user/EnterpriseCommunityList.xhtml" >尾页
								 	<f:param name="pageNum" value="#{communityList.PAGE_COUNT}" />
								 </s:link>
							</td>
							</ui:fragment>
							<td class="td_t_b td_t_t" style=" color:#9a9a9c;">共#{communityList.PAGE_COUNT}页</td>
                            <td ><img src="#{request.contextPath}/asset/images/page_70.jpg" width="4" height="30" /></td>
                         </ui:fragment>
                    	</tr>
                    </table>
                    <!--翻页结束-->
                    </a4j:outputPanel>
                   
                
<!-- 创建角色模态框 开始 -->
<div class="modal fade" id="myModal_cjjs" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-dialog" style="width:540px;">
<h:form id="user">
<div class="modal-content">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"></button>
        <h4 class="modal-title" id="myModalLabel">创建角色</h4>
    </div>
    <a4j:outputPanel id="showPanel2" style="margin:0; border:none; padding: 0;">
    <div class="modal-body" style="padding:20px 0 0;">
    	<table class="modalTable_minni" width="100%" cellpadding="0" cellspacing="0">
        	<tr>
        		
            	<td class="pr10" width="110" align="right">角色名称</td>
                <td width="262">
                	<span class="bootSelt21">
                   <h:inputText  styleClass="form-control" id="name" value="" required="true" />
                   <input type="text" id="idHidden" style="display: none" />
                    </span>
                </td>
            </tr>
            <tr id="communityIdCopy_tr">
            	<td class="pr10" width="110" align="right">复制角色</td>
                <td width="262">
<!--                 #{communityHome.getCommunitySelecTiems()} -->
                	<span class="bootSelt21">
	                    <select id="communityIdCopy" name="communityIdCopy"  data-live-search="true"  class="selectpicker" >
	                    	<option value="0">无</option>
							<a4j:repeat value="#{communityHome.cl}" var="_var">
								<option value="#{_var.communityId}">#{_var.name}</option>
							</a4j:repeat>
						</select>
                    </span>
                </td>
            </tr>
            <tr id="levelId_tr">
            	<td class="pr10" width="110" align="right">用户类型</td>
                <td width="262">
<!--                 	  #{communityHome.getLevelSelectItems()}  -->
                	<span class="bootSelt21">
	                    <select id="levelId" name="levelId"   class="selectpicker"  >
							<a4j:repeat value="#{communityHome.leveList}" var="_var" rowKeyVar="_index">
									<option value="#{_var.levelId}" >#{_var.name}</option> -->
							</a4j:repeat>
						</select>
                    </span>
                </td>
            </tr>
            <tr>
            	<td class="pr10" width="110" align="right">角色描述</td>
                <td>
                	<span class="bootTextarea">
                		<h:inputTextarea id="description"  styleClass="form-control area_textarea" rows="3"  value=""/>
                	</span>
                </td>
            </tr>
        </table>     
    </div>
    </a4j:outputPanel>
    <div class="modal-footer">
    	<input type="button" id="ajaxSavebt" class="btn btn-primary" value="提交" onclick="if(!checkSubmit())return false;" />
        <a class="btn btn-default" id="btn-default" data-dismiss="modal">返回</a>
    </div>
</div>
</h:form>
</div>
</div>
<!--  创建角色模态框 结束 -->
<a4j:form>
	<a4j:queue requestDelay="100" ignoreDupResponses="true"/>
	<a4j:jsFunction status="ajaxStatus"  name="ajaxSave"  action="#{communityHome.mySave()}" reRender="showPanel,showPanel2"  data="#{communityHome.chongfu}"  oncomplete="complenteAction(data);" >
		<a4j:actionparam name="name" assignTo="#{communityHome.name2}"/>
		<a4j:actionparam name="communityIdCopy" assignTo="#{communityHome.communityIdCopy}"/>
		<a4j:actionparam name="levelId" assignTo="#{communityHome.levelId}"/>
		<a4j:actionparam name="description2" assignTo="#{communityHome.description2}"/>
	</a4j:jsFunction>
	
	<a4j:jsFunction status="ajaxStatus" name="ajaxEdit" action="#{communityHome.myUpdate()}" reRender="showPanel,showPanel2" data="#{communityHome.chongfu}"  oncomplete="complenteAction(data);" >
		<a4j:actionparam name="id" assignTo="#{communityHome.communityId2}"/>
		<a4j:actionparam name="name" assignTo="#{communityHome.name2}"/>
		<a4j:actionparam name="description2" assignTo="#{communityHome.description2}"/>
	</a4j:jsFunction>
	
	<a4j:jsFunction status="ajaxStatus" name="ajaxRemove" action="#{communityHome.myRemove()}" reRender="showPanel,showPanel2" data="#{communityHome.chongfu}"  oncomplete="complenteAction(data);" >
		<a4j:actionparam name="id" assignTo="#{communityHome.communityId2}"/>
		<a4j:actionparam name="page" assignTo="#{communityHome.pageNum}"/>
	</a4j:jsFunction>
	<a4j:jsFunction status="ajaxStatus" name="checkUsed" action="#{communityHome.checkUsed()}" data="#{communityHome.showMessage}"  oncomplete="confirmRemove(data)" >
		<a4j:actionparam name="id" assignTo="#{communityHome.communityId2}"/>
	</a4j:jsFunction>
</a4j:form> 
</div>
</div>
</td>

<script type="text/javascript">
//<![CDATA[
jQuery = jQuery.noConflict();
jQuery(function(){
	//下拉框
	jQuery('.selectpicker').selectpicker();
	var searchStr = jQuery("#storageTypeSearch\\:searchStr").val();
	if(searchStr == null || searchStr == ""){
		jQuery("#storageTypeSearch\\:searchStr").val("请输入搜索条件");
		jQuery("#storageTypeSearch\\:searchStr").css("color","#a8a8a8");
	}else if(searchStr == "请输入搜索条件"){
		jQuery("#storageTypeSearch\\:searchStr").css("color","#a8a8a8");
	}else{
		jQuery("#storageTypeSearch\\:searchStr").css("color","#000");
	}
	 
	//隔行换色
	jQuery(".ze_table tr,.tr_tab_b tr").not(".nottt").mouseover(function(){  //如果鼠标移到class为stripe的表格的tr上时，执行函数
		jQuery(this).addClass("over");
	})
	jQuery(".ze_table tr,.tr_tab_b tr").not(".nottt").mouseout(function(){  //给这行添加class值为over，并且当鼠标一出该行时执行函数
		jQuery(this).removeClass("over");
	})  //移除该行的class
	jQuery(".ze_table tr:even,.tr_tab_b tr:even").not(".nottt").addClass("alt");
	
	//文本控制
	jQuery('.public-searchWap input[type=text]').not('input[readonly]').focus(function(){
		var txt_value = jQuery(this).val();
		if(txt_value=="请输入搜索条件"){
			jQuery(this).val("");	
			jQuery(this).css("color","#000");
		};	
	});
	jQuery('input[type=text]').blur(function(){
		var txt_value = jQuery(this).val();
		if(txt_value==""){
			jQuery(this).val("请输入搜索条件");	
			jQuery(this).css("color","#a8a8a8");
		};	
	});	
});


function trim(str){
   	return str.replace(/(^\s+)|\s+$/g,"");
 }
function checkSubmit(){
	   var id = document.getElementById("idHidden").value;
	   var name = document.getElementById("user:name").value;
	   var communityIdCopy = jQuery("#communityIdCopy").val();
	   var levelId =  jQuery("#levelId").val();
	   var description =  document.getElementById("user:description").value;
// 	   alert(id + "=" + communityIdCopy + " = " + description + "= " + levelId);
	   if(trim(name)==""){
		   alert("角色名称不能为空!");
		   return false;
	   }
	   if(id == ""){
		   ajaxSave(name,communityIdCopy,levelId,description);
	   }else{
		   ajaxEdit(id,name,description);
	   }
	   return true;
	   
}

function complenteAction(data){
	//下拉框
	jQuery('.selectpicker').selectpicker();
	
	if(data != null & data != ""){
		alert(data);
	}else{
		jQuery("#btn-default").click();
	}
// 	location = location;
}
var cid;
var cpage;

function confirmRemove(data){
	if(""!=data && null!=data){
		alert("已有人员使用此角色，不能删除!");
	}else{
		ajaxRemove(cid,cpage);
	}
}

function removeCheck(id,page){
	cid=id;
	cpage=page;
	var re = confirm('确定删除吗？');
	if(re){
		//ajaxRemove(id,page);
		checkUsed(id);
	}
	return re;
}
function addView(){
	 jQuery("#communityIdCopy_tr").show();
	 jQuery("#levelId_tr").show();
	 document.getElementById("idHidden").value = "";
     document.getElementById("user:name").value = "";
	 jQuery("#communityIdCopy").selectpicker("val",0);
// 	 jQuery("#levelId").selectpicker("val",0);	
	 document.getElementById("user:description").value = "";	
}

function editView(id,name,level,des){
	jQuery("#communityIdCopy_tr").hide();
	 jQuery("#levelId_tr").hide();
	document.getElementById("idHidden").value = id;
	document.getElementById("user:name").value = name;
   jQuery("#communityIdCopy").selectpicker("val",0);
   jQuery("#levelId").selectpicker("val",level);	
   document.getElementById("user:description").value = des;	
   jQuery(".btn-success2").click();
}
//]]>
</script>
	<style type="">
	.public-searchWap .form-control{padding-left: 10px;}
	.list_edit4{width:15px;height:11px;}
	.dr-pnl-b{font-family:'微软雅黑';color:rgb(108, 106, 107);font-size: 13px;}
	.modal-header h4{font-family:'微软雅黑';}
/* 	.right_c{padding-left: 20px;padding-right:20px;} */
	</style>


	</ui:define>

</ui:composition>
