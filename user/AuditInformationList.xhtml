<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	template="/layout/template_new.xhtml">
	<ui:define name="body">
		<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/user/review.css"/>
		<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/commons/commons.css"/>
	    <link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/settings/EnterpriseSettings.css" />
		<script type="text/javascript" src="#{request.contextPath}/asset/js/EnterpriseLeftMenu.js"></script>
		<!-- #{resumeExamineHome.begin()} 
		-->
		
		<td valign="top">
		<div class="inbentory_file_main">
            <!-- 企业设置左侧二级导航 -->
            <div class="inbentory_level_wap">
                <div class="inbentory_level">
                    <strong class="inben_first inben_first2">
                        <a href="javascript:;"><i class="icon_L icon_rkgl"></i>基础设置</a><b class="b_arrow"></b>
                    </strong>
                    <ol class="inben_second">
                        <li class="sed_item" onclick="window.open('#{request.contextPath}/user/UpdateEnterpriseSettings.seam?enterpriseId=#{sessionTake.enterpriseInfoId}','_self')" >
                        	<i class="icon_sed"></i>企业设置                   	
                        </li>
                        <!-- 管理版和以前的版本（标准、白金...)显示 -->
                        <h:panelGroup rendered="#{sessionTake.nowVersionService.basicService.basicServiceId==10 or sessionTake.nowVersionService.basicService.serviceType eq 1}">
                        	<li class="sed_item" onclick="window.open('#{request.contextPath}/user/ModuleSettings.seam','_self')" ><i class="icon_sed"></i>模块配置</li>                          
                        </h:panelGroup>
                        <li class="sed_item" onclick="window.open('#{request.contextPath}/dictionary/DataDicinfoList.seam','_self')" ><i class="icon_sed"></i>字段管理</li>
                        <li class="sed_item" onclick="window.open('#{request.contextPath}/user/EnterpriseCommunityList.seam','_self')" ><i class="icon_sed"></i>角色管理</li>
                        <s:fragment rendered="#{enterpriseInfoHome.enterpriseInfo.govState}">
                        	<li class="sed_item sed_cur" onclick="window.open('#{request.contextPath}/user/AuditInformationList.seam','_self')" ><i class="icon_sed"></i>审核信息</li>
                        </s:fragment>
                        <li class="sed_item" onclick="window.open('#{request.contextPath}/system/RecycleInfoList_1.seam','_self')" ><i class="icon_sed"></i>回收站</li>
                    </ol>
                    <strong class="inben_first inben_first2">
                        <a href="javascript:;"><i class="icon_L icon_ckgl"></i>生产管理设置</a><b class="b_arrow"></b>
                    </strong>
                    <ol class="inben_second">                      	
                        <h:panelGroup rendered="#{s:hasRole('certification')}">
                        	<li class="sed_item" onclick="window.open('#{request.contextPath}/map/CertificationList.seam','_self')" ><i class="icon_sed"></i>认证信息</li>
                        </h:panelGroup>
                        <li class="sed_item" onclick="window.open('#{request.contextPath}/message/TunnelGroupList.seam','_self')" ><i class="icon_sed"></i>分组管理</li>
                        <li class="sed_item" onclick="window.open('#{request.contextPath}/product/InputsInfoList.seam?goodsTypeInfoId=5','_self')" ><i class="icon_sed"></i>投入品信息</li>                           
                    </ol>
                    <strong class="inben_first inben_first2">
                        <a href="javascript:;"><i class="icon_L icon_zkgl"></i>销售管理设置</a><b class="b_arrow"></b>
                    </strong>
                    <ol class="inben_second">
                        <li class="sed_item" onclick="window.open('#{request.contextPath}/product/GoodsInfoList.seam','_self')"><i class="icon_sed"></i>物料信息</li>
                        <li class="sed_item" onclick="window.open('#{request.contextPath}/product/ProductInfoList.seam','_self')" ><i class="icon_sed"></i>商品信息</li>
                    </ol>
                    <strong class="inben_first inben_first2">
                        <a href="javascript:;"><i class="icon_L icon_pdgl"></i>硬件管理设置</a><b class="b_arrow"></b>
                    </strong>
                    <ol class="inben_second">
                        <li class="sed_item" onclick="window.open('#{request.contextPath}/device/DeviceList.seam','_self')"><i class="icon_sed"></i>设备管理</li>
                        <li class="sed_item" onclick="window.open('#{request.contextPath}/device/VideoList.seam','_self')" ><i class="icon_sed"></i>视频管理</li>
                        <li class="sed_item" onclick="window.open('#{request.contextPath}/farming/AmRfidInfoList.seam','_self')" ><i class="icon_sed"></i>RFID卡管理</li>
                    </ol>
                </div>
                <i class="collapse_btn"></i>
            </div>
            <!-- 企业设置左侧二级导航 -->
			<!-- 企业设置右侧 -->
            <div class="inbentory_content">
        	<div class="right_c" style="min-height:30px; padding-bottom:15px; padding-top:15px;">
                <!-- 面包屑导航 开始 -->
                <div class="r_title clear" style="margin:15px 0 25px;">
                    <div class="r_t_l fl"><font size="3">审核信息</font></div>   
                </div>
                <!-- 内容 开始 -->
                <input type="hidden" value="#{resumeExamineHome.changeType}" id="changeType"/>
                <ul class="nav nav-tabs review" role="tablist" id="myTab">
                	<li class="#{resumeExamineHome.changeType eq 1?'active':'' }" onclick="change(1)"><a href="#home" role="tab" data-toggle="tab" class="icon1">经营许可证</a></li>
                	<li class="#{resumeExamineHome.changeType eq 3?'active':'' }" style="display:#{resumeExamineHome.entApplyFlag?'':'none'}" onclick="change(3)"><a href="#messages" role="tab" data-toggle="tab" class="icon3">履历数量申请</a></li>
                </ul>
                
                <div class="tab-content">
                	<div class="tab-pane #{resumeExamineHome.changeType eq 1?'active':'' } " id="home">
                	<s:div id="enterpriseBasicInformation">
                		<h:outputText rendered="#{resumeExamineHome.entState eq 1}">
                    	<a href="#{request.contextPath}/user/BusinessLicenses.seam" class="btn btn-success fr mt15 mb15">添加申请</a>
                    	</h:outputText>
                    	<h:outputText rendered="#{resumeExamineHome.entState eq 2}">
                        <button type="button" class="btn btn-success fr mt15 mb15" onclick="alert('您有等待审核的申请，不可再次申请！');">添加申请</button> 
                        </h:outputText>
                       
                        <table class="tableModel" width="100%" cellpadding="0" cellspacing="0">
                        	<thead>
	                            <tr>
	                                <th width="10%">申请负责人</th>
	                                <th width="10%">申请日期</th>
	                                <th width="20%">审核机关</th>
	                                <th width="10%">审核人</th>  
	                                <th width="20%">审核日期</th> 
	                                <th width="10%">有效期至</th>   
	                                <th width="10%">审核状态</th>  
	                                <th width="10%">操作</th>
	                            </tr>
                            </thead>
                            <tbody>
                            <a4j:repeat value="#{resumeExamineHome.enterpriseBasicInformations}" var="_var" rowKeyVar="_index">
	                            <tr>
	                                <td>#{_var.principal}</td> 
	                                <td>#{_var.time}</td>
	                                <td>#{_var.auditInstitutions eq null ? '--' : _var.auditInstitutions}</td>
	                                <td>#{_var.audutPerson eq null ? '--' : _var.audutPerson}</td>
	                                <td>#{_var.audutTime eq null ? '--' : _var.audutTimeString}</td>
	                                <td class="#{_var.type eq 1 ? 'red':''}">#{_var.validityPeriod eq null ? '--' : _var.validityPeriodString}</td>
	                                <td class="#{_var.state eq 1 ? 'green':''}">
	                                	<h:outputText value="待审核" rendered="#{_var.state eq 0}" />
	                                	<h:outputText value="已通过" rendered="#{_var.state eq 1}" />
	                                	<h:outputText value="已驳回" rendered="#{_var.state eq 2}" />
	                                	<h:outputText value="--" rendered="#{_var.state eq null or _var.state eq ''}" />
	                                </td>
	                                <td>
			                            <s:link propagation="none" view="/user/BusinessLicensesShow.xhtml" id="show" title="查看" styleClass="list_view">
										<f:param name="entBasicId" value="#{_var.id}" />
										</s:link>
										<h:outputText rendered="#{_var.state eq 2}" >
										<s:link propagation="none" view="/user/BusinessLicenses.xhtml" id="edit" title="编辑" styleClass="list_edit">
										<f:param name="entBasicId" value="#{_var.id}" />
										</s:link>
										<a onclick="LicensesDeletes('#{_var.id}')" style="cursor:pointer;" title="删除" class="list_delete"></a>
	                                    </h:outputText>
	                                    <h:outputText rendered="#{_var.type eq 1}" >
	                                    <img src="#{request.contextPath}/asset/images/map/seal.png" class="seal"/>
	                                    </h:outputText>
	                                </td>
	                            </tr>
	                        </a4j:repeat>
                            </tbody>
                        </table>
                        </s:div>
					</div>
                  <div class="tab-pane #{resumeExamineHome.changeType eq 3?'active':'' }" id="messages">
                        <h:panelGroup id="resumeList">
                        <span type="button" class="btn btn-success fr mt15 mb15" onclick="resumeOpenSave('#{resumeExamineHome.countNumbers}','#{resumeExamineHome.resumeFlag}')">添加申请</span>
                         <table class="tableModel" width="100%" cellpadding="0" cellspacing="0">
                            <thead>
	                            <tr>
	                                <th width="10%">序号</th>
	                                <th width="14%">申请日期</th>
	                                <th width="21%">申请张数</th>
	                                <th width="10%">审核状态</th>  
	                                <th width="20%">通过张数</th> 
	                                <th width="15%">剩余可用张数</th>    
	                                <th width="10%">操作</th>
	                            </tr>
                            </thead>
                            <tbody>
                            	<a4j:repeat value="#{resumeExamineHome.resultList}" var="_var" rowKeyVar="_index">
		                            <tr>
		                                <td>#{_var.id}</td> 
		                                <td>
			                                <h:inputText  id="buyTime" styleClass="new_time" value="#{_var.insertTime}" style="text-align:center;">
									    		<f:convertDateTime  pattern="yyyy-MM-dd" timeZone="GMT+8" />
									    	</h:inputText>
		                                </td>
		                                <td>#{_var.applyNumber}</td>
		                                <td>#{_var.state==0?'等待审核':''}#{_var.state==1?'审核通过':''}#{_var.state==2?'驳回申请':''}</td>
		                                <td>
			                                <h:panelGroup rendered="#{_var.state==0}">--</h:panelGroup>
			                                <h:panelGroup rendered="#{_var.state!=0}">#{_var.adoptNumber}</h:panelGroup>
		                                </td>
		                                <td>
			                                <h:panelGroup rendered="#{_var.state==0}">--</h:panelGroup>
			                                <h:panelGroup rendered="#{_var.state!=0}">#{_var.surplusNumber}</h:panelGroup>
		                                </td>
		                                <td>
		                               	 	<h:panelGroup rendered="#{_var.state==1}">
			                                    <a onclick="remarks('#{_var.state}','#{_var.adoptNumber}','#{_var.returnExplain}')" style="cursor:pointer;"><img width="16" height="15" src="#{request.contextPath}/asset/images/cz.png"/></a>
		                               	 	</h:panelGroup>
		                               	 	<h:panelGroup rendered="#{_var.state==2}">
		                               	 	   	<a onclick="resumeOpenEdit('#{_var.id}','#{_var.applyNumber}','#{_var.applyExplain}')" style="cursor:pointer;" class="list_edit"></a>
	                                     		<a onclick="resumeDelete('#{_var.id}')" style="cursor:pointer;"  class="list_delete"></a>
		                               	 	</h:panelGroup>
		                                </td>
		                            </tr>
		                		</a4j:repeat>
                            </tbody>
                        </table>
		                </h:panelGroup>
					</div>
				</div>
                <!-- 履历查看备注 弹窗-->
                <div class="modal fade" id="noteView" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                	<div class="modal-dialog notePop">
                    	<div class="modal-content">
                      		<div class="modal-header">
		                        <button type="button" class="close" data-dismiss="modal" style="margin-top:0;"><span aria-hidden="true" style="color: #d8d6d8;">&times;</span></button>
		                        <h4 class="modal-title" id="myModalLabel" style='font-family:"微软雅黑";font-weight:bold;'>查看备注</h4>
	                      	</div>
	                      	<div class="modal-body">
	                       		<p class="apply1"><span>审批通过张数： </span><span>5000</span>张</p> 
	                       		<p class="apply2"><span>说明：</span><span>10000050000张暂时足够使用，用尽后请再次申请.</span></p>
	                      	</div>
						</div>
                  	</div>
				</div>
                <!-- 履历查添加申请 弹窗-->
                <div class="modal fade" id="addApply" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                	<div class="modal-dialog addPop">
                    	<div class="modal-content">
                      		<div class="modal-header">
		                        <button type="button" class="close" data-dismiss="modal" style="margin-top:0;"><span aria-hidden="true" style="color: #d8d6d8;">&times;</span></button>
		                        <h4 class="modal-title" id="myModalLabel" style='font-family:"微软雅黑";font-weight:bold;'>添加申请</h4>
                      		</div>
                      		<div class="modal-body">
	                        	<div class="clear" style="padding:10px 0;">
	                            	<span class="fl former">申请张数</span>
	                              	<input type="text" class="form-control fl nw210"/>
	                          	</div>
	                          	<div class="clear" style="padding:10px 0;">
	                              	<span class="fl former">说明</span>
	                              	<textarea class="form-control nw300 fl" rows="3"></textarea>
	                          	</div>
	                          	<h:inputHidden value="" id="prid"/>
                      		</div>
                      		<div class="modal-footer" style="text-align:center; border-top: 0;">
                        		<button type="button" class="btn btn-success" onclick="resumeSave()">提交申请</button>
                        		<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                      		</div>
                    	</div>
                  	</div>
				</div>
                <!-- 内容 结束 -->
			</div>
			</div>
			</div>
		</td> 
		<a4j:form>
		 	<a4j:jsFunction name="resumetosave" action="#{resumeExamineHome.reSave}" reRender="resumeList" oncomplete="resumeCallback()">
		 		<a4j:actionparam name="reId" assignTo="#{resumeExamineHome.reId}"/>
				<a4j:actionparam name="numbers" assignTo="#{resumeExamineHome.numbers}"/>
				<a4j:actionparam name="explain" assignTo="#{resumeExamineHome.explain}"/>
			</a4j:jsFunction>
			<a4j:jsFunction name="resumetodelete" action="#{resumeExamineHome.reDelete}" reRender="resumeList" oncomplete="resumeCallback()">
		 		<a4j:actionparam name="reId" assignTo="#{resumeExamineHome.reId}"/>
			</a4j:jsFunction>
			<a4j:jsFunction name="licensesDel" action="#{resumeExamineHome.deletedLicense()}" reRender="enterpriseBasicInformation" >
		 		<a4j:actionparam name="entBasicId" assignTo="#{resumeExamineHome.entBasicId}"/>
			</a4j:jsFunction>
			<a4j:jsFunction name="seedReportDel" action="#{resumeExamineHome.deletedSeedReport()}" reRender="seedReport" >
		 		<a4j:actionparam name="seedInfoId" assignTo="#{resumeExamineHome.seedInfoId}"/>
			</a4j:jsFunction>
		</a4j:form>
		<script>
		//<![CDATA[
			function LicensesDeletes(id){
				if(confirm('确定删除吗？')){
					licensesDel(id);
				}
			}
			function LicensesDelete(id){
				if(confirm('确定删除吗？')){
					seedReportDel(id);
				}
			}
			//查看备注
			function remarks(state,numbers,returnExplain){
				jquery('#noteView .apply1').find('span').eq(1).text(numbers);
				jquery('#noteView .apply2').find('span').eq(1).text(returnExplain);
				jquery('#noteView').modal('show');
			}

			//履历申请保存
			function resumeSave(){
				var reg=/^[0-9]*[1-9][0-9]*$/;
				var num=jquery('#addApply .nw210').val();
				var explain=jquery('#addApply .nw300').val();
				var flag=true;
				if(!reg.test(num) || num>1000000 || num==0){
					flag=false;
					alert("申请张数为大于0小于1000000的正整数！");
				}

				if(explain.length>100){
					flag=false;
					alert("说明不能大于100字！");
				}

				if(flag){
					if(jquery('#prid').val()==""){
						resumetosave(0,num,explain);
					}else{
						resumetosave(jquery('#prid').val(),num,explain);
					}
				}
			}

			//弹出履历添加申请框
			function resumeOpenSave(numbers,flag){
				if(numbers!=0){
					alert("您有履历还未使用完，请全部使用后再申请！");
				}else if(flag==2){
					alert("您有待审核或驳回的申请，请编辑或重新添加申请！");
				}else{
					jquery('#addApply .nw210').val("");
					jquery('#addApply .nw300').val("");
					jquery('#prid').val("")
					jquery('#addApply').modal('show');
				}
			}

			//弹出履历修改申请框
			function resumeOpenEdit(id,numbers,returnExplain){
				jquery('#addApply .nw210').val(numbers);
				jquery('#addApply .nw300').val(returnExplain);
				jquery('#prid').val(id)
				jquery('#addApply').modal('show');
			}
			
			//履历申请回调
			function resumeCallback(){
				jquery('#addApply').modal('hide');
				jquery('#prid').val("");
			}

			//履历删除
			function resumeDelete(id){
				if(confirm('确定删除吗？')){
					resumetodelete(id)
				}
			}
			function change(id){
				jquery('#changeType').val(id);
			}
		//]]>
		</script>
	</ui:define>
</ui:composition>
