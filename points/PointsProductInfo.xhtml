<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j"
    template="/layout/template_new.xhtml">

<ui:define name="body">

<link rel="stylesheet" href="#{request.contextPath}/asset/css/points/detail.css" type="text/css" />


<td valign="top">
    <!--右边开始-->
    <div class="right_c clear">
        <!-- 面包屑导航 开始 -->
        <div class="r_title clear">
            <div class="r_t_l fl"><a href="#{request.contextPath}#{sessionTake.urlTemp}">个人主页</a><span style="padding:0 5px;">&gt;</span><a href="#{request.contextPath}/points/PointsProductInfoList.seam">积分商城</a><span style="padding:0 5px;">&gt;</span><font size="3">#{pointsProductInfoHome.instance.name}</font></div>
            <div class="fr"><img src="#{request.contextPath}/asset/images/points/no6.png" style="padding-right:10px; padding-bottom:3px;"/>可用积分<span style="color:#ff5000; padding-left:10px;" class="kyjf">#{pointsProductInfoHome.allPoints}</span></div>
        </div>
        <!-- 面包屑导航 结束 -->
        <!-- 商品详情内容 开始 -->
        <div class="clear" style="padding:15px 0">
            <table width="100%" cellpadding="0" cellspacing="0">
                <tr>
                    <td width="312">
                        <div class="detailL">
                        <div class="pic">
                        	<h:panelGroup rendered="#{pointsProductInfoHome.instance.productImages !=null &amp;&amp; pointsProductInfoHome.instance.productImages !=''}">                             
                            	<img src="#{pointsProductInfoHome.instance.productImages.split(',')[0]}" style="padding-left: 1px;padding-top:1px;" width="311px" height="267px"/>
                            </h:panelGroup>
                        </div>
                        <div class="carousel">
                           <h:panelGroup rendered="#{pointsProductInfoHome.instance.productImages !=null &amp;&amp; pointsProductInfoHome.instance.productImages !=''}">                             
	                       	 <ul class="imagesList">
	                           	<a4j:repeat value="#{pointsProductInfoHome.instance.productImages.split(',')}" var="img" rowKeyVar="_index">
	                               <li><img src="#{img}" /></li>
	                            </a4j:repeat>
	                           </ul>
	                       </h:panelGroup>
                        </div>
                        <div class="btns">
                            <a href="javascript:void(0);" class="leftBtn"></a>
                            <a href="javascript:void(0);" class="rightBtn"></a>
                        </div>
                        </div>
                    </td>
                    <td style="padding-left:30px; vertical-align: top;">
                        <div class="detailC">
                            <h4>#{pointsProductInfoHome.instance.name}#{pointsProductInfoHome.instance.productParams}</h4>
                            <p><span class="c64">商品编号&#160;&#160;</span><span class="spbh">#{pointsProductInfoHome.instance.pointsProductInfoId}</span></p>
                            <p><span class="c64">兑换积分&#160;&#160;</span><span style="font-size:16px; color:#ff5000; font-weight:bold;" class="dhjf">#{pointsProductInfoHome.instance.productPoints}</span></p>
                            <p style="display:none;"><span class="c64">市场价格&#160;&#160;</span><span>￥#{pointsProductInfoHome.instance.marketPrice}</span></p>
                            <p><span class="c64">库&#160;&#160;&#160;&#160;&#160;&#160;存&#160;&#160;</span><span class="kc" num="#{pointsProductInfoHome.instance.surplusNum}">#{pointsProductInfoHome.instance.surplusNum}#{pointsProductInfoHome.instance.productUnit}</span></p>
                            <div class='clear' style="padding:5px 0;">
                                <span class="c64 fl" style="margin-right:10px;">数&#160;&#160;&#160;&#160;&#160;&#160;量</span>
                                <table class="fl">
                                    <tr>
                                        <td width="23" class="minus"><img src="#{request.contextPath}/asset/images/points/minus2.png" /></td>
                                        <td width="37" style="padding-top:1px;"><input type="text" class="numV" value="1"/></td>
                                        <td width="23" class="plus"><img src="#{request.contextPath}/asset/images/points/plus2.png" /></td>
                                    </tr>
                                </table>
                            </div>
                            <div class="convert" style="width:95px;cursor:pointer;" onclick="exchange()"><a>立即兑换</a></div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="summary clear">
            <div class="product">产品简介</div>
            <div class="p_summary">
                <table width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                    <div style="word-break:break-all;"> <h:outputText value="#{stringUtil.unHtmlEncoder(pointsProductInfoHome.instance.productIntro)}" escape="false"/></div>
                    
                    </tr>
                </table>
            </div>
        </div>
        
        <!-- 商品详情 结束 -->
       
        <div class="mallFoot">
            <table width="100%">
                <tr>
                    <td class="boederR firstTd">
                        <a href="#{request.contextPath}/user/PointsTaskList.seam">
                        <img src="#{request.contextPath}/asset/images/points/step1.png" />
                        </a>
                    </td>
                    <td width="184" class="boederR center">
                        <a href="#{request.contextPath}#{sessionTake.urlTemp}"><img src="#{request.contextPath}/asset/images/points/step2.png" /></a>
                    </td>
                    <td width="184" class="boederR center">
                        <a href="#{request.contextPath}/points/ConvertPointsRecordList.seam"><img src="#{request.contextPath}/asset/images/points/step3.png" /></a>
                    </td>
                    <td class="lastTd">
                        <a href=""><img src="#{request.contextPath}/asset/images/points/step4.png" /></a>
                    </td>
                </tr>
            </table>
        </div>

    </div>
    <!--右侧结束-->
    
    
<div class="modal fade" id="prompt" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-dialog" style="width:560px; position:absolute; left:50%; margin-left:-280px; top:50%; margin-top:-197px; margin-bottom:0;">
<div class="modal-content" style="height:185px;">
<div class="modal-header" style="border-bottom:0; text-align:right;">
   <span style="cursor : pointer;"><img src="#{request.contextPath}/asset/images/farmingIco16.jpg" onclick="jquery('#prompt').modal('hide');"></img></span>      
</div>
<p style=" text-align:center; margin-top:10px;">您当前拥有<span style="color: #ff5000; ">积分不足</span>以兑换该商品，</p>
<p style=" text-align:center;">坚持完成<span style="color: #ff5000; ">每日任务</span>，早日兑换心仪商品哦！</p>
    <div class="modal-footer" style="text-align:center; border-top:0;">
 		<a class="btn btn-primary"  href="#{request.contextPath}#{sessionTake.urlTemp}" style="color:#fff;">去做任务</a>
        <a class="btn btn-default" data-dismiss="modal" href="#">我知道了</a>
    </div>
</div>
</div>
</div>
</td>  

<script type="text/javascript">
//<![CDATA[
jquery(function(){
	var spbh='000'+jquery('.spbh').text();
	jquery('.spbh').text(spbh.substring(spbh.length-4,spbh.length));
	
     // 轮播图
    var nowing=0;
    var imglength=jquery('.imagesList').children().length;       
　　jquery(".leftBtn").click(function(){
        if(imglength<=3){
        return false;
        }
        nowing--;
        if(nowing<=0){
            nowing=0;
        }
        jquery('.imagesList').animate({"left":-82*nowing+'px'});
    });
    jquery(".rightBtn").click(function(){
        if(imglength<=3){
        return false;
        }
        nowing++;
        if(nowing>=imglength-3){
             nowing=imglength-3;
        }
        jquery('.imagesList').animate({"left":-82*nowing+'px'});
    });
        jquery('.imagesList img').click(function(){
            jquery(".pic img").attr('src',jquery(this).attr('src'));
        });


    jquery(".plus").click(function() {
        var i = jquery('.numV').val();
        i++;
        if(i>99){
        	jquery('.numV').val(99);
        }else{
        	jquery('.numV').val(i);
        }

     });
     jquery(".minus").click(function() {
        var i = jquery('.numV').val();
        i--;
        if(i<1){
        	jquery('.numV').val(1);
        }else{
        	jquery('.numV').val(i);
        }
     });

     jquery('.numV').blur(function(){ 
 		var v = jquery(this).val().replace(/[^0-9]/g,""); 
    	jquery(this).val(v);
		if(v>99){
			jquery(this).val(99);
		}
		if(v<1){
			jquery(this).val(1);
		}
     });

});

function exchange(){
	if(jquery('.kyjf').text()>=(jquery('.dhjf').text()*jquery('.numV').val())){
		if(parseInt(jquery('.numV').val())>parseInt(jquery('.kc').attr('num'))){
			alert('库存不足，请输入小于等于'+jquery('.kc').text()+'的数量重新兑换！');
		}else{
			window.location.href = "#{request.contextPath}/points/PointsProductInfoEdit.seam?pointsProductInfoPointsProductInfoId="+#{pointsProductInfoHome.instance.pointsProductInfoId}+"&allPoints="+#{pointsProductInfoHome.allPoints}+"&num="+jquery('.numV').val()+"&dhjf="+(jquery('.dhjf').text()*jquery('.numV').val())+"&pag=2";
		}
	}else{
		jquery('#prompt').modal('show');
		//alert('可用积分不够兑换当前商品，请从新选择！');
	}
}
//]]>
</script>
</ui:define>

</ui:composition>
