<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template_new.xhtml">
	
<ui:define name="body">
	<style>
    	*{
			margin:0;
			padding:0;
			}
		li{
			list-style:none;
			}
		.choosebase_dialog{
			position: fixed;
			left: 50%;
			top: 50%;
			margin-left: -300px;
			width: 600px;
		}
		.choosebase_dialog .modal-title{
			font-size: 14px;
		}
		.choosebase_dialog .modal-footer{
			text-align: center;
		}
		.choosebase_dialog .modal-body{
			min-height: 105px;
			max-height: 200px;
			padding: 25px 0 30px 0;
			box-sizing: border-box;
			overflow-y: auto;
		}
		.choose_list{
			width: 448px;
			margin: auto;
		}
		.choose_list li{
			position: relative;
			float: left;
			width: 166px;
			height: 40px;
			line-height: 38px;
			margin: 5px 29px 5px;
			border: 1px solid #e5e5e5;
			border-radius: 5px;
			box-sizing: border-box;
			text-align: center;
			font-size: 14px;
			color: #9b9b9b;
			cursor: pointer;
			white-space:nowrap;
			text-overflow:ellipsis;
			overflow:hidden;
		}
		.choose_list li:hover{
			box-shadow: 0 0 10px 2px #c8ebfe;
		}
		.choose_list li:after{
			position: absolute;
			right: -1px;
			bottom: -1px;
			z-index: 1;
			width: 22px;
			height: 21px;
			border-radius: 0 0 5px 0;
			content: '';
		}
		.choose_list li.lCur{
			color: #4c96d5;
			border-color: #4c96d5;
		}
		.choose_list li.lCur:after{
			background: url(../asset/images/digitalCard/icon_duihao.png);
		}
		.select170,.select170>span{
			width:170px;
		}
		.select130,.select130>span{
			width:130px;
		}
		.input-append.date .add-on i, .input-prepend.date .add-on i{
			margin-left:0;
		}
    </style>
    <link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/commons/commons.css" />
    <link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/skinBlue.css" />
    <link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/sort.css" />     
    <link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/digitalCard/Card.css" />

	<script type="text/javascript" src="#{request.contextPath}/asset/js/jquery.nicescroll.min.js"></script>
 	<script type="text/javascript" src="#{request.contextPath}/asset/js/icheck.js"></script>
 	
#{baseDigitalCardHome.createBaseDigitalCard()}
<td valign="top">
            <div class="inbentory_file_main">
            	<!-- 库存左侧二级导航 -->
                <div class="inbentory_level_wap">
                    <div class="inbentory_level">
	                    	<div class="public-search">
								<span class="octicon-search02" id="card_serch_img"></span>
								<input class="form-control srarchfont" value="" id="baseCardSerch"/>
							</div>
						<s:div id="baseDigitalCardList">
							<div class="company_name_list">
		                        <a4j:repeat value="#{baseDigitalCardHome.baseDigitalCardList}" var="card_list">
									<strong class="inben_first inben_first1" aa="#{card_list.id}">
			                            <a href="javascript:;" onclick="getbaseDigitalCard(#{card_list.id})" ><i class="icon_L icon_kcda"></i>#{card_list.cardTitle}</a>
			                        </strong>
								</a4j:repeat>
	                        </div>
                        </s:div>
                    </div>
                    <i class="collapse_btn"></i>
                </div>
                <!-- 库存左侧二级导航 -->
                <!--数字名片右侧 -->
                <div class="inbentory_content">
                <s:div id="baseDigitalCardInfo">
                    <div class="inbentory_search_wap">
	                    <div class="breadNav_wap clear">
	                        <div class="breadNav_lt" style="margin-left:20px;"><a href="javascript:;">精准营销</a><span>&gt;</span><strong>农场秀</strong></div>
	                    </div>
                    	<!-- 数字名片 -->
                    	<div class="card_table">
                    		<div class="card_left">
                    			<!--数字名片-->
                    			<div class="card_code_cont border_ddd">
                    				<div class="card_code_head">
                    					<h4><img src="../asset/images/digitalCard/icon_card1.png" />农场秀</h4>
                    					<span class="btn btn-success" onclick="create_card_choosebase();">创建农场秀</span>
                    				</div>
                    				<div class="card_code_body">
                    					<dl>
	                    					<dt>
	                    						<!--<img class="pic_map" src="../images/marketing/pic_map.jpg"/>-->
	                    						<iframe src="" 
													id="digitalCardMapFrame_view" name="digitalCardMapFrame_view" frameBorder="0" scrolling="yes" width="" onLoad="" style="width:100%;height: 100%;">
												</iframe>
	                    						<i class="mark_b"></i>
	                    						<a class="btn_edit" id="btn_edit" href="javascript:;" >
	                    							<span class="icon_edit"><img src="../asset/images/digitalCard/icon_modifymap0.png" /></span><br /><span class="txt_change">修改地图</span>
	                    						</a>
	                    						<!--<a class="btn_edit" id="btn_complete" href="javascript:;" style="display: none;">
	                    							<span class="icon_edit"><img src="../images/marketing/icon_modifymap00.png" /></span><br />完成修改
	                    						</a>-->
	                    					</dt>
	                    					<dd>
	                    						<ol class="code_list">
	                    							<li class="item_title">
	                    								<p class="name">农场秀标题</p>
	                    								<input type="text" class="form-control" value="#{baseDigitalCardHome.baseDigitalCard.cardTitle}" id="card_title"/>
	                    								<span class="red_star">*</span>
	                    							</li>
	                    							<li class="item_link" >
	                    								<p class="name">分享链接</p>
	                    								<input type="text" readonly="true" class="form-control" value="#{dataDicConstant.getOldDomainNameUrl()}/digitalCard/#{baseDigitalCardHome.baseDigitalCard.id}" id="card_url"/>
														<span class="btn btn-default copy_link" onclick="copy_()" >复制链接</span>		                    								
	                    							</li>
	                    							<li class="item_share" >
	                    								<img class="img_code" src="#{request.contextPath}/GenerateCodeImage?cardid=#{baseDigitalCardHome.baseDigitalCard.id}&amp;type=7" />
	                    								<p class="txt_tip">手机扫一扫分享给好友</p>
	                    							</li>
	                    						</ol>
	                    					</dd>
	                    				</dl>
                    				</div>
                    			</div>
                    			<!--设置、介绍-->
                    			<div class="card_set_cont border_ddd">
                    				<ul id="myTab" role="tablist" class="nav nav-tabs">
										<li class="active">
											<a data-toggle="tab" role="tab" href="#mapSetting" onclick="refresh_select_map()"><img src="../asset/images/digitalCard/icon_enable01.png" />地图设置</a>
										</li>
										<li class="">
											<a data-toggle="tab" role="tab" href="#baseIntro" onclick="base_service_event();"><img src="../asset/images/digitalCard/icon_enable02.png" />基地介绍</a>
										</li>
										<li class="">
											<a data-toggle="tab" role="tab" href="#productIntro" onclick="refresh_select_sale()"><img src="../asset/images/digitalCard/icon_enable03.png" />产品介绍</a>
										</li>
										<li class="">
											<a data-toggle="tab" role="tab" href="#shareSetting"><img src="../asset/images/digitalCard/icon_enable04.png" />分享设置</a>
										</li>
									</ul>
									<div class="tab-content">
										<div id="mapSetting" class="tab-pane active">
										<!-- tab-pane 地图设置 -->
											<ul class="enable_list clear">
												<li>
													<div class="enable_box">
														<p class="txt_name fl">
															<img class="icon_16" src="../asset/images/digitalCard/icon_map.png" />默认地图全屏
														</p>
														<div class="fr">
															<input class="iCheck" type="checkbox" aa="checked" id="mapFullScreen"/>启用
														</div>
													</div>
												</li>
												<li>
													<div class="enable_box">
														<p class="txt_name fl">
															<img class="icon_16" src="../asset/images/digitalCard/icon_weather.png" />显示天气数据
														</p>
														<div class="fr">
															<input class="iCheck" type="checkbox" aa="checked" id="cardWeather"/>启用
														</div>
													</div>
												</li>
											</ul>
											<ul class="enable_list clear" id="more_map_sz" style="display: none;">
												<li>
													<div class="enable_box">
														<p class="txt_name fl">
															<img class="icon_16" src="../asset/images/digitalCard/icon_plant.png" />显示种植信息
														</p>
														<div class="fr">
															<input class="iCheck" type="checkbox" aa="checked" id="cardPlant"/>启用
														</div>
													</div>
												</li>
												<li>
													<div class="enable_box">
														<p class="txt_name fl">
															<img class="icon_16" src="../asset/images/digitalCard/icon_facility.png" />显示硬件设施
														</p>
														<div class="fr">
															<input class="iCheck" type="checkbox" aa="checked" id="cardEquipment"/>启用
														</div>
													</div>
												</li>
												<s:fragment rendered="#{baseDigitalCardHome.aerial_video_service == 1}">
												<li>
													<div class="enable_box">
														<p class="txt_name fl">
															<img class="icon_16" src="../asset/images/digitalCard/icon_aerial.png" />显示航拍
														</p>
														<span class="btn_set fr ml10" data-target="#chooseAreaModal" data-toggle="modal" id="cardAerial_set" style="display: none;">设置&gt;</span>
														<div class="fr">
															<input class="iCheck" type="checkbox" aa="checked" id="cardAerial"/>启用
														</div>
													</div>
												</li>
												</s:fragment>
												<s:fragment rendered="#{baseDigitalCardHome.street_service == 1}">
												<li>
													<div class="enable_box">
														<p class="txt_name fl">
															<img class="icon_16" src="../asset/images/digitalCard/icon_panorama.png" />显示四季田景
														</p>
														<span class="btn_set fr ml10" data-target="#choosePanoramaModal" data-toggle="modal" id="cardPanorama_set" style="display: none;">设置&gt;</span>
														<div class="fr">
															<input class="iCheck" type="checkbox" aa="checked" id="cardPanorama"/>启用
														</div>
													</div>
												</li>
												</s:fragment>
											</ul>
											<div class="more_seting" onoff="down" onclick="SlideDownUpFn(this,'#more_map_sz')">
												<span>更多设置</span>
											</div>
										<!-- tab-pane 地图设置 -->	
										</div>
										<div id="baseIntro" class="tab-pane">
										<!-- tab-pane 基地介绍 -->
											<div class="base_pane_box">
												<table width="100%" cellspacing="0" cellpadding="0">
													<tr>
														<th width="80">基地名称</th>
														<td width="260">
															<input type="text" class="form-control ipt_txt240 fl" value="#{baseDigitalCardHome.baseDigitalCard.baseName}" id="base_name"/>
															<span class="fl red_star">*</span>
														</td>
														<th width="80">联系方式</th>
														<td>
															<input type="text" class="form-control ipt_txt240 fl" value="#{baseDigitalCardHome.baseDigitalCard.basePhone}" id="base_phone"/>
															<span class="fl red_star">*</span>
														</td>
													</tr>
													<tr>
														<th>基地介绍</th>
														<td colspan="3">
															<textarea class="form-control textarea_box" rows="3" id="base_content">#{baseDigitalCardHome.baseDigitalCard.baseContent}</textarea>
														</td>
													</tr>
													<tr>
														<th>基地相册</th>
														<td colspan="3">
															<span class="file_pic" onclick="AddFarmPhotos(this,'#farm_model')">
																<img src="../asset/images/digitalCard/file_btn100.jpg" />
															</span>
														</td>
													</tr>
												</table>
											</div>
											<div class="base_pane_box" id="more_base_sz" style="display: none;">
												<table width="100%" cellspacing="0" cellpadding="0">
													<tr>
														<th width="80">联系人</th>
														<td colspan="3">
															<input type="text" class="form-control ipt_txt240 fl" value="#{baseDigitalCardHome.baseDigitalCard.baseContacts}" id="base_contacts"/>
															<span class="fl red_star">*</span>
														</td>
													</tr>
													<tr>
														<th width="80">销售方式</th>
														<td colspan="3">
															<ol class="icheck_list" id="base_sales_mode">
																<li>
																	<input class="iCheck" type="checkbox" id="base_sales_360" title="社区直供"/>社区直供
																</li>
																<li>
																	<input class="iCheck" type="checkbox" id="base_sales_361" title="商超"/>商超
																</li>
																<li>
																	<input class="iCheck" type="checkbox" id="base_sales_363" title="电商"/>电商
																</li>
																<li>
																	<input class="iCheck" type="checkbox" id="base_sales_364" title="批发"/>批发
																</li>
																<li>
																	<input class="iCheck" type="checkbox" id="base_sales_365" title="采摘"/>采摘
																</li>
																<li>
																	<input class="iCheck" type="checkbox" id="base_sales_366" title="其他"/>其他
																</li>
															</ol>
														</td>
													</tr>
													<tr>
														<th>配套能力</th>
														<td colspan="3">
															<ol class="icheck_list" id="base_matching_ability">
																<li>
																	<input class="iCheck" type="checkbox" id="base_matching_ability_268" title="遇冷处理"/>遇冷处理
																</li>
																<li>
																	<input class="iCheck" type="checkbox" id="base_matching_ability_269" title="分拣包装"/>分拣包装
																</li>
																<li>
																	<input class="iCheck" type="checkbox" id="base_matching_ability_270" title="冷库储存"/>冷库储存
																</li>
																<li>
																	<input class="iCheck" type="checkbox" id="base_matching_ability_271" title="冷链运输"/>冷链运输
																</li>
																<li>
																	<input class="iCheck" type="checkbox" id="base_matching_ability_410" title="代发快递"/>代发快递
																</li>
															</ol>
														</td>
													</tr>
												</table>
												<!-- 产品检测 -->
												<div class="title_head clear" id="rusticWaterDetection_head">
													<h4 class="txt_h4 fl">产品检测</h4>
													<p class="txt_english fl">Product testing</p>
													<button class="btn btn-success fr" onclick="addWaterDetection();">添加</button>
												</div>
												<a4j:repeat value="#{baseDigitalCardHome.rusticWaterDetectionList}" rendered="#{not empty baseDigitalCardHome.rusticWaterDetectionList}" var="rwd_list">
												<table width="100%" cellspacing="0" cellpadding="0" class="rusticWaterDetection">
													<tr>
														<th width="80">检测类型</th>
														<td width="240">
															<select name="type" class="selectpicker" >
																<s:span rendered="#{rwd_list.type == ''}">
																	<option value="" selected="selected" >请选择</option>
																</s:span>
																<s:span rendered="#{rwd_list.type != ''}">
																	<option value="" >请选择</option>
																</s:span>
																<s:span rendered="#{rwd_list.type == 1}">
																	<option value="1" selected="selected" >灌溉水</option>
																</s:span>
																<s:span rendered="#{rwd_list.type != 1}">
																	<option value="1" >灌溉水</option>
																</s:span>
																<s:span rendered="#{rwd_list.type == 2}">
																	<option value="2" selected="selected" >土壤</option>
																</s:span>
																<s:span rendered="#{rwd_list.type != 2}">
																	<option value="2" >土壤</option>
																</s:span>
																<s:span rendered="#{rwd_list.type == 3}">
																	<option value="3" selected="selected" >空气</option>
																</s:span>
																<s:span rendered="#{rwd_list.type != 3}">
																	<option value="3" >空气</option>
																</s:span>
																<s:span rendered="#{rwd_list.type == 4}">
																	<option value="4" selected="selected" >其他</option>
																</s:span>
																<s:span rendered="#{rwd_list.type != 4}">
																	<option value="4" >其他</option>
																</s:span>
															</select>
															
														</td>
														<!-- <th width="80">检测名称</th> -->
														<td>
															<!-- <input type="text" class="form-control ipt_txt220 fl" value="#{rwd_list.name}" /> -->
															<button class="btn btn-default delete_type" onclick="delWaterDetection(this);">删除</button>
														</td>
													</tr>
													<tr>
														<th>检测单位</th>
														<td>
															<input name="name" type="text" class="form-control ipt_txt220 fl" value="#{rwd_list.name}" />
															<input name="rwd_id" value="#{rwd_list.id}" style="display: none"/>
														</td>
														<th>检测时间</th>
														<td>
													        <div class="input-append date form_datetime datetime_220">
													            <!-- <input name="test_time" size="26" type="text" value="#{rwd_list.testTime}" readonly="readonly" /> -->
												            	<h:inputText name="test_time" size="26" value="#{rwd_list.testTime}" readonly="readonly" styleClass="test_time"/>
												            	<span class="add-on"><i class="icon-th"></i></span>
													        </div>
														</td>
													</tr>
													<tr>
														<th>检测图片</th>
														<td colspan="3">
															<iframe src="#{request.contextPath}/digitalCard/waterDetectionImages.seam?rusticWaterDetectionId=#{rwd_list.id}" 
                        										id="waterDetectionImagesframe_#{rwd_list.id}" name="waterDetectionImagesframe_#{rwd_list.id}" frameBorder="0" scrolling="yes" width="" height="110" onLoad="" style="width:100%;height: 110px;">
                        									</iframe>
														</td>
													</tr>
												</table>
												</a4j:repeat>
												<table width="100%" cellspacing="0" cellpadding="0" class="rusticWaterDetection" style="display: #{baseDigitalCardHome.rusticWaterDetectionList.size() == 0 ? 'block' : 'none'}" id="addrusticWaterDetectionhtml">
													<tr>
														<th width="80">检测类型</th>
														<td width="240">
															<select name="type" class="selectpicker">
																<option value="">请选择</option>
																<option value="1">灌溉水</option>
																<option value="2">土壤</option>
																<option value="3">空气</option>
																<option value="4">其他</option>
															</select>
														</td>
														<!-- <th width="80">检测名称</th> -->
														<td>
															<!-- <input type="text" class="form-control ipt_txt220 fl" value="#{rwd_list.name}" /> -->
															<button class="btn btn-default delete_type" onclick="delWaterDetection(this);">删除</button>
														</td>
													</tr>
													<tr>
														<th>检测单位</th>
														<td>
															<input name="name" type="text" class="form-control ipt_txt220 fl" value="" />
															<input name="rwd_id" value="0" style="display: none"/>
														</td>
														<th>检测时间</th>
														<td>
													        <div class="input-append date form_datetime datetime_220">
													            <input name="test_time" size="26" type="text" value="" readonly="readonly" class="test_time"/>
													            <span class="add-on"><i class="icon-th"></i></span>
													        </div>
														</td>
													</tr>
													<tr>
														<th>检测图片</th>
														<td colspan="3">
															<iframe src="#{request.contextPath}/digitalCard/waterDetectionImages.seam?rusticWaterDetectionId=0" 
                        										id="waterDetectionImagesframe_0" name="waterDetectionImagesframe_0" frameBorder="0" scrolling="yes" width="" height="110" onLoad="" style="width:100%;height: 110px;">
                        									</iframe>
														</td>
													</tr>
												</table>
												
												
												<!-- 产品认证 -->
												<div class="title_head clear" id="companyHouonr_head">
													<h4 class="txt_h4 fl">产品认证</h4>
													<p class="txt_english fl">Product certification</p>
													<button class="btn btn-success fr" onclick="addCompanyHouonr();">添加</button>
												</div>
												<a4j:repeat value="#{baseDigitalCardHome.companyHouonrList}" rendered="#{not empty baseDigitalCardHome.companyHouonrList}" var="ch_list">
												<table width="100%" cellspacing="0" cellpadding="0" class="companyHouonr">
													<tr>
														<th width="80">认证产品</th>
														<td width="240">
															<select name="flor" class="selectpicker" data-live-search="true" multiple="multiple" title="全部">
																<a4j:repeat value="#{baseDigitalCardHome.florList}" var="var">
																	<s:span rendered="#{ch_list.florList.contains(var[1])}">
																		<option value="#{var[1]}" selected="selected">#{var[0]}</option>
																	</s:span>
																	<s:span rendered="#{not ch_list.florList.contains(var[1])}">
																		<option value="#{var[1]}">#{var[0]}</option>
																	</s:span>
																</a4j:repeat>
															</select>
														</td>
														<th width="80">认证种类</th>
														<td>
															<div class="fl">
															<select name="dataDic" class="selectpicker">
																<a4j:repeat value="#{baseDigitalCardHome.dataDicList}" var="_obj">
																	<s:span rendered="#{ch_list.standard == _obj.dataDicId}">
																		<option value="#{_obj.dataDicId}" selected="selected">#{_obj.name}</option>
																	</s:span>
																	<s:span rendered="#{ch_list.standard != _obj.dataDicId}">
																		<option value="#{_obj.dataDicId}">#{_obj.name}</option>
																	</s:span>
																</a4j:repeat>
															</select>
															</div>
															<button class="btn btn-default delete_type" onclick="delCompanyHouonr(this);">删除</button>
														</td>
													</tr>
													<tr>
														<th>认证机构</th>
														<td>
															<input name="from" type="text" class="form-control ipt_txt220 fl" value="#{ch_list.from}" />
															<input name="ch_id" value="#{ch_list.companyHouonrId}" style="display: none;"/>
														</td>
														<th>认证时间</th>
														<td>
													        <div class="input-append date form_datetime datetime_220">
													            <h:inputText name="getTime" size="26" value="#{ch_list.getTime}" readonly="readonly" styleClass="getTime"/>
													            <span class="add-on"><i class="icon-th"></i></span>
													        </div>
														</td>
													</tr>
													<tr>
														<th>证件有效期</th>
														<td colspan="3">
															<div class="input-append date form_datetime datetime_220">
													            <!-- <input name="validPeriod" size="26" type="text" value="#{ch_list.validPeriod}" readonly="readonly" /> -->
													            <h:inputText name="validPeriod" size="26" value="#{ch_list.validPeriod}" readonly="readonly" styleClass="validPeriod"/>
													            <span class="add-on"><i class="icon-th"></i></span>
													        </div>
														</td>
													</tr>
													<tr>
														<th>认证图片</th>
														<td colspan="3">
															<!-- <span class="file_pic">
																<img src="../asset/images/digitalCard/file_btn100_2.jpg" />
															</span> -->
															<iframe src="#{request.contextPath}/digitalCard/companyHouonrImages.seam?companyHouonrId=#{ch_list.companyHouonrId}" 
                        										id="companyHouonrImagesframe_#{ch_list.companyHouonrId}" name="companyHouonrImagesframe_#{ch_list.companyHouonrId}" frameBorder="0" scrolling="yes" width="" height="110" onLoad="" style="width:100%;height: 110px;">
                        									</iframe>
														</td>
													</tr>
												</table>
												</a4j:repeat>
												<!-- 添加的HTML -->
												<table width="100%" cellspacing="0" cellpadding="0" class="companyHouonr" style="display: #{baseDigitalCardHome.companyHouonrList.size() == 0 ? 'block' : 'none'}" id="addcompanyHouonrhtml">
													<tr>
														<th width="80">认证产品</th>
														<td width="240">
															<select name="flor" class="selectpicker" data-live-search="true" multiple="multiple" title="全部">
																<a4j:repeat value="#{baseDigitalCardHome.florList}" var="var">
																	<option value="#{var[1]}">#{var[0]}</option>
																</a4j:repeat>
															</select>
														</td>
														<th width="80">认证种类</th>
														<td>
															<div class="fl">
																<select name="dataDic" class="selectpicker" >
																	<a4j:repeat value="#{baseDigitalCardHome.dataDicList}" var="_obj">
																		<option value="#{_obj.dataDicId}">#{_obj.name}</option>
																	</a4j:repeat>
																</select>
															</div>
															<button class="btn btn-default delete_type" onclick="delCompanyHouonr(this);">删除</button>
														</td>
													</tr>
													<tr>
														<th>认证机构</th>
														<td>
															<input name="from" type="text" class="form-control ipt_txt220 fl" value="" />
															<input name="ch_id" value="0" style="display: none;"/>
														</td>
														<th>认证时间</th>
														<td>
													        <div class="input-append date form_datetime datetime_220">
													            <input name="getTime" size="26" type="text" value="" readonly="readonly" class="getTime"/>
													            <span class="add-on"><i class="icon-th"></i></span>
													        </div>
														</td>
													</tr>
													<tr>
														<th>证件有效期</th>
														<td colspan="3">
															<div class="input-append date form_datetime datetime_220">
													            <input name="validPeriod" size="26" type="text" value="" readonly="readonly" class="validPeriod"/>
													            <span class="add-on"><i class="icon-th"></i></span>
													        </div>
														</td>
													</tr>
													<tr>
														<th>认证图片</th>
														<td colspan="3">
															<iframe src="#{request.contextPath}/digitalCard/companyHouonrImages.seam?companyHouonrId=0" 
                        										id="companyHouonrImagesframe_0" name="companyHouonrImagesframe_0" frameBorder="0" scrolling="yes" width="" height="110" onLoad="" style="width:100%;height: 110px;">
                        									</iframe>
														</td>
													</tr>
												</table>
												<!-- 添加的HTML -->
												
												
											</div>
											<div class="more_seting" onoff="down" onclick="SlideDownUpFn(this,'#more_base_sz')">
												<span>更多设置</span>
											</div>
										<!-- tab-pane 基地介绍 -->
										</div>
										<div id="productIntro" class="tab-pane">
										<!-- tab-pane 产品介绍 -->
											<div class="product_left">
											<s:div id="saleProductInfoList">
											<a4j:repeat value="#{baseDigitalCardHome.saleProductInfoList}" var="_supply" rendered="#{not empty baseDigitalCardHome.saleProductInfoList}" rowKeyVar="index_">
												<dl class="p_item #{_index_ == 1 ? 'dq_item' : ''}" aa="#{_supply.saleProductInfoId}">
													<dt class="dl_dt">
														<s:fragment rendered="#{_supply.publish}">
															<i class="txt_jia">已上架</i>
														</s:fragment>
														<img src="#{_supply.productImage eq null or _supply.productImage eq 'null' or _supply.productImage eq '' ? '/asset/images/supply/productImage.png' : _supply.productImage}"></img>
													</dt>
													<dd class="dl_dd">
														<div class="block_name">
															<p class="txt_name ellipsis">#{_supply.name}</p>
															<s:fragment rendered="#{_supply.hasSpot eq 1}">
																<img class="icon_xh" src="../asset/images/digitalCard/icon_xianhuo.jpg"/>
															</s:fragment>
														</div>
														<p class="block_weight ellipsis">供货量<span class="txt_weight">#{_supply.supplyNum}kg</span></p>
														<i class="btn_delete" aa="#{_supply.saleProductInfoId}"></i>
													</dd>
												</dl>
											</a4j:repeat>
											</s:div>
											</div>
											<div class="product_right">
											<s:div id="saleProductInfo">
												<div style="height: 100%; overflow-y: auto;overflow-x:hidden; padding: 0 10px;">
													<div class="base_pane_box" style="width: 100%;">
														<!-- 产品添加 -->
														<div class="title_head clear">
															<h4 class="txt_h4 fl">产品添加</h4>
															<p class="txt_english fl">Add product</p>
															<button class="btn btn-success fr" onclick="saveAndAddSaleProductInfo()">保存并新增</button>
														</div>
														<table width="100%" cellspacing="0" cellpadding="0">
															<tr>
																<th width="80">商品名称</th>
																<td width="190">
																	<input type="hidden" class="form-control ipt_txt170 fl" value="" id="saleProductInfo_saleProductInfoId"/>
																	<input type="text" class="form-control ipt_txt170 fl" value="" id="saleProductInfo_name"/>
																	<span class="red_star">*</span>
																</td>
																<th width="80">作物种类</th>
																<td>
																	<div class="select170">
																	<h:panelGroup id="plantList" style="float:left;">
																		<select style="display: none;" data-live-search="true" class="selectpicker" onchange="change1(this.value)" id="saleProductInfo_plantid">
																		    <option value="0">请选择</option>
																			<a4j:repeat value="#{baseDigitalCardHome.plantList}" var="var">
																				<option value="#{var.plantId}">#{var.name}</option>
																			</a4j:repeat>
																		</select>
																		</h:panelGroup>
																	</div>
																</td>
															</tr>
															<tr>
																<th>作物品种</th>
																<td>
																	<div class="select170 select130">
																		<h:panelGroup id="breedList" style="float:left;">
																			<select style="display: none;" data-live-search="true"  class="selectpicker" multiple="multiple" id="saleProductInfo_breedIds" title="请选择">
																			    <a4j:repeat value="#{baseDigitalCardHome.breedList}" var="var">
																					<option value="#{var.breedId}">#{var.name}</option>
																				</a4j:repeat>
																			</select>
																		</h:panelGroup>
																	</div>
																<!-- <a href="" data-toggle="modal" data-target="#addbreed_myModal"><img src="#{request.contextPath}/asset/images/supply/add.png" alt="" style="cursor: pointer;"/></a> -->
																</td>
																<th >产品标准</th>
																<td>
																	<div class="select170">
																		<h:panelGroup id="standsList">
																			<select style="display: none;" class="selectpicker" id="saleProductInfo_standsId">
																				<a4j:repeat value="#{baseDigitalCardHome.dataDicList}" var="_obj">
																					<s:span rendered="#{_obj.dataDicId == 124}">
																						<option value="#{_obj.dataDicId}" selected="selected">#{_obj.name}</option>
																					</s:span>
																					<s:span rendered="#{_obj.dataDicId != 124}">
																						<option value="#{_obj.dataDicId}" >#{_obj.name}</option>
																					</s:span>
																				</a4j:repeat>
																			</select>
																		</h:panelGroup>
																	</div>
																</td>
															</tr>
															<tr>
																<th>总供货量</th>
																<td colspan="3">
																	<input type="text" class="form-control ipt_txt220 fl" value="" id="saleProductInfo_supplynum"/>
																	<span style="float: left;height: 34px; line-height: 34px; padding: 0 5px;">kg</span>
																</td>
															</tr>
															<tr>
																<th>供货日期</th>
																<td colspan="3">
																	<div class="input-append date form_datetime datetime_170 fl">
															            <input size="26" type="text" value="" readonly="readonly" id="saleProductInfo_supplyBeginTime"/>
															            <span class="add-on"><i class="icon-th"></i></span>
															        </div>
															        <span style="float: left;height: 34px; line-height: 34px; padding: 0 5px;">--</span>
															        <div class="input-append date form_datetime datetime_170 fl">
															            <input size="26" type="text" value="" readonly="readonly" id="saleProductInfo_supplyEndTime"/>
															            <span class="add-on"><i class="icon-th"></i></span>
															        </div>
																</td>
															</tr>
															<tr>
																<th>产品图片</th>
																<td colspan="3">
																	<!-- <span class="file_pic">
																		<img src="../asset/images/digitalCard/file_btn100_2.jpg" />
																	</span> -->
																	<iframe src="#{request.contextPath}/digitalCard/SaleProductInfoImages.seam?aaiId=0" id="saleProductInfoImages" name="saleProductInfoImages" frameBorder="0" scrolling="no" width="" height="165" onLoad="" style="width:560px; height:145px"></iframe>
																</td>
															</tr>
														</table>
													</div>
													<div class="base_pane_box" id="more_product_sz" style="display: none;width:510px;">
														<table width="100%" cellspacing="0" cellpadding="0">
															<tr>
																<th width="80">产品介绍</th>
																<td colspan="3">
																	<textarea class="form-control textarea_box" rows="3" id="saleProductInfo_description"></textarea>
																</td>
															</tr>
															<tr>
																<th>价格区间</th>
																<td colspan="3">
																	<input type="text" class="form-control ipt_txt50 fl" value="" id="saleProductInfo_minPrice"/>
																	<span style="float: left;height: 34px; line-height: 34px; padding: 0 5px;">--</span>
																	<input type="text" class="form-control ipt_txt50 fl" value="" id="saleProductInfo_maxPrice"/>
																	<span style="float: left;height: 34px; line-height: 34px; padding: 0 5px; color: #9c9c9c;">元/</span>
																	<div class="fl select_w60">
																		<select style="display: none;" class="selectpicker" id="saleProductInfo_unitType">
																			<a4j:repeat value="#{baseDigitalCardHome.unitInfoList}" var="var">
																				<option value="#{var.id}">#{var.name}</option>
																			</a4j:repeat>
												                        </select>
																	</div>
																</td>
															</tr>
															<tr>
																<th>购买链接</th>
																<td colspan="3">
																	<div class="fl mr20" id="buy_iradio">
																		<input type="radio" name="testRadio" class="iRadio" checked="checked" id="purchase_content_type1"/>一键购
																	</div>
																	<div class="fl" id="mall_iradio">
																		<input type="radio" name="testRadio" class="iRadio" id="purchase_content_type2"/>微商城
																	</div>
																</td>
															</tr>
															<tr>
																<th></th>
																<td colspan="3">
																	<div id="buy_iradio_con">
																		<select style="display: none;" class="selectpicker" id="purchaseIds" title="请选择">
																		    <a4j:repeat value="#{baseDigitalCardHome.productInfoList}" var="var">
																				<option value="#{var[0]}">#{var[2]}</option>
																			</a4j:repeat>
																		</select>
																	</div>
																	<div id="mall_iradio_con" style="display: none;">
																		<input type="text" class="form-control ipt_txt220 fl" value="" id="micro_mall"/>
																	</div>
																</td>
															</tr>
															<tr>
																<th>产品规格</th>
																<td colspan="3">
																	<input type="text" class="form-control ipt_txt220 fl" style="margin-right: 50px;" value="" id="saleProductInfo_specs"/>
																	<div style="padding-top: 8px;"><span class="fl mr10">是否上架</span><input class="iCheck" type="checkbox" id="saleProductInfo_publish"/></div>
																</td>
															</tr>
														</table>
														<!-- 产品追溯 -->
														<div class="title_head center_head" style="overflow: hidden;" id="product_traceability_head">
															<h4 class="txt_h4 fl">产品追溯</h4>
														</div>
														<div class="new_trace_box" style="width: 510px;" id="product_traceability_add">
															<i class="btn_close" onclick="DeleteNewTrace(this)"></i>
															<table width="100%" cellspacing="0" cellpadding="0" >
																<tr>
																	<th width="80">追溯时间</th>
																	<td width="156">
																		<div class="input-append date form_datetime datetime_140 fl">
																            <input name="traceability_date" size="26" type="text" value="" readonly="readonly" />
																            <span class="add-on"><i class="icon-th"></i></span>
																        </div>
																        <span class="red_star">*</span>
																	</td>
																	<th width="80">追溯内容</th>
																	<td>
																		<input name="traceability_content" type="text" class="form-control ipt_txt140 fl" value="" />
																		<span class="red_star">*</span>
																	</td>
																</tr>
																<tr>
																	<th>追溯图片</th>
																	<td colspan="3">
																		<iframe src="#{request.contextPath}/digitalCard/productTraceabilityImages.seam?productTraceabilityid=0" 
																			id="productTraceabilityImagesframe_0" name="productTraceabilityImagesframe_0" frameBorder="0" scrolling="yes" width="" height="110" onLoad="" style="width:100%;height: 110px;">
																		</iframe>
																	</td>
																</tr>
															</table>
														</div>
														<button class="btn btn-success mb20" onclick="AddNewTrace(this)"><img src="../asset/images/digitalCard/icon_add.png" />&nbsp;新增产品追溯</button>
													</div>
													<div class="more_seting" onoff="down" onclick="SlideDownUpFn(this,'#more_product_sz')">
														<span>更多设置</span>
													</div>
												</div>
												</s:div>
											</div>
										<!-- tab-pane 产品介绍 -->
										</div>
										<div id="shareSetting" class="tab-pane">
										<!-- tab-pane 分享设置 -->
											<div class="base_pane_box">
												<table width="100%" cellspacing="0" cellpadding="0">
													<tr>
														<th width="80">分享标题</th>
														<td >
															<input type="text" class="form-control ipt_txt240 fl" value="#{baseDigitalCardHome.baseDigitalCard.shareTitle}" id="share_title"/>
															<span class="fl red_star">*</span>
														</td>
													</tr>
													<tr>
														<th>分享描述</th>
														<td>
															<textarea class="form-control textarea_box" rows="3" style="height: 110px;" id="share_content">#{baseDigitalCardHome.baseDigitalCard.shareContent}</textarea>
														</td>
													</tr>
													<tr>
														<th>分享图片</th>
														<td>
															<iframe src="#{request.contextPath}/digitalCard/cardShareImg.seam?baseDigitalCardId=0"
																id="cardShareImgframe" name="cardShareImgframe" frameBorder="0" scrolling="yes" width="" height="110" onLoad="" style="width:100%;height: 110px;">
															</iframe>
														</td>
													</tr>
													<tr>
														<th>分享预览</th>
														<td>
															<div class="share_preview_block">
											                   	<strong title="#{baseDigitalCardHome.baseDigitalCard.shareTitle}" class="text_name">#{baseDigitalCardHome.baseDigitalCard.shareTitle}</strong>
											                       <dl class="preview_dl">
											                       	<dt class="preview_dt">
											                       		<img src="#{baseDigitalCardHome.baseDigitalCard.shareImgUrl}" id="picture_plant2" />
											                           </dt>
											                           <dd style="vertical-align: middle;" class="preview_dd">
											                           <div style="max-height:60px;line-height:20px;overflow:hidden;">#{baseDigitalCardHome.baseDigitalCard.shareTitle}<br/>#{baseDigitalCardHome.baseDigitalCard.shareContent}</div>
											                           </dd>
											                       </dl>
											                   	<div class="share_people">
											                       	<img src="../asset/images/digitalCard/resumePreviewEdit_icon10.jpg" />
											                       </div>
											                   </div>
														</td>
													</tr>
												</table>
											</div>
											
										<!-- tab-pane 分享设置 -->
										</div>
									</div>
                    			</div>
                    		</div>
                    		<div class="card_right border_ddd">
                    			<ul class="LivePreview_head">
                    				<li class="l_item ss_item l_cur">
                    					<a href="javascript:;">
                    						<i></i>实时预览
                    					</a>
                    				</li>
                    				<!-- <li class="l_item al_item">
                    					<a href="javascript:;">
                    						<i></i>案例参考
                    					</a>
                    				</li> -->
                    			</ul>
                    			<div class="LivePreview_box iframe_phone" style="display: block;padding-right:0;">
                    				<iframe src="" 
                    				id="card_view" width="100%" height="100%" frameborder="0" style="background: #f1f1f1;"></iframe>
                    			</div>
                    			<div class="LivePreview_box iframe_case">
                    				aaa
                    			</div>
                    		</div>
                    	</div>
                    	<!-- 数字名片 -->
                    </div>
                    
                    <div class="btns_center">
                    	<a class="btn btn-primary" href="#" onclick="saveAll();">提交</a>
                        <a class="btn btn-default" href="#" data-toggle="modal" data-target="#delBaseCardModal">删除</a>
                    </div>
                    </s:div>
                </div>
                <!-- 数字名片右侧 -->
            </div>  
            
            
            
            <!--添加农场照片弹窗-->
			<div class="mark_b50" style="display: none;"></div>
			<div class="model_wrap" id="farm_model" style="display: none;">
				<div class="model_head clear">
					<h3 class="model_title fl">添加农场照片</h3>
					<span class="model_close fr" onclick="DeleteFarmPhotos(this,'#small_farm_model')"></span>
				</div>
				<div class="model_body">
					<table class="farm_table" width="100%" cellpadding="0" cellspacing="0">
						<tr>
							<th width="80">营业执照</th>
							<td width="320">
								<div class="addpic_box">
									<h:inputHidden value="#{baseDigitalCardHome.businessImgUrl}" id="businessImgUrl"/>
									<div class="btn_add" onclick="AddPhotos(this,'#small_farm_model_business')" id="businessImgUrlDiv"></div>
									<p class="txt_criterion mt60">图片标准：200x296（像素）</p>
									<p class="txt_criterion">支持格式：jpg,png,jpeg,bmp,3gp</p>
								</div>
							</td>
							<th width="80">公众号</th>
							<td>
								<div class="addpic_box">
									<h:inputHidden value="#{baseDigitalCardHome.wechatImgUrl}" id="wechatImgUrl"/>
									<div class="btn_add" onclick="AddPhotos(this,'#small_farm_model_wechat')" id="wechatImgUrlDiv"></div>
									<p class="txt_criterion mt60">图片标准：200x296（像素）</p>
									<p class="txt_criterion">支持格式：jpg,png,jpeg,bmp,3gp</p>
								</div>
							</td>
						</tr>
						<tr>
							<th>农场实景</th>
							<td colspan="3">
								<div class="pic_w318_h210" >
									<div class="addpic_box" id="base_sceneimage">
										<div class="btn_add" onclick="AddPhotos(this,'#small_farm_model_sceneimage');showsceneImg('')"></div>
										<p class="txt_criterion mt60">图片标准：318x210（像素）</p>
										<p class="txt_criterion">支持格式：jpg,png,jpeg,bmp,3gp</p>
									</div>
								</div>
							</td>
						</tr>
						<tr>
							<th>企业荣誉</th>
							<td colspan="3">
								<div class="pic_w318_h210" >
									<div class="addpic_box" id="base_honorimage">
										<div class="btn_add" onclick="AddPhotos(this,'#small_farm_model_honorimg');showhonorImg('')"></div>
										<p class="txt_criterion mt60">图片标准：200x296（像素）</p>
										<p class="txt_criterion">支持格式：jpg,png,jpeg,bmp,3gp</p>
									</div>
								</div>
							</td>
						</tr>
					</table>
					<!--添加营业照片-->
					<div class="mark_w50" style="display: none;"></div>
					<div class="model_wrap small_model_wrap" id="small_farm_model_business" style="display: none;">
						<div class="model_head clear">
							<h3 class="model_title fl">添加照片</h3>
							<span class="model_close fr" onclick="DeletePhotos(this,'#small_farm_model_business')"></span>
						</div>
						<div class="model_body">
							<table class="farm_table" width="100%" cellpadding="0" cellspacing="0">
								<tr>
									<th width="80">营业执照</th>
									<td>
                        				<iframe src="#{request.contextPath}/digitalCard/uploadBusinessImg.seam?baseDigitalCardId=0" 
                        				id="baseBusinessImgframe" name="baseBusinessImgframe" frameBorder="0" scrolling="no" height="110" onLoad="" style="width:100%;height: 110px;">
                        				</iframe>
									</td>
								</tr>
								<tr>
									<th>图片说明</th>
									<td>
										<textarea class="form-control textarea_box" rows="3" id="businessimgcontent"></textarea>
									</td>
								</tr>
							</table>
						</div>
						<div class="model_foot" style="text-align: right;">
							<button class="btn btn-success" onclick="savebusinessimg();">提交</button>
							<button class="btn btn-default" onclick="DeletePhotos(this,'#small_farm_model_business')">取消</button>
						</div>
					</div>
					<!--添加营业照片-->
					<!--添加公众号照片-->
					<div class="model_wrap small_model_wrap" id="small_farm_model_wechat" style="display: none;">
						<div class="model_head clear">
							<h3 class="model_title fl">添加照片</h3>
							<span class="model_close fr" onclick="DeletePhotos(this,'#small_farm_model_wechat')"></span>
						</div>
						<div class="model_body">
							<table class="farm_table" width="100%" cellpadding="0" cellspacing="0">
								<tr>
									<th width="80">公众号</th>
									<td>
                        				<iframe src="#{request.contextPath}/digitalCard/uploadWechatImg.seam?baseDigitalCardId=0" 
                        				id="baseWechatImgframe" name="baseWechatImgframe" frameBorder="0" scrolling="no" width="" height="110" onLoad="" style="width:100%;height: 110px;">
                        				</iframe>
									</td>
								</tr>
								<tr>
									<th>图片说明</th>
									<td>
										<textarea class="form-control textarea_box" rows="3" id="wechatimgcontent"></textarea>
									</td>
								</tr>
							</table>
						</div>
						<div class="model_foot" style="text-align: right;">
							<button class="btn btn-success" onclick="savewechatimg();">提交</button>
							<button class="btn btn-default" onclick="DeletePhotos(this,'#small_farm_model_wechat')">取消</button>
						</div>
					</div>
					<!--添加公众号照片-->
					<!--添加农场实景照片-->
					<div class="model_wrap small_model_wrap" id="small_farm_model_sceneimage" style="display: none;">
						<div class="model_head clear">
							<h3 class="model_title fl">添加照片</h3>
							<span class="model_close fr" onclick="DeletePhotos(this,'#small_farm_model_sceneimage')"></span>
						</div>
						<div class="model_body">
							<table class="farm_table" width="100%" cellpadding="0" cellspacing="0">
								<tr>
									<th width="80">农场实景</th>
									<td>
                        				<iframe src="#{request.contextPath}/digitalCard/sceneimage.seam?baseDigitalCardId=0" 
                        				id="sceneImgframe" name="sceneImgframe" frameBorder="0" scrolling="no" width="" height="110" onLoad="" style="width:100%;height: 110px;">
                        				</iframe>
									</td>
								</tr>
								<tr>
									<th>图片说明</th>
									<td>
										<textarea class="form-control textarea_box" rows="3" id="sceneimage_content"></textarea>
									</td>
								</tr>
							</table>
						</div>
						<div class="model_foot" style="text-align: right;">
							<button class="btn btn-success" onclick="savesceneimg();">提交</button>
							<button class="btn btn-default" onclick="DeletePhotos(this,'#small_farm_model_sceneimage');">取消</button>
						</div>
					</div>
					<!--添加农场实景照片-->
					<!--添加农场荣誉照片-->
					<div class="model_wrap small_model_wrap" id="small_farm_model_honorimg" style="display: none;">
						<div class="model_head clear">
							<h3 class="model_title fl">添加照片</h3>
							<span class="model_close fr" onclick="DeletePhotos(this,'#small_farm_model_honorimg')"></span>
						</div>
						<div class="model_body">
							<table class="farm_table" width="100%" cellpadding="0" cellspacing="0">
								<tr>
									<th width="80">企业荣誉</th>
									<td>
                        				<iframe src="#{request.contextPath}/digitalCard/honorImg.seam?baseDigitalCardId=0" 
                        				id="honorImgframe" name="honorImgframe" frameBorder="0" scrolling="no" width="" height="110" onLoad="" style="width:100%;height: 110px;">
                        				</iframe>
									</td>
								</tr>
								<tr>
									<th>图片说明</th>
									<td>
										<textarea class="form-control textarea_box" rows="3" id="honorImg_content"></textarea>
									</td>
								</tr>
							</table>
						</div>
						<div class="model_foot" style="text-align: right;">
							<button class="btn btn-success" onclick="savehonorImg();">提交</button>
							<button class="btn btn-default" onclick="DeletePhotos(this,'#small_farm_model_honorimg');">取消</button>
						</div>
					</div>
					<!--添加农场荣誉照片-->
				</div>
				<div class="model_foot">
					<button class="btn btn-success" onclick="saveAllImg();">提交</button>
					<button class="btn btn-default" onclick="DeleteFarmPhotos(this,'#small_farm_model')">取消</button>
				</div>
			</div> 
			<!--添加农场照片弹窗-->
			
</td>
	<!-- 选择基地弹出框 -->
	<div class="modal" id="choosebaseModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog choosebase_dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">选择基地</h4>
            </div>
            <div class="modal-body">
				<ul class="choose_list" id="choose_list_base">
					<a4j:repeat value="#{baseDigitalCardHome.create_base_list}" var="create_base_list">
						<li aa="#{create_base_list.id}">#{create_base_list.name}</li>
					</a4j:repeat>
                </ul>
            </div>
            <div class="modal-footer">
            	<button type="button" class="btn btn-primary" onclick="addBaseCard()" data-dismiss="modal">确认</button>
            	<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            </div>
        </div>
        </div>
    </div>
    <!-- 选择航拍弹出框 -->
    <div class="modal" id="chooseAreaModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog choosebase_dialog" style="margin-top:-160px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">选择航拍</h4>
            </div>
            <div class="modal-body" style="height:200px;">
				<ul class="choose_list" id="choose_list_area">
					<a4j:repeat value="#{baseDigitalCardHome.aerialVideoGroupList}" var="_avg">
						<li aa="#{_avg.aerialVideoGroupId}">#{_avg.groupName}</li>
					</a4j:repeat>
                </ul>
            </div>
            <div class="modal-footer">
            	<button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
            	<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            </div>
        </div>
        </div>
    </div>
    <!-- 选择全景弹出框 -->
    <div class="modal" id="choosePanoramaModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog choosebase_dialog" style="margin-top:-160px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">选择全景</h4>
            </div>
            <div class="modal-body" style="height:200px;">
				<ul class="choose_list" id="choose_list_panorama">
					<a4j:repeat value="#{baseDigitalCardHome.objList}" var="var">
						<li aa="#{var[0]}">#{var[1]}</li>
					</a4j:repeat>
                </ul>
            </div>
            <div class="modal-footer">
            	<button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
            	<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            </div>
        </div>
        </div>
    </div>
    

			<div aria-hidden="false" aria-labelledby="myModalLabel"
					role="dialog" tabindex="-1" id="myModal"
					class="modal fade in w600na" style="display: none;z-index:1111;">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal">
									<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
								</button>
								<h4 class="modal-title" id="myModalLabel">提示框</h4>
							</div>
							<div class="modal-body">
								<span id="productMsg">*号部分为必填项！</span>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default"
									data-dismiss="modal">取消</button>
								<button type="button" class="btn btn-primary"
									data-dismiss="modal">确认</button>
							</div>
						</div>
					</div>
				</div>
				
				<div aria-hidden="false" aria-labelledby="myModalLabel"
					role="dialog" tabindex="-1" id="delBaseCardModal"
					class="modal fade in w600na" style="display: none;z-index:1111;">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal">
									<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
								</button>
								<h4 class="modal-title" id="delBaseCardModalLabel">提示框</h4>
							</div>
							<div class="modal-body">
								<span id="delBaseCard">是否确定删除该名片？</span>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default"
									data-dismiss="modal">取消</button>
								<button type="button" class="btn btn-primary"
									data-dismiss="modal" onclick="delBaseCard();">确认</button>
							</div>
						</div>
					</div>
				</div>
				
	 <!-- 作物品种添加 内容开始 -->
     <a4j:form id="pinzhong">
    <div class="modal fade" id="addbreed_myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog kuandu">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" style="display:none;">&times;</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title" id="myModalLabel">添加</h4>
          </div>
          <div class="modal-body addbreed_body">
                <div class="h50">
                    <span class="txt_name">植物类型：</span>
						<span id="plantName"></span>
                </div> 
                <div class="h50">
                    <span class="txt_name" >名称：</span>
                    <h:inputText class="form-control" id="mingcheng" style="width: 220px; display: inline;" value="#{baseDigitalCardHome.breedName}" />
                    <h:inputHidden id="addPlantId" value="#{baseDigitalCardHome.plantId}" />
                    <img src="#{request.contextPath}/asset/images/supply/important.png" alt="" />
                </div>
                <div class="h50">
                    <span class="txt_name">图片：</span>
          				<s:fileUpload id="picture" size="30" style="display:inline;margin-top: 4px;"
							accept="image/png,image/jpeg,image/gif"
							contentType="image/png,image/jpeg,image/gif"
							fileName="#{baseDigitalCardHome.pictureName}"
							data="#{baseDigitalCardHome.imgUrl}"
							onchange="changeFileName(this.value)">
						</s:fileUpload>
                </div>
                <div class="h5">
                    <span class="txt_name" >适合茬口：</span>
                    <h:inputText class="form-control" style="width: 220px; display: inline;" value="#{baseDigitalCardHome.suitableCrops}" />
                </div>
                <div class="h90">
                    <span class="txt_name">产地：</span>
                    <h:inputTextarea class="form-control" rows="3" style="width: 300px; display: inline-block; margin-top:10px" value="#{baseDigitalCardHome.origin}" />
                </div>
          </div>
          <div class="modal-footer">
            <a4j:commandButton id="persistModal" value="提交" styleClass="btn btn-primary" action="#{baseDigitalCardHome.addBreed()}"  oncomplete="submithd()" reRender="breedList"/>
            <a class="btn btn-default" id="btn-default" data-dismiss="modal">返回</a>
          </div>
        </div>
      </div>
    </div>
    </a4j:form>
				

<a4j:form>
 	<a4j:queue requestDelay="10" ignoreDupResponses="true"/>
 	<a4j:jsFunction name="getbaseDigitalCard" action="#{baseDigitalCardHome.getbaseDigitalCard()}" reRender="baseDigitalCardInfo" data="#{baseDigitalCardHome.baseDigitalCard}" oncomplete="baseDigitalCardInfo(data)">
		<a4j:actionparam name="base_digital_card_id" assignTo="#{baseDigitalCardHome.base_digital_card_id}"/>
	</a4j:jsFunction>
	<a4j:jsFunction name="saveDigitalCardImgAllImg" action="#{baseDigitalCardHome.saveDigitalCardImgAllImg()}" data="#{baseDigitalCardHome.baseDigitalCard}" oncomplete="baseDigitalCardInfo(data)">
		<a4j:actionparam name="base_digital_card_id" assignTo="#{baseDigitalCardHome.base_digital_card_id}"/>
		<a4j:actionparam name="allImgStr" assignTo="#{baseDigitalCardHome.allImgStr}"/>
	</a4j:jsFunction>
	<a4j:jsFunction name="saveBaseDigitalCard" action="#{baseDigitalCardHome.saveBaseDigitalCard()}" reRender="baseDigitalCardInfo,baseDigitalCardList" data="#{baseDigitalCardHome.baseDigitalCard}" oncomplete="baseDigitalCardInfo(data)">
		<a4j:actionparam name="base_digital_card_id" assignTo="#{baseDigitalCardHome.base_digital_card_id}"/>
		<a4j:actionparam name="rusticWaterDetectionArrStr" assignTo="#{baseDigitalCardHome.rusticWaterDetectionArrStr}"/>
		<a4j:actionparam name="companyHouonrArrStr" assignTo="#{baseDigitalCardHome.companyHouonrArrStr}"/>
		<a4j:actionparam name="baseDigitalCardStr" assignTo="#{baseDigitalCardHome.baseDigitalCardStr}"/>
	</a4j:jsFunction>
	<a4j:jsFunction name="getSaleProductInfoDetailed" action="#{baseDigitalCardHome.getSaleProductInfoDetailed}" reRender="saleProductInfo,breedList"  data="#{baseDigitalCardHome.saleProductInfoStr}" oncomplete="saleProductInfoBack(data)">
		<a4j:actionparam name="saleProductInfoId" assignTo="#{baseDigitalCardHome.saleProductInfoId}"/>
		<a4j:actionparam name="base_id" assignTo="#{baseDigitalCardHome.base_id}"/>
	</a4j:jsFunction>
	<a4j:jsFunction name="change2" action="#{baseDigitalCardHome.changePlant()}" reRender="breedList,standsList" oncomplete="breedListBack()">
    	<a4j:actionparam name="plantId" assignTo="#{baseDigitalCardHome.plantId}"/>
    	<a4j:actionparam name="base_id" assignTo="#{baseDigitalCardHome.base_id}"/>
    </a4j:jsFunction>
    <a4j:jsFunction name="savesaleProductInfo" action="#{baseDigitalCardHome.saveSaleProductInfo()}" reRender="saleProductInfoList,saleProductInfo" oncomplete="savesaleProductInfoBack()" >
    	<a4j:actionparam name="saveSaleProductInfoStr" assignTo="#{baseDigitalCardHome.saveSaleProductInfoStr}"/>
    </a4j:jsFunction>
    <a4j:jsFunction name="delSaleProductInfo" action="#{baseDigitalCardHome.delSaleProductInfo}" reRender="saleProductInfoList,saleProductInfo" oncomplete="delSaleProductInfoBack()" >
    	<a4j:actionparam name="saleProductInfoId" assignTo="#{baseDigitalCardHome.saleProductInfoId}"/>
    	<a4j:actionparam name="base_id" assignTo="#{baseDigitalCardHome.base_id}"/>
    </a4j:jsFunction>
    <a4j:jsFunction name="createNewBaseCard" action="#{baseDigitalCardHome.createNewBaseCard}" reRender="baseDigitalCardList,baseDigitalCardInfo" data="#{baseDigitalCardHome.baseDigitalCard}" oncomplete="baseDigitalCardInfo(data)">
    	<a4j:actionparam name="create_base_id" assignTo="#{baseDigitalCardHome.create_base_id}"/>
    </a4j:jsFunction>
    <a4j:jsFunction name="getSerchPlant" action="#{baseDigitalCardHome.getSerchPlant()}" reRender="plantList"  oncomplete="serchPlantBack(data)">
    	<a4j:actionparam name="plant_serch" assignTo="#{baseDigitalCardHome.plant_serch}"/>
    </a4j:jsFunction>
    <a4j:jsFunction name="delBaseDigitalCard" action="#{baseDigitalCardHome.delBaseCard()}" reRender="baseDigitalCardList,baseDigitalCardInfo" data="#{baseDigitalCardHome.baseDigitalCardList}" oncomplete="baseDigitalCardInfo(data)">
    	<a4j:actionparam name="base_digital_card_id" assignTo="#{baseDigitalCardHome.base_digital_card_id}"/>
    </a4j:jsFunction>
    <a4j:jsFunction name="serBaseDigitalCard" action="#{baseDigitalCardHome.serchBaseCard()}" reRender="baseDigitalCardList,baseDigitalCardInfo" data="#{baseDigitalCardHome.baseDigitalCardList}" oncomplete="baseDigitalCardInfo(data)">
    	<a4j:actionparam name="baseCardSerch" assignTo="#{baseDigitalCardHome.serch}"/>
    </a4j:jsFunction>
    
</a4j:form>
<script type="text/javascript">
//<![CDATA[
$ = jQuery.noConflict();
var baseDigitalCardId = 0;
var base_id = 0;
//实景图片对象
var sceneImg = function(url,content){
	this.url = url;
    this.content = content;
}
//实景图片对象数组
var sceneImgArr = new Array();
//当前选中的实景图片下标
var clickSceneImgArrIndex = -1;

//荣誉图片对象
var honorImg = function(url,content){
	this.url = url;
    this.content = content;
}
//荣誉图片对象数组
var honorImgArr = new Array();
//当前选中的荣誉图片下标
var clickHonorImgArrIndex = -1;

//产品检测数组
var rusticWaterDetectionArr = new Array();
//产品检测对象
var rusticWaterDetection = function(rwd_id,type,name,test_time,imgsUrl,base_id){
	this.rwd_id = rwd_id;
	this.type = type;
	this.name = name;
	this.test_time = test_time;
	this.imgsUrl = imgsUrl;
	this.base_id = base_id;
}
//产品认证数组
var companyHouonrArr = new Array();
var companyHouonr = function(ch_id,floristicsIds,standard,imageUrl,from,getTime,validPeriod,base_id){
	this.ch_id = ch_id;
	this.floristicsIds = floristicsIds;
	this.standard = standard;
	this.imageUrl = imageUrl;
	this.from = from;
	this.getTime = getTime;
	this.validPeriod = validPeriod;
	this.base_id = base_id;
}

//供应信息
var saleProductInfo = function(base_id,saleProductInfoId,name,plantId,breedIds,breedNames,standard,supplyNum,
		supplyBeginTime,supplyEndTime,description,minPrice,maxPrice,unitType,specs,publish,imagesUrl,content_type,content,product_traceability_arr){
	this.base_id = base_id;
	this.saleProductInfoId = saleProductInfoId;
	this.name = name;
	this.plantId = plantId;
	this.breedIds = breedIds;
	this.breedNames = breedNames;
	this.standard = standard;
	this.supplyNum = supplyNum;
	this.supplyBeginTime = supplyBeginTime;
	this.supplyEndTime = supplyEndTime;
	this.description = description;
	this.minPrice = minPrice;
	this.maxPrice = maxPrice;
	this.unitType = unitType;
	this.specs = specs;
	this.publish = publish;
	this.imagesUrl = imagesUrl;
	this.content_type = content_type;
	this.content = content;
	this.product_traceability_arr = product_traceability_arr;
}
//产品追溯
var productTraceability = function (traceability_content,traceability_date,img_Url){
	this.traceability_content = traceability_content;
	this.traceability_date = traceability_date;
	this.img_Url = img_Url;
}
//地图设置对象
var map_set_info = function(card_title,card_url,mapFullScreen,cardWeather,cardPlant,cardEquipment,cardAerial,cardPanorama){
	this.card_title = card_title;
	this.card_url = card_url;
	this.mapFullScreen = mapFullScreen;
	this.cardWeather = cardWeather;
	this.cardPlant = cardPlant;
	this.cardEquipment = cardEquipment;
	this.cardAerial = cardAerial;
	this.cardPanorama = cardPanorama;
}
//基地介绍对象
var base_set_info = function(base_name,base_phone,base_content,base_contacts,base_sales_mode,base_matching_ability){
	this.base_name = base_name;
	this.base_phone = base_phone;
	this.base_content = base_content;
	this.base_contacts = base_contacts;
	this.base_sales_mode = base_sales_mode;
	this.base_matching_ability = base_matching_ability;
}
//分享设置对象
var card_share_set = function(share_title,share_content,share_img_url){
	this.share_title = share_title;
	this.share_content = share_content;
	this.share_img_url = share_img_url;
}
//整体保存地图设置、基地介绍、分享设置对象
var all_card_info = function(map_info,base_info,share_info){
	this.map_info = map_info;
	this.base_info = base_info;
	this.share_info = share_info;
}

jQuery(function(){
	var promptMessage = "#{baseDigitalCardHome.message}";
	if(promptMessage != ""){
		document.getElementById("productMsg").innerHTML = promptMessage;
		jQuery("#myModal").modal('show');
	}
	jQuery('.selectpicker').selectpicker();

	//基地选择模态框显示出来，显示居中的计算
	jQuery('#choosebaseModal').on('shown.bs.modal', function (e) {
		var choose_dialog_h = jQuery('.choosebase_dialog').height();
		jQuery('.choosebase_dialog').css('margin-top',-(choose_dialog_h/2))
	})
	//基地选择模态框中，选择基地
	jQuery('.choose_list li').click(function(){
		jQuery(this).addClass('lCur').siblings().removeClass('lCur');
	});

	//默认选中第一个名片
	jQuery(".inben_first1:first").find("a").click();

	//数字名片回车搜索
	jQuery("#baseCardSerch").focus(function(){
		document.onkeydown = function(e){
		    var ev = document.all ? window.event : e;
		    if(ev.keyCode == 13) {
		    	serch_card();
		    	jQuery(".inben_first1:first").find("a").click();
		     }
		}
	});
	//数字名片图标点击搜索
	jQuery("#card_serch_img").click(function(){
		serch_card();
		jQuery(".inben_first1:first").find("a").click();
	});

});

function baseDigitalCardInfo(data){
	console.log(data);
	baseDigitalCardId = data.id;
	base_id = data.baseId;
	//重新加载右侧预览页面
	jQuery("#card_view").attr("src", "#{request.contextPath}/digitalCard/card.seam?base_digital_card_id=" + baseDigitalCardId);
	jQuery("#digitalCardMapFrame_view").attr("src", "../DigitalCardMap.seam?enterprise_Id=" 
			+ data.enterpriseInfoId + "&base_Id=" + base_id + "&showDevice=true&showPlant=true");
	
	var wap_height = jQuery('.inbentory_file_main').height();
	var bread_height = jQuery('.breadNav_wap').height()+20;
	var btns_height = jQuery('.btns_center').outerHeight()+1+20;
	var code_height = jQuery('.card_code_cont').height()+14+2;
	jQuery('.LivePreview_box').height(wap_height-bread_height-btns_height-44-2);
	jQuery('.card_set_cont .tab-content').height(wap_height-bread_height-btns_height-code_height-46-2);

	//联系方式预览事件
	jQuery("#base_phone").keyup(function(){
		var base_phone = jQuery("#base_phone").val();
		jQuery("#card_view").contents().find('#base_phone').html(base_phone);
	});
	//基地介绍绑定预览事件
	jQuery("#base_content").keyup(function(){
		var base_content = jQuery("#base_content").val();
		if(trim(base_content) != ""){
			jQuery("#card_view").contents().find('#base_description_head').show();
			jQuery("#card_view").contents().find('#base_description').html(base_content.replace(/</g,"&lt;").replace(/>/g,"&gt;"));
		}else{
			jQuery("#card_view").contents().find('#base_description_head').hide();
			jQuery("#card_view").contents().find('#base_description').hide();
		}
	});
	//联系人预览事件
	jQuery("#base_contacts").keyup(function(){
		var base_contacts = jQuery("#base_contacts").val();
		jQuery("#card_view").contents().find('#base_contact').html(base_contacts);
	});
	
	jQuery('.inben_first1').click(function(){
		jQuery(this).addClass('in_cur').siblings('.inben_first').removeClass('in_cur');	
		jQuery('.inben_second .sed_item').removeClass('sed_cur');
	});
	//选中
	jQuery('.inben_first1').each(function(){
		if(jQuery(this).attr("aa") == baseDigitalCardId){
			jQuery(this).addClass('in_cur').siblings('.inben_first').removeClass('in_cur');	
			jQuery('.inben_second .sed_item').removeClass('sed_cur');
		}	
	});
	
	// (15)产品介绍内容下，作物列表鼠标滑过状态及删除
	jQuery('.product_left .p_item').mouseover(function(){
		jQuery(this).addClass('dq_item');
	});
	jQuery('.product_left .p_item').mouseout(function(){
		jQuery(this).removeClass('dq_item');
	});
	//产品删除
	jQuery('.product_left .btn_delete').bind('click',function(event){
		var saleProductInfoId = jQuery(this).attr("aa");
		delSaleProductInfo(saleProductInfoId,base_id);
		event.stopPropagation();    //  阻止事件冒泡
	}); 
	//产品重新渲染对应数据
	jQuery('.product_left .p_item').bind('click',function(event){
		var saleProductInfoId = jQuery(this).attr("aa");
		getSaleProductInfoDetailed(saleProductInfoId,base_id);
		event.stopPropagation();    //  阻止事件冒泡
	});

	//修改地图跳转页面
	jQuery("#btn_edit").attr("target","_blank");
	jQuery("#btn_edit").attr("href",'#{request.contextPath}/map/Map.seam?base_Id=' + base_id); 
	//是否全屏
	var mapFullScreen = data.mapFullScreen;
	if(mapFullScreen == true){
		jQuery("#mapFullScreen").iCheck("check");
	}
	
	//是否显示天气
	var cardWeather = data.cardWeather;
	if(cardWeather == true){
		jQuery("#cardWeather").iCheck("check");
	}

	//是否显示种植
	var cardPlant = data.cardPlant;
	if(cardPlant == true){
		jQuery("#cardPlant").iCheck("check");
	}
	
	//是否显示硬件
	var cardEquipment = data.cardEquipment;
	if(cardEquipment == true){
		jQuery("#cardEquipment").iCheck("check");
	}
	//是否显示航拍
	var cardAerial = data.cardAerial;
	if(cardAerial != null && cardAerial != 0){
		jQuery("#cardAerial").iCheck("check");
		jQuery("#cardAerial_set").show();
		//选中选择的航拍
		jQuery('#choose_list_area li').each(function(){
			if(jQuery(this).attr("aa") == cardAerial){
				jQuery(this).addClass('lCur').siblings().removeClass('lCur');
			}
		});
	}else{
		jQuery("#cardAerial_set").hide();
		//取消选中选择的航拍
		jQuery('#choose_list_area li').each(function(){
			jQuery(this).removeClass('lCur');
		});
	}
	//是否显示全景
	var cardPanorama = data.cardPanorama;
	if(cardPanorama != null && cardPanorama != 0){
		jQuery("#cardPanorama").iCheck("check");
		jQuery("#cardPanorama_set").show();
		//选中选择的全景
		jQuery('#choose_list_panorama li').each(function(){
			if(jQuery(this).attr("aa") == cardPanorama){
				jQuery(this).addClass('lCur').siblings().removeClass('lCur');
			}
		});
	}else{
		jQuery("#cardPanorama_set").hide();
		//取消选中选择的全景
		jQuery('#choose_list_panorama li').each(function(){
			jQuery(this).removeClass('lCur');
		});
	}
	
	initPageEle();
	refresh_select_map();
	
	//销售方式
	if(data.baseSalesMode != null && data.baseSalesMode != ""){
		var baseSalesMode = data.baseSalesMode.split(",");
		if(baseSalesMode.length > 0){
			for(var i=0;i<baseSalesMode.length;i++){
				jQuery("#base_sales_" + baseSalesMode[i]).iCheck("check");
			}
		}
	}
	//销售方式与配套能力预览页面事件
	base_service_event();

	//配套能力
	if(data.baseMatchingAbility != null && data.baseMatchingAbility != ""){
		var baseMatchingAbility = data.baseMatchingAbility.split(",");
		if(baseMatchingAbility.length > 0){
			for(var i=0;i<baseMatchingAbility.length;i++){
				jQuery('#base_matching_ability_' + baseMatchingAbility[i]).iCheck('check');
			}
		}
	}
	//重新加载营业执照图片
	jQuery("#businessImgUrlDiv").css("background","url(../asset/images/digitalCard/file_btn100_3.jpg)").css("background-size","100% 100%");
	jQuery("#businessimgcontent").val("");
	jQuery("#baseBusinessImgframe").attr("src", "#{request.contextPath}/digitalCard/uploadBusinessImg.seam?baseDigitalCardId=" + data.id);
	if(data.baseBusinessImgUrl != null && data.baseBusinessImgUrl != ""){
		jQuery("#businessImgUrlDiv").css("background","url(" + data.baseBusinessImgUrl + ")").css("background-size","100% 100%");
	}
	if(data.baseBusinessImgContent != null && data.baseBusinessImgContent != ""){
		jQuery("#businessimgcontent").val(data.baseBusinessImgContent);
	}
	jQuery("#baseBusinessImgframe").load(function () {
		jQuery("#baseBusinessImgframe").height("110px");
	});
	//重新加载公众号图片
	jQuery("#wechatImgUrlDiv").css("background","url(../asset/images/digitalCard/file_btn100_3.jpg)").css("background-size","100% 100%");
	jQuery("#wechatimgcontent").val("");
	jQuery("#baseWechatImgframe").attr("src", "#{request.contextPath}/digitalCard/uploadWechatImg.seam?baseDigitalCardId=" + data.id);
	if(data.baseWechatImgUrl != null && data.baseWechatImgUrl != ""){
		jQuery("#wechatImgUrlDiv").css("background","url(" + data.baseWechatImgUrl + ")").css("background-size","100% 100%");
	}
	if(data.baseWechatImgContent != null && data.baseWechatImgContent != ""){
		jQuery("#wechatimgcontent").val(data.baseWechatImgContent);
	}
	jQuery("#baseWechatImgframe").load(function () {
		jQuery("#baseWechatImgframe").height("110px");
	});
	//重新加载农场实景图片
	jQuery("#sceneImgframe").attr("src", "#{request.contextPath}/digitalCard/sceneimage.seam?baseDigitalCardId=" + data.id);
	jQuery("#sceneImgframe").load(function () {
		jQuery("#sceneImgframe").height("110px");
	});
	var imgurl = data.baseSceneImageUrlList;
	jQuery("#base_sceneimage").prevAll().remove();
	if(imgurl.length > 0){
		sceneImgArr = new Array();
		jQuery("#base_sceneimage").parent().children("img").remove();
		var imgHtml = "";
		for(var i = 0;i < imgurl.length; i++){
			var imgInfo = imgurl[i].split(">>");
			var sceneImgInfo = new sceneImg(imgInfo[0],imgInfo[1]);
			sceneImgArr.push(sceneImgInfo);
			imgHtml += "<img src='" + sceneImgInfo.url + "' onclick=\"AddPhotos(this,'#small_farm_model_sceneimage');showsceneImg('" + sceneImgArr.indexOf(sceneImgInfo) +"')\"/>";
		}
		jQuery("#base_sceneimage").before(imgHtml);
		jQuery("#base_sceneimage").show();
	}else{
		sceneImgArr = new Array();
		jQuery("#base_sceneimage").show();
		jQuery("#sceneImgframe").contents().find("#sceneImageLi").hide();
		jQuery("#sceneimage_content").val("");
		clickSceneImgArrIndex = -1;
	}
	//重新加载企业荣誉图片
	jQuery("#honorImgframe").attr("src", "#{request.contextPath}/digitalCard/honorImg.seam?baseDigitalCardId=" + data.id);
	jQuery("#honorImgframe").load(function () {
		jQuery("#honorImgframe").height("110px");
	});
	var honorimgurl = data.baseHonorImageUrlList;
	jQuery("#base_honorimage").prevAll().remove();
	if(honorimgurl.length > 0){
		honorImgArr = new Array();
		jQuery("#base_honorimage").parent().children("img").remove();
		var imgHtml = "";
		for(var i = 0;i < honorimgurl.length; i++){
			var imgInfo = honorimgurl[i].split(">>");
			var honorImgInfo = new honorImg(imgInfo[0],imgInfo[1]);
			honorImgArr.push(honorImgInfo);
			imgHtml += "<img src='" + honorImgInfo.url + "' onclick=\"AddPhotos(this,'#small_farm_model_honorimg');showhonorImg('" + honorImgArr.indexOf(honorImgInfo) +"')\"/>";
		}
		jQuery("#base_honorimage").before(imgHtml);
		jQuery("#base_honorimage").show();
	}else{
		honorImgArr = new Array();
		jQuery("#base_honorimage").show();
		jQuery("#honorImgframe").contents().find("#honorImgLi").hide();
		jQuery("#honorImg_content").val("");
		clickHonorImgArrIndex = -1;
	}
	//重新加载分享设置图片
	jQuery("#cardShareImgframe").attr("src", "#{request.contextPath}/digitalCard/cardShareImg.seam?baseDigitalCardId=" + data.id);
	jQuery("#cardShareImgframe").load(function () {
		jQuery("#cardShareImgframe").height("110px");
	});
	//更新预览图片
	if(data.shareImgUrl != null && data.shareImgUrl != ""){
		jQuery("#picture_plant2").attr("src", data.shareImgUrl);
	}
	
	//加载产品检测
	rusticWaterDetectionArr = new Array();
	//加载产品认证
	companyHouonrArr = new Array();
}

	//营业执照
	function previewImage(id,file){
		var MAXWIDTH  = 0; 
		var MAXHEIGHT = 0;
		MAXWIDTH  = document.getElementById(id).offsetWidth; 
		MAXHEIGHT = document.getElementById(id).offsetHeight;
		var div = document.getElementById(id);
		if (file.files && file.files[0]){
			var img;
			div.innerHTML = '<img class=imghead id='+id+'>';
			img = document.getElementById(id);
			img.onload = function(){
				var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
				img.width  =  rect.width;
				img.height =  rect.height;
				//img.style.marginLeft = rect.left+'px';
				img.style.marginTop = rect.top+'px';
			}
			var reader = new FileReader();
			reader.onload = function(evt){img.src = evt.target.result;}
			reader.readAsDataURL(file.files[0]);
		}else{//兼容IE
			var sFilter='filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="';
			file.select();
			var src = document.selection.createRange().text;
			var img;
			div.innerHTML = '<img class=imghead id='+id+'>';
			img = document.getElementById(id);
			img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;
			var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
			status =('rect:'+rect.top+','+rect.left+','+rect.width+','+rect.height);
			div.innerHTML = "<div class=divhead id='"+id+"' style='position:absolute; width:"+rect.width+"px;height:"+rect.height+"px;margin-top:"+rect.top+"px;"+sFilter+src+"\"'></div>";
		}
		jQuery(".fPicture").css("display","");
    }
    
	function clacImgZoomParam( maxWidth, maxHeight, width, height ){
		var param = {top:0, left:0, width:maxWidth, height:maxHeight};
		return param;
    }
	function delLogoImg(){
		jQuery(".fPicture").css("display","none");
		jQuery("#loginSuccessByte_p").attr("src","");
	}
	//保存营业执照图片
	function savebusinessimg(){
		var businessimgcontent = jQuery("#businessimgcontent").val();
		if(businessimgcontent.length > 40){
			jQuery("#productMsg").html("图片说明最多20字!");
			jQuery("#myModal").modal('show');
			return;
		}
		var img_temp = jQuery("#baseBusinessImgframe").contents().find(".plant_imgbd").attr("src");
		if(img_temp != "" && img_temp != undefined){
			jQuery("#businessImgUrl").val(img_temp);
			jQuery("#businessImgUrlDiv").css("background","url(" + img_temp + ")").css("background-size","100% 100%");
		}else{
			jQuery("#businessImgUrlDiv").css("background","url(../asset/images/digitalCard/file_btn100_3.jpg)").css("background-size","100% 100%");
		}
		DeletePhotos("",'#small_farm_model_business');
	}
	
	//保存公众号图片
	function savewechatimg(){
		var wechatimgcontent = jQuery("#wechatimgcontent").val();
		if(wechatimgcontent.length > 40){
			jQuery("#productMsg").html("图片说明最多20字!");
			jQuery("#myModal").modal('show');
			return;
		}
		var img_temp = jQuery("#baseWechatImgframe").contents().find(".plant_imgbd").attr("src");
		if(img_temp != "" && img_temp != undefined){
			jQuery("#wechatImgUrl").val(img_temp);
			jQuery("#wechatImgUrlDiv").css("background","url(" + img_temp + ")").css("background-size","100% 100%");
		}else{
			jQuery("#wechatImgUrlDiv").css("background","url(../asset/images/digitalCard/file_btn100_3.jpg)").css("background-size","100% 100%");
		}
		DeletePhotos("",'#small_farm_model_wechat');
	}
	//保存实景图片
	function savesceneimg(){
		var sceneImgArrIndex = jQuery("#sceneImgframe").contents().find("#sceneImage").attr("indexval");
		var sceneImgUrl = jQuery("#sceneImgframe").contents().find("#sceneImage").attr("src");
		if(sceneImgArrIndex != "" && sceneImgArrIndex != -1 && sceneImgUrl == ""){//删除
			sceneImgArr.splice(sceneImgArrIndex,1);
		} else if(sceneImgArrIndex != "" && sceneImgArrIndex != -1 && sceneImgUrl != ""){//替换
			var sceneimageContent = jQuery("#sceneimage_content").val();
			if(sceneimageContent.length > 20){
				jQuery("#productMsg").html("图片说明最多20字!");
				jQuery("#myModal").modal('show');
				return;
			}
			var sceneImgInfo = new sceneImg(sceneImgUrl,sceneimageContent);
			sceneImgArr[sceneImgArrIndex] = sceneImgInfo;
		}else if(sceneImgArrIndex == -1){//新增
			var sceneImgUrl = jQuery("#sceneImgframe").contents().find("#sceneImage").attr("src");
			var sceneimageContent = jQuery("#sceneimage_content").val();
			if(sceneimageContent.length > 20){
				jQuery("#productMsg").html("图片说明最多20字!");
				jQuery("#myModal").modal('show');
				return;
			}
			var sceneImgInfo = new sceneImg(sceneImgUrl,sceneimageContent);
			sceneImgArr.push(sceneImgInfo);
		}
		var imgHtml = "";
		for(var i = 0;i<sceneImgArr.length;i++){
			var sceneImgInfo = sceneImgArr[i];
			if(sceneImgInfo != null){
				imgHtml += "<img src='" + sceneImgInfo.url + "' onclick=\"AddPhotos(this,'#small_farm_model_sceneimage');showsceneImg('" + sceneImgArr.indexOf(sceneImgInfo) + "')\" />";
			}
		}
		console.log(sceneImgArr);
		jQuery("#base_sceneimage").parent().children("img").remove();
		jQuery("#base_sceneimage").before(imgHtml);
		DeletePhotos("",'#small_farm_model_sceneimage');
	}
	//显示实景图片
	function showsceneImg(sceneImgArrIndex){
		if(sceneImgArrIndex != ""){
			var sceneImgInfo = sceneImgArr[sceneImgArrIndex];
			jQuery("#sceneImgframe").contents().find("#sceneImageLi").show();
			jQuery("#sceneImgframe").contents().find("#sceneImage").attr("src",sceneImgInfo.url);
			jQuery("#sceneImgframe").contents().find("#sceneImage").attr("indexval",sceneImgArrIndex);
			jQuery("#sceneimage_content").val(sceneImgInfo.content);
			clickSceneImgArrIndex = sceneImgArrIndex;
		}else{
			jQuery("#sceneImgframe").contents().find("#sceneImageLi").hide();
			jQuery("#sceneimage_content").val("");
			clickSceneImgArrIndex = -1;
		}
	}
	//保存荣誉图片
	function savehonorImg(){
		var honorImgIndex = jQuery("#honorImgframe").contents().find("#honorImg").attr("indexval");
		var honorImgUrl = jQuery("#honorImgframe").contents().find("#honorImg").attr("src");
		if(honorImgIndex != "" && honorImgIndex != -1 && honorImgUrl == ""){
			honorImgArr.splice(honorImgIndex,1);
		}else if(honorImgIndex != "" && honorImgIndex != -1 && honorImgUrl != ""){
			var honorImgContent = jQuery("#honorImg_content").val();
			if(honorImgContent.length > 40){
				jQuery("#productMsg").html("图片说明最多20字!");
				jQuery("#myModal").modal('show');
				return;
			}
			var honorImgInfo = new honorImg(honorImgUrl,honorImgContent);
			honorImgArr[honorImgIndex] = honorImgInfo;
		}else if(honorImgIndex == -1){
			var honorImgUrl = jQuery("#honorImgframe").contents().find("#honorImg").attr("src");
			var honorImgContent = jQuery("#honorImg_content").val();
			if(honorImgContent.length > 40){
				jQuery("#productMsg").html("图片说明最多20字!");
				jQuery("#myModal").modal('show');
				return;
			}
			var honorImgInfo = new honorImg(honorImgUrl,honorImgContent);
			honorImgArr.push(honorImgInfo);
		}
		var imgHtml = "";
		for(var i = 0;i<honorImgArr.length;i++){
			var honorImgInfo = honorImgArr[i];
			if(honorImgInfo != null){
				imgHtml += "<img src='" + honorImgInfo.url + "' onclick=\"AddPhotos(this,'#small_farm_model_honorimg');showhonorImg('" + honorImgArr.indexOf(honorImgInfo) + "')\" />";
			}
		}
		jQuery("#base_honorimage").parent().children("img").remove();
		jQuery("#base_honorimage").before(imgHtml);
		DeletePhotos("",'#small_farm_model_honorimg');
	}
	//显示荣誉图片
	function showhonorImg(honorImgIndex){
		if(honorImgIndex != ""){
			var honorImgInfo = honorImgArr[honorImgIndex];
			jQuery("#honorImgframe").contents().find("#honorImgLi").show();
			jQuery("#honorImgframe").contents().find("#honorImg").attr("src",honorImgInfo.url);
			jQuery("#honorImgframe").contents().find("#honorImg").attr("indexval",honorImgIndex);
			jQuery("#honorImg_content").val(honorImgInfo.content);
			clickHonorImgArrIndex = honorImgIndex;
		}else{
			jQuery("#honorImgframe").contents().find("#honorImgLi").hide();
			jQuery("#honorImg_content").val("");
			clickHonorImgArrIndex = -1;
		}
	}
	//所有图片对象
	var DigitalCardImgAllImg = function(businessImg,wechatImg,sceneImgArrTemp,honorImgArrTemp){
		this.businessImg = businessImg;
		this.wechatImg = wechatImg;
		this.sceneImgArr = sceneImgArrTemp;
		this.honorImgArr = honorImgArrTemp;
	}
	//保存所有图片
	function saveAllImg(){
		var businessImgUrl = jQuery("#businessImgUrl").val();
		var businessimgcontent = jQuery("#businessimgcontent").val();
		var businessImg = null;
		if(businessImgUrl != undefined){
			businessImg = new sceneImg(businessImgUrl,businessimgcontent);
		}
		var baseWechatImgUrl = jQuery("#baseWechatImgframe").contents().find(".plant_imgbd").attr("src");
		var wechatimgcontent = jQuery("#wechatimgcontent").val();
		var wechatImg = null;
		if(baseWechatImgUrl != undefined){
			wechatImg = new sceneImg(baseWechatImgUrl,wechatimgcontent);
		}
		if(sceneImgArr.length > 20){
			jQuery("#productMsg").html("农场实景图片最多上传20张!");
			jQuery("#myModal").modal('show');
			return;
		}
		if(honorImgArr.length > 20){
			jQuery("#productMsg").html("企业荣誉图片最多上传20张!");
			jQuery("#myModal").modal('show');
			return;
		}
		var digitalCardImgAllImg = new DigitalCardImgAllImg(businessImg,wechatImg,sceneImgArr,honorImgArr);
		saveDigitalCardImgAllImg(baseDigitalCardId,JSON.stringify(digitalCardImgAllImg));
		DeleteFarmPhotos("",'#small_farm_model');
	}
	
	//产品检测添加
	function addWaterDetection(){
		var html_obj = ".rusticWaterDetection:last";
		if(jQuery(".rusticWaterDetection").length == 0){
			html_obj = "#rusticWaterDetection_head";
		}
		jQuery(html_obj).after("<table width='100%' cellspacing='0' cellpadding='0' class='rusticWaterDetection' >"+
				"<tr>"+
					"<th width='80'>检测类型</th>"+
					"<td width='240'>"+
						"<select class='selectpicker'>"+
							"<option value=''>请选择</option>"+
		                    "<option value='1'>灌溉水</option>"+
		                    "<option value='2'>土壤</option>"+
		                    "<option value='3'>空气</option>"+
		                    "<option value='4'>其他</option>"+
		                "</select>"+
					"</td>"+
					"<td>"+
						"<button class='btn btn-default delete_type' onclick='delWaterDetection(this);'>删除</button>"+
					"</td>"+
				"</tr>"+
				"<tr>"+
					"<th>检测单位</th>"+
					"<td>"+
						"<input name='name' type='text' class='form-control ipt_txt220 fl' value='' />"+
						"<input name='rwd_id' value='0' style='display: none'/>"+
					"</td>"+
					"<th>检测时间</th>"+
					"<td>"+
				        "<div class='input-append date form_datetime datetime_220'>"+
				            "<input class='test_time' name='test_time' size='26' type='text' value='' readonly='readonly' />"+
				            "<span class='add-on'><i class='icon-th'></i></span>"+
				        "</div>"+
					"</td>"+
				"</tr>"+
				"<tr>"+
					"<th>检测图片</th>"+
					"<td colspan='3'>"+
						"<iframe src='#{request.contextPath}/digitalCard/waterDetectionImages.seam?rusticWaterDetectionId=0'"+ 
							"id='waterDetectionImagesframe_0' name='waterDetectionImagesframe_0' frameBorder='0' scrolling='yes' width='' height='110' onLoad='' style='width:100%;height: 110px;'>"+
						"</iframe>"+
					"</td>"+
				"</tr>"+
			"</table>"+
				"<table/>");
		jQuery('.selectpicker').selectpicker();
		//(6)时间插件
		jQuery(".form_datetime").datetimepicker({
			format: "yyyy-mm-dd",  /* 控制显示格式，默认为空，显示小时分钟 */
		    autoclose: true,
		    weekStart: 1,
		   //startDate: "2014-08-14",
		    language:  'zh-CN',
		    startView: 3,
		    minView: 2,
		    maxView: 4,     
		    pickerPosition: "top-left"
		});
	}
	//产品检测删除
	function delWaterDetection(obj){
		jQuery(obj).closest("table").remove();
	}
	
	//添加产品认证
	function addCompanyHouonr(){
		var floristicsList = eval('#{baseDigitalCardHome.florJSONArr}');
		var floristicsHtml = "";
		if(floristicsList.length > 0){
			for(var i=0;i<floristicsList.length;i++){
				floristicsHtml += "<option value='" + floristicsList[i].id + "'>" + floristicsList[i].name + "</option>";
			}
		}
		var dataDicList = eval('#{baseDigitalCardHome.dataDicJSONArr}');
		var dataDicHtml = "";
		if(dataDicList.length > 0){
			for(var i=0;i<dataDicList.length;i++){
				dataDicHtml += "<option value='" + dataDicList[i].id + "'>" + dataDicList[i].name + "</option>";
			}
		}
		var html_obj = ".companyHouonr:last";
		if(jQuery(".companyHouonr").length == 0){
			html_obj = "#companyHouonr_head";
		}
		jQuery(html_obj).after("<table width='100%' cellspacing='0' cellpadding='0' class='companyHouonr'>"+
				"<tr>"+
					"<th width='80'>认证产品</th>"+
					"<td width='240'>"+
						"<select name='flor' class='selectpicker' data-live-search='true' multiple='multiple' title='全部'>"+
							floristicsHtml +
						"</select>"+
					"</td>"+
					"<th width='80'>认证种类</th>"+
					"<td>"+
						"<div class='fl'>"+
						"<select name='dataDic' class='selectpicker'>"+
						dataDicHtml+
						"</select>"+
						"</div>"+
						"<button class='btn btn-default delete_type' onclick='delCompanyHouonr(this);'>删除</button>"+
					"</td>"+
				"</tr>"+
				"<tr>"+
					"<th>认证机构</th>"+
					"<td>"+
						"<input name='from' type='text' class='form-control ipt_txt220 fl' value='' />"+
						"<input name='ch_id' value='0' style='display: none;'/>"+
					"</td>"+
					"<th>认证时间</th>"+
					"<td>"+
				        "<div class='input-append date form_datetime datetime_220'>"+
				            "<input class='getTime' name='getTime' size='26' type='text' value='' readonly='readonly' />"+
				            "<span class='add-on'><i class='icon-th'></i></span>"+
				        "</div>"+
					"</td>"+
				"</tr>"+
				"<tr>"+
					"<th>证件有效期</th>"+
					"<td colspan='3'>"+
						"<div class='input-append date form_datetime datetime_220'>"+
				            "<input class='validPeriod' name='validPeriod' size='26' type='text' value='' readonly='readonly' />"+
				            "<span class='add-on'><i class='icon-th'></i></span>"+
				        "</div>"+
					"</td>"+
				"</tr>"+
				"<tr>"+
					"<th>认证图片</th>"+
					"<td colspan='3'>"+
						"<iframe src='#{request.contextPath}/digitalCard/companyHouonrImages.seam?companyHouonrId=0'"+ 
							"id='companyHouonrImagesframe_0' name='companyHouonrImagesframe_0' frameBorder='0' scrolling='yes' width='' height='110' onLoad='' style='width:100%;height: 110px;'>"+
						"</iframe>"+
					"</td>"+
				"</tr>"+
			"</table>");
		
		jQuery('.selectpicker').selectpicker();
		//(6)时间插件
		jQuery(".form_datetime").datetimepicker({
			format: "yyyy-mm-dd",  /* 控制显示格式，默认为空，显示小时分钟 */
		    autoclose: true,
		    weekStart: 1,
		   //startDate: "2014-08-14",
		    language:  'zh-CN',
		    startView: 3,
		    minView: 2,
		    maxView: 4,     
		    pickerPosition: "top-left"
		});
	}
	
	//删除产品认证
	function delCompanyHouonr(obj){
		jQuery(obj).closest("table").remove();
	}	
	
	//整体保存
	function saveAll(){
		if(baseDigitalCardId == 0){
			jQuery("#productMsg").html("请先选择一个数字名片!");
			jQuery("#myModal").modal('show');
			return;
		}
		//拼接地图设置对象
		//标题
		var card_title = jQuery("#card_title").val();
		if(card_title == null || trim(card_title) == ""){
			jQuery("#productMsg").html("数字名片标题不能为空!");
			jQuery("#myModal").modal('show');
			return;
		}
		if(card_title.length > 50){
			jQuery("#productMsg").html("数字名片标题不能超过50字!");
			jQuery("#myModal").modal('show');
			return;
		}
		//地址
		var card_url = jQuery("#card_url").val();
		//是否全屏
		var mapFullScreen = 0;
		if(jQuery("#mapFullScreen").is(":checked")){
			mapFullScreen = 1;
		}
		//是否天气
		var cardWeather = 0;
		if(jQuery("#cardWeather").is(":checked")){
			cardWeather = 1;
		}
		//是否种植
		var cardPlant = 0;
		if(jQuery("#cardPlant").is(":checked")){
			cardPlant = 1;
		}
		//是否设备
		var cardEquipment = 0;
		if(jQuery("#cardEquipment").is(":checked")){
			cardEquipment = 1;
		}
		//是否航拍
		var cardAerial = 0;
		if(jQuery("#cardAerial").is(":checked")){
			//选中的航拍
			jQuery('#choose_list_area li').each(function(){
				if(jQuery(this).hasClass('lCur')){
					cardAerial = jQuery(this).attr("aa");
				}
			});
		}
		//是否全景
		var cardPanorama = 0;
		if(jQuery("#cardPanorama").is(":checked")){
			//选中的全景
			jQuery('#choose_list_panorama li').each(function(){
				if(jQuery(this).hasClass('lCur')){
					cardPanorama = jQuery(this).attr("aa");
				}
			});
		}
		var map_set = new map_set_info(card_title,card_url,mapFullScreen,cardWeather,cardPlant,cardEquipment,cardAerial,cardPanorama);
		
		//拼接基地介绍页面对象
		//基地名称
		var base_name = jQuery("#base_name").val();
		if(base_name == null || trim(base_name) == ""){
			jQuery("#productMsg").html("基地名称不能为空!");
			jQuery("#myModal").modal('show');
			return;
		}
		if(base_name.length > 30){
			jQuery("#productMsg").html("基地名称不能超过30字!");
			jQuery("#myModal").modal('show');
			return;
		}
		var isMobile=/^(?:13\d|15\d|17\d|18\d)\d{5}(\d{3}|\*{3})$/;   
		var isPhone=/^((0\d{2,3})-)?(\d{7,8})(-(\d{3,}))?$/;
		//联系电话
		var base_phone = jQuery("#base_phone").val();
		if(!isMobile.test(base_phone) && !isPhone.test(base_phone)){
			jQuery("#productMsg").html("请输入正确的联系方式!");
			jQuery("#myModal").modal('show');
			return;
		}
		//基地介绍
		var base_content = jQuery("#base_content").val();
		if(base_content.length > 200){
			jQuery("#productMsg").html("基地介绍不能超过200字!");
			jQuery("#myModal").modal('show');
			return;
		}
		//联系人
		var base_contacts = jQuery("#base_contacts").val();
		if(base_contacts.length > 15){
			jQuery("#productMsg").html("联系人不能超过15字!");
			jQuery("#myModal").modal('show');
			return;
		}
		//销售方式
		var base_sales_mode_str = "";
		jQuery("#base_sales_mode").find(".iCheck").each(function(){
			if(jQuery(this).is(":checked")){
				base_sales_mode_str += jQuery(this).attr("id").split("_")[2] + ",";
			}
		});
		//配套能力
		var base_matching_ability = "";
		jQuery("#base_matching_ability").find(".iCheck").each(function(){
			if(jQuery(this).is(":checked")){
				base_matching_ability += jQuery(this).attr("id").split("_")[3] + ",";
			}
		});
		var base_set = new base_set_info(base_name,base_phone,base_content,base_contacts,base_sales_mode_str,base_matching_ability);
		
		//产品检测
		rusticWaterDetectionArr = new Array();
		var is_rwd_img = false;
		jQuery(".rusticWaterDetection").each(function(){
			var type = jQuery(this).find(".selectpicker").val();
			if(type != "" && type != undefined && type != "请选择"){
				var name = jQuery(this).find("input[name='name']").val();
			    var test_time = jQuery(this).find("input[class='test_time']").val();
			    var rwd_id = jQuery(this).find("input[name='rwd_id']").val();
			    var imgUrlArr = new Array();
			    jQuery(this).find("iframe").contents().find(".plant_imgbd").each(function(){
			    	imgUrlArr.push(jQuery(this).attr("src"));
				});
				if(imgUrlArr.length == 0){
					is_rwd_img = true;
					return false;
				}
			    var rusticWaterDetection_temp = new rusticWaterDetection(rwd_id,type,name,test_time,imgUrlArr,base_id);
			    rusticWaterDetectionArr.push(rusticWaterDetection_temp);
			}
		});
		if(is_rwd_img){
			jQuery("#productMsg").html("产品检测图片不能为空!");
			jQuery("#myModal").modal('show');
			return;
		}
		//产品认证
		companyHouonrArr = new Array();
		var is_ch_img = false;
		jQuery(".companyHouonr").each(function(){
			var imgUrlArr = new Array();
			jQuery(this).find("iframe").contents().find(".plant_imgbd").each(function(){
		    	imgUrlArr.push(jQuery(this).attr("src"));
			});
			
			if(jQuery(this).attr("id") == "addcompanyHouonrhtml" && imgUrlArr.length == 0){
				return true;
			}
			if(imgUrlArr.length == 0){
				is_ch_img = true;
			}
			var floristicsIds = jQuery(this).find("select[name='flor']").val();
			var dataDic = jQuery(this).find("select[name='dataDic']").val();
			var from = jQuery(this).find("input[name='from']").val();
			var getTime = jQuery(this).find("input[class='getTime']").val();
			var validPeriod = jQuery(this).find("input[class='validPeriod']").val();
			var ch_id = jQuery(this).find("input[name='ch_id']").val();
			var companyHouonr_temp = new companyHouonr(ch_id,floristicsIds,dataDic,imgUrlArr,from,getTime,validPeriod,base_id);
			companyHouonrArr.push(companyHouonr_temp);
		});
		if(is_ch_img){
			jQuery("#productMsg").html("产品认证图片不能为空!");
			jQuery("#myModal").modal('show');
			return;
		}
		//分享设置页面对象
		var share_title = jQuery("#share_title").val();
		if(share_title == null || trim(share_title) == ""){
			jQuery("#productMsg").html("分享标题不能为空!");
			jQuery("#myModal").modal('show');
			return;
		}
		var share_content = jQuery("#share_content").val();
		if(share_content.length > 40){
			jQuery("#productMsg").html("分享描述不能超过40字!");
			jQuery("#myModal").modal('show');
			return;
		}
		var share_img_url = jQuery("#cardShareImgframe").contents().find(".plant_imgbd").attr("src");
		if(share_img_url == null || share_img_url == ""){
			share_img_url = '#{sessionTake.logoSuccessName}';
		}
		var card_share = new card_share_set(share_title,share_content,share_img_url);
		
		console.log("检测对象" + JSON.stringify(rusticWaterDetectionArr));
		console.log("认证对象" + JSON.stringify(companyHouonrArr));
		console.log("地图设置对象" + JSON.stringify(map_set));
		console.log("基地介绍对象" + JSON.stringify(base_set));
		console.log("分享设置对象" + JSON.stringify(card_share));
		var all_card_info_temp = new all_card_info(map_set,base_set,card_share);
		console.log("整体保存对象" + JSON.stringify(all_card_info_temp));
		saveBaseDigitalCard(baseDigitalCardId,JSON.stringify(rusticWaterDetectionArr),JSON.stringify(companyHouonrArr),JSON.stringify(all_card_info_temp));
	}
	//加载定产品
	function saleProductInfoDetailed(saleProductInfoId){
		getSaleProductInfoDetailed(saleProductInfoId,base_id);
	}
	//产品详情回调
	function saleProductInfoBack(data){
		console.log(">>>" + data);
		var saleProductInfo = jQuery.parseJSON(data);
		//ID
		jQuery('#saleProductInfo_saleProductInfoId').val(saleProductInfo.saleProductInfoId);
		//名称
		jQuery('#saleProductInfo_name').val(saleProductInfo.name);
		//种类
		jQuery('#saleProductInfo_plantid').val(saleProductInfo.plantId);
		//品种
		var breedIds = new Array();
		if(saleProductInfo.breedId != null){
			breedIds = saleProductInfo.breedId.split(",");
		}
		jQuery('#saleProductInfo_breedIds').val(breedIds);
		//产品标准
		jQuery('#saleProductInfo_standsId').val(saleProductInfo.standard);
		//供货量
		jQuery('#saleProductInfo_supplynum').val(saleProductInfo.supplyNum);
		//开始时间
		jQuery('#saleProductInfo_supplyBeginTime').val(saleProductInfo.supplyBeginTime);
		//结束时间
		jQuery('#saleProductInfo_supplyEndTime').val(saleProductInfo.supplyEndTime);
		//产品介绍
		jQuery('#saleProductInfo_description').val(saleProductInfo.description);
		//价格
		jQuery('#saleProductInfo_minPrice').val(saleProductInfo.minPrice);
		jQuery('#saleProductInfo_maxPrice').val(saleProductInfo.maxPrice);
		jQuery('#saleProductInfo_unitType').val(saleProductInfo.unitType);
		//规格
		jQuery('#saleProductInfo_specs').val(saleProductInfo.specs);
		//上架
		if(saleProductInfo.publish == true){
			jQuery("#saleProductInfo_publish").iCheck("check");
		}
		//图片
		jQuery("#saleProductInfoImages").attr("src", "#{request.contextPath}/digitalCard/SaleProductInfoImages.seam?aaiId=" + saleProductInfo.saleProductInfoId);
		jQuery("#saleProductInfoImages").load(function () {
			jQuery("#saleProductInfoImages").height("110px");
		});
		
		//购买链接
		var card_purchase = saleProductInfo.card_purchase;
		if(card_purchase != ""){
			var content_type = card_purchase.content_type;
			if(content_type == 1){
				jQuery('#buy_iradio_con').show();
				jQuery('#mall_iradio_con').hide();
				jQuery("#purchase_content_type1").iCheck("check");
				jQuery('#purchaseIds').val(card_purchase.content);
			}else{
				jQuery('#mall_iradio_con').show();
				jQuery('#buy_iradio_con').hide();
				jQuery("#purchase_content_type2").iCheck("check");
				jQuery('#micro_mall').val(card_purchase.content);
			}
		}

		//产品追溯
		var product_traceability = saleProductInfo.product_traceability;
		if(product_traceability != ""){
			var product_traceability_arr = product_traceability;
			if(product_traceability_arr.length > 0){
				var product_traceability_html = "";
				for(var i=0;i<product_traceability_arr.length;i++){
					product_traceability_html += "<div class='new_trace_box' >"+
						"<i class='btn_close' onclick='DeleteNewTrace(this)'></i>"+
						"<table width='100%' cellspacing='0' cellpadding='0'>"+
							"<tr>"+
								"<th width='80'>追溯时间</th>"+
								"<td width='156'>"+
									"<div class='input-append date form_datetime datetime_140 fl'>"+
								    "<input name='traceability_date' size='26' type='text' value='" + product_traceability_arr[i].traceability_date + "' readonly='readonly' />"+
								    "<span class='add-on'><i class='icon-th'></i></span>"+
								"</div>"+
								"<span class='red_star'>*</span>"+
								"</td>"+
								"<th width='80'>追溯内容</th>"+
								"<td>"+
									"<input name='traceability_content' type='text' class='form-control ipt_txt140 fl' value='" + product_traceability_arr[i].traceability_content + "' />"+
									"<span class='red_star'>*</span>"+
								"</td>"+
							"</tr>"+
							"<tr>"+
								"<th>追溯图片</th>"+
								"<td colspan='3'>"+
									"<iframe src='#{request.contextPath}/digitalCard/productTraceabilityImages.seam?productTraceabilityid=" + product_traceability_arr[i].product_traceability_id + "'" +  
										"id='productTraceabilityImagesframe_" + product_traceability_arr[i].product_traceability_id + "' name='productTraceabilityImagesframe_" + product_traceability_arr[i].product_traceability_id + "' frameBorder='0' scrolling='yes' width='' height='110' onLoad='' style='width:100%;height: 110px;'>"+
									"</iframe>"+
								"</td>"+
							"</tr>"+
						"</table>"+
					"</div>";
				}
				jQuery("#product_traceability_head").after(product_traceability_html);
				jQuery("#product_traceability_add").hide();
			}
		}
		
		initPageEle();
	}
	
	//产品种类、品种联动
	function change1(plantId){
		if(plantId == 0){
			return;
		}else{
			change2(plantId,base_id);
		}
	}
	//联动回调
	function breedListBack(){
		jQuery('#breedIds').show();
		jQuery('#standsId').show();
		jQuery('.selectpicker').selectpicker({size:8,dropupAuto:false});
	}

	//保存并新增
	function saveAndAddSaleProductInfo(){
		if(baseDigitalCardId == 0 || base_id == 0){
			jQuery("#productMsg").html("请先选择一个数字名片!");
			jQuery("#myModal").modal('show');
			return;
		}
		var saleProductInfoId = jQuery('#saleProductInfo_saleProductInfoId').val();
		var name = jQuery('#saleProductInfo_name').val();
		var breedIds = jQuery('#saleProductInfo_breedIds').val();
		var breedNames = null;
		if('请选择' != jQuery("#saleProductInfo_breedIds").next().find(".btn-default").attr("title")){
			breedNames = jQuery("#saleProductInfo_breedIds").next().find(".btn-default").attr("title");
		}
		var standard = jQuery('#saleProductInfo_standsId').val();
		var unitType = jQuery('#saleProductInfo_unitType').val();
		var specs = jQuery('#saleProductInfo_specs').val();
		var publish = 0;
		if(jQuery("#saleProductInfo_publish").is(":checked")){
			publish = 1;;
		}
		//名称
		if(trim(name) == "undefined" || trim(name) == "" || trim(name) == null){
			jQuery("#productMsg").html("商品名称不能为空!");
			jQuery("#myModal").modal('show');
			return;
		}
		//种类
		var plant = jQuery('#saleProductInfo_plantid').val();
		if(plant == "undefined" || plant == "" || plant == null || plant == 0){
			jQuery("#productMsg").html("请选择作物种类!");
			jQuery("#myModal").modal('show');
			return;
		}
		//价格
		var minPrice = jQuery('#saleProductInfo_minPrice').val();
		if(minPrice == "undefined" || minPrice == ""){
			jQuery("#productMsg").html("最低价格不能为空!");
			jQuery("#myModal").modal('show');
			return;
		}else if(isNaN(minPrice)){
			jQuery("#productMsg").html("最低价格只能是数字!");
			jQuery("#myModal").modal('show');
			return;
		}
		if(minPrice < 0){
			jQuery("#productMsg").html("最低价格不能小于0!");
			jQuery("#myModal").modal('show');
			return;
		}
		var maxPrice = jQuery("#saleProductInfo_maxPrice").val();
		if(maxPrice == "undefined" || maxPrice == ""){
			jQuery("#productMsg").html("最高价格不能为空!");
			jQuery("#myModal").modal('show');
			return;
		}else if(isNaN(maxPrice)){
			jQuery("#productMsg").html("最高价格只能是数字!");
			jQuery("#myModal").modal('show');
			return;
		}
		if(maxPrice < 0){
			jQuery("#productMsg").html("最高价格不能小于0!");
			jQuery("#myModal").modal('show');
			return;
		}
		if(eval(minPrice) > eval(maxPrice)){
			jQuery("#productMsg").html("最高价格不应小于最低价格!");
			jQuery("#myModal").modal('show');
			return;
		}
		var description = jQuery('#saleProductInfo_description').val();
		if(description.length > 50 ){
			jQuery("#productMsg").html("产品介绍字数不能超过50字!");
			jQuery("#myModal").modal('show');
			return;
		}
		var supplyBeginTime = jQuery('#saleProductInfo_supplyBeginTime').val();
		var supplyEndTime = jQuery('#saleProductInfo_supplyEndTime').val();
		
		if(supplyBeginTime == ''){
			jQuery("#productMsg").html("请选择供货开始日期!");
			jQuery("#myModal").modal('show');
			return;
		}
		if(supplyEndTime == ''){
			jQuery("#productMsg").html("请选择供货结束日期!");
			jQuery("#myModal").modal('show');
			return;
		}
		var date1 = new Date(Date.parse(supplyBeginTime));
		var date2 = new Date(Date.parse(supplyEndTime));
		if (null != date1 && null != date2 && date1.getTime() > date2.getTime()) {  
			jQuery("#productMsg").html("结束日期不应小于开始日期!"); 
			jQuery("#myModal").modal('show');
			return; 
	    }
		var supplyNum = jQuery('#saleProductInfo_supplynum').val();
		if(trim(supplyNum) == "undefined" || trim(supplyNum) =="" ){
			jQuery("#productMsg").html("供货量不能为空!");
			jQuery("#myModal").modal('show');
			return;
		}else if(isNaN(supplyNum)){
			jQuery("#productMsg").html("供货量只能是数字!");
			jQuery("#myModal").modal('show');
			return;
		}
		
		var imagesUrl = "";
		jQuery("#saleProductInfoImages").contents().find(".plant_imgbd").each(function(){
			imagesUrl += jQuery(this).attr('src') + ",";
		})
		if(imagesUrl != ""){
			imagesUrl = imagesUrl.substr(0,imagesUrl.length - 1)
		}
		//购买链接
		var content_type = 1;
		var content = jQuery("#purchaseIds").val();
		if(jQuery("#purchase_content_type2").is(":checked")){
			content_type = 2;
			content = jQuery("#micro_mall").val();
			if(content.indexOf("http://") == -1){
				if(content != ""){
					content = "http://" + content;
				}
			}
		}
		//产品追溯
		var product_traceability_arr = new Array();
		var is_traceability_date = false;
		var is_traceability_content = false;
		var is_traceability_img = false;
		jQuery(".new_trace_box").each(function(){
			var traceability_date = jQuery(this).find("input[name='traceability_date']").val()
			var traceability_content = jQuery(this).find("input[name='traceability_content']").val()
			var imgUrlArr = new Array();
			jQuery(this).find("iframe").contents().find(".plant_imgbd").each(function(){
				imgUrlArr.push(jQuery(this).attr("src"));
			});
			if(traceability_date == "" && traceability_content == "" && imgUrlArr.length == 0){
			}else{
				if(traceability_date == ""){
					is_traceability_date = true;
					return false;
				}
				if(traceability_content == ""){
					is_traceability_content = true;
					return false;
				}
				if(imgUrlArr.length == 0){
					is_traceability_img = true;
					return false;
				}
				
				if(traceability_date != "" && traceability_content != ""){
					var productTraceability_temp = new productTraceability(traceability_content,traceability_date,imgUrlArr);
					product_traceability_arr.push(productTraceability_temp);
				}
			}
		});
		if(is_traceability_date){
			jQuery("#productMsg").html("产品追溯日期不能空!");
			jQuery("#myModal").modal('show');
			return;
		}
		if(is_traceability_content){
			jQuery("#productMsg").html("产品追溯内容不能空!");
			jQuery("#myModal").modal('show');
			return;
		}
		if(is_traceability_img){
			jQuery("#productMsg").html("产品追溯图片不能空!");
			jQuery("#myModal").modal('show');
			return;
		}
		var saleProductInfo_temp = new saleProductInfo(base_id,saleProductInfoId,name,plant,breedIds,breedNames,standard,supplyNum,
				supplyBeginTime,supplyEndTime,description,minPrice,maxPrice,unitType,specs,publish,imagesUrl,content_type,content,product_traceability_arr);

		console.log(JSON.stringify(saleProductInfo_temp));
		savesaleProductInfo(JSON.stringify(saleProductInfo_temp));
	}
	//添加并保存回调
	function savesaleProductInfoBack(){

		//产品标准默认选中无公害
		jQuery("#saleProductInfo_standsId").val(124);
		
		jQuery('.selectpicker').selectpicker({size:8,dropupAuto:false});
		//(6)时间插件
		jQuery(".form_datetime").datetimepicker({
			format: "yyyy-mm-dd",  /* 控制显示格式，默认为空，显示小时分钟 */
		    autoclose: true,
		    weekStart: 1,
		   //startDate: "2014-08-14",
		    language:  'zh-CN',
		    startView: 3,
		    minView: 2,
		    maxView: 4,     
		    pickerPosition: "top-left"
		});

		// (8)复选框功能
		jQuery('input[class="iCheck"]').iCheck({
			checkboxClass: 'icheckbox_minimal-blue'
		});
		// (9)单选按钮功能
		jQuery('input[class="iRadio"]').iCheck({
			radioClass: 'iradio_minimal-blue'
		});

		// (15)产品介绍内容下，作物列表鼠标滑过状态及删除
		jQuery('.product_left .p_item').mouseover(function(){
			jQuery(this).addClass('dq_item');
		});
		jQuery('.product_left .p_item').mouseout(function(){
			jQuery(this).removeClass('dq_item');
		});
		
		//产品删除
		jQuery('.product_left .btn_delete').bind('click',function(event){
			var saleProductInfoId = jQuery(this).attr("aa");
			delSaleProductInfo(saleProductInfoId,base_id);
			event.stopPropagation();    //  阻止事件冒泡
		}); 
		//产品重新渲染对应数据
		jQuery('.product_left .p_item').bind('click',function(event){
			var saleProductInfoId = jQuery(this).attr("aa");
			getSaleProductInfoDetailed(saleProductInfoId,base_id);
			event.stopPropagation();    //  阻止事件冒泡
		});
		//重新加载右侧预览页面
		jQuery("#card_view").attr("src", "#{request.contextPath}/digitalCard/card.seam?base_digital_card_id=" + baseDigitalCardId);

		//供应名称模糊搜索
		jQuery("#saleProductInfo_name").keyup(function(){
			var plant_name = jQuery("#saleProductInfo_name").val();
			getSerchPlant(plant_name);
		});

		jQuery('#buy_iradio input').on('ifClicked', function(){ //全选
			jQuery(this).attr("checked", true);
			jQuery('#mall_iradio .iradio_minimal-blue').removeClass("checked");
			jQuery('#buy_iradio_con').attr('onoff','true');
			jQuery('#mall_iradio_con').attr('onoff','false');
			jQuery('#buy_iradio_con').show();
			jQuery('#mall_iradio_con').hide();
			
		});
		jQuery('#mall_iradio input').on('ifClicked', function(){ //全选
			jQuery(this).attr("checked", true);
			jQuery('#buy_iradio .iradio_minimal-blue').removeClass("checked");
			jQuery('#buy_iradio_con').attr('onoff','false');
			jQuery('#mall_iradio_con').attr('onoff','true');
			jQuery('#buy_iradio_con').hide();
			jQuery('#mall_iradio_con').show();
		});
	}
	
	function trim(str){ //删除左右两端的空格
	    return str.replace(/(^\s*)|(\s*$)/g, "");
	}
	
	// (16)点击删除，则删除新增的产品追溯板块
	function DeleteNewTrace(obj){
		jQuery(obj).parents('.new_trace_box').remove();
	}
	// (17)新增产品追溯
	function AddNewTrace(obj){
		var _html = '<div class="new_trace_box">'+
						'<i class="btn_close" onclick="DeleteNewTrace(this)"></i>'+
						'<table width="100%" cellspacing="0" cellpadding="0">'+
							'<tr>'+
								'<th width="80">追溯时间</th>'+
								'<td width="156">'+
									'<div class="input-append date form_datetime datetime_140 fl">'+
							            '<input name=\'traceability_date\' size="26" type="text" value="" readonly="readonly" />'+
							            '<span class="add-on"><i class="icon-th"></i></span>'+
							        '</div>'+
							        "<span class='red_star'>*</span>"+
								'</td>'+
								'<th width="80">追溯内容</th>'+
								'<td>'+
									'<input name=\'traceability_content\' type="text" class="form-control ipt_txt140 fl" value="" />'+
									"<span class='red_star'>*</span>"+
								'</td>'+
							'</tr>'+
							'<tr>'+
								'<th>追溯图片</th>'+
								'<td colspan="3">'+
									"<iframe src='#{request.contextPath}/digitalCard/productTraceabilityImages.seam?productTraceabilityid=0'" +  
										"id='productTraceabilityImagesframe_0' name='productTraceabilityImagesframe_0' frameBorder='0' scrolling='yes' width='' height='110' onLoad='' style='width:100%;height: 110px;'>"+
									"</iframe>"+
								'</td>'+
							'</tr>'+
						'</table>'+
					'</div>';
		//在按钮的前面添加新增产品追溯板块			
		jQuery(obj).before( _html );
		//添加完之后，在重新执行一下时间控件
		jQuery(".form_datetime").datetimepicker({
			format: "yyyy-mm-dd",  /* 控制显示格式，默认为空，显示小时分钟 */
		    autoclose: true,
		    weekStart: 1,
		   //startDate: "2014-08-14",
		    language:  'zh-CN',
		    startView: 3,
		    minView: 2,
		    maxView: 4,     
		    pickerPosition: "top-left"
		});
	}
	
	function submithd(){
		//种类
		var plant = jQuery('#saleProductInfo_plantid').val();
		if(plant == "undefined" || plant == "" || plant == null || plant == 0){
			jQuery("#productMsg").html("请选择作物种类!");
			jQuery("#myModal").modal('show');
			jQuery('.modal-backdrop').eq(1).css('z-index','1060');
			return false;
		}
		var mingcheng = jQuery('#pinzhong\\:mingcheng').val();
		if(mingcheng == "undefined" || mingcheng == ""){
			jQuery("#productMsg").html("品种名称不能为空!");
			jQuery("#myModal").modal('show');
			jQuery('.modal-backdrop').eq(1).css('z-index','1060');
			return false;
		}
		if(mingcheng.length > 30){
			jQuery("#productMsg").html("品种名称不能超过30字!");
			jQuery("#myModal").modal('show');
			jQuery('.modal-backdrop').eq(1).css('z-index','1060');
			return false;
		}
		jQuery("#pinzhong\\:addPlantId").val(plant);
		jQuery("#addbreed_myModal").modal("hide");
		jQuery('.selectpicker').selectpicker({size:8,dropupAuto:false});
	}
	
	//获取文件名称
	function changeFileName(name){
		jQuery("#picture").val(name);
	}
	//删除回调
	function delSaleProductInfoBack(){
		initPageEle();
		//产品删除
		jQuery('.product_left .btn_delete').bind('click',function(event){
			var saleProductInfoId = jQuery(this).attr("aa");
			delSaleProductInfo(saleProductInfoId,base_id);
			event.stopPropagation();    //  阻止事件冒泡
		}); 
		//产品重新渲染对应数据
		jQuery('.product_left .p_item').bind('click',function(event){
			var saleProductInfoId = jQuery(this).attr("aa");
			getSaleProductInfoDetailed(saleProductInfoId,base_id);
			event.stopPropagation();    //  阻止事件冒泡
		});
		
		//重新加载右侧预览页面
		jQuery("#card_view").attr("src", "#{request.contextPath}/digitalCard/card.seam?base_digital_card_id=" + baseDigitalCardId);
	}
	//产品介绍页签初始化下拉列表
	function refresh_select_sale(){
		initPageEle();
	}
	
	//初始化元素事件
	function initPageEle(){
		jQuery('.selectpicker').selectpicker({size:8,dropupAuto:false});
		//jQuery('.selectpicker').selectpicker();
		//(6)时间插件
		jQuery(".form_datetime").datetimepicker({
			format: "yyyy-mm-dd",  /* 控制显示格式，默认为空，显示小时分钟 */
		    autoclose: true,
		    weekStart: 1,
		   //startDate: "2014-08-14",
		    language:  'zh-CN',
		    startView: 3,
		    minView: 2,
		    maxView: 4,     
		    pickerPosition: "top-left"
		});
		// (8)复选框功能
		jQuery('input[class="iCheck"]').iCheck({
			checkboxClass: 'icheckbox_minimal-blue'
		});
		// (9)单选按钮功能
		jQuery('input[class="iRadio"]').iCheck({
			radioClass: 'iradio_minimal-blue'
		});
		
		jQuery('#buy_iradio input').on('ifClicked', function(){ //全选
			jQuery(this).attr("checked", true);
			jQuery('#mall_iradio .iradio_minimal-blue').removeClass("checked");
			jQuery('#buy_iradio_con').attr('onoff','true');
			jQuery('#mall_iradio_con').attr('onoff','false');
			jQuery('#buy_iradio_con').show();
			jQuery('#mall_iradio_con').hide();
			
		});
		jQuery('#mall_iradio input').on('ifClicked', function(){ //全选
			jQuery(this).attr("checked", true);
			jQuery('#buy_iradio .iradio_minimal-blue').removeClass("checked");
			jQuery('#buy_iradio_con').attr('onoff','false');
			jQuery('#mall_iradio_con').attr('onoff','true');
			jQuery('#buy_iradio_con').hide();
			jQuery('#mall_iradio_con').show();
		});
		//供应名称模糊搜索
		jQuery("#saleProductInfo_name").keyup(function(){
			var plant_name = jQuery("#saleProductInfo_name").val();
			getSerchPlant(plant_name);
		});

		jQuery('.product_left .p_item').mouseover(function(){
			jQuery(this).addClass('dq_item');
		});
		jQuery('.product_left .p_item').mouseout(function(){
			jQuery(this).removeClass('dq_item');
		});
	}

	//地图设置初始化元素
	function refresh_select_map(){
		//预览页面事件全屏
		jQuery('#mapFullScreen').on('ifChanged', function(event){
			var flag = jQuery('#mapFullScreen').is(':checked');
			if (flag) {
				jQuery("#card_view").contents().find('.btn_screen').attr('onoff','false');
				jQuery("#card_view").contents().find('.btn_screen').click();
			}else{
				jQuery("#card_view").contents().find('.btn_screen').attr('onoff','true');
				jQuery("#card_view").contents().find('.btn_screen').click();
			}
		});
		//预览页面事件显示天气
		jQuery('#cardWeather').on('ifChanged', function(event){
			var flag = jQuery('#cardWeather').is(':checked');
			if (flag) {
				jQuery("#card_view").contents().find("#base_card_weather").show();
			}else{
				jQuery("#card_view").contents().find("#base_card_weather").hide();
			}
		});
		//预览页面事件显示种植
		jQuery('#cardPlant').on('ifChanged', function(event){
			var flag = jQuery('#cardPlant').is(':checked');
			if (flag) {
				jQuery("#card_view").contents().find("#digitalCardMapFrame")[0].contentWindow.displayPlantList(true);
			}else{
				jQuery("#card_view").contents().find("#digitalCardMapFrame")[0].contentWindow.displayPlantList(false);
			}
		});
		//预览页面事件显示硬件
		jQuery('#cardEquipment').on('ifChanged', function(event){
			var flag = jQuery('#cardEquipment').is(':checked');
			if (flag) {
				jQuery("#card_view").contents().find("#digitalCardMapFrame")[0].contentWindow.displayDevice(true);
			}else{
				jQuery("#card_view").contents().find("#digitalCardMapFrame")[0].contentWindow.displayDevice(false);
			}
		});
		//预览页面事件显示航拍
		jQuery('#cardAerial').on('ifChanged', function(event){
			var flag = jQuery('#cardAerial').is(':checked');
			if (flag) {
				jQuery("#card_view").contents().find("#base_card_aerial").show();
				jQuery("#cardAerial_set").show();
			}else{
				jQuery("#card_view").contents().find("#base_card_aerial").hide();
				jQuery("#cardAerial_set").hide();
				//取消选中选择的航拍
				jQuery('#choose_list_area li').each(function(){
					jQuery(this).removeClass('lCur');
				});
			}
		});
		//预览页面事件显示全景
		jQuery('#cardPanorama').on('ifChanged', function(event){
			var flag = jQuery('#cardPanorama').is(':checked');
			if (flag) {
				jQuery("#card_view").contents().find("#base_card_panorama").show();
				jQuery("#cardPanorama_set").show();
			}else{
				jQuery("#card_view").contents().find("#base_card_panorama").hide();
				jQuery("#cardPanorama_set").hide();
				//取消选中选择的全景
				jQuery('#choose_list_panorama li').each(function(){
					jQuery(this).removeClass('lCur');
				});
			}
		});
	}
	//创建新的数字名片
	function addBaseCard(){
		var new_base_id = 0;
		jQuery('#choose_list_base li').each(function(){
			if(jQuery(this).hasClass('lCur')){
				new_base_id = jQuery(this).attr("aa");
			}
		});
		if(new_base_id == 0){
			jQuery("#productMsg").html("请先选择基地!");
			jQuery("#myModal").modal('show');
			return;
		}
		jQuery('#selectBaseDiv .siteSelection .siteSeleBd').find("#selected" + new_base_id).addClass("active");
		jQuery(".siteSeleHd").html(jQuery('#selectBaseDiv .siteSelection .siteSeleBd').find("#selected" + new_base_id).find("a").html());
		createNewBaseCard(new_base_id);
	}
	
	//复制分享链接
	function copy_(){
		jQuery("#card_url")[0].select();
		document.execCommand("Copy");
		alert('已复制该内容');
	}
	//名片搜索
	function serch_card(){
		serchBaseCard();
	}
	//点击创建名片是否需要弹框
	function create_card_choosebase(){
		var bid = '#{sessionTake.baseModel.baseId}';
		if(bid == 0){
			jQuery("#choosebaseModal").modal('show');
		}else{
			createNewBaseCard(bid);
		}
	}
	//获取产品认证、产品检测所有的图片
	function getAllHonorImg(){

		var img_url_arr = new Array();
		//营业执照
		var businessImgUrl = jQuery("#businessImgUrlDiv").css("background-image").replace("url(\"","").replace("\")","");
		if(businessImgUrl.indexOf("file_btn100_3.jpg") == -1){
			var content = jQuery("#businessimgcontent").val();
			var imgInfo = new honorImg(businessImgUrl,content);
			img_url_arr.push(imgInfo);
		}
		//公众号
		var wechatImgUr = jQuery("#wechatImgUrlDiv").css("background-image").replace("url(\"","").replace("\")","");
		if(wechatImgUr.indexOf("file_btn100_3.jpg") == -1){
			var content = jQuery("#wechatimgcontent").val();
			var imgInfo = new honorImg(wechatImgUr,content);
			img_url_arr.push(wechatImgUr);
		}
		//企业荣誉
		/* jQuery("#base_honorimage").prevAll().each(function(){
			img_url_arr.push(jQuery(this).attr("src"));
		}); */
		if(honorImgArr.length > 0){
			for(var i=0;i<honorImgArr.length;i++){
				img_url_arr.push(honorImgArr[i]);
			}
		}
		//产品检测
		jQuery(".rusticWaterDetection").each(function(){
			var type = jQuery(this).find(".selectpicker").val();
			 if('请选择' != jQuery(this).find(".selectpicker").next().find(".btn-default").attr("title")){
				 type = jQuery(this).find(".selectpicker").next().find(".btn-default").attr("title") + "检测";
			 }
			 jQuery(this).find("iframe").contents().find(".plant_imgbd").each(function(){
				 var imgInfo = new honorImg(jQuery(this).attr("src"),type);
				 //img_url_arr.push(jQuery(this).attr("src"));
				 img_url_arr.push(imgInfo);
			});
		});
		//产品认证
		jQuery(".companyHouonr").each(function(){
			 var type = jQuery(this).find("select[name='dataDic']").val();
			 if('请选择' != jQuery(this).find("select[name='dataDic']").next().find(".btn-default").attr("title")){
				 type = jQuery(this).find("select[name='dataDic']").next().find(".btn-default").attr("title")+ "认证";
			 }
			jQuery(this).find("iframe").contents().find(".plant_imgbd").each(function(){
				 var imgInfo = new honorImg(jQuery(this).attr("src"),type);
				//img_url_arr.push(jQuery(this).attr("src"));
				img_url_arr.push(imgInfo);
			});
		});
		console.log(img_url_arr);
		return img_url_arr;
	}
	//供应名称搜索回调
	function serchPlantBack(data){
		jQuery('#saleProductInfo_plantid').get(0).selectedIndex = 1; 
		var plantId = jQuery('#saleProductInfo_plantid').val();
		if(plantId == null || plantId == ""){
			plantId = 0;
		}
		jQuery('.selectpicker').selectpicker();
		change2(plantId,base_id);
	}

	//预览面页事件
	function base_service_event(){
		jQuery('#base_sales_mode,#base_matching_ability').find(".iCheck").on('ifChanged', function(event){
			var flag = jQuery(this).is(':checked');
			if (flag) {
				jQuery("#card_view").contents().find("#base_matching_ability").show();
				jQuery("#card_view").contents().find("#base_matching_ability_head").show();
				
				var title = jQuery(this).attr("title");
				var title_html = "";
				var flag = 0;
				jQuery("#card_view").contents().find("#base_matching_ability p").each(function(){
					if(jQuery(this).attr("aa") == title){
						flag = 1;
					}
				});
				if(flag == 0){
					title_html = "<p class='text_chain' aa='" + title + "'>" + title + "</p>";
					jQuery("#card_view").contents().find("#base_matching_ability").append(title_html);
				}
			}else{
				var title = jQuery(this).attr("title");
				jQuery("#card_view").contents().find("#base_matching_ability p").each(function(){
					if(jQuery(this).attr("aa") == title){
						jQuery(this).remove();
					}
				});

				var is_view = 0;
				jQuery("#base_sales_mode").find(".iCheck").each(function(){
					if(jQuery(this).is(":checked")){
						is_view = 1;
					}
				});
				jQuery("#base_matching_ability").find(".iCheck").each(function(){
					if(jQuery(this).is(":checked")){
						is_view = 1;
					}
				});
				if(is_view == 0){
					jQuery("#card_view").contents().find("#base_matching_ability").hide();
					jQuery("#card_view").contents().find("#base_matching_ability_head").hide();
				}
			}
		});
	}
	//删除数字名片
	function delBaseCard(){
		if(baseDigitalCardId == 0){
			jQuery("#productMsg").html("请先选择一个数字名片!");
			jQuery("#myModal").modal('show');
			return;
		}
		delBaseDigitalCard(baseDigitalCardId);
		jQuery(".inben_first1:first").find("a").click();
	}

	//数字名片搜索
	function serchBaseCard(){
		var serch = jQuery("#baseCardSerch").val();
		serBaseDigitalCard(serch);
	}
//]]>
</script>
<!--[if IE 8]>
<script type="text/javascript" src="../js/bootstrap/respond.js"></script>
<![endif]-->
<script type="text/javascript" src="#{request.contextPath}/asset/js/digitalCard/Card.js"></script>
</ui:define>

</ui:composition>
