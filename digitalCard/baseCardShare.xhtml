<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">
	<meta name="viewport" content="initial-scale=1.0, width=device-width, maximum-scale=1.0, user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" /> 
	<meta name="format-detection" content="telephone=no" />
	
	<script type="text/javascript">
		var ResizeSize = function (){
				var _html = document.documentElement;
				var _width = _html.getBoundingClientRect().width;
				//var _width = document.body.clientWidth;
				if(_width>=640){
					_width=640
				}
				var _scale = _width/6.4 +'px';
				_html.style.fontSize = _scale;
			}
		ResizeSize();
		window.onresize = function (){
			ResizeSize();
		}
	</script>
	<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/digitalCard/card/commons.css" />
	<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/digitalCard/card/swiper-3.4.0.min.css" />
	<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/digitalCard/card/default_skin.css" />
	<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/digitalCard/card/weixinCard.css" />
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
	<style >
		.anchorBL{ display:none;}	
		.supply_box .txt_total span{float:left;width: 1.0rem;}
		.supply_box .txt_total{width: 4.0rem;}
	</style>
<body class="card_body">
<!-- #{baseCardShareHome.initCardPreview()} -->
	<div class="card_main">
		<!--农场风光swiper-->
	<div class="swiper-container swiper_scenery" id="swiper_scenery">
			<div class="swiper-wrapper">
			</div>
		</div>
		<!--生产追溯swiper-->
		
		<!--荣誉swiper-->
		<div class="swiper-container swiper_honor" id="swiper_honor">
			<div class="swiper-wrapper">
			</div>
		</div>
		<!-- 农场地图板块 -->
		<div class="map_wrap" id="big_map">
			<!-- <img class="temp_map" src="#{request.contextPath}/asset/images/digitalCard/card/temp_map.jpg"/> -->
			<iframe src="" 
				id="digitalCardMapFrame" name="digitalCardMapFrame" frameBorder="0" scrolling="yes" width="" onLoad="" style="width:100%;height: 100%;">
			</iframe>
			<div class="fixed_head">
				<p class="txt_site"><img src="#{request.contextPath}/asset/images/digitalCard/card/icon_point.png"/><span class="txt_province" id="base_area"></span></p>
				<p class="txt_area" id="base_muNumber"></p>
			</div>
			<div class="weather_block" id="base_card_weather">
				<dl class="weather_con">
					<dt>
						<img src="#{request.contextPath}/asset/images/digitalCard/card/icon_weather01.png" id="base_weather_img"/>
					</dt>
					<dd>
						<div>
							<p class="txt_zhishu ellipsis"><img src="#{request.contextPath}/asset/images/digitalCard/card/icon_zhishu.png" id="base_waste_img"/></p>
							<p class="txt_tianqi ellipsis" id="base_weather"></p>
						</div>
					</dd>
				</dl>
			</div>
			<div class="map_block">
				<!-- <img src="#{request.contextPath}/asset/images/digitalCard/card/temp_map2.jpg"/> -->
				<div class="farmmapimg" style="width:100%; height:100%;" id="map-canvas"/>
			</div>
			<div class="btn_screen" onoff="false" id="base_full_screen">
				<img width="100%" height="100%" src="#{request.contextPath}/asset/images/digitalCard/card/btn_fullscreen.png"/>
			</div>
			<div class="btn_pano" id="base_card_panorama" >
				<img width="100%" height="100%" id="abc" src="#{request.contextPath}/asset/images/digitalCard/card/btn_pano.png" onclick="openwin(1,this)"/>
			</div>
			<div class="btn_aerial" id="base_card_aerial">
				<img width="100%" height="100%" src="#{request.contextPath}/asset/images/digitalCard/card/btn_aerial.png" onclick="openwin(2,this)"/>
			</div>
			<div class="markmapopa"></div>
		</div>
		<!-- 农场风光板块  -->
		<div class="farm_scenery">
			<div id="scenery-phase" class="phase-row" data-title="Illustrations" data-coloroverlap="light">
				<div id="scenery-slider" class="sky-carousel sc-no-select">
					<div class="sky-carousel-wrapper">
						<ul class="sky-carousel-container">
						</ul>
					</div>
					<canvas class="sc-overlay sc-overlay-left" width="300" height="1"></canvas>
					<canvas class="sc-overlay sc-overlay-right" width="300" height="1"></canvas>
				</div>
			</div>
			<div class="scenery_dot">
			</div>
			<!--农场风光轮播结束-->
		</div>
		<div class="farm_introduce">
			<div class="title_head clear">
				<h3><img src="#{request.contextPath}/asset/images/digitalCard/card/icon_ncqh.jpg" />农场气候</h3>
			</div>
			<div class="more_body climate_box" style="display: block;">
				<dl>
					<dt>
						<p class="txt_num" id="base_altitude"></p>
						<p class="txt_date">海拔<span class="txt_hb" id="base_altitude_class">低海拔</span></p>
					</dt>
					<dd>
						<img class="txt_icon" src="#{request.contextPath}/asset/images/digitalCard/card/icon_haiba.png" />
					</dd>
				</dl>
				<dl class="ml40">
					<dt>
						<p class="txt_num" id="base_rainfall"></p>
						<p class="txt_date">累计降水量<span class="txt_hb" id="base_rainfall_class"></span></p>
					</dt>
					<dd>
						<img class="txt_icon" src="#{request.contextPath}/asset/images/digitalCard/card/icon_jiangshui.png" />
					</dd>
				</dl>
				<dl>
					<dt>
						<p class="txt_num" id="base_air_temp"></p>
						<p class="txt_date">平均温度<span class="txt_hb" id="base_air_temp_class"></span></p>
					</dt>
					<dd>
						<img class="txt_icon" src="#{request.contextPath}/asset/images/digitalCard/card/icon_pingwen.png" />
					</dd>
				</dl>
				<dl class="ml40">
					<dt>
						<p class="txt_num" id="base_temp_diff">10.3℃</p>
						<p class="txt_date">平均昼夜温差<span class="txt_hb" id="base_temp_diff_class"></span></p>
					</dt>
					<dd>
						<img class="txt_icon" src="#{request.contextPath}/asset/images/digitalCard/card/icon_zhouwen.png" />
					</dd>
				</dl>
			</div>
			<!--农场介绍-->
			<div class="title_head clear" id="base_description_head">
				<h3><img src="#{request.contextPath}/asset/images/digitalCard/card/icon_ncjs.jpg" />农场介绍</h3>
				<a class="btn_more" onclick="ViewMorebaseFn(this,'dq_top','.introduce_box')" href="javascript:;">查看更多<i></i></a>
			</div>
			<div class="more_body introduce_box" id="base_description"></div>
			<!--配套能力和服务-->
			<div class="title_head clear" id="base_matching_ability_head">
				<h3><img src="#{request.contextPath}/asset/images/digitalCard/card/icon_ncjs.jpg" />配套能力和服务</h3>
				<a class="btn_more" onclick="ViewMorebaseFn(this,'dq_top','.service_box')" href="javascript:;">查看更多<i></i></a>
			</div>
			<div class="more_body service_box" id="base_matching_ability">
			</div>
			<!--公司下属其它农场-->
			<div class="title_head clear" id="other_card_arr_head">
				<h3><img src="#{request.contextPath}/asset/images/digitalCard/card/icon_ncjs.jpg" />公司下属其它农场</h3>
				<a class="btn_more" onclick="ViewMorebaseFn(this,'dq_top','.otherfarm_box')" href="javascript:;">查看更多<i></i></a>
			</div>
			<div class="more_body otherfarm_box">
				<ul id="other_card_arr">
				</ul>
			</div>
			<!--公司下属其它农场-->
		</div>
		<!--可供应产品-->
		<div class="farm_supply">
			<h2 class="title_h2" id="sale_product_info">可供应产品</h2>
		</div>
		<!--荣誉-->
		<div class="farm_honor">
			<h2 class="title_honor">
				<img src="#{request.contextPath}/asset/images/digitalCard/card/icon_honor.png"/>
			</h2>
			<div id="honor-phase" class="phase-row" data-title="Illustrations" data-coloroverlap="light">
				<div id="honor-slider" class="sky-carousel sc-no-select">
					<div class="sky-carousel-wrapper">
						<ul class="sky-carousel-container" id="honor_img_li">
						</ul>
					</div>
					<div class="sc-content-wrapper">
						<div class="sc-content-container">
							<div class="sc-content">
								<h2>Thinker</h2>
							</div>
						</div>
					</div>
					<canvas class="sc-overlay sc-overlay-left" width="300" height="1"></canvas>
					<canvas class="sc-overlay sc-overlay-right" width="300" height="1"></canvas>
				</div>
			</div>
			<!--荣誉轮播结束-->
			<div class="ellipsis honor_signtxt"></div>
		</div>
		<!--底部信息-->
		<div class="farm_nowsite">
			<p class="txt_company"><img src="#{request.contextPath}/asset/images/digitalCard/card/icon_site.png" id="base_address"/></p>
			<p class="txt_contact"><img src="#{request.contextPath}/asset/images/digitalCard/card/icon_people.png" /><span id="base_contact" class="base_contact ellipsis"></span> <span class="txt_line"></span><img src="#{request.contextPath}/asset/images/digitalCard/card/icon_phone.png" /><span class="base_phone ellipsis" id="base_phone"></span></p>
			<a class="hereto_link" href="javascript:;"></a>
			<p class="goto_farmshow">
				<a target="_top" href="#{dataDicConstant.getWeixinMenuUrl()}">
					<img src="#{request.contextPath}/asset/images/digitalCard/card/link_farmshow.png" />
				</a>
			</p>
		</div>
		<!--底部信息-->
		<!--农场风光swipper-->
		<!--<div class="swiper-container">
			<div class="swiper-wrapper">
				<div class="swiper-slide blue-slide">slider1</div>
				<div class="swiper-slide red-slide">slider2</div>
				<div class="swiper-slide orange-slide">slider3</div>
			</div>
		</div>-->
		<!--农场风光swipper-->
	</div>
	<script type="text/javascript" src="#{request.contextPath}/asset/new/jquery.js"></script>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&amp;ak=pokmWUvo4GzGDVGGBb8HrM9h"></script>
	<a4j:form>
		<a4j:jsFunction name="saveforward" action="#{baseCardShareHome.shareCardRecord}">
			<a4j:actionparam name="baseCardId" assignTo="#{baseCardShareHome.baseCardId}"/>
		</a4j:jsFunction>
	</a4j:form>
	<script>
//<![CDATA[
	var baseCardId = "#{baseCardShareHome.baseCardId}";
	
	function fenxiang(myname1,enName1,imgUrl1,myurl1){
		jQuery.ajax({
			url : url,
			data : {url:myurl1},
			dataType: 'jsonp',  
			crossDomain: true,  
			success: function (data) { 
				var wNoncestr=data.noncestr;
				var wTimestamp=data.timestamp;
				var wsignature=data.signature;
				var appId = data.appid;
				wx.config({
					debug:false,
					appId:appId,
					timestamp:wTimestamp,
					nonceStr:wNoncestr,
					signature:wsignature,
					jsApiList: ['checkJsApi',
							'onMenuShareTimeline',
							'onMenuShareAppMessage',
							'onMenuShareQQ',
							'onMenuShareWeibo','startRecord'
							]
				});
				//步骤四：通过ready接口处理成功验证    
				wx.ready(function(){            
					wx.checkJsApi({                
						jsApiList: ['onMenuShareTimeline']
					});
					wx.onMenuShareTimeline({
						title: myname1,
						desc: enName1,
						link: myurl1,
						imgUrl: imgUrl1,
						trigger: function(res) {// 不要尝试在trigger中使用ajax异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用ajax的回包会还没有返回
						},
						success: function(res) {
							saveforward(baseCardId);
						},
						cancel: function(res) {
						}
					});
					wx.onMenuShareAppMessage({
						title: myname1,
						desc: enName1,
						link: myurl1,
						imgUrl: imgUrl1,
						trigger: function (res) {// 不要尝试在trigger中使用ajax异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用ajax的回包会还没有返回
						},
						success: function (res) {
							saveforward(baseCardId);
						},
						cancel: function (res) {
						},
						fail: function (res) {
						}
					});
					wx.onMenuShareQQ({
						title: myname1,
						desc: enName1,
						link: myurl1,
						imgUrl: imgUrl1,
						trigger: function (res) {
						},
						complete: function (res) {
						},
						success: function (res) {
							saveforward(baseCardId);
						},
						cancel: function (res) {
						},
						fail: function (res) {
						}
					});
				})
				/* wx.error(function(res){

					 alert('wx.error: '+JSON.stringify(res));

				}); */
			},
		    error: function(XMLHttpRequest, textStatus, errorThrown){
			}
		})
	}
	/* 微信接口 结束 */
	var url = "#{dataDicConstant.getWxDomainNameUrl()}/weixinservice/farmeasy/adopter?callback=?&method=js_ticket";
	var myurl = window.location.href.split("#")[0];
	var card_title = '#{baseCardShareHome.baseDigitalCard.shareTitle}';
	var card_content = '#{baseCardShareHome.baseDigitalCard.shareContent}';
	if(card_content == null || card_content == ""){
		card_content = "数字名片";
		var data = '#{baseCardShareHome.base_info_str}';
		if(data != ""){
			data = data.replace(/[\r\n]/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;");
			var base_info = jQuery.parseJSON(data);
			var base_description = base_info.base_description;
			if(base_description != null && base_description != ""){
				card_content = base_description;
			}
		}
	}
	var card_img = '#{baseCardShareHome.baseDigitalCard.shareImgUrl}';
	fenxiang(card_title,card_content,card_img,myurl);
//]]>
</script>

	<script type="text/javascript">
	//<![CDATA[
		$ = jQuery.noConflict();
		jQuery(function(){
			var data = '#{baseCardShareHome.base_info_str}';
			if(data != ""){
				data = data.replace(/[\r\n]/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;");
				var base_info = jQuery.parseJSON(data);
				if(base_info.base_card_title.length > 10){
					jQuery(document).attr('title',base_info.base_card_title.substr(0,10) + "...");
				}else{
					jQuery(document).attr('title',base_info.base_card_title);
				}
				
				var base_enterpriseInfoId = base_info.base_enterpriseInfoId;
				var base_id = base_info.base_id;
				var base_card_plant = base_info.base_card_plant;
				var base_card_equipment = base_info.base_card_equipment;
				//加载地图
				jQuery("#digitalCardMapFrame").attr("src", "../DigitalCardMap.seam?enterprise_Id=" 
						+ base_enterpriseInfoId + "&base_Id=" + base_id + "&showDevice=" + base_card_equipment + "&showPlant=" + base_card_plant);
				//小地图
				var base_latitude = base_info.base_latitude;
				var base_longitude = base_info.base_longitude;
				if(base_latitude != "" && base_longitude != ""){
					var myIcon = new BMap.Icon("/asset/images/digitalCard/marker_single.png", new BMap.Size(16, 25), {  
                        offset: new BMap.Size(10, 25), // 指定定位位置  
                        imageOffset: new BMap.Size(0, 0) // 设置图片偏移  
                    });  
					var map = new BMap.Map("map-canvas");    
					var point = new BMap.Point(base_latitude,base_longitude);
					map.centerAndZoom(point, 13);    
					var marker = new BMap.Marker(point,{icon:myIcon});    
					map.addOverlay(marker);
					//到这里连接
					var base_name = base_info.base_name;
					jQuery(".hereto_link").attr("target","_blank");
					jQuery(".hereto_link").attr("href","http://api.map.baidu.com/marker?location=" + base_longitude +"," + base_latitude + "&title=" + base_name + "&content=" + base_info.base_address + "&output=html&src=acsm|acsm");
				}
				//是否全屏
				var base_full_screen = base_info.base_full_screen;
				if(base_full_screen == true){
					jQuery(".btn_screen").attr('onoff','true');
					jQuery(".btn_screen").find('img').attr('src','#{request.contextPath}/asset/images/digitalCard/card/btn_smallscreen.png');
					jQuery('#big_map').addClass('bigmap');
					jQuery('.card_main').css('overflow-y','hidden');
					jQuery('.markmapopa').hide();
				}else{
					jQuery(".btn_screen").attr('onoff','false');
					jQuery(".btn_screen").find('img').attr('src','#{request.contextPath}/asset/images/digitalCard/card/btn_fullscreen.png');
					jQuery('#big_map').removeClass('bigmap');
					jQuery('.card_main').css('overflow-y','auto');
					jQuery('.markmapopa').show();
				}
				//是否显示四季全景
				var base_card_panorama = base_info.base_card_panorama;
				if(base_card_panorama != null && base_card_panorama != 0){
					jQuery("#base_card_panorama").show();
					jQuery("#base_card_panorama").attr("aa",'#{dataDicConstant.getDomainNameUrl()}/Panorama.seam?gid=' + base_card_panorama);
				}else{
					jQuery("#base_card_panorama").hide();
				}
				//是否显示航拍
				var base_card_aerial = base_info.base_card_aerial;
				if(base_card_aerial != null && base_card_aerial != 0){
					jQuery("#base_card_aerial").show();
					jQuery("#base_card_aerial").attr("aa",'#{dataDicConstant.getDomainNameUrl()}/map/AerialVideo.seam?groupId=' + base_card_aerial);
				}else{
					jQuery("#base_card_aerial").hide();
				}
				//是否显示天气
				var base_card_weather = base_info.base_card_weather;
				if(base_card_weather == true){
					jQuery("#base_card_weather").show();
				}else{
					jQuery("#base_card_weather").hide();
				}
				//天气 
				var base_weather_img = base_info.base_weather_img;
				var base_weather = base_info.base_weather;
				var base_weather_day_night = base_info.base_weather_day_night;
				var base_waste_count = base_info.base_waste_count;
				if(base_weather_day_night != ""){
					if(base_weather_day_night == "d"){
						if(base_weather_img.length == 1){
							base_weather_img = "0" + base_weather_img;
						}
						jQuery("#base_weather_img").attr("src","/asset/images/icon/day/" + base_weather_img + ".png");
					}else{
						if(base_weather_img.length == 1){
							base_weather_img = "0" + base_weather_img;
						}
						jQuery("#base_weather_img").attr("src","/asset/images/icon/night/" + base_weather_img + ".png");
					}
				}
				if(base_weather != ""){
					jQuery("#base_weather").html(base_weather);
				}
				if(base_waste_count != 0){
					jQuery("#base_waste_img").attr("src","#{request.contextPath}/asset/images/weather/resource/4.png");
					jQuery("#base_waste_img").after("有污染(有" + base_waste_count + "家)");
				}else{
					jQuery("#base_waste_img").after("无污染");
				}
				
				//省
				var base_prov = base_info.base_prov;
				if(base_prov != ""){
					jQuery("#base_area").html(base_prov);
				}
				//市
				var base_district = base_info.base_district;
				if(base_district != ""){
					jQuery("#base_area").after("·" + base_district);
				}
				//海拔
				var base_altitude = base_info.base_altitude;
				var base_altitude_class = base_info.base_altitude_class;
				if(base_altitude != ""){
					jQuery("#base_altitude").html(base_altitude + "m");
					jQuery("#base_altitude_class").html(base_altitude_class);
				}else{
					jQuery("#base_altitude").html("--m");
					jQuery("#base_altitude_class").hide();
				}
				//降水量
				var base_rainfall = base_info.base_rainfall;
				var base_rainfall_class = base_info.base_rainfall_class;
				jQuery("#base_rainfall").html(base_rainfall + "mm");
				jQuery("#base_rainfall_class").html(base_rainfall_class);
				//温度
				var base_air_temp = base_info.base_air_temp;
				var base_air_temp_class = base_info.base_air_temp_class;
				jQuery("#base_air_temp").html(base_air_temp + "℃");
				jQuery("#base_air_temp_class").html(base_air_temp_class);
				//温差
				var base_temp_diff = base_info.base_temp_diff;
				var base_temp_diff_class = base_info.base_temp_diff_class;
				jQuery("#base_temp_diff").html(base_temp_diff + "℃");
				jQuery("#base_temp_diff_class").html(base_temp_diff_class);
				//农场介绍
				if(base_info.base_description != null && base_info.base_description != ""){
					jQuery("#base_description").html(base_info.base_description.replace(/</g,"&lt;").replace(/>/g,"&gt;"));
				}else{
					jQuery("#base_description_head").hide();
					jQuery("#base_description").hide();
				}
				//地址
				if(base_info.base_address != null && base_info.base_address != ""){
					jQuery("#base_address").after(base_info.base_address);
				}else{
					jQuery("#base_address").after("暂无");
				}
				//联系人
				if(base_info.base_contact != null && base_info.base_contact != ""){
					jQuery("#base_contact").html(base_info.base_contact);
				}else{
					jQuery("#base_contact").html("暂无");
				}
				//电话
				if(base_info.base_phone != null && base_info.base_phone != ""){
					jQuery("#base_phone").html(base_info.base_phone);
				}else{
					jQuery("#base_phone").html("暂无 ");
				}
				//面积
				jQuery("#base_muNumber").html("农场面积：" + base_info.base_muNumber + "亩");
				//农场实景
				var width = jQuery(window).width();
				var base_real_img = base_info.base_real_img;
				if(base_real_img != ""){
					var img_html1 = "";
					var img_html2 = "";
					var img_html3 = "";
					var img_info_length = base_real_img.length;
					for(var i=0;i<base_real_img.length;i++){
						var img_info = base_real_img[i];
						img_html1 += "<div class='swiper-slide'>"+
							"<div class='con_center'>"+
								"<img src='" + img_info.img_url + "?x-oss-process=image/resize,m_lfit,w_" + width + "'/>"+
								"<p class='txt_con'>"+ img_info.img_content +"</p>"+
								"<p class='txt_total'>" + (i + 1) +"/" + img_info_length + "</p>"+
							"</div>"+
							"</div>";
						img_html2 += "<li>"+
							"<img src='" + img_info.img_url + "@200w_134h_1e_1c_1o.src' class='sc-image' />";
							if(img_info.img_content != null && img_info.img_content != ""){
								img_html2 += "<div class='sc-content'>"+
									"<p>" + img_info.img_content + "</p>"+
								"</div>";
							}
							img_html2 += "</li>";
						img_html3 += "<span></span>";
					}
					jQuery("#swiper_scenery").children().html(img_html1);
					jQuery("#scenery-slider").children().children().html(img_html2);
					jQuery(".scenery_dot").html(img_html3);
					var sceneryCarousel = jQuery('#scenery-slider').carousel({
						itemWidth: 200,
						itemHeight: 134,
						distance: 10,
						selectedItemDistance: 70,
						selectedItemZoomFactor: 1,
						unselectedItemZoomFactor: 0.2,
						unselectedItemAlpha: 0.9,
						motionStartDistance: 200,
						topMargin: 10,
						gradientStartPoint: 0.35,
						gradientOverlayColor: "#ebebeb",
						gradientOverlaySize: 190,
						selectByClick: false,
						topMargin : 5,
						navigationButtonsVisible : true,
						autoSlideshow: true
					});
					//默认第几个点是选中的
					jQuery('.scenery_dot span').eq(jQuery('#scenery-slider li.sc-selected').index()).addClass('dq_dot');
					//当滑屏时，点和图片都变化
					sceneryCarousel.on('closestItemChanged.sc', function(evt) {
						jQuery('.scenery_signtxt').html(jQuery('#scenery-slider li').eq(evt.item.index()).find('.sc-content h2').html() );
						jQuery('.scenery_dot span').eq(evt.item.index()).addClass('dq_dot').siblings().removeClass('dq_dot');
					});
					// (2-1)农场风光图片点击时，放大图片功能
					jQuery('#scenery-slider .sky-carousel-container li').click(function(){
						jQuery('#swiper_scenery').show();
						var _index = jQuery(this).index();
						var mySwiper;
						mySwiper = new Swiper('#swiper_scenery',{
							initialSlide : _index,
							loop: false,
							lazyLoading : true,
							lazyLoadingInPrevNext : true,
						});
						if(_index == 0){
							//如果是第一个会有问题，所以在这里把translate3d设置成0
							//mySwiper.translate = '0';
							jQuery('#swiper_scenery .swiper-wrapper').attr('style','transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;')
						}
					});
					jQuery('#swiper_scenery').click(function(){
						jQuery(this).hide();
					});
				}else{
					jQuery(".farm_scenery").hide();
				}
				//配套能力
				var base_matching_ability = base_info.base_matching_ability;
				if(base_matching_ability != ""){
					var matching_ability_html = "";
					var name_arr = base_matching_ability.split(",");
					if(name_arr.length > 0){
						for(var i=0;i<name_arr.length;i++){
							matching_ability_html += "<p class='text_chain'>" + name_arr[i] + "</p>";
						}
					}
					jQuery("#base_matching_ability").html(matching_ability_html);
				}else{
					jQuery("#base_matching_ability").hide();
					jQuery("#base_matching_ability_head").hide();
				}
				//其它名片
				var other_card_arr = base_info.other_card_arr;
				if(other_card_arr.length > 0){
					var other_card_html = "";
					for(var i=0;i<other_card_arr.length;i++){
						other_card_html += "<li class='item_belongs' onclick='openwin(3,this)' aa='#{dataDicConstant.getDomainNameUrl()}/digitalCard/baseCardShare.seam?baseCardId=" + other_card_arr[i].card_id + "' >"+
								"<p class='ellipsis'>" + other_card_arr[i].card_name.replace(/</g,"&lt;").replace(/>/g,"&gt;") + "</p>"+
								"<i></i>"+
								"</li>";
					}
					jQuery("#other_card_arr").html(other_card_html);
				}else{
					jQuery("#other_card_arr_head").hide();
					jQuery("#other_card_arr").parent().hide();
					
				}
				//荣誉
				var base_honor_img_arr = base_info.base_honor_img;
				if(base_honor_img_arr.length > 0){
					var img_html1 = "";
					var img_html2 = "";
					var honor_img_length = base_honor_img_arr.length;
					for(var i=0;i<base_honor_img_arr.length;i++){
						var img_info = base_honor_img_arr[i];
						img_html1 += "<li>"+
								//"<img src='" + img_info.img_url + "?x-oss-process=image/resize,w_116,h_160' class='sc-image'/>"+
								"<img src='" + img_info.img_url + "@93w_128h_1e_1c_1o.src' class='sc-image'/>"+
									"<div class='sc-content'>"+
									"<h2>"+ img_info.img_content + "</h2>"+
								"</div>"+
							"</li>";
						img_html2 += "<div class='swiper-slide'>"+
							"<div class='con_center'>"+
								"<img src='"+ img_info.img_url +"?x-oss-process=image/resize,w_" + width + "'/>"+
								"<p class='txt_con'>" + img_info.img_content + "</p>"+
								"<p class='txt_total'>" + (i + 1) + "/" + honor_img_length + "</p>"+
							"</div>"+
						"</div>";
					}
					jQuery("#honor_img_li").html(img_html1);
					jQuery("#swiper_honor").children().html(img_html2);
					 // (4)荣誉轮播图
					var honorCarousel = jQuery('#honor-slider').carousel({
						itemWidth: 116, //The width of the carousel item images.
						itemHeight: 160,
						distance: 10,
						selectedItemDistance: 70,
						selectedItemZoomFactor: 1,
						unselectedItemZoomFactor: 0.2,
						unselectedItemAlpha: 0.9,
						motionStartDistance: 200,
						topMargin: 10,
						gradientStartPoint: 0.35,
						gradientOverlayColor: "#ebebeb",
						gradientOverlaySize: 190,
						selectByClick: false,
						topMargin : 5,
						navigationButtonsVisible : true,
						autoSlideshow: true
					});
					//荣誉下的内容是当前LI里的H2里的内容
					jQuery('.honor_signtxt').html(jQuery('#honor-slider li.sc-selected').find('.sc-content h2').html() );
					//当滑屏时，荣誉下的内容和图片都变化
					honorCarousel.on('closestItemChanged.sc', function(evt) {
						jQuery('.honor_signtxt').html(jQuery('#honor-slider li').eq(evt.item.index()).find('.sc-content h2').html());
					});
					// (4-1)荣誉图片点击时，放大图片功能
					jQuery('#honor-slider .sky-carousel-container li').click(function(){
						jQuery('#swiper_honor').show();
						var _index3 = jQuery(this).index();
						var mySwiper3;
						mySwiper3 = new Swiper('#swiper_honor',{
							initialSlide : _index3,
							loop: false,
							lazyLoading : true,
							lazyLoadingInPrevNext : true,
						});
						if(_index3 == 0){
							//如果是第一个会有问题，所以在这里把translate3d设置成0
							//mySwiper.translate = '0';
							jQuery('#swiper_honor .swiper-wrapper').attr('style','transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;');
						}
					});
					jQuery('#swiper_honor').click(function(){
						jQuery(this).hide();
					});
				}else{
					jQuery(".farm_honor").hide();
				}
				//供应
				var sale_product_info_arr = base_info.sale_product_info;
				if(sale_product_info_arr.length > 0){
					//所有供应元素
					var sale_product_html1 = "";
					//供应产品追溯的放大后图片整体
					var sale_product_swipers_html = "";
					for(var i=0;i<sale_product_info_arr.length;i++){
						var sale_product_info = sale_product_info_arr[i];
						//每个供应相对应的产品追溯轮播图
						var product_traceability_html = "";
						//每个供应相对应的产品追溯轮播图下边的日期
						var product_traceability_date_html = "";
						//每个供应产品追溯的放大后图片
						var swiper_img_content = "";
						//追溯
						var product_traceability_arr = sale_product_info.product_traceability;
						for(var x=0;x<product_traceability_arr.length;x++){
							var product_traceability = product_traceability_arr[x];
							product_traceability_html += "<li>"+
										//"<img src='" + product_traceability.traceability_img + "?x-oss-process=image/resize,w_" + width + "' class='sc-image'/>"+
										"<img src='" + product_traceability.traceability_img + "@200w_134h_1e_1c_1o.src' class='sc-image'/>"+
									"<div class='sc-content'>"+
										"<h2>" + product_traceability.traceability_content + "</h2>";
										if(sale_product_info.prd_description_text != null && sale_product_info.prd_description_text != ""){
											product_traceability_html += "<p>" + sale_product_info.prd_description_text + "</p>";
										}else{
											product_traceability_html += "<p style='display:none;'></p>";
										}
										product_traceability_html += "</div>"+
								"</li>";
								
							product_traceability_date_html += "<li><p><span>" + product_traceability.traceability_date_y + "</span>" + product_traceability.traceability_date_md + "</p></li>";
							
							swiper_img_content += "<div class='swiper-slide'><div class='con_center'>"+
												"<img src='" + product_traceability.traceability_img + "?x-oss-process=image/resize,w_" + width + "'/>"+
												"<p class='txt_con'>" + product_traceability.traceability_content + "</p>"+
												"<p class='txt_total'>" + (x + 1) + "/" + product_traceability_arr.length + "</p>"+
											"</div></div>";
						}
						sale_product_swipers_html += "<div class='swiper-container swiper_trace' id='swiper_trace" + i + "'><div class='swiper-wrapper'>" + swiper_img_content + "</div></div>";
						//购买连接地址
						var buy_url_info = sale_product_info.card_purchase;
						var buy_url_html = "";
						if(buy_url_info != ""){
							var buy_type = buy_url_info.content_type;
							if(buy_type == 1){
								if(buy_url_info.content != "" ){
									buy_url_html = "#{dataDicConstant.getDomainNameUrl()}/purchase/ProductDetail.html?enterprise_info_id=" + base_info.base_enterpriseInfoId + "&product_id=" + buy_url_info.content;
								}
							}else{
								buy_url_html = buy_url_info.content;
							}
						}
						var color = "";
						if(i%2 != 0){
							color = "redbgcor";
						}
						sale_product_html1 += "<dl class='supply_box " + color + " supply_box" + i + "'>"+
								"<dt>"+
								"<div class='crop_pic'>";
									if(sale_product_info.productImage != null && sale_product_info.productImage != ""){
										sale_product_html1 += "<img src='" + sale_product_info.productImage + "?x-oss-process=image/resize,w_126,h_126' />";
									}else{
										sale_product_html1 += "<img src='/asset/images/supply/productImage.png' />";
									}
									if(sale_product_info.standard != null && sale_product_info.standard != ""){
										sale_product_html1 += "<p>" + sale_product_info.standard + "</p>"; 
									}else{
										sale_product_html1 += "<p style='display:none;'></p>"; 
									}
									sale_product_html1 += "</div>";
									if(buy_url_html != null && buy_url_html != ""){
										sale_product_html1 += "<a class='buy_link' href='" + buy_url_html + "' target='_blank'>购买</a>";
									}
								sale_product_html1 += "<div class='txt_cropname'><span class='txt_name ellipsis'>" + sale_product_info.name + "</span>";
								if(sale_product_info.specs != null && sale_product_info.specs != ""){
									sale_product_html1 += "<span class='ellipsis txt_miaoshu'>" + sale_product_info.specs + "</span>";
								}
								sale_product_html1 += "</div><div class='txt_total'>"+
									"<p><span>供应量</span><strong>" + sale_product_info.supplynum + "kg</strong></p>"+
									"<p><span>供应时间</span> <strong>" + sale_product_info.supplybegintime + "-" + sale_product_info.supplyendtime + "</strong></p>"+
								"</div>";
							/* if(product_traceability_arr.length > 0){
								sale_product_html1 += "<i class='btn_down btn_up' onclick='ViewMoreFn(this,\"btn_up\",\".supply_box" + i + " dd\")'></i>";
								sale_product_html1 += "</dt>"+
								"<dd style='display: block;'>";
							}else{
								sale_product_html1 += "</dt>"+
								"<dd style='display: none;'>";
							} */
							if(i == 0){
								if(product_traceability_arr.length > 0){
									sale_product_html1 += "<a href='javascript:;' class='btn_down btn_up' onclick='ViewMoreFn(this,\"btn_up\",\".supply_box" + i + " dd\")'></a>";
									sale_product_html1 += "</dt>"+
									"<dd style='height:auto;'>";
								}else{
									sale_product_html1 += "</dt>"+
									"<dd style='height:0;overflow:hidden;'>";
								}
							}else{
								if(product_traceability_arr.length > 0){
									sale_product_html1 += "<a href='javascript:;' class='btn_down' onclick='ViewMoreFn(this,\"btn_up\",\".supply_box" + i + " dd\")'></a>";
									sale_product_html1 += "</dt>"+
									"<dd style='height:0;overflow:hidden;'>";
								}else{
									sale_product_html1 += "</dt>"+
									"<dd style='height:0;overflow:hidden;'>";
								}
							}
							
							sale_product_html1 += "<img class='trace_sign' src='#{request.contextPath}/asset/images/digitalCard/card/icon_tracetitle.png' />"+
								"<div id='trace-phase" + i +"' class='phase-row' data-title='Illustrations' data-coloroverlap='light'>"+
									"<div id='trace-slider" + i + "' class='sky-carousel sc-no-select'>"+
										"<div class='sky-carousel-wrapper'>"+
											"<ul class='sky-carousel-container'>"+
											 product_traceability_html + 
											"</ul>"+
										"</div>"+
										"<canvas class='sc-overlay sc-overlay-left' width='300' height='1'></canvas>"+
										"<canvas class='sc-overlay sc-overlay-right' width='300' height='1'></canvas>"+
									"</div>"+
								"</div>"+
								"<div class='trace_timeline'>"+
									"<p class='ellipsis trace_signtxt trace_signtxt" + i + "'></p>"+
									"<div class='trace_datelist trace_datelist" + i + "'>"+
									"<ol>"+product_traceability_date_html+
									"</ol>"+
									"</div>";
									sale_product_html1 += "</div>";
									if(sale_product_info.prd_description_text != null && sale_product_info.prd_description_text != ""){
										sale_product_html1 += "<p class='ellipsis trace_txtdetail trace_txtdetail"+ i + "'></p>";
									}else{
										sale_product_html1 += "<p class='ellipsis trace_txtdetail trace_txtdetail"+ i + "' style='display:none;'></p>";
									}
									sale_product_html1 += "</dd>"+
						"</dl>";
					}
					jQuery("#sale_product_info").after(sale_product_html1);
					jQuery("#swiper_scenery").after(sale_product_swipers_html);
					for(var i=0;i<sale_product_info_arr.length;i++){
						TraceCarousel(i);
					}
				}else{
					jQuery(".farm_supply").hide();
				}
			}

			function TraceCarousel (item){
				var traceCarousel = traceCarousel+item;
				if(jQuery('#trace-slider'+item).children().children().html() == ""){
					return;
				}
				traceCarousel = jQuery('#trace-slider'+item).carousel({
					itemWidth: 166, //The width of the carousel item images.
					itemHeight: 110,
					distance: 10,
					selectedItemDistance: 70,
					selectedItemZoomFactor: 1,
					unselectedItemZoomFactor: 0.2,
					unselectedItemAlpha: 0.9,
					motionStartDistance: 200,
					topMargin: 10,
					gradientStartPoint: 0.35,
					gradientOverlayColor: "#ebebeb",
					gradientOverlaySize: 190,
					selectByClick: false,
					topMargin : 5,
					navigationButtonsVisible : true,
					autoSlideshow: true
				});
				var trace_li_width = jQuery('.trace_datelist'+item).width()/3;
				var trace_li_len =  jQuery('.trace_datelist'+item+' li').length;
				jQuery('.trace_datelist'+item+' li').width( trace_li_width );
				jQuery('.trace_datelist'+item+' ol').css({
					'width' : trace_li_width*trace_li_len,
					'left' : -(jQuery('#trace-slider'+item+' li.sc-selected').index()-1)*trace_li_width
				});
				//生产追溯下的内容是当前LI里的H2里的内容
				jQuery('.trace_signtxt'+item).html( jQuery('#trace-slider'+item+' li.sc-selected').find('.sc-content h2').html() );
				jQuery('.trace_txtdetail'+item).html( jQuery('#trace-slider'+item+' li.sc-selected').find('.sc-content p').html() );
				//默认第几个点是选中的
				jQuery('.trace_datelist'+item+' li').eq( jQuery('#trace-slider'+item+' li.sc-selected').index()).addClass('dq_dot');
				//当滑屏时，点和图片都变化
				traceCarousel.on('closestItemChanged.sc', function(evt) {
					jQuery('.trace_signtxt'+item).html( jQuery('#trace-slider'+item+' li').eq(evt.item.index()).find('.sc-content h2').html() );
					jQuery('.trace_txtdetail'+item).html( jQuery('#trace-slider'+item+' li').eq(evt.item.index()).find('.sc-content p').html() );
					jQuery('.trace_datelist'+item+' li').eq( evt.item.index()).addClass('dq_dot').siblings().removeClass('dq_dot');
					jQuery('.trace_datelist'+item+' ol').css({
						'left' : -(evt.item.index()-1)*trace_li_width
					});
				});
				
				// (3-1)生产追溯图片点击时，放大图片功能
				jQuery('#trace-slider'+item+' .sky-carousel-container li').click(function(){
					jQuery('#swiper_trace'+item).show();
					var _index2 = jQuery(this).index();
					var mySwiper2;
					mySwiper2 = new Swiper('#swiper_trace'+item,{
						initialSlide : _index2,
						loop: false,
						lazyLoading : true,
						lazyLoadingInPrevNext : true,
					});
					if(_index2 == 0){
						//如果是第一个会有问题，所以在这里把translate3d设置成0
						//mySwiper.translate = '0';
						jQuery('#swiper_trace'+item+' .swiper-wrapper').attr('style','transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;')
					}
				});
				jQuery('#swiper_trace'+item).click(function(){
					jQuery(this).hide();
				});
			}
		});
		
		//全景、航拍、购买页面跳转
		function openwin(type,obj){
			if(type == 1){
				var url = jQuery("#base_card_panorama").attr("aa");
				window.open(url);
			}else if(type == 2){
				var url = jQuery("#base_card_aerial").attr("aa");
				window.open(url);
			}else if(type == 3){
				var url = jQuery(obj).attr("aa");
				window.open(url);
			}
		}
	//]]>
</script>
		<script type="text/javascript" src="#{request.contextPath}/asset/css/digitalCard/card/swiper-3.4.0.min.js"></script>
		<script type="text/javascript" src="#{request.contextPath}/asset/css/digitalCard/card/jquery.sky.carousel-1.0.2.min.js"></script>
		<script type="text/javascript" src="#{request.contextPath}/asset/css/digitalCard/card/Card.js"></script>
	</body>
</ui:composition>