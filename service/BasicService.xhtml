<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j"
    template="/layout/template_new.xhtml">

<ui:define name="body">
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/service/commons.css"/>
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/skinBlue.css"/>
    <link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/service/SystemBuy.css" />
    <script type="text/javascript" src="#{request.contextPath}/asset/js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="#{request.contextPath}/asset/js/icheck.js"></script>
<style>
	dt,dd{line-height: 2.428571;}
</style>
        	<!-- #{feeServiceHome.initBaseData()} -->
            <td valign="top">
            <div class="right_c systemBuy_body small_body" style="min-height:30px; padding-bottom:15px; padding-top:15px;">
            	<!-- 面包屑导航 开始 -->
                <div class="breadNav_wap mb15 clear">
                    <div class="breadNav_lt">
                        <a href="/service/ServiceCenter.seam">增值服务</a><span>&gt;</span>
                        <strong>版本升级</strong>
                    </div>
                </div>
                <!-- 系统升级购买 -->
                <div class="standard_edition clear">
                	<div class="stand_left">
                    	<img src="#{request.contextPath}/asset/images/service/SystemBuy_iconbig#{feeServiceHome.enterprisePaymentInfo.basicService.sort mod 5}.jpg" />
                        <p>#{feeServiceHome.enterprisePaymentInfo.basicService.packageName}</p>
                    </div>
                    <div class="stand_right">
                    	<div class="progress_item">
                            <div class="p_progress">
                                <p class="p_tootip"><span>基地#{feeServiceHome.baseObj[0][0]}个</span></p>
                                <div class="progress">
                                    <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width:#{feeServiceHome.baseObj[0][1]}%;"></div>
                                </div>
                            </div>
                            <p class="total_num">#{feeServiceHome.enterprisePaymentInfo.farmNum}个</p>
                        </div>
                        <div class="progress_item">
                        	<p class="total_name">培训天数</p>
                            <div class="p_progress">
                                <p class="p_tootip"><span>已培训#{feeServiceHome.enterprisePaymentInfo.trainDays}天</span></p>
                                <div class="progress">
                                    <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width:100%;"></div>
                                </div>
                            </div>
                            <p class="total_num">#{feeServiceHome.enterprisePaymentInfo.trainDays}天</p>
                        </div>
                        <div class="progress_item">
                        	<p class="total_name">账号数</p>
                            <div class="p_progress">
                                <p class="p_tootip"><span>已创建#{feeServiceHome.baseObj[1][0]}个</span></p>
                                <div class="progress">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width:#{feeServiceHome.baseObj[1][1]}%;"></div>
                                </div>
                            </div>
                            <p class="total_num">#{feeServiceHome.enterprisePaymentInfo.accountLimit}个</p>
                        </div>
                        <div class="progress_item">
                        	<p class="total_name">硬件接入数量</p>
                            <div class="p_progress">
                                <p class="p_tootip"><span>已接入#{feeServiceHome.baseObj[2][0]}个</span></p>
                                <div class="progress">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width:#{feeServiceHome.baseObj[2][1]}%;"></div>
                                </div>
                            </div>
                            <p class="total_num">#{feeServiceHome.enterprisePaymentInfo.hdNum}个</p>
                        </div>
                    </div>
                </div>     
                <!-- 基础服务 -->
                <h2 class="system_buy_title mt10">基础服务</h2> 
                <ul class="buy_edition_list clear">
                	<a4j:repeat value="#{feeServiceHome.basicServiceList}" var="_bs" rowKeyVar="_index"> 
	                	<s:fragment rendered="#{_bs.buyingOnlineFlag and 
	                	(((feeServiceHome.enterprisePaymentInfo.basicService.standardVersionFlag or feeServiceHome.enterprisePaymentInfo.basicService.basicServiceId eq _bs.basicServiceId)) or (empty feeServiceHome.enterprisePaymentInfo.basicService))}">
		                	<li class="sys_items">
		                    	<div class="buy_class_li class_common#{_bs.sort mod 5}">
		                        	<span class="line_bg"></span>
		                            <div class="edit_header">
		                            	<img src="#{request.contextPath}/asset/images/service/SystemBuy_iconqtb#{_bs.sort mod 5}.jpg" />
		                                <p class="p_txt1">#{_bs.packageName}</p>
		                            </div>
		                            <dl class="dl_dl">
		                            	<dt class="dl_dt">基地数</dt>
		                                <dd class="dl_dd">#{_bs.baseNum}</dd>
		                            </dl>
		                            <dl class="dl_dl">
		                            	<dt class="dl_dt">账号数</dt>
		                                <dd class="dl_dd">#{_bs.accountNum}</dd>
		                            </dl>
		                            <dl class="dl_dl">
		                            	<dt class="dl_dt">培训天数</dt>
		                                <dd class="dl_dd">#{_bs.trainDays}天</dd>
		                            </dl>
		                            <dl class="dl_dl dl_last">
		                            	<dt class="dl_dt">硬件接入数量</dt>
		                                <dd class="dl_dd">#{_bs.hardwareAccessNum}</dd>
		                            </dl>
		                            <div class="edit_body">
		                                <div class="year_eblock">
		                                	<a4j:repeat value="#{_bs.validityPeriod.split(',')}" var="_vp" rowKeyVar="_row" rendered="#{not empty _bs.validityPeriod}">
		                                		<span aa="#{_vp}" bb="#{_bs.basicServiceId}" cc="#{_bs.packagePrice}" class="validityPeriod#{_bs.basicServiceId} #{_row eq 0?'s_cur':''}" ><i>#{_vp}</i>年</span>
		                                	</a4j:repeat>
		                                </div>
		                                <p class="txt_price"><span>￥</span><span id="packagePrice#{_bs.basicServiceId}" aa="#{_bs.packagePrice}">#{_bs.packagePrice}</span></p>
		                                <button type="button" class="buyOrderBtn buynow_btn" onclick="checkSubmit('#{_bs.basicServiceId}','#{_bs.packagePrice}');">立即购买</button>
		                            </div>
		                        </div>
		                    </li>
	                    </s:fragment>
	                    <s:fragment rendered="#{!_bs.buyingOnlineFlag}">
	                    	<li class="sys_items">
		                    	<div class="buy_class_li class_common#{_bs.sort  mod 5 }">
		                        	<span class="line_bg"></span>
		                            <div class="edit_header">
		                            	<img src="#{request.contextPath}/asset/images/service/SystemBuy_iconqtb#{_bs.sort  mod 5}.jpg" />
		                                <p class="p_txt1">#{_bs.packageName}</p>
		                            </div>
		                            <p class="txt_phone">#{_bs.offlineContact}<br /></p>
		                        </div>
		                    </li>
	                    </s:fragment>
	                     <s:fragment rendered="#{_bs.buyingOnlineFlag and !feeServiceHome.enterprisePaymentInfo.basicService.standardVersionFlag and feeServiceHome.enterprisePaymentInfo.basicService.basicServiceId ne _bs.basicServiceId and not empty feeServiceHome.enterprisePaymentInfo.basicService}">
	                    	<li class="sys_items">
		                    	<div class="buy_class_li class_common#{_bs.sort  mod 5 }">
		                        	<span class="line_bg"></span>
		                            <div class="edit_header">
		                            	<img src="#{request.contextPath}/asset/images/service/SystemBuy_iconqtb#{_bs.sort  mod 5}.jpg" />
		                                <p class="p_txt1">#{_bs.packageName}</p>
		                            </div>
		                            <p class="txt_phone">请拨打400-8199-586<br />与我们联系！</p>
		                        </div>
		                    </li>
	                    </s:fragment>
                    </a4j:repeat>               	              	
                </ul>
                <!-- 购买协议内容 -->
                <div class="buy_rotocol mt10 mb20 clear">
                	<p class="txt_tip1 clear"><input type="checkbox" class="iCheck" name="testCheck" id="agreeBtn" checked="checked" />我已阅读并同意<a href="ServiceAgreement.html" target="_blank">《义田帮手服务购买协议》</a></p>
                    <p class="txt_tip2">注：平均每基地不超过5000亩。培训按农场所在区域提供远程或上门服务。<br /> 
					对硬件接入的品牌、网络环境等要求，请咨询义田客服。
                    </p>
                </div>
                <!-- 系统升级购买 -->
            </div>
            <h:form id="basicForm" name="basicForm">
            	<h:inputHidden value="#{feeServiceHome.serviceId}" id="hidServiceId"/>
            	<h:inputHidden value="#{feeServiceHome.serviceYear}" id="hidServiceYear" />
            	<h:inputHidden value="#{feeServiceHome.serviceType}" id="hidServiceType" />
            	<h:commandButton id="saveOrderBtn" style="display:none;" value="立即购买" action="#{feeServiceHome.addServiceOrder()}"/>
            </h:form>
            </td>    
<script>
//<![CDATA[
   	var agreeStu="1";//协议选中状态 1选中
   	var validityYear=0;//有效年
   	var selYearserviceId=0;//选中的有效期是否与购买的服务一致
	jQuery(function(){
		 // 系统升级购买页面--进度条鼠标滑过提示位置
	    jQuery('.progress_item').each(function(index, elem) {
	    	jQuery( elem).find('.p_tootip').css( 'left' , jQuery( elem ).find('.progress-bar').width() );
	    	jQuery( elem).find('.progress').css( 'width' , jQuery( elem ).find('.p_progress').width() );	 
	    });	
		
		//系统升级购买页面--购买协议的复选框
		jQuery('input[class="iCheck"]').iCheck({
			checkboxClass: 'icheckbox_minimal-blue'
		});
		
		//系统升级购买页面--版本及版本的年限购买选择
		jQuery('.year_eblock span').each(function(index, elem) {
	        jQuery( elem ).click(function(){
	        	validityYear=jQuery(this).attr("aa");
	        	selYearserviceId=jQuery(this).attr("bb");
	        	var price=jQuery(this).attr("cc");
	        	jQuery("#packagePrice"+selYearserviceId).html(parseFloat(price)*parseInt(validityYear));
				jQuery(this).addClass('s_cur').siblings().removeClass('s_cur');	
				//jQuery(this).parents('.sys_items').siblings().find('.year_eblock span').removeClass('s_cur');	
			});
	    });
	
		jQuery(window).resize(function(){		
			// 服务中心页面--进度条鼠标滑过提示位置
			jQuery('.progress_item').each(function(index, elem) {
				jQuery( elem).find('.p_tootip').css( 'left' , jQuery( elem ).find('.progress-bar').width() );
				jQuery( elem).find('.progress').css( 'width' , jQuery( elem ).find('.p_progress').width() );			 
			});				
			//屏幕小于1280时，添加小屏样式
			getResize();				
		});	
	    jQuery(window).resize(function(){
			getResize();
		});
	
		jQuery("#agreeBtn").on("ifClicked", function(event){
	    	if (this.checked) {
	    		agreeStu = "0";
	    		jQuery(".buyOrderBtn").removeClass("buynow_btn");
	    		jQuery(".buyOrderBtn").attr("disabled","disabled");
	    	}else{
	    		agreeStu = "1";
	    		jQuery(".buyOrderBtn").removeAttr("disabled");
	    		jQuery(".buyOrderBtn").addClass("buynow_btn");
	    	}
	    });
	});
	function getResize(){
		if( jQuery(window).width() < 1280 ){
			jQuery('.systemBuy_body').addClass('small_body');	
		}else{
			jQuery('.systemBuy_body').removeClass('small_body');		
		}
	}
	function checkSubmit(basicServiceId){	
		validityYear=jQuery(".validityPeriod"+basicServiceId+".s_cur").attr("aa");
		if(validityYear==null || validityYear==""){
			alert("请选择购买服务的有效期！");
			return false;
		}
		jQuery("#basicForm\\:hidServiceId").val(basicServiceId);
		jQuery("#basicForm\\:hidServiceYear").val(validityYear);
		jQuery("#basicForm\\:hidServiceType").val(1);
		if(agreeStu !="1"){
			alert("请同意协议内容！");
			return false;
		}else{
			jQuery("#basicForm\\:saveOrderBtn").click();
		}		
	}

//]]>
</script>




</ui:define>

</ui:composition>
