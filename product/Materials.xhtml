<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jstl/core"
    template="/layout/template.xhtml">

<ui:define name="body">
<style>
.skc_cs_s{margin-left:15px; min-width:105px; display:inline-block;}
</style>
<td valign="top" width="100%">

<!-- #{aliasesHome.works()} -->
                <div class="right_c">
                	<div class="r_title">
                    	<div class="r_t_l">
						<s:link propagation="none"  view="#{sessionTake.urlTemp}" style="text-decoration:none;color:black;" value="工作 ">
                        </s:link>
						&#160;&gt;&#160;&#160;<font size="3">库存管理</font></div>
                    </div>

					<div class="yuleng">
						<a href="#{request.contextPath}/product/Materials.seam"><img src="#{request.contextPath}/asset/images/jx_03.jpg" width="106" height="74" /></a>
 						<a href="#{request.contextPath}/storage/GoodsBatchList.seam"><img src="#{request.contextPath}/asset/images/jx_05.jpg" width="106" height="74" /></a>
 						<a href="#{request.contextPath}/storage/StorageChangeFormList.seam"><img src="#{request.contextPath}/asset/images/jx_07.jpg" width="106" height="74" /></a>
 						<a href="#{request.contextPath}/storage/EnterOf.seam"><img src="#{request.contextPath}/asset/images/jx_09.jpg" width="106" height="74" /></a>
 						<a href="#"><img src="#{request.contextPath}/asset/images/jx_11.jpg" width="106" height="74" /></a>
						<a href="#{request.contextPath}/storage/Delivery.seam"><img src="#{request.contextPath}/asset/images/jx_13.jpg" width="106" height="74" /></a>
					</div>
                    	<div class="clear"></div>
                    </div>  
                    
                    <h:form id="goodsInfoSearch">
                    <div class="z_r_ser">
                    	<table cellpadding="0" cellspacing="0" class="cxtja">
                        	<tr>
                        		<td width="80" style="font-size:14px;">查询条件：<h:inputHidden value="#{aliasesHome.tag}" /></td>
                                <td width="340">
                                <h:inputText value="#{aliasesHome.searchName}" styleClass="z_r_ser_i"/>
                                </td>
                                <td width="70" align="left">
                                <h:commandButton id="search" action="/product/Materials.xhtml" onclick="return checkSearch();" styleClass="list_search"/>
                                </td>
                                <td width="65" height="30" align="right" valign="bottom">
                                <h:inputHidden id="flag" value="#{aliasesHome.flag}"/>
                                <a class="gjss_a gjtop" href="javascript:" onclick="op(this)" aa="#{aliasesHome.flag=='2'?'2':'1'}">高级搜索</a></td>
                           </tr>
                       </table>                          
                    </div>
                  
                     <div class="gjs" style="#{aliasesHome.flag=='1'?'display:none;':''}">
                         <div class="gjss_con">
                         <div class="gjss_w gjss_w1" >
                                    <table>
                                        <tr>
                                            <td class="all_te">物料编码：</td>
                                            <td>
                                            <h:inputText id="wname1" styleClass="gjss1"  value="#{aliasesHome.wcode}" />
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="gjss_w gjss_w1" >
                                    <table>
                                        <tr>
                                            <td class="all_te">物料名称：</td>
                                            <td>
                                            <h:inputText id="wname" styleClass="gjss1"  value="#{aliasesHome.wname}" />
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="gjss_w gjss_w2" >
                                    <table>
                                        <tr>
                                            <td class="all_te">库存量：</td>
                                            <td>
                                                <h:inputText id="cstart" styleClass="gjss1"  value="#{aliasesHome.cstart}" />
                                            </td>
                                            <td>—</td>
                                            <td>
                                                <h:inputText id="cend" styleClass="gjss1"  value="#{aliasesHome.cend}" />
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="gjss_w gjss_w2" style="width:350px">
                                    <table>
                                        <tr>
                                            <td class="all_te">采购时间：</td>
                                            <td>
                                                <rich:calendar id="start" value="#{aliasesHome.start}"  datePattern="yyyy-MM-dd" />
                                            </td>
                                            <td>—</td>
                                            <td>
                                                <rich:calendar id="end" value="#{aliasesHome.end}" datePattern="yyyy-MM-dd" />
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                
                               <div class="clear"></div> 
                         </div>
                    	<div class="clear"></div>
                    </div>
                    </h:form>
                    <div class="right_c">
<rich:modalPanel id="product" autosized="true" height="166" width="450" headerClass="modalHeader" >
		<div class="tck_div">
       <div class="tck_ti">
       <h:outputLink value="#"
                onclick="#{rich:component('product')}.hide(); return false;">
                    <img src="../images/close_17.jpg" width="20" height="20"/>
                </h:outputLink>
                </div>
       <h:form id="productform" enctype="multipart/form-data">
               	<table class="tck_table">
                    <tr>
                    	<td width="130" class="font_td" align="right">名称：</td>
                        <td width="240"  >
				  	 <h:inputText id="productName" styleClass="ge_file" required="true" size="20" maxlength="45" value="#{aliasesHome.instance.name}">
	                </h:inputText>
                        </td>
                    </tr>
                    <tr>
                    	<td align="right" class="font_td">物料名称</td>
                        <td  >
						  	<rich:pickList sourceListWidth="120px" targetListWidth="120px"  listsHeight="120px"  
						value="#{aliasesHome.roleResult}" copyAllControlLabel="全部选择"
						removeAllControlLabel="全部清除" copyControlLabel="选择"
						removeControlLabel="清除">
						<f:selectItems value="#{aliasesHome.roleResult2}" />
					</rich:pickList>  
                        </td>
                    </tr>
                    <tr>
                    	<td colspan="2" align="center" valign="bottom">
		                <a4j:commandButton value="添加" style="width:74px;height:26px" image="../images/safe.jpg"  
		                action="#{aliasesHome.persist}"
		                	reRender="urls"
		                	oncomplete="#{rich:component('product')}.hide();document.getElementById('productform:productName').value='';" />
		                	&#160;<h:outputLink value="#" onclick="#{rich:component('product')}.hide(); return false;"><img class="er_buttton" src="../images/button_17.jpg" width="74" height="26" />
                				  </h:outputLink>
                        </td>
                    </tr>
                </table>
               
       </h:form>
       </div>
   </rich:modalPanel>
					<!--商品分类开始-->
                    <div class="tree_dis">
                     <h:panelGroup id="urls">
                    	<ul class="tree_ul">
                    		<li id="sel0" class="sel #{aliasesHome.tag==0?'current':''}" ><a href="#{request.contextPath}/product/Materials.seam?&#38;tag=0" title="">全部</a></li>
                    	<a4j:repeat rendered="#{not empty aliasesHome.aliasesList}" value="#{aliasesHome.aliasesList}" var="_var" rowKeyVar="_index">
                            <li id="sel#{_index+1}" class="sel #{aliasesHome.tag==_index+1?'current':''}" ><a href="#{request.contextPath}/product/Materials.seam?&#38;tag=#{_index+1}" title="">#{_var.name}</a></li>
                        </a4j:repeat>
                            <li style="border:none;"><a style="background:none;" href="#" onclick="#{rich:component('product')}.show();return false;"><img style="position:relative; top:8px;" src="#{request.contextPath}/asset/images/jh_22.jpg" width="21" height="19" /></a></li>
                    	</ul>
                    </h:panelGroup>
                        <div class="box2">
                        	<!--全部开始-->
                        	<div>
                                <table width="100%" cellpadding="0" cellspacing="0" class="tr_tab_b2" style="border-top:1px solid #ddd;">
                                    <tr>
                                        <td class="tree_th" width="15%">批次编码</td>
                                        <td class="tree_th" width="15%">物料名称</td>
                                        <td class="tree_th" width="10%">规格</td>
                                        <td class="tree_th" width="10%">库存数量</td>
                                        <td class="tree_th" width="10%">采购时间</td>
                                        <td class="tree_th" width="10%">采购人</td>
                                        <td class="tree_th" width="10%">操作</td>
                                    </tr>
                                </table>
                        	<!--第一个table开始-->
                                <table width="100%" cellpadding="0" cellspacing="0" class="tr_tab_b">
                                <a4j:repeat value="#{aliasesHome.objList}" var="obj" rendered="#{not empty aliasesHome.objList}" rowKeyVar="index">
                                    <tr class="nottt">
                                        <td height="48" colspan="7" style="border-bottom:1px solid #ddd;">
                                        	<span class="skc_cs_s"><font color="#71aae1">物料编码：</font><font color="#717171">#{obj[1]}</font></span>
                                        	<span class="skc_cs_s"><font color="#71aae1">物料名称：</font><font color="#717171">#{obj[2]}</font></span>
                                        	<span class="skc_cs_s"><font color="#71aae1">物料类型：</font>
                                        			<font color="#717171">
                                        				<h:outputText rendered="#{obj[7] == 1}" value="原料"/>
                                        				<h:outputText rendered="#{obj[7] == 2}" value="成品"/>
                                        				<h:outputText rendered="#{obj[7] == 3}" value="半成品"/>
                                        			</font>
                                        	</span>
                                        	<span class="skc_cs_s"><font color="#71aae1">库存总量：</font><font color="#717171">#{obj[3]}&#160;#{obj[6]}</font></span>
                                        	<span class="skc_cs_s"><font color="#71aae1">冻结总量：</font><font color="#717171">#{obj[4]}&#160;#{obj[6]}</font></span>
                                        	<span class="skc_cs_s"><font color="#71aae1">剩余总量：</font><font color="#717171">#{obj[3] - obj[4]}&#160;#{obj[6]}</font></span>
                                        </td>
                                    </tr>
                                    <a4j:repeat value="#{aliasesHome.getGoodsBatchById(obj[0])}" var="_obj"  rowKeyVar="_index">
                                    <tr>
                                        <td class="tree_td" width="15%">#{_obj.batchCode}</td>
                                        <td class="tree_td" width="15%">#{obj[2]}</td>
                                        <td class="tree_td" width="10%">#{obj[6]}</td>
                                        <td class="tree_td" width="10%">#{_obj.goodsCount}</td>
                                        <td class="tree_td" width="10%">
                            <h:outputText value="#{_obj.insertTime}">
								<s:convertDateTime type="both" dateStyle="short" pattern="yyyy-MM-dd" />
						    </h:outputText></td>
                                        <td class="tree_td" width="10%">#{_obj.operater}</td>
                                        <td class="tree_td" width="10%">
                                            <s:link propagation="none"  view="/product/MaterialsView.xhtml" styleClass="list_view">
                                            	<f:param name="batchId" value="#{_obj.goodsBatchId}"/>
                                            </s:link>
                                        </td>
                                    </tr>
                                    </a4j:repeat>
                                    </a4j:repeat>
                                </table>
                                <!--第一个table结束-->
                        	
                                    </div>
                                <!--叶类结束-->    
                        <div class="clear"></div>
                        </div>
                    	<div class="clear"></div>
                    </div>

					<!--商品分类结束-->
                    <div class="clear"></div>
                </div><!--right_c结束-->
                <script type="text/javascript">
            	jquery(".rich-calendar-input").addClass("gjss1");
            	jquery(".rich-calendar-input").removeClass("rich-calendar-input");
op = function(ind){
	if(ind.getAttribute("aa")=="1"){
		jquery(".gjs").slideDown(800);
		jquery(".gjss_a").attr("aa",2).removeClass("gjtop").addClass("gjbottom");
		
		document.getElementById("goodsInfoSearch:flag").value="2";
	}else{
		jquery(".gjs").slideUp(800);
		jquery(".gjss_a").attr("aa",1).removeClass("gjbottom").addClass("gjtop");
		document.getElementById("goodsInfoSearch:wname").value="";
		document.getElementById("goodsInfoSearch:cstart").value="";
		document.getElementById("goodsInfoSearch:cend").value="";
		document.getElementById("goodsInfoSearch:startInputDate").value="";
		document.getElementById("goodsInfoSearch:endInputDate").value="";
		document.getElementById("goodsInfoSearch:flag").value="1";
	}
}

function checkInteger(obj,str){
	if(obj.value!=""){
		var v = obj.value;
		var reg = /^[1-9]+[0-9]*]*$/; 
		if (!reg.test(v)){
			alert(str);
			obj.focus();
			return false;
		}
	}
	return true;
}
          checkSearch = function(){
              if(jquery(".gjss_a").attr("aa")==2){
        	  var a = checkInteger(document.getElementById("goodsInfoSearch:cstart"),"请填写正确的数字");
        	  if(!a)
            	  return false;
        	  var b = checkInteger(document.getElementById("goodsInfoSearch:cend"),"请填写正确的数字");
        	  if(!b)
            	  return false;
              }
          }      
se = function(obj){
	jquery(".sel").each(function(){
		jquery(this).removeClass("current");
	});
	jquery("#sel"+obj).addClass("current");

	jquery(".box2 > div").each(function(index,domEle){
		if(index==obj){
			jquery(domEle).css("display","block");
		}else{
			jquery(domEle).css("display","none");
		}
	});
}
</script>
            </td>
<style>
 .dr-mpnl-pnl{padding:0;}
 .dr-mpnl-pnl-b{color:none;padding:0; font-family:"微软雅黑";}
 .dr-insldr td{padding:0;}
 .font_td{font-size:14px;}
 .dr-insldr{width:255px!important;}
</style>
</ui:define>
	</ui:composition>

