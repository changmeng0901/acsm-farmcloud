<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:c="http://java.sun.com/jstl/core"
	template="/layout/template_device.xhtml">

	<ui:define name="body">
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/settings/EnterpriseSettings.css" />
    <script type="text/javascript" src="#{request.contextPath}/asset/js/EnterpriseLeftMenu.js"></script>
<style>
.form-control{
	float:left;
}
	   html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
.maptck{ border-collapse:collapse; position:absolute; z-index:10000; left:150px; top:150px;}
.titlefont{ font-size:16px; color:#e8e8e8; font-weight:bold;}
.numfont{ font-size:12px; color:#dadada; font-weight:normal; padding-left:20px;}
.closed{ margin-right:10px;}
.ludian{ height:19px; line-height:19px; padding-left:10px; background:url(#{request.contextPath}/asset/images/tckbg.png) left center no-repeat; display:inline-block; float:left;}
.ludian span{ min-width:30px; height:19px; line-height:19px; margin-right:-10px; padding-right:10px; color:#fff; background:url(#{request.contextPath}/asset/images/tckbg.png) right center no-repeat; display:inline-block; float:left; font-size:12px;}
.shidu{ height:19px; line-height:19px; padding-left:10px; float:left; color:#fff;}
.shuju{ width:100%; table-layout:fixed; margin-top:10px;padding-left:30px}
.shujutd{ color:#fff; background:url(#{request.contextPath}/asset/images/shuline.png) right repeat-y;}
.fottable{ height:22px; line-height:22px; background:url(#{request.contextPath}/asset/images/tckkbg5.png) repeat;}
.ckxx{ color:#0878bf; font-size:14px; text-decoration:underline; padding-left:25px; text-align:left; font-weight:bold;}
.qckxx2{ color:#0878bf; font-size:14px; text-decoration:underline; margin:0 auto; font-weight:bold; padding-top:5px; display:block;}
.cjtime{ text-align:right; color:#dddddd; padding-right:15px;}
.tdimg{padding-top:10px; padding-bottom:10px;}

.qixz{ border-collapse:collapse; position:absolute; z-index:10000; left:650px; top:150px;}
.qingt{ color:#fff; font-size:14px;}
.box_back{background:url(asset/images/bg_png3.png) repeat; width:100%; height:100%; position:fixed; z-index:8888; display:none;}

.gm-style-iw{ position:relative; z-index:100;margin-left:10px; }
.div_012{width:220px;}

.zw_bgt2{ width:88px;   position: absolute; z-index:3;}
.zw_libg_img2{ width:88px;  z-index:2; position:absolute;  margin-left:auto; margin-right:auto;display:block; cursor:pointer; }
.ret_pic2{width:92px; height:52px; float:left; position:relative; top:-33px; top:-23px\9;}
.div_width{ width:225px; padding:0px; background:#efefef; margin:0px auto;}
.div_dl2{position:relative; width:95px; *width:130px;  top:-8px; top:-6px\9; [;top:0px;]; margin-left:8px;}
.div_dt2{ font-size:14px; color:#171717; line-height:18px; font-family:"微软雅黑";}
.div_dt3{ font-size:14px; color:#e75467; line-height:20px;}
.div_dt4{ width:91px; *width:130px; height:20px; overflow:hidden; font-family:"黑体"; font-size:14px; color:#686868; line-height:22px;}
.modal-dialog2 {
    margin: 30px auto;
    width: 765px;
    height:580px;
}
.fr{float:right;}
.r_ulli1{float:right;}

  .r_t #topModel{width:600px;}
  .r_t #topModel .modal-dialog{ width:600px;}
</style>
<script type="text/javascript">
document.getElementById("selectBaseDiv").style.display="none";
</script>
	<!-- #{deviceHome.methods()} -->
	<!-- #{deviceHome.showMap()} -->
             <td valign="top">
                <div class="inbentory_file_main">
                <!--左侧二级导航 -->
                <div class="inbentory_level_wap">
                    <div class="inbentory_level">
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_rkgl"></i>基础设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/user/UpdateEnterpriseSettings.seam?enterpriseId=#{sessionTake.enterpriseInfoId}','_self')" >
                            	<i class="icon_sed"></i>企业设置                   	
                            </li>
                            <!-- 管理版和以前的版本（标准、白金...)显示 -->
                            <h:panelGroup rendered="#{sessionTake.nowVersionService.basicService.basicServiceId==10 or sessionTake.nowVersionService.basicService.serviceType eq 1}">
                            	<li class="sed_item" onclick="window.open('#{request.contextPath}/user/ModuleSettings.seam','_self')" ><i class="icon_sed"></i>模块配置</li>   
                            </h:panelGroup>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/dictionary/DataDicinfoList.seam','_self')" ><i class="icon_sed"></i>字段管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/user/EnterpriseCommunityList.seam','_self')" ><i class="icon_sed"></i>角色管理</li>
                            <s:fragment rendered="#{enterpriseInfoHome.enterpriseInfo.govState}">
	                        	<li class="sed_item" onclick="window.open('#{request.contextPath}/user/AuditInformationList.seam','_self')" ><i class="icon_sed"></i>审核信息</li>
	                        </s:fragment>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/system/RecycleInfoList_1.seam','_self')" ><i class="icon_sed"></i>回收站</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_ckgl"></i>生产管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <h:panelGroup rendered="#{s:hasRole('certification')}">
                            	<li class="sed_item" onclick="window.open('#{request.contextPath}/map/CertificationList.seam','_self')" ><i class="icon_sed"></i>认证信息</li>
                            </h:panelGroup>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/message/TunnelGroupList.seam','_self')" ><i class="icon_sed"></i>分组管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/InputsInfoList.seam?goodsTypeInfoId=5','_self')" ><i class="icon_sed"></i>投入品信息</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_zkgl"></i>销售管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/GoodsInfoList.seam','_self')"><i class="icon_sed"></i>物料信息</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/ProductInfoList.seam','_self')" ><i class="icon_sed"></i>商品信息</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_pdgl"></i>硬件管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item sed_cur" onclick="window.open('#{request.contextPath}/device/DeviceList.seam','_self')"><i class="icon_sed"></i>设备管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/device/VideoList.seam','_self')" ><i class="icon_sed"></i>视频管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/farming/AmRfidInfoList.seam','_self')" ><i class="icon_sed"></i>RFID卡管理</li>
                        </ol>
                    </div>
                    <i class="collapse_btn"></i>
                </div>
                <!--左侧二级导航 -->
				<!--右侧 -->
                <div class="inbentory_content">
		<a:form id="user" enctype="multipart/form-data">
				<!-- Modal -->
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal" class="modal fade in" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="productMsgs">*号部分为必填项！</span>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal2" class="modal fade in" style="display: none;">
  <div class="modal-dialog2">
    <div class="modal-content" >
    	<div style="  position: absolute; right: -19px;  top: -16px; z-index: 10;cursor: pointer;" onclick="_Q('#myModal2').modal('hide');" ><img src="#{request.contextPath}/asset/images/new_close03.png" /></div>
      <div class="modal-body" style="padding:0px;">
       <div style="width: 100%; height:580px;">
        <div id="map-canvas" class="gm-style"> </div>
        <script type="text/javascript">
      //<![CDATA[ 
				var workpath = "#{request.contextPath}";
				var _center = "#{deviceHome.center}";
				var markstr = #{deviceHome.baseString};
                var secondstr = #{deviceHome.partitionString};
                var thirdstr = #{deviceHome.groupString};
                var colors = #{deviceHome.dicColor};
				var collects = #{deviceHome.collect};
				//var allList = #{deviceHome.allList};
				var envTypeList = #{deviceHome.entTypeString};
				var realPlantJson = #{deviceHome.realPlantJson};
				var ret = 1;
				var deviceStr = #{deviceHome.deviceStr};
				var lastStr;
				var addOrUpdate = #{deviceHome.managed};
				var drugObj = #{deviceHome.drugObj};
				var head = document.getElementsByTagName('head')[0];
				var insertBefore = head.insertBefore;
				head.insertBefore = function (newElement, referenceElement) {
				    if (newElement.href && (newElement.href.indexOf('https://fonts.googleapis.com/css?family=') === 0 || newElement.href.indexOf('http://fonts.googleapis.com/css?family=') === 0)) {
				        //console.info('Prevented Roboto from loading!');
				        return;
				    }
				    insertBefore.call(head, newElement, referenceElement);
				};
				//]]>  
				//alert(drugObj);
                </script>
	    <script type="text/javascript" src="#{request.contextPath}/asset/js/map/JsMap.js"> </script> 
	    <script type="text/javascript" src="#{request.contextPath}/asset/js/jquery-ui2.js"></script> 
		<script src="http://ditu.google.cn/maps/api/js?v=3.25&amp;key=AIzaSyB2mG9FLX3dYDFycXGkmidn-OZU-FL1rLM&amp;sensor=false&amp;libraries=drawing"></script>
		<script src="#{request.contextPath}/asset/js/map/device_map.js" type="text/javascript"></script>
       </div>
      </div>
    </div>
  </div>
</div>
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal3" class="modal fade in w600na" style="display: none;width:100%;">
  <div class="modal-dialog">
    <div class="modal-content">
      <button class="close"></button>
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="productMsg">是否定位此设备？</span>
        
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" onclick="save_no()">取消</button>
        <button type="button" class="btn btn-primary sure" data-dismiss="modal" onclick="save_ok()">确认</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal4" class="modal fade in w600na" style="display: none;width:100%;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="productMsg">是否定位此设备？</span>
        
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="save_ok_move()">确认</button>
      </div>
    </div>
  </div>
</div>



<input type="hidden" value="" id="device_coordinateX" name="device_coordinateX"/>
 <input type="hidden" value="" id="device_coordinateY" name="device_coordinateY"/>
 <input type="hidden" value="" id="partition_id" name="partition_id"/>
 <input type="hidden" value="" id="tunnel_id" name="tunnel_id"/>
 
 
                <div class="right_c">
                	<div class="r_title">
                    	<div class="r_t_l"><font size="3"><a href="#{request.contextPath}/device/DeviceList.seam">设备管理</a></font><rich:messages styleClass="messages"></rich:messages></div>
                    </div>
				<!--入库订单列表开始-->
				<div class="all_d3">
				<h:inputHidden value="#{deviceHome.bId}" id="bId"/>
                        <s:div styleClass="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">基地名称：</td>
                                    <td>
                                       <h:outputText value="#{deviceHome.baseName}" />
                                    </td>
                                </tr>
                            </table>
                        </s:div>
						<div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">设备编号：</td>
                                    <td>
										 <h:inputText id="sn" styleClass="form-control nw221"  value="#{deviceHome.instance.sn}" onkeyup="this.value=this.value.replace(/[^\w\.\/]/ig,'');"/>
										  <span class="finput" style="color:#FF0000">*</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">设备名称：</td>
                                    <td>
										 <h:inputText id="name" styleClass="form-control nw221"  value="#{deviceHome.instance.name}"/>
										  <span class="finput"  style="color:#FF0000">*</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">设备类型：</td>
                                    <td>
                                    <h:panelGroup id="idObj1">
										<h:selectOneMenu  styleClass="selectpicker" id="plantingPattern" style="width:146px;"  value="#{deviceHome.fatherDeviceTypeId}" valueChangeListener="#{deviceHome.getDeviceTypeByF}">
									<s:selectItems value="#{deviceHome.fDeviceTypeList}" var="var" label="#{var.name}" itemValue="#{var.id}"/>
									<a:support event="onchange" reRender="idObj2" eventsQueue="default" ajaxSingle="true" bypassUpdates="true" oncomplete="_Q('.selectpicker').selectpicker();"/>
								</h:selectOneMenu>
								</h:panelGroup>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">设备类别：</td>
                                    <td>
                                    <h:panelGroup id="idObj2">
										<h:selectOneMenu  styleClass="selectpicker" id="deviceTypeId" style="width:146px;"  value="#{deviceHome.instance.deviceTypeId}" >
											<s:selectItems value="#{deviceHome.deviceTypeList}" var="var" label="#{var.name}"/>
											<s:convertEntity />
										</h:selectOneMenu>
										</h:panelGroup>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">出厂时间：</td>
                                    <td>
	                                   <div class="input-append date form_datetime " >
									    <h:inputText id="factoryTime" styleClass="new_time" value="#{deviceHome.instance.factoryTime}"/>
									    <span class="add-on"><i class="icon-th"></i></span>
									    </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="all_da all_w01" style="width:auto;">
                        	<table>
                                <tr>
                                    <td class="all_te">图片：</td>
                                    <td>
										<s:fileUpload id="iePitcure" size="30"
											accept="image/png,image/jpeg,image/gif"
											contentType="image/png,image/jpeg,image/gif"
											fileName="#{deviceHome.instance.pictureNameStr}"
											data="#{deviceHome.instance.pictureByte}">
										</s:fileUpload>
										
										<p class="pic_stress" style="width:auto;">图片标准：158X146（像素）支持格式：jpg,gif,png,jpeg,bmp,3gp</p>
									</td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01" style="width:auto;">
                        	<table>
                                <tr>
                                    <td class="all_te"></td>
                                    <td>
										<a href="#"  class="btn btn-default" onclick="showMapMe()">设备定位</a>
									</td>
                                </tr>
                            </table>
                        </div>
                         <div class="all_da all_w01" style="width:724px;">
                        	<table>
                                <tr>
								<td class="all_te">描述：</td>
								<td>
									<h:inputTextarea id="description"  styleClass="form-control nw420" rows="3" value="#{deviceHome.instance.description}" />
	                            </td>
								</tr>
								<tr>
									<td colspan="2" height="35"></td>
								</tr>
                            </table>
                        </div>
                        
				</div>
					<table class="r_c_table" style="margin-bottom:30px; margin-top:0;" cellpadding="0" cellspacing="0">
                       <tr>
							<td class="r_c_td"></td>
							<td>
		            	<h:commandButton   styleClass="btn btn-primary" style=""  value="提交" action="#{deviceHome.persist}"  rendered="#{!deviceHome.managed}" onclick="if(!checkSubmit()) return false;"/>
		            	<h:commandButton   styleClass="btn btn-primary" style=""  value="提交" action="#{deviceHome.update}"  rendered="#{deviceHome.managed}" onclick="if(!checkSubmit()) return false;"/>
		    			&#160;<s:button view="/device/DeviceList.xhtml" styleClass="btn btn-default" value="返回" id="bn_left6" style="margin-left:10px" >
		    				<f:param name="pageNum" value="#{deviceHome.pageNum}" />
		    			</s:button>
                            </td>
						</tr>
					</table>
				<!--入库订单列表结束-->
                    <div class="clear"></div>
                </div><!--right_c结束-->
                <div class="clear"></div>
                </a:form>
                </div>
                </div>
                <a:form id="formid" >
				<a:queue requestDelay="10" ignoreDupResponses="true" id="mainQueue"/>
				<a:jsFunction name="queryParAndTunnelNew"  eventsQueue="mainQueue" action="#{deviceHome.queryParAndTunnel()}" data="#{deviceHome.refreshStr}" oncomplete="queryParAndTunnel_next(data)">
				   <a:actionparam name="bId" assignTo="#{deviceHome.bId}"/>
				</a:jsFunction>
				</a:form>
              <script  type="text/javascript">
				//<![CDATA[
				var promptMessage = "#{deviceHome.promptMessage}";
				if(promptMessage != ""){
					document.getElementById("productMsgs").innerHTML = promptMessage;
					_Q("#myModal").modal('show');
				}
				function queryParAndTunnel(){
						var bId = _Q("#user\\:basicId").val();
						queryParAndTunnelNew(bId);
					}
				
				function queryParAndTunnel_next(obj){
						//alert(obj);
						if(obj != ""){
							_center = obj.split("/")[0];
						     markstr = eval(obj.split("/")[1]);
			                 secondstr = eval(obj.split("/")[2]);
			                 thirdstr = eval(obj.split("/")[3]);
			                 deviceStr = eval(obj.split("/")[4]);
			                 initialize();
							}
						device_coordinateX = 0;
						device_coordinateY = 0;
					}
				function checkSubmit(){
					var tunnel = _Q("#user\\:tunnel").val();
					var sn = document.getElementById("user:sn").value;
					var name = document.getElementById("user:name").value;

					var time = document.getElementById("user:factoryTime").value;
					
					if(sn == ""){
						document.getElementById("productMsgs").innerHTML = "设备编号不能为空！";
						_Q("#myModal").modal('show');
				      return false;
					}else if(sn.length > 30){
						document.getElementById("productMsgs").innerHTML = "设备编号长度不能大于30！";
						_Q("#myModal").modal('show');
				      return false;
					}
					if(name == ""){
						document.getElementById("productMsgs").innerHTML = "设备名称不能为空！";
						_Q("#myModal").modal('show');
				      return false;
					}
					if(new Date(time).getTime() > new Date().getTime()){
						document.getElementById("productMsgs").innerHTML = "出厂日期不能大于今天！";
						_Q("#myModal").modal('show');
				      return false;
					}
					return true;
				}
				//]]>
				
				</script>
				<script type="text/javascript">
				_Q(".form_datetime").datetimepicker({
			    format: "yyyy-mm-dd",
			    autoclose: true,
				 weekStart: 1,
				  //startDate: "2014-08-14 10:00",
				 language:  'zh-CN',
				 minView:2,
			    pickerPosition: "bottom-left"
			    });
			  window.onload = function () {
			    _Q('.selectpicker').selectpicker();
			  };
			</script>
            </td> 
             <style>
  
 </style>
	</ui:define>

</ui:composition>
