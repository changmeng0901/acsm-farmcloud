<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
     xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jstl/core"
    template="/layout/template_new.xhtml"
                xmlns:a4j="http://richfaces.org/a4j">
<ui:define name="body">
<!-- #{repertoryChange.inputOrInoutValue()} -->
<!-- #{inputsStockHome.nongZi()} -->
<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/skinBlue.css" />
<script src="#{request.contextPath}/asset/js/common-acsm.js"/>
<style>
.catd {font-size: 12px;line-height: 25px;padding: 5px 0;text-align: center;}
.form_datetime input {border: 1px solid #ccc;float: left;height: 30px;line-height: 30px;width: 220px;}	
a:focus {outline:none;-moz-outline:none;}
.input-append.date .add-on i, .input-prepend.date .add-on i {cursor: pointer;height: 14px;margin-left: -19px;margin-top: 7px;width: 14px;}
.new_da {display: inline-block;float: none;margin-bottom: 15px;margin-right: 50px;min-height: 30px;min-width: 310px;}
.dr-pnl {padding: 0px;border: none;}
.dr-pnl-b {padding: 0px;border: none;}
.newble12 {width: 99%;}
.dr-table-subheadercell{background:#f3f7fc; line-height:36px;}
.dr-table-subheadercell{background:#f0f5fb; padding:0; line-height:36px; color:#4d4d4d; font-size:14px; font-family:"微软雅黑"; font-weight:normal;}
.dr-table-cell{color: #000; font-family:"微软雅黑"; font-size: 12px;}
.form-control{ font-size:12px;}
.rich-panel{border-style:none;}
.clear{ clear:both;}
.clear:after{ clear:both; content:""; display:block; visibility:hidden; height:0;}
.pop{width: 794px; height: 535px; position: absolute; left: 50%; margin-left: -397px; top:10%;display:block;}
.fl{float: left;}
.fr{float: right;}
.work .bootstrap-select:not([class*="span"]):not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) { width: 146px;}
.work .bootstrap-select{width: 146px;}
.search-c{line-height: 34px; padding: 10px 0 20px 0;}
.nature{padding: 0 10px;}
.thd{border-left: 1px solid #e1e1e1; border-right: 1px solid #e1e1e1; border-top: 1px solid #e1e1e1; border-radius: 10px 10px 0 0; border-collapse: separate;}
.thd td,.tableModel td{height: 40px; border-bottom: 1px solid #e1e1e1; text-align: center; color: #646464;}  
.thd td{background-color: #ebf5fc;}
.thd td:first-child{border-radius: 10px 0 0 0;}
.thd td:last-child{border-radius: 0 10px 0 0;}
.tableModel tr td{background: #fcfcfc;}
.tableModel tr.odd td{background: #fbfcfe;}
.tableModel tr.hover td{background: #ecf7e6;}
.icheckbox_minimal-blue,.icheckbox_minimal-blue.checked{ float:left; margin-left: 20px;}
.pop-table{height: 282px; border: 1px solid #e2e2e2; border-top: 0; border-radius: 10px 10px 0 0;}
.mark-pic{width: 100%; padding: 60px 0 30px 0; text-align: center;}
.farmingMageTab_jl td {font-size: 12px;  height: 34px;line-height: 34px; padding-bottom: 20px;}
.bootSelt-80 {display: inline-block;float: left;}
.bootSelt-80 .bootstrap-select:not([class*="span"]):not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) {width: 80px;}
.bootSelt-80 .bootstrap-select span {font-family: "微软雅黑";font-size: 12px;}
.bootSelt-80 .bootstrap-select > .btn {height: 30px;line-height: 18px;width: 80px;}
.bootSelt-80 .bootstrap-select.btn-group .dropdown-menu {max-width: 80px;}
.bootstrap-select.btn-group .dropdown-menu {max-width: 100%;}
.bootSelt-190 {display: inline-block;float: left;}
.bootSelt-190 .bootstrap-select:not([class*="span"]):not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) {width: 190px;}
.bootSelt-190 .bootstrap-select span {font-family: "微软雅黑";font-size: 12px;}
.bootSelt-190 .bootstrap-select > .btn {height: 30px;line-height: 18px;width: 190px;}
.bootSelt-190 .bootstrap-select.btn-group .dropdown-menu {max-width: 190px;}
.bootstrap-select.btn-group .dropdown-menu {max-width: 100%;}
.baseFile_onload{ display:block; float:left; width:130px; height:130px; margin:25px 50px 25px 0;border:none;background: url("../asset/images/farmingIco15.jpg") no-repeat scroll 0 0; cursor:pointer;}
.baseFile_onload:hover{ background: url("../asset/images/farmingIco15.jpg") no-repeat scroll 0 0; border:none;}
.baseFile_onload input{ position:absolute; right:0; top:0; width:130px; height:130px; opacity:0; filter:alpha(opacity=0); cursor:pointer;}
.div1{float: left;height: 144px;width: 128px;position:relative;}
.div2{text-align:center;font-size:15px;font-weight:800}
.logoUrl{ width: 144px;height: 144px;cursor: pointer; font-size: 30px;outline: medium none;position: absolute;filter:alpha(opacity=0); -moz-opacity:0;opacity:0; left:0px;top: 0px;}
.plant_bd{width:128px;height:128px; display:block;}
</style>
<script>
//<![CDATA[
	jquery(document).ready(function(){
		jquery('.b1').attr("data-live-search","true");
		jquery('select:not(.data_dic)').not("#trpleixing").selectpicker();
		jquery("#trpbiaozhun1").selectpicker({noneSelectedText:"请选择"});
        jquery("#trpbiaozhun2").selectpicker({noneSelectedText:"请选择"});
        jquery("#trpbiaozhun3").selectpicker({noneSelectedText:"请选择"});
		jquery("#inStorageTime").val('#{repertoryChange.nowDate}');
		jquery(".form_datetime").datetimepicker({
			format: "yyyy-mm-dd hh:ii",
		    autoclose: true,
			weekStart: 1,
			language:  'zh-CN',
		    pickerPosition: "bottom-left"
		});
	});
	document.getElementById("selectBaseDiv").style.display="none";
//]]>
</script>
<td valign="top" width="100%">
	<div class="right_c">
		<div class="r_title">
			<div class="r_t_l">
				生产管理&#160;&gt;&#160;&#160;<a href="#{request.contextPath}/inputs/StockRecord.seam">农资管理</a>&#160;&gt;&#160;&#160;<font size="3">投入品入库管理</font>
			</div>
		</div>
		#{repertoryChange.detailsInit()}
		<div class="all_d3" style=" margin-top:35px;">
			<div class="new_da">
				<table>
					<tr>
						<td class="all_tenew">仓库：</td>
						<td width="205">
							<h:selectOneMenu styleClass="selectpicker" value="#{repertoryChange.storageRoomId}"  id="storageRoomId">
								<s:selectItems var="_storage" value="#{repertoryChange.storageRoomList}" label="#{_storage.name}" itemValue="#{_storage.storageRoomId}" />
							</h:selectOneMenu> 
						</td>
					</tr>
				</table>
			</div>
			<div class="new_da">
				<table>
					<tr>
						<td class="all_tenew">类型：</td>
						<td width="205">
							<h:selectOneMenu styleClass="selectpicker" id="storageType" value="#{repertoryChange.storageType}" immediate="true" onchange="showProductList(this.value);">
								<s:selectItems value="#{repertoryChange.inStorageTypeList}" var="_type" itemValue="#{_type.id}" label="#{_type.name}"/>
							</h:selectOneMenu>
						</td>
					</tr>
				</table>
			</div>
			<div class="new_da">
				<table>
					<tr>
						<td class="all_tenew">经办人：</td>
						<td width="205">
							<h:selectOneMenu styleClass="selectpicker b1" id="operater" value="#{repertoryChange.operater}">
								<s:selectItems var="_attn" value="#{repertoryChange.attnList}" label="#{_attn[1]}" itemValue="#{_attn[0]}" />
							</h:selectOneMenu>
						</td>
					</tr>
				</table>
			</div>
			<div class="new_da">
				<table>
					<tr>
						<td class="all_tenew">入库时间：</td>
						<td>
							<div class="input-append date form_datetime " >
								<input id="inStorageTime" size="22" type="text" value="" readonly="readonly"></input>
								<span class="add-on"><i class="icon-th"></i></span>
							</div>
						</td>
					</tr>
				</table>
			</div>
			<div class="new_da">
				<table>
					<tr>
						<td class="all_tenew">操作人：</td>
						<td>#{sessionTake.nickname}</td>
					</tr>
				</table>
			</div>
			<div class="new_da">
				<table>
					<tr>
						<td class="all_tenew">操作时间：</td>
						<td>#{dateUtil.getCurrentTime('yyyy-MM-dd HH:mm')}</td>
					</tr>
				</table>
			</div>
			<div class="new_da" style="width:80%">
				<table >
					<tr>
						<td class="all_tenew">备注：</td>
						<td>
							<h:inputTextarea cols="85" value="#{enterOutHome.textarea}" style="resize:none;" styleClass="form-control nw300"></h:inputTextarea>
						</td>
					</tr>
				</table> 
			</div>
			<div class="clear"></div>
		</div>
		<div class="erlist2" style="margin-top:35px;">
			<ul>
				<li class="current" id="tab1"><a href="javascript:void(0);" onclick="switchTab(1, '名称')">搜索</a></li>
			</ul>
		</div>
		<div class="erbox2">
			<div id="tar1">
				<div class="z_r_ser" style="position:relative;margin:12px 0 30px;">
					<table cellpadding="0" cellspacing="0" class="cxtja" style="width:547px">
						<tr>
							<td width="80" style="font-size:14px;"><span id="searchTitle">名称</span>：</td>
							<td width="340">
								<div class="public-search">   
									<span class="octicon-search02"></span>
									<input type="text" id="searchName" value="" class="form-control nw300 srarchfont" style="width: 340px;color:#777;"/>
								</div>
							</td>
							<td width="40" align="left">
								<input id="selectButton" type="submit" value="搜索" class="btn btn-primary" onclick="searchButton();"></input>
							</td>
							<td>
								<div id="showMsg"></div>
							</td>
						</tr>
					</table>     
					<div  style="position:absolute;right:0;top:0;line-height:32px;color:#368aca;text-decoration:underline;cursor: pointer;">
						<a href="#" onclick="inputsAdd();">没有需要的投入品？去添加</a>
					</div>
				</div>
				<rich:panel style="width:100%;" id="showPanel">
				<div id="addTableDiv" style="border: 1px solid #DDDDDD; width:99%; margin:0 auto; padding-right:1%; [;text-align:left;]; background: url(../asset/images/order/next_bg_24.jpg) repeat-x; color:#4e4d4d; border-right:1px solid #ccc; float: left;">
					<table width="100%" cellspacing="0" cellpadding="0" border="0" style=" border-collapse:collapse; width:99.2%;  width: -moz-calc(100% - 5px); *width:101% !important； float:left;">
						<tr>
							<th class="catd" width="4%"><input type="checkbox" id="productCheckAll" onclick="selectedAll();"/></th>
							<th class="catd" width="20%" align="center">物料编号</th>
							<th class="catd" width="20%" align="center">物料名称</th>
							<th class="catd" width="20%" align="center">生产厂家</th>
							<th class="catd" width="20%" align="center">规格</th>
							<th class="catd" width="16%" align="center">库存数量</th>
						</tr>
					</table>
					<div style="width:101%; height:200px; overflow-y:auto; overflow-x:hidden; margin:0 auto;  border-right:0px solid #ccc;">
						<table width="99%" cellspacing="0" cellpadding="0" border="0">
							<a:repeat value="#{repertoryChange.showGoodsInfoList}" var="_showProduct" >
								<tr>
									<td class="catd" width="4%">
										<input type="checkbox" onclick="selectedOne();" name="productCheck" id="productCheck" value="#{_showProduct.goodsInfoId}|" />
									</td>
									<td class="catd" width="20%" align="center"><h:outputText value="#{_showProduct.goodsCode}"/></td>
									<td class="catd" width="20%" align="center"><h:outputText value="#{_showProduct.goodsName}"/></td>
									<td class="catd" width="20%" align="center"><h:outputText value="#{_showProduct.manufacturers}"/></td>
									<td class="catd" width="20%" align="center">
									<h:outputText value="#{_showProduct.goodsSpec}"/>
									</td>
									<td class="catd" width="16%" align="center">
										<h:outputText value="#{_showProduct.goodsNum}">
				                    		<f:convertNumber pattern="#.###"/> 
				                    	</h:outputText>
									</td>  
								</tr>
							</a:repeat>
						</table>
					</div>
				</div>
				</rich:panel>
				<div class="clear"></div>
				<div id="addGoodsInfoDiv" class="tjan_02" style=" width:100%; text-align:left; margin-top:27px; padding-bottom:27px;margin-left:30px;">
					<a style="width:44px; height:30px;" href="javascript:void(0);" onclick="if(!submitProduct()){return false;};">
						<button class="btn btn-success" type="button">添加</button>
					</a>
				</div>
			</div>
		</div>
		<rich:panel id="totalPenal" style="width:100%; margin-top:35px;">
			<rich:dataTable width="99%" id="cartList" var="_cartList" styleClass="newble12" value="#{repertoryChange.pickGoodsInfoList}" rowKeyVar="_index">
		        <rich:column>
		        	<f:facet name="header">物料编号</f:facet>
		            <center>
		            	<h:outputText value="#{_cartList.goodsCode}"/>
		            	<input type="hidden" value="#{_cartList.goodsInfoId}-#{_index}" id="hiddenGoodsKey#{_index}"></input>
		            </center>
		        </rich:column>
		        <h:column>
		        	<f:facet name="header">物料名称</f:facet>
		        	<center>
		        		<h:outputText value="#{_cartList.goodsName}"/>
	        		</center>
		        </h:column>
		        <h:column>
		        	<f:facet name="header">规格</f:facet>
		            <center>
		            	<h:outputText value="#{_cartList.goodsSpec}"/>
		            </center>
		        </h:column>
		        <h:column>
		            <f:facet name="header">入库量</f:facet>
		            <center>
						<input class="form-control _number" onblur="updateMaoNum(#{_cartList.goodsInfoId},this.value,this.id, #{_cartList.goodsLevelId},#{_index});" style="width: 100%; text-align: center;" id="numMaober#{_cartList.goodsInfoId}-#{_index}" type="text" value="#{_cartList.realityMaoNum}"/>
		            </center>
		        </h:column>
		        <h:column>
		            <f:facet name="header">生产日期</f:facet>
		            <center>
		            <div class="input-append date form_datetime" style="position:relative;" >
	                	<input id="shengchanTime#{_cartList.goodsInfoId}-#{_index}" class="form-control" type="text" value="#{_cartList.productionDate}" style="width:100%;padding:6px 10px;line-height:20px;box-sizing:border-box;" readonly="readonly" />
	                	<span class="add-on" style="position:absolute;right:10px;top:10px;"><i class="icon-th" style="margin:0;"></i></span>
					</div>
		            </center>
		        </h:column>
		        <h:column>
		            <f:facet name="header">保质期(月)</f:facet>
		            <center>
						<input class="form-control" onblur="updateExpirationDate(#{_cartList.goodsInfoId},this.value, #{_cartList.goodsLevelId}, this.id,#{_index});" style="width: 100%; text-align: center;" id="baozhiqi#{_cartList.goodsInfoId}-#{_index}" type="text" value="#{_cartList.expirationTimes}"/>
		            </center>
		        </h:column>
		        <h:column>
		            <f:facet name="header">物料单价</f:facet>
		            <center>
		            	<table>
		            		<tr>
		            			<td style="font-size: 14px;">￥</td>
		            			<td><input class="form-control" onblur="updatePrice(#{_cartList.goodsInfoId},this.value, #{_cartList.goodsLevelId},#{_index});" style="width: 100%; text-align: center;" id="goodsPrice#{_cartList.goodsInfoId}-#{_index}" type="text" value="#{_cartList.price}"/></td>
		            		</tr>
		            	</table>
		            </center>
		        </h:column>
		        <h:column>
		            <f:facet name="header">物料总价</f:facet>
		            <center>
		            	<table>
		            		<tr>
		            			<td style="font-size: 14px;">￥</td>
		            			<td id="totalGoodsPrice#{_cartList.goodsInfoId}#{_index}"><h:outputText value="#{_cartList.totalPrice}"><f:convertNumber pattern="#0.00"/></h:outputText></td>
		            		</tr>
		            	</table>
		            </center>
		        </h:column>
		        <rich:column styleClass="action" width="5%" style="border-right:none;">
		            <f:facet name="header">操作</f:facet>
					<table class="ps" align="center">
						<tr>
							<td style="border: none;">
								<a href="javascript:void(0);" onclick="delOneProduct(#{_cartList.goodsInfoId}, #{_cartList.goodsLevelId},'#{_index}');">删除</a>
							</td>
						</tr>
					</table>
		        </rich:column>
		    </rich:dataTable>
		</rich:panel>
		<h:form id="saveFrom">
			<div style="height:25px;"></div>
			<div style="padding-top:35px; text-align:center;">
				<a:commandLink id="refreshShow" reRender="showPanel"></a:commandLink>
				<a:commandLink id="refreshToral" reRender="totalPenal"></a:commandLink>
				<h:inputHidden id="storageRoomIdHidden" value="#{repertoryChange.storageRoomId}"/>
				<h:inputHidden id="tunnelInfoIdHidden" value="#{repertoryChange.tunnelInfoId}"/>
				<h:inputHidden id="storageTypeHidden" value="#{repertoryChange.storageType}"/>
				<h:inputHidden id="storageDateHidden" value="#{repertoryChange.storageDate}"/>
				<h:inputHidden id="commentHidden" value="#{repertoryChange.comment}"/>
				<h:inputHidden id="operaterHidden" value="#{repertoryChange.operater}"/>
				<h:inputHidden id="goodsBatchStringsHidden" value="#{repertoryChange.goodsBatchStrings}"/>
				<h:commandButton id="save" value="提交" styleClass="btn btn-primary" onclick="if(!submitSave()){return false;};" action="#{repertoryChange.materialInStorageFind}"/>
				&#160;
				<s:button view="/inputs/StockRecord.xhtml" value="返回" styleClass="btn btn-default">
				<f:param name="baseId" value="#{repertoryChange.baseId}"></f:param>
				</s:button>
			</div>
			<div style="height:20px; width:100%;"></div>
			<div class="clear"></div>
		</h:form>
	</div>
	<!-- 模态框 内容开始 -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false" data-backdrop="static">
    <div style="position:relative;min-height:800px;overflow:auto;">
      <div class="modal-dialog pop">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title" id="myModalLabel">从农资库添加投入品</h4>
          </div>
          <div class="modal-body">
            <div class="clear search-c" >
				<!-- 内容开始 -->
                <!-- 搜索 开始 -->
                <div class="public-search fl"><span class="octicon-search02"></span>
                <input type="text" value="" class="form-control" style="padding-left:25px; color:#d2d2d2; width:230px; margin-right:20px;" id="stockInputs"/>
                </div>
                <span class="fl nature">生产厂家</span>
                <div class="work fl">
                    <select class="selectpicker" id="inputsSelect">
                    <option value="-1">全部</option>
                    <a4j:repeat value="#{inputsStockHome.stockInputsFactoryList}" var="_factory" rowKeyVar="_index">
	                    <option value="#{_factory}">#{_factory}</option>
                    </a4j:repeat>
                    </select>
                </div>
                 <span class="fl nature">农资分类</span>
                <div class="work fl">
                    <select class="selectpicker" data-live-search="true" id="inputsTypeSelect">
                    <option value="-1">请选择</option>
                    <a4j:repeat value="#{inputsStockHome.typeList}" var="_inputsType" rowKeyVar="_index">
                    	<s:fragment rendered="#{_inputsType[2]}">
		                    <option value="#{_inputsType[0]}" disabled="disabled">#{_inputsType[1]}</option>
                    	</s:fragment>
                    	<s:fragment rendered="#{!_inputsType[2]}">
                    		<option value="#{_inputsType[0]}">#{_inputsType[1]}</option>
                    	</s:fragment>
                    </a4j:repeat>
                    </select>
                </div>
                <button class="btn btn-primary fr" type="button" onclick="searchStockInputsPage();">搜索</button>
            </div> 
            <div class="pop-table">
                <table width="100%" cellpadding="0" cellspacing="0" class="thd">                   
                        <tr>
                            <td width="5%"></td>
                            <td width="15%">序号</td>
                            <td width="25%">名称</td>
                            <td width="20%">规格</td>
                            <td width="35%">生产厂家</td>
                        </tr>
                </table>
                <!-- 没有数据 -->
			<h:panelGroup id="stockInputss">
                <h:outputText rendered="#{inputsStockHome.notMeInputsList eq null or inputsStockHome.notMeInputsList.size() == 0}">
                <div class="no-data">
                    <div class="mark-pic">
                        <img src="../asset/images/mark.jpg" alt="" />
                    </div>
                    <p style="text-align:center;">没有在农资库中搜索到您想要的农资，</p>
                    <p style="text-align:center;">您可以<a href="javascript:void(0);" onclick="showAdd();">创建</a>一个</p>
                </div>
                </h:outputText>
            <!-- 没有数据结束 -->
                <!-- 有数据 -->   
                <h:outputText rendered="#{inputsStockHome.notMeInputsList ne null and inputsStockHome.notMeInputsList.size() > 0}">
                <div class="table_scroll" style="width:760px;height: 240px;overflow:hidden ">
                    <table width="100%" cellpadding="0" cellspacing="0" class="tableModel">
                   		<a4j:repeat value="#{inputsStockHome.notMeInputsList}" var="_publicInputs" rowKeyVar="_index">
                   			<tr class="odd">
	                            <td width="5%"><input type="checkbox" class="icheck" name="sss" value="#{_publicInputs.id}|"/></td>
	                            <td width="15%">#{_index+1}</td>
	                            <h:outputText rendered="#{_publicInputs.name.length() ge 7}">
		                            <td width="25%" title="#{_publicInputs.name}">#{_publicInputs.name.substring(0,7)}</td>
	                            </h:outputText>
	                            <h:outputText rendered="#{_publicInputs.name.length() lt 7}">
	                            	<td width="25%">#{_publicInputs.name}</td>
	                            </h:outputText>
	                            <td width="20%">
	                            	<h:outputText rendered="#{_publicInputs.packSpec ne null and _publicInputs.packSpec ne ''}">
		                            	#{_publicInputs.netContent}#{_publicInputs.unitInfo.name}/#{_publicInputs.packSpec}   
	                            	</h:outputText>
	                            	<h:outputText rendered="#{_publicInputs.packSpec eq null or _publicInputs.packSpec eq ''}">
	                            		#{_publicInputs.netContent}#{_publicInputs.unitInfo.name}   
	                            	</h:outputText>
	                            </td>
	                            <td width="35%">
	                            	#{_publicInputs.manufacturers}
	                            </td>
                        	</tr>
                   		</a4j:repeat>
                    </table>
                </div>
                </h:outputText>
              </h:panelGroup>
            </div>
            <!--分页开始-->
            <h:panelGroup id="stockInputssPage1">
                   <h:inputHidden value="#{inputsStockHome.selectPageNum}" id="thisPageId"/>
					<div class="pageModel_wap">
						<h:form id="pageFrom" rendered="#{null ne inputsStockHome.notMeInputsList and inputsStockHome.notMeInputsList.size() gt 0}">
							<table style="height:30px; margin:40px auto 0 auto;" cellpadding="0" cellspacing="0">
								<tr>
									<s:fragment rendered="#{!inputsStockHome.hasPreviousPage }">
										<td><img src="#{request.contextPath}/asset/images/page_68.jpg" width="4" height="32" /></td>
									</s:fragment>
									<s:fragment rendered="#{inputsStockHome.hasPreviousPage and inputsStockHome.totalPages > 1}">
										<td><img src="#{request.contextPath}/asset/images/page_67.jpg" width="4" height="32" /></td>
										<td class="td_t_b">
											<a:commandLink style="color:#333333;" id="firstPage" onclick="queryByPage(1)" rendered="#{inputsStockHome.hasPreviousPage and inputsStockHome.totalPages > 1}" >首页</a:commandLink>
										</td>
										<td class="td_t_b td_t_t" style="padding:0; width:30px;">
											<a:commandLink styleClass="no_n" id="previousPage" onclick="queryByPage(#{inputsStockHome.prePageNum})"  >&lt;</a:commandLink>
										</td>
									</s:fragment>
									<a:repeat var="_page" value="#{inputsStockHome.showPageList}" rowKeyVar="_index">
										<s:fragment rendered="#{_page gt 0 and _page le inputsStockHome.totalPages}">
											<td class="td_t_b #{inputsStockHome.hasPreviousPage  or _index >0 ?' td_t_t' : ''} #{_page eq inputsStockHome.selectPageNum ? 'onp' : ''}" >
												<a:commandLink id="thisPage"  onclick="queryByPage(#{_page})"  >#{_page}</a:commandLink>
											</td>
										</s:fragment>
									</a:repeat>
									<s:fragment rendered="#{inputsStockHome.flag}">
										<td class="td_t_b td_t_t">
											<a:commandLink styleClass="no_d"  id="nextPage" onclick="queryByPage(#{inputsStockHome.nextPageNum})" rendered="#{inputsStockHome.hasNextPage and inputsStockHome.totalPages > 1}" >&gt;</a:commandLink>
										</td>
										<td class="td_t_b td_t_t">
											<a:commandLink style="color:#333333;"  id="lastPage" onclick="queryByPage(#{inputsStockHome.totalPages})" rendered="#{inputsStockHome.hasNextPage and inputsStockHome.totalPages > 1}" >尾页</a:commandLink>
										</td>
									</s:fragment>
									<td class="td_t_b td_t_t" style=" color:#9a9a9c;">共#{inputsStockHome.totalPages}页</td>
									<td ><img src="#{request.contextPath}/asset/images/page_70.jpg" width="4" height="32" /></td>
								</tr>
							</table>
						</h:form>	
					</div> 
					</h:panelGroup>
           		   <!--分页结束-->  
            <div style="text-align: right; padding-top: 10px; text-decoration: underline; color: #2a6496;">
            	<a href="javascript:void(0);" onclick="showAdd();">没有合适的农资？去创建一个</a>
            </div>
            <!-- 有数据结束 -->
          </div>
          <div class="modal-footer" style="text-align:center; border-top:0;">
            <button type="button" class="btn btn-primary" onclick="submitInputs();">提交</button>
            <button type="button" class="btn btn-default" onclick="hideInputs();">返回</button>
          </div>
        </div>
      </div>
    </div>
    </div>
    <!-- 模态框 内容结束 -->
    <!-- 添加投入品框 开始 -->
    <a4j:form ajaxSubmit="true" id="inputs" autocomplete="on">
<div class="modal fade pop" id="addInput" style="display:none;width:760px;height:auto;margin-left:-380px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
       <div class="modal-content">
         <div class="modal-header">
           	<input type="button" class="close" onclick="jquery('#addInput').hide();"> </input>
        	<h4 class="modal-title font14 mlal" id="myModalLabel">投入品信息</h4>
        </div>
        <h:panelGroup id="addInputsPanel">
        <div class="modal-body" style="padding-bottom:0;">
       		<table class="farmingMageTab_jl" style="width:100%;">
                <tr class="input_h">
                	<td width="62" align="right">投入品名称</td>
                    <td width="205" style="padding-left:15px;">
                       <input type="hidden" value="" id="auto_input_code" name="auto_input_code"/>
					   <h:inputText type="text" class="form-control nw221" style="width:190px;float:left;margin-left:2px;" id="trpmingcheng" value="#{inputsStockHome.mingcheng}" />
					   <span style="color: red;">*</span>
                    </td>
                	<td width="62" align="right">投入品类型</td>
                    <td width="240" style="padding-left:15px;">
                       <h:inputHidden type="hidden" value="#{inputsStockHome.totalInputsType}" id="input_type" name="input_type"/>
                       <h:inputHidden type="hidden" value="#{inputsStockHome.leixing}" id="input_type_child"/>
                       <select class="" style="width:220px" id="trpleixing" data-live-search="true" onchange="changeAddPage();">
                    		<option value="-1">请选择</option>
                    	</select>
                    	<span style="color: red;">*</span>
                    </td>
                </tr>
                <tr  class="input_h">                                                           	
                	<td width="" align="right">保质期</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputText type="text" value="#{inputsStockHome.baozhiqi}" class="form-control nw221" style="width:180px;float:left;margin-left:2px;float:left" id="trpbaozhiqi"/>
                    	<div>月<span style="color: red;">*</span></div>
                    </td>
					<td width="62" align="right">规格</td>
                    <td width="218" style="padding-left:15px;">
                    	<h:inputText type="text" value="#{inputsStockHome.netContent}" class="form-control nw221" style="width:70px;height:30px;float:left;margin-right:5px;" id="net_content"/>
						<div class="bootSelt-80" style="float:left;">
							<h:selectOneMenu styleClass="selectpicker" id="input_unit"  value="#{inputsStockHome.unit}" >
								<s:selectItems value="#{goodsInfoHome.getAllInputsUnit()}" var="unit" label="#{unit.name}" itemValue="#{unit.id}"/>
							</h:selectOneMenu>
						</div>
						<p style="float:left; margin-right: 2px;margin-left: -5px;">/</p>
						<h:inputText type="text" value="#{inputsStockHome.packSpec}" class="form-control nw221" style="width:70px;height:30px;float:left;" id="input_spec"/>
						<div style="clear:both;line-height:1;"><span style="color: red;">*</span>(净含量 单位规格/包装规格)</div>
						<div style="color: red;line-height:1;">投入品规格在提交投入品信息后不可修改！</div>
                    </td>
                </tr>
                <tr  class="input_h">
                	<td width="" align="right">存储类型</td>
                    <td width="" style="padding-left:15px;">
                    	<div class="bootSelt-190" style="float:left;">
	                    	<h:selectOneMenu styleClass="selectpicker" id="trpcunchu" style="" value="#{inputsStockHome.storageType}">
								<s:selectItems value="#{goodsInfoHome.goodsStorgeTypeList()}" var="plant" label="#{plant.name}" itemValue="#{plant.goodsStorageTypeId}"/>
							</h:selectOneMenu>
						</div>
						<span style="color: red;">*</span>
                    </td>
                    <td width="" align="right">生产厂家</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputText type="text" value="#{inputsStockHome.shengchanchangjia}" class="form-control nw221 fl" style="width:190px;" id="trpchangjia" />
                    	<span style="color: red;">*</span>
                    </td>
                </tr>
                <tr class="input_pest inpu" style="display: none;">
	                <td width="" align="right">有效成分</td>
	                <td width="" style="padding-left:15px;">
	                   <h:inputText type="text" class="form-control nw221" value="#{inputsStockHome.chengfen}" style="width:190px;" id="trpchengfen"/>
	                </td>
                    <td width="" align="right">适用标准</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputHidden type="hidden" value="#{inputsStockHome.biaozhun}" id="bz1"/>
                    	<div class="bootSelt-190" style="float:left;">
	                    	<select class="selectpicker data_dic" data-live-search="true" id="trpbiaozhun1" multiple="multiple" title="请选择">
	                    		<option value="122">有机</option>
	                    		<option value="123">绿色</option>
	                    		<option value="124">无公害</option>
	                    	</select>
                    	</div>
                    </td>
                </tr>
                <tr class="input_pest inpu" style="display: none;">
                	<td width="" align="right">安全间隔期</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputText type="text" value="#{inputsStockHome.anquan}" class="form-control nw221" style="width:190px;float:left" id="trpanquan"/> 天
                    </td>
                    <td width="" align="right">防治对象</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputText type="text" value="#{inputsStockHome.fangzhi}" class="form-control nw221" style="width:190px;" id="trpfangzhi" />
                    </td>
                </tr>
                <tr class="input_pest inpu" style="display: none;">
                	<td width="" align="right">使用方法</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputText type="text" value="#{inputsStockHome.shiyongfangfa}" class="form-control nw221" style="width:190px;" id="trpshiyong1"  />
                    </td>
                    <td width="" align="right"></td>
                    <td width="" style="padding-left:15px;">
                    	
                    </td>
                </tr>
                <tr class="input_pest inpu" style="display: none;">
                	<td width="" align="right" valign="middle">备注</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputTextarea class="form-control" id="trpremark1" value="#{inputsStockHome.remark}" style="width:175px; resize:none; font-size:12px;" rows="3">
                    	</h:inputTextarea>
                    </td>
                    <td></td>
                    <td></td>
                </tr>
                <tr class="input_fert inpu" style="display: none;">
                	<td width="" align="right">养分含量</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputText type="text" value="#{inputsStockHome.yangfen}" class="form-control nw221" style="width:190px;" id="trpyangfen" />
                    </td>
                    <td width="" align="right">适用标准</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputHidden type="hidden" value="#{inputsStockHome.biaozhun}" id="bz2"/>
                    	<select class="selectpicker data_dic" id="trpbiaozhun2" multiple="multiple" title="请选择">
                    		<option value="122">有机</option>
                    		<option value="123">绿色</option>
                    		<option value="124">无公害</option>
                    	</select>
                    </td>
                </tr>
                <tr class="input_fert inpu" style="display: none;">
                	<td width="" align="right">登记证号</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputText type="text" value="#{inputsStockHome.dengji}" class="form-control nw221" style="width:190px;" id="trpdengji" />
                    </td>
                    <td width="" align="right">适用作物</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputText type="text" value="#{inputsStockHome.zuowu}" class="form-control nw221" style="width:190px;" id="trpzuowu" />
                    </td>
                </tr>
                <tr class="input_fert inpu" style="display: none;">
                	<td width="" align="right">施用方法</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputText type="text" value="#{inputsStockHome.shiyongfangfa}" class="form-control nw221" style="width:190px;" id="trpshiyong2"/>
                    </td>
                    <td width="" align="right"></td>
                    <td width="" style="padding-left:15px;">
                    </td>
                </tr>
                <tr class="input_fert inpu" style="display: none;">
                	<td width="" align="right" valign="middle">备注</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputTextarea class="form-control" value="#{inputsStockHome.remark}" id="trpremark2" style="width:175px; resize:none; font-size:12px;" rows="3">
                    	</h:inputTextarea>
                    </td>
                    <td></td>
                    <td></td>
                </tr>
                <tr class="input_other">
                	<td width="" align="right" valign="middle">备注</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputTextarea value="#{inputsStockHome.remark}" class="form-control" id="trpremark3" style="width:175px; resize:none; font-size:12px;" rows="3"></h:inputTextarea>
                    </td>
                    <td width="" align="right" valign="middle">适用标准</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputHidden value="#{inputsStockHome.biaozhun}" id="bz3"/>
                    	<select class="selectpicker data_dic" id="trpbiaozhun3" multiple="multiple" title="请选择">
                    		<option value="122">有机</option>
                    		<option value="123">绿色</option>
                    		<option value="124">无公害</option>
                    	</select>
                    </td>
                 </tr>
                 <tr class="input_seed inpu" style="display: none;">
	                <td width="" align="right">茬口</td>
	                <td width="" style="padding-left:15px;">
	                   <h:inputText type="text" class="form-control nw221 fl" value="#{inputsStockHome.crops}" style="width:190px;" id="crops"/>
	                   <span style="color: red;padding:0 5px;">*</span>
	                </td>
                    <td width="" align="right">适用标准</td>
                    <td width="" style="padding-left:15px;">
                    	<h:inputHidden type="hidden" value="#{inputsStockHome.biaozhun}" id="bz4"/>
                    	<div class="bootSelt-190" style="float:left;">
	                    	<select class="selectpicker data_dic" id="trpbiaozhun4" multiple="multiple">
	                    		<option value="122">有机</option>
	                    		<option value="123">绿色</option>
	                    		<option value="124">无公害</option>
	                    	</select>
                    	</div>
                    </td>
                </tr>
                 <tr>
                    <td width="" align="right" valign="middle">图片上传：
                    </td>
                    <td width="" style="padding-left:15px;" colspan="3">
                    	<h:panelGroup id="reshIframe" >
                    	<h:inputHidden value="#{inputsStockHome.url}" id="url" name="url"/>
                    	<iframe src="#{request.contextPath}/inputs/AddInputsImage.seam" id="myframe" class="fl" name="myframe" frameBorder="0" scrolling="no" width="130" onLoad="" ></iframe>
                    	 </h:panelGroup>
                    	<div style="padding:55px 0 0 10px;float:left;">
	                    	<p id="uploadMsg" style="margin:0;line-height:20px;">未选择任何文件</p>
							<p style="margin:0;line-height:20px;"><font color="#FF0000">支持格式:jpg,gif,png,jpeg,bmp,3gp。图片大小不可超过1M！</font></p>
						</div>
                    </td>
                </tr>
            </table>
        </div>
        </h:panelGroup>
        <div class="modal-footer">
        <input type="button" class="btn btn-success" value="提交"  onclick="if(!checkInput())return false;" style="cursor: pointer;" />
        <a4j:commandButton id="submitBtn" styleClass="btn btn-success" value="提交" eventsQueue="mainQueue" style="cursor: pointer;display:none;" action="#{inputsStockHome.addInputs()}" data="#{inputsStockHome.promptMessage}" oncomplete="hdInsert(data);"/>
        <input class="btn btn-default" type="button" onclick="jquery('#addInput').modal('hide');jquery('#myModal').modal('show');"  value="返回"></input>
        </div>
    </div>
</div>  
    </a4j:form>
    <!-- 添加投入品框 结束 -->
</td>
<a:form>
	<a:queue requestDelay="10" ignoreDupResponses="true"/>
	<a:jsFunction name="modifyGoodsMaoNum" action="#{repertoryChange.modifyGoodsMaoNum}" oncomplete="refreshCartAction();" >
		<a:actionparam name="goodsInfoKey" assignTo="#{repertoryChange.goodsInfoKey}"/>
		<a:actionparam name="modifyMaoNum" assignTo="#{repertoryChange.modifyMaoNum}"/>
	</a:jsFunction>
	<a:jsFunction name="modifyGoodsInfoPrice" action="#{repertoryChange.modifyGoodsInfoPrice}" oncomplete="refreshCartAction();" >
		<a:actionparam name="goodsInfoKey" assignTo="#{repertoryChange.goodsInfoKey}"/>
		<a:actionparam name="modifyPrice" assignTo="#{repertoryChange.modifyPrice}"/>
	</a:jsFunction>
	<a:jsFunction name="modifyGoodsInfoExpirationDate" action="#{repertoryChange.modifyGoodsInfoExpirationDate}" oncomplete="refreshCartAction();" >
		<a:actionparam name="goodsInfoKey" assignTo="#{repertoryChange.goodsInfoKey}"/>
		<a:actionparam name="modifyExpirationDate" assignTo="#{repertoryChange.modifyExpirationDate}"/>
	</a:jsFunction>
	<a:jsFunction name="modifyGoodsJingNum" action="#{repertoryChange.modifyGoodsJingNum}" oncomplete="refreshCartAction();" >
		<a:actionparam name="goodsInfoKey" assignTo="#{repertoryChange.goodsInfoKey}"/>
		<a:actionparam name="modifyJingNum" assignTo="#{repertoryChange.modifyJingNum}"/>
	</a:jsFunction>
	<a:jsFunction name="removeGoodsInfo" action="#{repertoryChange.removeInputsInfo}" reRender="totalPenal" oncomplete="checkedhuidiao();">
		<a:actionparam name="goodsInfoKey" assignTo="#{repertoryChange.goodsInfoKey}"/>
		<a:actionparam name="listIndex" assignTo="#{repertoryChange.listIndex}"/>
		<a:actionparam name="goodsBatchStrings" assignTo="#{repertoryChange.goodsBatchStrings}"/>
	</a:jsFunction>
	<a:jsFunction name="showListFiltel" action="#{repertoryChange.showListFiltel}" reRender="showPanel" >
		<a:actionparam name="goodsNameCode" assignTo="#{repertoryChange.goodsNameCode}"/>
	</a:jsFunction>
	<a:jsFunction name="scanCodeFind" action="#{repertoryChange.scanCodeFind}" data="#{repertoryChange.scanCodeMsg}" oncomplete="searchScanOnComplete(data);" >
		<a:actionparam name="goodsNameCode" assignTo="#{repertoryChange.goodsNameCode}"/>
	</a:jsFunction>
	<a:jsFunction name="addCheckedGoodsInfo" action="#{repertoryChange.addCheckedGoodsInfo}"  reRender="totalPenal" oncomplete="checkedhuidiao();">
		<a:actionparam name="resultTree" assignTo="#{repertoryChange.resultTree}"/>
		<a:actionparam name="goodsBatchStrings" assignTo="#{repertoryChange.goodsBatchStrings}"/>
		<a:actionparam name="typeNum" assignTo="#{repertoryChange.typeNum}"/>
	</a:jsFunction>
	<a:jsFunction name="queryStockInputsPage" action="#{inputsStockHome.searchNotMeInputs}" reRender="stockInputss,stockInputssPage1" oncomplete="hd();">
		<a:actionparam name="stockInputs" assignTo="#{inputsStockHome.stockInputsSearch}"/>
		<a:actionparam name="inputsSelect" assignTo="#{inputsStockHome.stockFactory}"/>
		<a:actionparam name="inputsTypeSelect" assignTo="#{inputsStockHome.stockInputsType}"/>
		<a:actionparam name="selectPageNum" assignTo="#{inputsStockHome.selectPageNum}"/>
	</a:jsFunction>
	<a:jsFunction name="addToOwn" action="#{inputsStockHome.addToOwn}" data="#{inputsStockHome.callStr}" oncomplete="hdAdd(data);">
		<a:actionparam name="str" assignTo="#{inputsStockHome.inputsIdStr}"/>
	</a:jsFunction>
	<a:jsFunction name="changePage" action="#{inputsStockHome.changePage}" data="#{inputsStockHome.totalInputsType}" oncomplete="hdchange(data);">
		<a:actionparam name="type" assignTo="#{inputsStockHome.type}"/>
	</a:jsFunction>
	<a:jsFunction name="refreshPage" action="#{inputsStockHome.refreshPage}">
	</a:jsFunction>
	<a:jsFunction name="refreshIframe" action="#{inputsStockHome.refreshIframe}" reRender="reshIframe" oncomplete="showModel();">
	</a:jsFunction>
</a:form>
<script type="text/javascript" src="#{request.contextPath}/asset/js/jquery.nicescroll.min.js" charset="utf-8"></script>
<link rel="stylesheet" href="#{request.contextPath}/asset/css/webgis/select2.css" />
<script type="text/javascript" src="#{request.contextPath}/asset/js/webgis/select2.full.js" ></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/webgis/i18n/zh-CN.js" ></script>
<script type="text/javascript">
//<![CDATA[
	var tab = 1;//当前标签 
	jquery(document).ready(function() {
        jquery('select:not(.data_dic)').not("#trpleixing").selectpicker();
        jquery("#trpbiaozhun1").selectpicker({noneSelectedText:"请选择"});
        jquery("#trpbiaozhun2").selectpicker({noneSelectedText:"请选择"});
        jquery("#trpbiaozhun3").selectpicker({noneSelectedText:"请选择"});
        init();
        initComplex();
	}); 	
    jquery('.tableModel tr').mouseover(function(){  // 表格模板隔行换色
    jquery(this).addClass('hover');
    });
    jquery('.tableModel tr').mouseout(function(){
        jquery(this).removeClass('hover');
    }); 
	//可添加投入品列表
	function inputsAdd(){
		jquery("#stockInputs").val("");
		jquery("#inputsSelect").selectpicker("val",jquery("#inputsSelect option:eq(0)").val());
		jquery("#inputsTypeSelect").selectpicker("val",jquery("#inputsTypeSelect option:eq(0)").val());
		searchStockInputsPage("1");
		jquery("#myModal").modal('show'); 
	}
    //滚动条初始化
    function init(){
    	jquery(".table_scroll").niceScroll({cursorcolor:"#52a9f3",cursorwidth:6,cursoropacitymax:0.7,touchbehavior:false,autohidemode:false});  //滚动条控件 
    }
	function submitSave(){
		var storageDate = jquery("#inStorageTime").val();
		if(!storageDate){
			alert("请选择入库时间");
			return false;
		}
		if(jquery("._number").length==0){ 
			alert("请至少添加一个投入品信息");
  		  	return false;
		} 
		var storageRoomId = jquery('select[name="storageRoomId"]').val();
        if ("org.jboss.seam.ui.NoSelectionConverter.noSelectionValue" == storageRoomId||storageRoomId==''||storageRoomId==null){
        	alert("请选择库房....");
			return false;
		}
        var storageType = jquery('select[name="storageType"]').val();
        if ("org.jboss.seam.ui.NoSelectionConverter.noSelectionValue" == storageType||storageType==''||storageType==null){
        	alert("请选择入库类型....");
			return false;
		}
		var commentArea = jquery("#commentArea").val();
		var operaterValue = jquery("#operater").val();
		var tunnelInfoId = jquery('select[name="tunnelInfoId"]').val();
		jquery("#saveFrom\\:tunnelInfoIdHidden").val(tunnelInfoId);
		jquery("#saveFrom\\:storageRoomIdHidden").val(storageRoomId);
		jquery("#saveFrom\\:storageTypeHidden").val(storageType);
		jquery("#saveFrom\\:storageDateHidden").val(storageDate);
		jquery("#saveFrom\\:commentHidden").val(commentArea); 
		if(operaterValue == ''){
			alert("经办人不能为空!");
			return false;
		}else{
			jquery("#saveFrom\\:operaterHidden").val(operaterValue);
		}
		 var goodsBatchStrings=getAddGoodsInfo();
		 jquery("#saveFrom\\:goodsBatchStringsHidden").val(goodsBatchStrings); 
		return true;
	}
	//添加入库 保留上次修改的记录
   	function getAddGoodsInfo(){ 	
    	var maoNum="";
        var jingNum="";
        var exprDate="";
        var goodsPrice="";
        var goodsBatchStrings="";
        var index;
 	    var trObj=jquery("#cartList\\:tb").children("tr");
 	    trObj.each(function(i){     
 	 	    	var goodsKey=jquery("#hiddenGoodsKey"+i).val();  
				var tdObj=jquery(trObj[i]).children("td");
				maoNum=jquery("#numMaober"+goodsKey).val();
				jingNum=jquery("#numMaober"+goodsKey).val();
				shengchanTime=jquery("#shengchanTime"+goodsKey).val();
				exprDate=jquery("#baozhiqi"+goodsKey).val();
				goodsPrice=jquery("#goodsPrice"+goodsKey).val();
				index = goodsKey.split('-')[1];
				if(""!=goodsBatchStrings){
					goodsBatchStrings+="###";
				}
				goodsBatchStrings+=goodsKey+"@@"+maoNum+"@@"+shengchanTime+"@@"+jingNum+"@@"+exprDate+"@@"+goodsPrice + "@@" + index;
     	});
     	return goodsBatchStrings;
   	}       
    function KeyDown(){    
        if (event.keyCode == 13){     
            event.returnValue=false;        
         }
     }
    jquery('#searchName').keydown(function(e){
    	if(e.keyCode==13){
    		var searchName = jquery("#searchName").val();
        	if (tab == 1) {
    			showListFiltel(searchName);
			} else {
				scanCodeFind(searchName);
			}
    	}
    }); 
    function updateExpirationDate(productId, expirationDate, levelId, Numberid,index){
    	if(jquery.REGEX_TYPES.digital.test(expirationDate)){
        	if (expirationDate.length > 4) {
				alert("保质期不能大于4位数字...");
				document.getElementById(Numberid).value=1;
			} else {
				var goodsInfoKey = productId + "-" + levelId;
			}
		}else {
			alert("保质期只能为正整数...");
			document.getElementById(Numberid).value=1;
		}
	}
    function updatePrice(productId, price, levelId,index){
    	if(isNaN(price) || price <0 ){
			alert("单价必须为数字");
			document.getElementById("numMaober"+productId).value=parseFloat(0).toFixed(1);
			return;
		}  
		var goodsInfoKey = productId + "-" + levelId;
		jquery("#totalGoodsPrice"+productId+index).html((parseFloat(jquery("#numMaober"+productId+"-"+index).val())*parseFloat(jquery("#goodsPrice"+productId+"-"+index).val())).toFixed(2));
	}
	function updateMaoNum(productId, num,Numberid, levelId,index){
		if(isNaN(num) || num <=0 ){
			alert("商品数量大于0...");
			document.getElementById(Numberid).value=1;
			num = 1;
		}
		var goodsInfoKey = productId + "-" + levelId;
		if(jquery.REGEX_TYPES.digital.test(parseFloat(num)) == true){
		}else{
			var number = num.substr(0,num.indexOf('.')+4);
		}
		jquery("#totalGoodsPrice"+productId+index).html((parseFloat(jquery("#numMaober"+productId+"-"+index).val())*parseFloat(jquery("#goodsPrice"+productId+"-"+index).val())).toFixed(2));
	}
	function updateJingNum(productId, num,Numberid, levelId,maoNum, unitType){
		maoNum=parseFloat(jquery("#numMaober"+productId).val());
		if(isNaN(num) || num <=0 ){
			alert("商品数量大于0...");
			document.getElementById(Numberid).value=1;
			num = 1;
		}
		if(num>maoNum){
			alert("净入库量必须小于毛入库量");
			document.getElementById(Numberid).value=1;  
			return;
		}
		var goodsInfoKey = productId + "-" + levelId;
		if(jquery.REGEX_TYPES.digital.test(parseFloat(num)) == true){
		}else{
			var number = num.substr(0,num.indexOf('.')+4);
		}	
	}
    //添加选中商品到购物车
    function submitProduct(){
        var str = "";
    	jquery("input[name='productCheck']:checkbox:checked").each(function(){
          	str += jquery(this).val();
      	});
      	var type=jquery("#storageType").val();
		if (str != '') {
			var values = '{"resultDatas":[';
			var temp = str.split("|"); 
			for ( var i = 0; i < temp.length-1; i++) {
				values += '{"goodsInfoId":' + temp[i] + ',"number":1},';
			}
	    	values = values.substring(0, values.length-1) + ']}';
		    var goodsStr=getAddGoodsInfo();
	    	addCheckedGoodsInfo(values,goodsStr,11);
	    	return true;
		}else {
			alert("请选择至少一个投入品...");
			return false;
		}
    }
    //全选事件
    function selectedAll(){
		var checked = jquery("#productCheckAll").prop("checked");
		jquery("input[name='productCheck']").prop("checked", checked);
	}
  	//单选事件
    function selectedOne(){
    	var str = "";
    	jquery("input[name='productCheck']:checkbox:checked").each(function(){
          	str += jquery(this).val();
      	});
      	if (str == '') {
      		jquery("#productCheckAll").removeAttr("checked");
		}
	}
    //搜索商品
    function searchButton(){
		var searchName = jquery("#searchName").val();
		showListFiltel(searchName);
    }
  	//搜索商品回调
    function searchOnComplete(){
    	document.getElementById("saveFrom:refreshShow").onclick();
    }
	//扫码
    function searchScan(){
		var searchName = jquery("#searchName").val();
		scanCodeFind(searchName);
    }
	//扫码商品回调
    function searchScanOnComplete(data){
    	jquery('#preview').remove();
    	jquery("#showMsg").append("<div id='preview' style='width:340px; height:50px; line-height:50px; padding:20px; font-size:25px; background:#fcf8e3; text-align:center; position:absolute; left:50%; top:50%; margin-left:-170px; margin-top:-45px; border-radius:10px; border:1px solid #faebcc; color:#8a6d3b;'>" + data + "</div>");
    	jquery("#preview").fadeIn(2500);
    	jquery("#preview").fadeOut(2500);
        document.getElementById("saveFrom:refreshToral").onclick();
    }
	//删除单个
	function delOneProduct(productId, levelId,listIndex){
		var goodsInfoKey = productId + "-" + levelId;
		if(confirm('确定删除吗？')){
		    var goodsStr=getAddGoodsInfo();
			removeGoodsInfo(goodsInfoKey,listIndex,goodsStr);
		}
	}
	//添加到购物车回调
	function addProductComplete(data){
		refreshCartAction();
	}
	//修改数量回调
	function modifyNumComplete(data){
		refreshCartAction();
	}
	//刷新
	function refreshCartAction(){
		document.getElementById("saveFrom:refreshToral").onclick();
	}
	//切换tab展示
	function switchTab(showTabId,searchTitle){
		tab = showTabId;
		jquery(".current").removeClass("current");
		jquery("#tab" + showTabId).addClass("current");
		jquery("#searchTitle").html(searchTitle);
		jquery("#searchName").val("");
		jquery('#searchName').focus();
		if (showTabId == 2) {
			jquery("#addTableDiv").hide();
			jquery("#addGoodsInfoDiv").hide();
			jquery("#selectButton").css("display","none");
			jquery("#scanButton").css("display","");
		} else {
			jquery("#addTableDiv").show();
			jquery("#addGoodsInfoDiv").show();
			jquery("#selectButton").css("display","");
			jquery("#scanButton").css("display","none");
			showListFiltel("");
		}
	}
//查询公有投入品
function queryByPage(page){
	var stockInputs = jquery("#stockInputs").val();
	var inputsSelect = jquery("#inputsSelect").val();
	var inputsTypeSelect = jquery("#inputsTypeSelect").val();
	var selectPageNum = Number(page);
	queryStockInputsPage(stockInputs,inputsSelect,inputsTypeSelect,selectPageNum);
}
function searchStockInputsPage(){
	queryByPage("1");
}
function hd(){
	init();
}

function hideInputs(){
	jquery("#myModal").modal('hide');
}
function submitInputs(){
	var str = "";
 	jquery("input[name='sss']:checkbox:checked").each(function(){
       	str += jquery(this).val();
   	});
   	if(str != ""){
		addToOwn(str);
   	}else{
   	   	if(confirm("请选择要提交的投入品！")){
			jquery("#myModal").show();
   	   	}else{
   	   		jquery("#myModal").modal("show");
   	   	}
   	}
}
function hdAdd(data){
	if(data == "yes"){
		alert("提交成功！");
		jquery("#myModal").modal("hide");
		refreshPage();
	}else{
		alert("提交失败！");
	}
}
//添加投入品后执行刷新投入品列表
function  refreshPage(){
	searchButton();
}
//验证提交
function checkInput(){
	var mingcheng = jquery("#inputs\\:trpmingcheng").val();
	if(mingcheng == null || mingcheng == ""){
		alert("投入品名称不可为空！");
		return false;
	}else if(mingcheng.length>20){
    	alert("投入品名称输入过长!");
        return false;
    }
	var leixing = jquery("#trpleixing").val();
	if(leixing == -1){
		alert("投入品类型必须选择！");
		return false;
	}
	jquery("#inputs\\:input_type_child").val(leixing);
	var baozhiqi = jquery("#inputs\\:trpbaozhiqi").val();
	var reg = /^[1-9]+[0-9]*]*$/;
	if(!reg.test(baozhiqi)){
		 alert("保质期必须输入正整数!"); 
		 return false; 
	}else if(baozhiqi == ""){
		alert("请填写保质期！");
	}
	var cunchu = jquery("#inputs\\:trpcunchu").val();
	if(cunchu == null){
		alert("存储类型不可为空！");
		return false;
	}	
	var changjia = jquery("#inputs\\:trpchangjia").val();
	if(changjia == null || changjia == ""){
		alert("生产厂家不可为空！");
		return false;
	}else if(changjia.length > 50){
		alert("生产厂家不能大于50个字符！");
		return false;
	}
	var totalLeixing = jquery("#inputs\\:input_type").val();
	var arr = new Array();
	var biaozhun = "";
	if(totalLeixing == 2){
		var chengfen = jquery("#inputs\\:trpchengfen").val();
		if(chengfen.length > 200){
			alert("有效成分不能大于200个字符！");
			return false;
		}
		arr = jquery("#trpbiaozhun1").val();
		if(arr != null){
			for(var i=0;i<arr.length; i++){
				biaozhun += arr[i] + ",";
			}
		}
		jquery("#inputs\\:bz1").val(biaozhun);
		var anquan = jquery("#inputs\\:trpanquan").val();
		if(anquan!= "" && !reg.test(anquan)){
			 alert("安全期必须输入正整数!"); 
			 return false; 
		}
		var fangzhi = jquery("#inputs\\:trpfangzhi").val();
		if(fangzhi.length > 500){
			alert("防治对象不可以超过500个字符！");
			return false;
		}
		var shiyong = jquery("#inputs\\:trpshiyong1").val();
		if(shiyong.length > 500){
			alert("使用方法不可以超过500个字符！");
			return false;
		}
		var beizhu = jquery("#inputs\\:trpremark1").val();
		if(beizhu.length > 200){
			alert("备注长度过长！不可以超过200个字符！");
			return false;
		}
		var jinghanliang = jquery("#inputs\\:net_content").val();
		if(jinghanliang == "" || jinghanliang == null){
			alert("净含量不可为空！");
			return false;
		}
		if(isNaN(jinghanliang)){
			alert("净含量必须是数字！");
			return false;
		}
		var baozhuang = jquery("#inputs\\:input_spec").val();
		if(baozhuang == "" || baozhuang == null){
			alert("包装规格不可为空！");
			return false;
		}
	}else if(totalLeixing == 3){
		var yangfen = jquery("#inputs\\:trpyangfen").val();
		if(yangfen.length > 500){
			alert("养分含量不可以超过500个字符！");
			return false;
		}
		arr = jquery("#trpbiaozhun2").val();
		if(arr != null){
			for(var i=0;i<arr.length; i++){
				biaozhun += arr[i] + ",";
			}
		}
		jquery("#inputs\\:bz2").val(biaozhun);
		var dengji = jquery("#inputs\\:trpdengji").val();
		if(dengji.length > 50){
			alert("登记证号不可以超过50个字符！");
			return false;
		}
		var zuowu = jquery("#inputs\\:trpzuowu").val();
		if(zuowu.length > 200){
			alert("适用作物不可以超过200个字符！");
			return false;
		}
		var shiyong = jquery("#inputs\\:trpshiyong2").val();
		if(shiyong.length > 500){
			alert("使用方法不可以超过500个字符！");
			return false;
		}
		var beizhu = jquery("#inputs\\:trpremark2").val();
		if(beizhu.length > 200){
			alert("备注长度过长！不可以超过200个字符！");
			return false;
		}
		var jinghanliang = jquery("#inputs\\:net_content").val();
		if(jinghanliang == "" || jinghanliang == null){
			alert("净含量不可为空！");
			return false;
		}
		if(isNaN(jinghanliang)){
			alert("净含量必须是数字！");
			return false;
		}
		var baozhuang = jquery("#inputs\\:input_spec").val();
		if(baozhuang == "" || baozhuang == null){
			alert("包装规格不可为空！");
			return false;
		}
	}else if(totalLeixing == 4){
		arr = jquery("#trpbiaozhun3").val();
		if(arr != null){
			for(var i=0;i<arr.length; i++){
				biaozhun += arr[i] + ",";
			}
		}
		jquery("#inputs\\:bz3").val(biaozhun);
		var beizhu = jquery("#inputs\\:trpremark3").val();
		if(beizhu.length > 200){
			alert("备注长度过长！不可以超过200个字符！");
			return false;
		}
	}else if(totalLeixing == 5){
		arr = jquery("#trpbiaozhun4").val();
		if(arr != null){
			for(var i=0;i<arr.length; i++){
				biaozhun += arr[i] + ",";
			}
		}
		jquery("#inputs\\:bz4").val(biaozhun);
		var crops = jquery("#inputs\\:crops").val();
		if(crops==''|| crops==null){
			alert("茬口不可为空！");
			return false;
		}else if(crops.length > 20){
			alert("茬口长度过长！不可以超过20个字符！");
			return false;
		}
	}
	var logoUrl=jquery("#myframe").contents().find("#inputsImages\\:logoUrl").val();
    if(""!=logoUrl){
    	jquery("#myframe").contents().find("#inputsImages\\:insertImages").click();
    }else{
		jquery("#inputs\\:submitBtn").click();
    	
    }
	return true;
}
//更改投入品类型 页面更改
function changeAddPage(){
	var type = jquery("#trpleixing").val();	
	changePage(type);
}
function showAdd(){
	jquery("#myModal").modal("hide");
	jquery("#inputs\\:trpmingcheng").val("");
	plant_select.select2("trigger", "select", {
	    data:{"id": -1,"text":"请选择"}
	});
	jquery("#inputs\\:trpbaozhiqi").val("");
	jquery("#inputs\\:net_content").val("");
	jquery("#inputs\\:input_unit").selectpicker();
	jquery("#inputs\\:input_spec").val("");
	jquery("#inputs\\:trpcunchu").selectpicker();
	jquery("#inputs\\:trpchangjia").val("");
	jquery("#inputs\\:trpchengfen").val("");
	jquery("#inputs\\:trpanquan").val("");
	jquery("#inputs\\:trpfangzhi").val("");
	jquery("#inputs\\:trpshiyong1").val("");
	jquery("#trpbiaozhun1").selectpicker("val","");
	jquery("#trpbiaozhun2").selectpicker("val","");
	jquery("#trpbiaozhun3").selectpicker("val","");
	jquery("#inputs\\:trpremark1").val("");
	jquery("#inputs\\:trpremark2").val("");
	jquery("#inputs\\:trpremark3").val("");
	jquery("#inputs\\:trpyangfen").val("");
	jquery("#inputs\\:trpdengji").val("");
	jquery("#inputs\\:trpzuowu").val("");
	jquery("#inputs\\:trpshiyong2").val("");
	refreshIframe();
}
function showModel(){
	jquery('.selectpicker').not("#trpleixing").selectpicker();
	jquery("#addInput").modal("show");
}
function hdchange(data){
	jquery('select:not(.data_dic)').not("#trpleixing").selectpicker();
	jquery("#trpbiaozhun1").selectpicker({noneSelectedText:"请选择"});
    jquery("#trpbiaozhun2").selectpicker({noneSelectedText:"请选择"});
    jquery("#trpbiaozhun3").selectpicker({noneSelectedText:"请选择"});
    jquery("#trpbiaozhun4").selectpicker({noneSelectedText:"请选择"});
	jquery("#inputs\\:input_type").val(data);
	if(data == 2){
		jquery(".input_pest").css("display","");
		jquery(".input_fert").css("display","none");
		jquery(".input_other").css("display","none");
		jquery(".input_seed").css("display","none");
	}else if(data == 3){
		jquery(".input_pest").css("display","none");
		jquery(".input_fert").css("display","");
		jquery(".input_other").css("display","none");
		jquery(".input_seed").css("display","none");
	}else if(data == 4){
		jquery(".input_pest").css("display","none");
		jquery(".input_fert").css("display","none");
		jquery(".input_other").css("display","");
		jquery(".input_seed").css("display","none");
	}else if(data == 5){
		jquery(".input_pest").css("display","none");
		jquery(".input_fert").css("display","none");
		jquery(".input_other").css("display","none");
		jquery(".input_seed").css("display","");
	}
}
function hdInsert(data){
	if(data == "yes"){
		alert("添加成功！");
		jquery("#addInput").modal('hide');
		refreshPage();
	}else if(data == "same"){
		alert("投入品信息已存在！");
	}else if(data == "no"){
		alert("添加投入品失败！");
	}else{
		alert(data);
	}
}
function checkedhuidiao(){
	//时间控件
	jQuery(".form_datetime").datetimepicker({
		format: "yyyy-mm-dd",  /* 控制显示格式，默认为空，显示小时分钟 */
		autoclose: true,
		weekStart: 1,
		language:  'zh-CN',	
		minView:2,
		pickerPosition: "bottom-left"
	});
}
var plant_select ;
function initComplex(){
	plant_select = jQuery('#trpleixing').select2({
		placeholder: {
		    id: '',
		    text: '搜索投入品类型的名称！'
		  },
		language : "zh-CN",
		ajax : {
			url : "/rest/1.0/breedList",
			delay : 450,
			dataType : 'json',
			data : function(params) {
				var param = "";
				var page = "";
				if(typeof(params.term) != "undefined"){
					param = params.term;
					param = param.replace("'","\'");
				}
				if(typeof(params.page) != "undefined"){
					page = params.page;
				}
				return {
					'method' : 'inputs_type_list',
					'field' : "{'enterprise_info_id':#{sessionTake.enterpriseInfoId},'search':'"+param+"','page':'"+page+"'}",
				};
			},
			processResults : function(data, params) {
				if(typeof(params.page) == "undefined"){
					params.page = 1
				}
				return {
					results : data.result_data,
					pagination : {
						more : (params.page * 50) < data.total_count
					}
				};
			}
		},
		escapeMarkup : function(markup) {
			return markup;
		}, 
		//minimumInputLength : 2,
		templateResult : formatData,
		templateSelection : formatDataSelection
	})
}
function formatData(result) {
	if (result.loading) return result.text;
		var html = '<div>'+result.text+'</div>';
    return html;
}

function formatDataSelection(data) {
	if(data.id == "-1")
		return '搜索投入品类型名称！';
	return data.text;
}
//]]>
</script>
</ui:define>
</ui:composition>
