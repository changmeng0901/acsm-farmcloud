<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="../layout/iframeTemplate.xhtml"
                xmlns:a="http://richfaces.org/a4j">
	<ui:define name="body">
	#{videoPlay.init()}
	<style>
	
	@charset "utf-8";
/* CSS Document */

body { height:auto;}
html{ height:auto; overflow-y:inhert; padding:0; margin:0;}
body{ font-size:12px; color:#525252;margin:0px}
ul, ol{ margin:0;}
.fl{ float:left; display:inline;}
.fr{ float:right; display:inline;}
.clear{ clear:both;}
.clear:after{ clear:both; content:""; display:block; visibility:hidden; height:0;}
em{ font-style:normal;}
.videoimg .Download {
    bottom: 12px;
    color: #9fa5ad;
    position: absolute;
    right: 8px;
}
/* 监控页视频样式 */
.jiankong-menu{ width:196px;}
#jiankong-menu{ width:196px;}
.jiankong-video{}
.jian-video-body{ position:relative; min-width:729px-; min-height:636px-; background:#000 url(../asset/images/jiankong_videobg.jpg) no-repeat center bottom;}
.jian-video-body .imgvideo{ position:absolute; left:50%; margin-left:-283px; top:50%; margin-top:-225px;}

/* 视频按钮控制样式 */
.video-btns-control{ position:relative; height:74px; background:url(../asset/images/video_bigbg.jpg) repeat-x;}
.btns-control-lt{ position:absolute; left:10px; top:22px; height:34px;}
.btns-control-lt .btns-lt{ float:left; width:37px; height:32px; background:url(../asset/images/video_btnbg.png);}
.btns-control-lt .btns-lt span{ display:block; width:37px; height:32px;}
.btns-control-lt .btns-line,
.btns-control-rt .btns-line{ float:left; width:2px; height:32px; margin:0 10px; overflow:hidden; background:url(../asset/images/video_line.jpg);}
.btns-control-rt .btns-line{ margin-right:5px;}
.btns-control-lt .btns-lt span{ float:left; display:block; width:37px; height:32px;}
.btns-control-lt .btns-lt .btn-HD{ background:url(../asset/images/video_hdbtn.png);}
.btns-control-lt .btns-lt .btn-camera{ background:url(../asset/images/video_cameraBtn.png);}
.btns-control-lt .btns-lt .btn-speech{ background:url(../asset/images/video_speechBtn.png);}
.btns-control-lt .btns-lt .btn-voice{  background:url(../asset/images/video_voiceBtn.png);}
.btns-control-lt .btns-lt .btn-HD,
.btns-control-lt .btns-lt .btn-nocamera,
.btns-control-lt .btns-lt .btn-nospeech, 
.btns-control-lt .btns-lt .btn-novoice{ display:none;}
.btns-control-lt .btns-lt .btn-noHD{ background:url(../asset/images/video_nohdbtn.png) no-repeat;}
.btns-control-lt .btns-lt .btn-nocamera{ background:url(../asset/images/video_cameraBtn.png) no-repeat;}
.btns-control-lt .btns-lt .btn-nospeech{ background:url(../asset/images/video_speechBtnCr.png) no-repeat;}
.btns-control-lt .btns-lt .btn-novoice{ background:url(../asset/images/video_voiceBtnCr.png) no-repeat;}

.btns-control-rt{ position:absolute; right:10px; top:22px; height:34px;}
.btns-control-rt .btns-rt{ float:left; width:37px; height:32px; margin-left:5px; background:url(../asset/images/video_btnbg.png);}
.btns-control-rt .btns-rt span{ display:block; width:37px; height:32px;}
.btns-control-rt .btns-rt:hover,
.btns-control-rt .btns-rt.cur{ background:url(../asset/images/video_btnbgHv.png) no-repeat;}
.btns-control-rt .btns-rt .btn-oneVd{ background:url(../asset/images/video_oneBtn2.png);}
.btns-control-rt .btns-rt .btn-fourVd{ background:url(../asset/images/video_fourBtn2.png);}
.btns-control-rt .btns-rt .btn-nineVd{ background:url(../asset/images/video_nineBtn2.png);}
.btns-control-ct{ position:absolute; left:50%; top:7px; width:269px; height:60px; margin-left:-135px; background:url(../asset/images/video_playbg.png);}
.resize-control{ position:absolute; left:25px; top:25px; z-index:2; width:221px; height:12px;}
.resize-smaller{ float:left; width:49px; height:12px; background:url(../asset/images/video_smallerBtn.png); cursor:pointer;}
.resize-bigger{ float:right; width:49px; height:12px; background:url(../asset/images/video_biggerBtn.png); cursor:pointer;}
.resize-smaller.cur{ background:url(../asset/images/video_nosmallerBtn.png);}
.resize-bigger.cur{ background:url(../asset/images/video_nobiggerBtn.png);}
.direction-control{ position:absolute; left:111px; top:7px; z-index:3; width:47px; height:47px;}
.direction-control span{ position:absolute; cursor:pointer;}
.direction-control .play-top{ left:17px; top:-3px; width:12px; height:7px; background:url(../asset/images/video_playtt.png);}
.direction-control .play-right{ right:-2px; top:18px; width:7px; height:12px; background:url(../asset/images/video_playrt.png);}
.direction-control .play-bottom{ left:18px; bottom:-2px; width:12px; height:7px; background:url(../asset/images/video_playbt.png);}
.direction-control .play-left{ left:-2px; top:18px; width:7px; height:12px; background:url(../asset/images/video_playLt.png);}
.direction-control .play-top.cur{ background:url(../asset/images/video_noplaytt.png);}
.direction-control .play-right.cur{ background:url(../asset/images/video_noplayrt.png);}
.direction-control .play-bottom.cur{ background:url(../asset/images/video_noplaybt.png);}
.direction-control .play-left.cur{ background:url(../asset/images/video_noplayLt.png);}
.play-control{ position:absolute; left:128px; top:22px; z-index:4; width:16px; height:14px; background:url(../asset/images/video_play.png) no-repeat; cursor:pointer;}
.play-control span{ position:absolute; z-index:5px; display:none; width:16px; height:16px; background:url(../asset/images/video_noplay.png) no-repeat;}
/* 小视频按钮样式 */
.small-video-control{ position:relative; width:410px; height:74px; margin:50px auto;}
.small-btns-control-ct{ position:absolute; left:50%; top:7px; width:269px; height:60px; margin-left:-135px; background:url(../asset/images/video_playbg2.png);}
ul,ol,li{
			list-style:none;
			}
		.control_qhbtn{
			float:left;
			margin-left:500px;
			border:1px solid #575f6c;
			border-radius:5px;
			overflow:hidden;
			}
		.control_qhbtn li{
			float:left;
			height:30px;
			line-height:30px;
			padding:0 5px;
			font-size:12px;
			color:#fff;
			background:url(#{request.contextPath}/asset/images/growth/video_btnbg50.jpg) repeat-x left bottom;
			box-sizing:border-box;
			border-left:1px solid #575f6c;
			margin-left:-1px;
			color:#4e5661;
			cursor:pointer;
			}
		.control_qhbtn li i{
			display:inline-block;
			width:20px;
			height:18px;
			vertical-align:top;
			margin:6px 5px 0 0;
			}
		.control_qhbtn li.i_cur{
			background:url(#{request.contextPath}/asset/images/growth/video_btnbg51.jpg) repeat-x left bottom;
			color:#fff;
			}
		.control_qhbtn li .kz_icon{
			background:url(#{request.contextPath}/asset/images/growth/btns_kzan2.png) no-repeat center center;
			}
		.control_qhbtn li.i_cur .kz_icon{
			background:url(#{request.contextPath}/asset/images/growth/btns_kzan1.png) no-repeat center center;
			}
		.control_qhbtn li .jk_icon{
			background:url(#{request.contextPath}/asset/images/growth/btns_jkan2.png) no-repeat center center;
			}
		.control_qhbtn li.i_cur .jk_icon{
			background:url(#{request.contextPath}/asset/images/growth/btns_jkan1.png) no-repeat center center;
			}
		.btns_line{
			background: url(#{request.contextPath}/asset/images/growth/video_line.jpg);
			float: left;
			height: 32px;
			margin: 0 10px;
			overflow: hidden;
			width: 2px;
		}
	</style>
	<div class="jiankong-video">
        	<!-- 视频内容上部 开始 -->
        	<div class="jian-video-body">
            	<div class="imgvideo videoimg" id="videoimg" style="width: 888px; height: 100%; overflow: hidden; text-align: center; top:0;margin-top: 0; margin-left: -437px;">
            	
            	</div>
            </div>
            <!-- 视频内容上部 结束 -->
            <!-- 视频控制 开始 -->
            <div class="video-btns-control">
	            <ul class="control_qhbtn" style="margin-left: 40px; margin-top: 22px; padding-left: 0px;">
			    	<li class="item_jk i_cur"><i class="jk_icon"></i>监控</li>
			    	<li class="item_kz"><i class="kz_icon"></i>控制</li>
			    </ul>
                <div class="btns-control-lt" style="margin-left: 160px;">
                    <a class="btns-lt btns-lt1" href="javascript:;"><span class="btn-noHD"></span><span class="btn-HD"></span></a>
                    <!-- <span class="btns-line"></span>
                    <a class="btns-lt btns-lt2" href="javascript:;" onclick="fetchPicture()"><span class="btn-camera"></span><span class="btn-nocamera"></span></a> -->
                </div>
                <div class="btns-control-ct">
                    <div class="resize-control">
                        <span class="resize-smaller" onmousedown="zoomout()"  onmouseup="stopzoomout()"></span>
                        <span class="resize-bigger" onmousedown="zoomin()"  onmouseup="stopzoomin()"></span>
                    </div>
                    <div class="play-control"><span style="display:inline;"></span></div>
                    <div class="direction-control">
                        <span class="play-top" onmousedown="up()" onmouseup="stopup()"></span>
                        <span class="play-right" onmousedown="right()" onmouseup="stopright()"></span>
                        <span class="play-bottom" onmousedown="down()" onmouseup="stopdown()"></span>
                        <span class="play-left" onmousedown="left()" onmouseup="stopleft()"></span>
                    </div>
                </div>
                <div class="btns-control-lt" style="position:absolute; left:inherit; right:10px;">
                    <a class="btns-lt btns-lt3" href="javascript:;"><span class="btn-speech"></span><span class="btn-nospeech"></span></a>
                    <span class="btns-line"></span>
                    <a class="btns-lt btns-lt4" href="javascript:;"><span class="btn-voice"></span><span class="btn-novoice"></span></a>
                </div>
            </div>   
            <!-- 视频控制 结束 -->    
        </div>
        <select id="audiochannels" style="display:none"></select>
	<script type="text/javascript"> 
	//<![CDATA[ 
	var video = #{videoPlay.result};
	var isWindow = 1;
	var isIE = 1;  //1.ie,2.其它
	var webcam_url = "";
	var whattype = 0;
	var g_iWndIndex = 0;
	var streamType = 2;

		
	jQuery(window).resize(function(){
		VideoResize()
	});
	VideoResize();
	function VideoResize(){
		var oClictWid = jQuery(window).width();
		var h = jQuery(window).height();
		if(h < 600||oClictWid<1280){
			jQuery("#CuPlayerVideo_video_embed").css({'width':'600px','height':'80%',"margin":"auto","margin-top":"10%"});
			//jQuery("#videoimg").css({'width':'620px','height':'400px','overflow':'hidden','text-align':'center','margin-top':'-183px','margin-left':'-287px'});
		}else{
			jQuery("#CuPlayerVideo_video_embed").css({'width':'800px','height':'80%',"margin":"auto","margin-top":"10%"});
			//jQuery("#videoimg").css({'width':'888px','height':'708px','overflow':'hidden','text-align':'center','margin-top':'-348px','margin-left':'-437px'});
		}
	}
	
	function showVideo2(){
		 if(video.type == 3 || video.device_type==305){
			 if(isWindow){
				 //未安装视频插件
				 if (-1 == WebVideoCtrl.I_CheckPluginInstall()) {
					 jQuery(".videoimg").html("");
					 jQuery(".videoimg").append('<img src="#{request.contextPath}/asset/images/nosp.png" id="imgShow"/><a class="Download" id="videoActiveX" href="http://img1.farmeasy.cn/plugin/WebComponents.exe">视频插件下载</a>');	
				 }else{
					 jQuery(".videoimg").html("<div id='divPlugin' style='width:100%;height:100%;'></div>");
					 whattype = 3;
					 // 初始化插件参数及插入插件
					 WebVideoCtrl.I_InitPlugin("100%", "100%", {
						iWndowType:1, 
						cbSelWnd: function(){}
					 });
					 WebVideoCtrl.I_InsertOBJECTPlugin("divPlugin"); 
					 var iChannelID = parseInt(video.app_device_video_channel_no, 10);//通道列表
					 var bZeroChannel = false;
					 console.log(video.app_ip+"----"+video.app_web_port+'-------'+video.app_username+'---------'+video.app_password+'--------'+iChannelID);
					 // 登录
					 var iRet = WebVideoCtrl.I_Login(video.app_ip, 1, video.app_web_port, video.app_username, video.app_password, {
						success: function (xmlDoc) {
							console.log("登录成功...");
							newVideoPreview(video.app_ip, streamType, iChannelID, bZeroChannel);
						},
						error: function () {
							console.log("登录失败...");
						}
					 });
					 if (-1 == iRet) {
						console.log("已登录过...");
						newVideoPreview(video.app_ip, streamType, iChannelID, bZeroChannel);
					 }
					 setTimeout(function(){
						var arrXml = [],
						szInfo = "";
						arrXml.push("<LocalConfigInfo>");
						arrXml.push("<RecordPath>c:\camera\</RecordPath>");
						arrXml.push("<CapturePath>c:\camera\</CapturePath>");
						arrXml.push("</LocalConfigInfo>");
						var iRet = WebVideoCtrl.I_SetLocalCfg(arrXml.join(""));
						if (0 == iRet) {
							szInfo = "本地配置设置成功！";
						} else {
							szInfo = "本地配置设置失败！";
						}
						console.log(szInfo);
					 },0);
					
				 }
			 }else{
				 jQuery("#videoActiveX").hide();
				 webcam_url = video.webcam_url; 
				 if(webcam_url!="" && webcam_url != null){ 
					jQuery(".video-btns-control").hide();
					jQuery(".videoimg").html(""); 
					var height = jQuery("#videoimg").height();
					var width = jQuery("#videoimg").width();   
					var scriptAdd = "<script> var vID = 'videoimg';var vWidth = '"+width+"';var vHeight = '"+height+"';var vPlayer = '#{request.contextPath}/document/player.swf?autostart=true';var vHLSset = '#{request.contextPath}/document/HLS.swf';var vPic = ''; var vHLSurl = '"
						+ webcam_url +"';a.init('videoimg');<\/script>";   
					jQuery("#videoimg").html(scriptAdd);     
				 }
		     }
		 }else{
			 if(isIE == 1){
				 jQuery(".videoimg").html("");
				 if(video.type == 1){
					 //硬盘视频
					 jQuery(".videoimg").append("<object classid='clsid:D5E14042-7BF6-4E24-8B01-2F453E8154D7' id='PlayViewOCX' width='100%' height='100%' style='margin-top:-25px' name='ocx'/>");
					 if(document.all.PlayViewOCX.object != null){
						 jQuery(".btns-lt1").hide();
						 jQuery(".btns-lt2").hide();
						 jQuery(".btns-line").hide();
						 jQuery(".btns-lt3").hide();
						 jQuery(".btns-lt4").hide();
						 setTimeout(function(){
							 jQuery("#videoimg")[0].style["border-top"]="1px solid #FF8A24";
							 },1);
						 whattype = 1;
						 var OCXobj = document.getElementById("PlayViewOCX");
				 	     OCXobj.SetOcxMode(0); 
				 	     OCXobj.SetWndNum(1);  
				 	     OCXobj.SetCapturParam("C:\\camera",0);
				    	 var strName = video.video_name;										//设备名称
				         var strIP = video.app_ip;    				        					//设备ip
				         var strAppName = video.app_username;									//用户名 
				         var strAppPwd = video.app_password;					    			//密码 
				         var strPort = video.app_port;				    						//设备端口号
				         var ChanNum1 = video.app_device_video_channel_no;  					//通道号 
				         var cameraID1 = video.app_device_video_channel_no;
				         var strXML = "<?xml version='1.0'?><Parament><CameraName>"+strName+"</CameraName><CameraID>" + cameraID1 + "</CameraID><DeviceIP>" + 
				   	 	     strIP + "</DeviceIP><DevicePort>" + strPort + "</DevicePort><User>"+ strAppName +"</User><Password>" + 
				   	 		 strAppPwd + "</Password><ChannelNum>"+ ChanNum1 +"</ChannelNum><ProtocolType>0</ProtocolType><StreamType>0</StreamType><Transmits></Transmits></Parament>";
				  	     //var win = OCXobj.GetSelWnd();  
				       	 //OCXobj.StopRealPlay(win); 
				       	 OCXobj.StartTask_Preview_InWnd(strXML,0);  
					 }else{ 
						 jQuery(".videoimg").html("");
						 jQuery(".videoimg").append('<img src="#{request.contextPath}/asset/images/nosp.png" id="imgShow"/><a class="Download" id="videoActiveX" href="http://img1.farmeasy.cn/plugin/cmsocx.exe">视频插件下载</a>');
					 }
				 }else{
					 jQuery(".videoimg").append("<object classid='clsid:EE4EA829-B8DA-4229-AC72-585AF45AD778' standby='Waiting...' id='ppvs'  width='566' height='450' name='ocx1'/>");
					 if(document.all.ppvs.object != null){
						 whattype = 2;
						 jQuery(".btns-lt1").hide();
						 jQuery(".btns-lt2").hide();
						 jQuery(".btns-line").hide();
						 jQuery(".btns-lt3").hide();
						 jQuery(".btns-lt4").hide();
					     var iConnHandle = -1;		//连接设备返回句柄
						 var iPlayHandle = -1;		//播放视频返回句柄 
						 //var iChannel = 1;		//设备视频通道
						 var iStreamType = 0;		//取设备流类型	0：主码流	1：子码流
						 var szAccount= video.sn;
						 var szRegIP = video.ip;
						 var szUserName = video.username;
						 var szPassWord = video.password;
						 var iRegPort = 7660;
					     //7660
						 //流媒体服务IP、端口
						 var iStreamServerPort = 7554;//7554
						 var iPlayConnMode = 0;		//取流方式	0：与设备直连取流	1：通过流媒体转发取流
						 var PlayOCX = document.getElementById("ppvs");
						 iConnHandle = PlayOCX.ConnectDeviceByACS(szAccount, szRegIP, iRegPort,szUserName,szPassWord);
						 if (0 > iConnHandle){
							 jQuery("#showMessage").html("连接设备失败！");
							 jQuery("#showMessageDiv").modal('show');
							 jQuery("body").css("padding-right",0);
						 }else{
							 if ( 0 > iConnHandle){ 
								 jQuery("#showMessage").html("请先连接设备，并确保连接成功！");
								 jQuery("#showMessageDiv").modal('show');
								 jQuery('body').css('padding-right',0);
								 return;
							 } 
							 var PlayOCX = document.getElementById("ppvs");
							 PlayOCX.StreamPlayStartByTCP(szRegIP, iStreamServerPort, szAccount, "1", iStreamType, 1);
						 }
					 }else{
						 jQuery(".videoimg").html(""); 
						 jQuery(".videoimg").append('<img src="#{request.contextPath}/asset/images/nosp.png" id="imgShow"/><a class="Download" id="videoActiveX" href="http://img1.farmeasy.cn/plugin/EHomeActiveX.exe">视频插件下载</a>');
					 }
			     }
			 }else{ 
				 whattype = 4;
				webcam_url = video.webcam_url; 
				if(webcam_url!="" && webcam_url != null){ 
					jQuery("#videoActiveX").hide();
					jQuery(".video-btns-control").hide();
					jQuery(".videoimg").html(""); 
					var height = jQuery("#videoimg").height();
					var width = jQuery("#videoimg").width();   
					var scriptAdd = "<script> var vID = 'videoimg';var vWidth = '"+width+"';var vHeight = '"+height+"';var vPlayer = '#{request.contextPath}/document/player.swf?autostart=true';var vHLSset = '#{request.contextPath}/document/HLS.swf';var vPic = ''; var vHLSurl = '"
						+ webcam_url +"';a.init('videoimg');<\/script>";   
					jQuery("#videoimg").html(scriptAdd);   
				}
		     } 
		 } 
	}


	function showVideo(){
		 if(video.webcam_url != null && video.webcam_url != ''){
		 		jQuery("#videoActiveX").hide();
				//jQuery(".video-btns-control").hide();
				jQuery(".btns-control-ct").hide();
				jQuery(".btns-control-lt").hide();
				jQuery(".videoimg").html(""); 
				var height = jQuery("#videoimg").height();
				var width = jQuery("#videoimg").width();   
				var scriptAdd = "<script> var vID = 'videoimg';var vWidth = '"+width+"';var vHeight = '"+height+"';var vPlayer = '#{request.contextPath}/document/player.swf?autostart=true';var vHLSset = '#{request.contextPath}/document/HLS.swf';var vPic = ''; var vHLSurl = '"
					+ video.webcam_url +"';a.init('videoimg');<\/script>";   
				jQuery("#videoimg").html(scriptAdd);
		 }else{
			if(video.device_type_id==305 || video.type == 3){
				console.log("浏览器类型..."+isIE);
				if(isWindow == 1 && isIE != 3){
					 //未安装视频插件
					 if (-1 == WebVideoCtrl.I_CheckPluginInstall()) {
						 jQuery(".videoimg").html("");
						 jQuery(".videoimg").append('<img src="#{request.contextPath}/asset/images/nosp.png" id="imgShow"/><a class="Download" id="videoActiveX" href="http://img1.farmeasy.cn/plugin/WebComponents.exe">视频插件下载</a>');	
					 }else{
						 jQuery(".videoimg").html("<div id='divPlugin' style='width:100%;height:100%;'></div>");
						 whattype = 3;
						 // 初始化插件参数及插入插件
						 WebVideoCtrl.I_InitPlugin("100%", "100%", {
							iWndowType:1, 
							cbSelWnd: function(){}
						 });
						 WebVideoCtrl.I_InsertOBJECTPlugin("divPlugin"); 
						 var iChannelID = parseInt(video.app_device_video_channel_no, 10);//通道列表
						 var bZeroChannel = false;
						 console.log(video.app_ip+"----"+video.app_web_port+'-------'+video.app_username+'---------'+video.app_password+'--------'+iChannelID);
						 // 登录
						 var iRet = WebVideoCtrl.I_Login(video.app_ip, 1, video.app_web_port, video.app_username, video.app_password, {
							success: function (xmlDoc) {
								console.log("登录成功...");
								newVideoPreview(video.app_ip, streamType, iChannelID, bZeroChannel);
							},
							error: function () {
								console.log("登录失败...");
							}
						 });
						 if (-1 == iRet) {
							console.log("已登录过...");
							newVideoPreview(video.app_ip, streamType, iChannelID, bZeroChannel);
						 }
						 setTimeout(function(){
							var arrXml = [],
							szInfo = "";
							arrXml.push("<LocalConfigInfo>");
							arrXml.push("<RecordPath>c:\camera\</RecordPath>");
							arrXml.push("<CapturePath>c:\camera\</CapturePath>");
							arrXml.push("</LocalConfigInfo>");
							var iRet = WebVideoCtrl.I_SetLocalCfg(arrXml.join(""));
							if (0 == iRet) {
								szInfo = "本地配置设置成功！";
							} else {
								szInfo = "本地配置设置失败！";
							}
							console.log(szInfo);
						 },0);
						
					 }
				 }else{
					 alert("系统或浏览器不支持视频播放");
					 jQuery('.play-control span').show();
					 /* jQuery("#videoActiveX").hide();
					 webcam_url = video.webcam_url; 
					 if(webcam_url!="" && webcam_url != null){ 
						jQuery(".video-btns-control").hide();
						jQuery(".videoimg").html(""); 
						var height = jQuery("#videoimg").height();
						var width = jQuery("#videoimg").width();   
						var scriptAdd = "<script> var vID = 'videoimg';var vWidth = '"+width+"';var vHeight = '"+height+"';var vPlayer = '#{request.contextPath}/document/player.swf?autostart=true';var vHLSset = '#{request.contextPath}/document/HLS.swf';var vPic = ''; var vHLSurl = '"
							+ webcam_url +"';a.init('videoimg');<\/script>";   
						jQuery("#videoimg").html(scriptAdd);     
					 } */
			     }

			}else if(video.type == 1){
				jQuery(".videoimg").html("");
				 if(isWindow == 1 && isIE == 1){
					 //硬盘视频
					 jQuery(".videoimg").append("<object classid='clsid:D5E14042-7BF6-4E24-8B01-2F453E8154D7' id='PlayViewOCX' width='100%' height='100%' style='margin-top:-25px' name='ocx'/>");
					 if(document.all.PlayViewOCX.object != null){
						 jQuery(".btns-lt1").hide();
						 jQuery(".btns-lt2").hide();
						 jQuery(".btns-line").hide();
						 jQuery(".btns-lt3").hide();
						 jQuery(".btns-lt4").hide();
						 setTimeout(function(){
							 jQuery("#videoimg")[0].style["border-top"]="1px solid #FF8A24";
							 },1);
						 whattype = 1;
						 var OCXobj = document.getElementById("PlayViewOCX");
				 	     OCXobj.SetOcxMode(0); 
				 	     OCXobj.SetWndNum(1);  
				 	     OCXobj.SetCapturParam("C:\\camera",0);
				    	 var strName = video.video_name;										//设备名称
				         var strIP = video.app_ip;    				        					//设备ip
				         var strAppName = video.app_username;									//用户名 
				         var strAppPwd = video.app_password;					    			//密码 
				         var strPort = video.app_port;				    						//设备端口号
				         var ChanNum1 = video.app_device_video_channel_no;  					//通道号 
				         var cameraID1 = video.app_device_video_channel_no;
				         var strXML = "<?xml version='1.0'?><Parament><CameraName>"+strName+"</CameraName><CameraID>" + cameraID1 + "</CameraID><DeviceIP>" + 
				   	 	     strIP + "</DeviceIP><DevicePort>" + strPort + "</DevicePort><User>"+ strAppName +"</User><Password>" + 
				   	 		 strAppPwd + "</Password><ChannelNum>"+ ChanNum1 +"</ChannelNum><ProtocolType>0</ProtocolType><StreamType>0</StreamType><Transmits></Transmits></Parament>";
				  	     //var win = OCXobj.GetSelWnd();  
				       	 //OCXobj.StopRealPlay(win); 
				       	 OCXobj.StartTask_Preview_InWnd(strXML,0);  
						 }else{ 
							 jQuery(".videoimg").html("");
							 jQuery(".videoimg").append('<img src="#{request.contextPath}/asset/images/nosp.png" id="imgShow"/><a class="Download" id="videoActiveX" href="http://img1.farmeasy.cn/plugin/cmsocx.exe">视频插件下载</a>');
						 }
				 	}else{
				 		alert("系统或浏览器不支持视频播放");
				 		jQuery('.play-control span').show();
					}
			}else{
				alert("系统或浏览器不支持视频播放");
				jQuery('.play-control span').show();
			}
		 }
		if(video.webcam_url != null && video.webcam_url != ''){
			if((video.device_type_id==305 || video.type == 3) && (isWindow == 1 && isIE != 3)){
				jQuery(".control_qhbtn").show();
			}else if(video.type == 1 && isWindow == 1 && isIE == 1){
				jQuery(".control_qhbtn").show();
			}else{
				jQuery(".control_qhbtn").hide();
			}
		}else{
			jQuery(".control_qhbtn").hide();
		}
	}

	function jiankong(){
		if(video.webcam_url != null && video.webcam_url != ''){
	 		jQuery("#videoActiveX").hide();
			jQuery(".videoimg").html(""); 
			var height = jQuery("#videoimg").height();
			var width = jQuery("#videoimg").width();   
			var scriptAdd = "<script> var vID = 'videoimg';var vWidth = '"+width+"';var vHeight = '"+height+"';var vPlayer = '#{request.contextPath}/document/player.swf?autostart=true';var vHLSset = '#{request.contextPath}/document/HLS.swf';var vPic = ''; var vHLSurl = '"
				+ video.webcam_url +"';a.init('videoimg');<\/script>";   
			jQuery("#videoimg").html(scriptAdd);
	 	}
	}

	function kongzhi(){
		if(video.device_type_id==305 || video.type == 3){
			if(isWindow == 1 && isIE != 3){
				 //未安装视频插件
				 if (-1 == WebVideoCtrl.I_CheckPluginInstall()) {
					 jQuery(".videoimg").html("");
					 jQuery(".videoimg").append('<img src="#{request.contextPath}/asset/images/nosp.png" id="imgShow"/><a class="Download" id="videoActiveX" href="http://img1.farmeasy.cn/plugin/WebComponents.exe">视频插件下载</a>');	
				 }else{
					 jQuery(".videoimg").html("<div id='divPlugin' style='width:100%;height:100%;'></div>");
					 whattype = 3;
					 // 初始化插件参数及插入插件
					 WebVideoCtrl.I_InitPlugin("100%", "100%", {
						iWndowType:1, 
						cbSelWnd: function(){}
					 });
					 WebVideoCtrl.I_InsertOBJECTPlugin("divPlugin"); 
					 var iChannelID = parseInt(video.app_device_video_channel_no, 10);//通道列表
					 var bZeroChannel = false;
					 console.log(video.app_ip+"----"+video.app_web_port+'-------'+video.app_username+'---------'+video.app_password+'--------'+iChannelID);
					 // 登录
					 var iRet = WebVideoCtrl.I_Login(video.app_ip, 1, video.app_web_port, video.app_username, video.app_password, {
						success: function (xmlDoc) {
							console.log("登录成功...");
							newVideoPreview(video.app_ip, streamType, iChannelID, bZeroChannel);
						},
						error: function () {
							console.log("登录失败...");
						}
					 });
					 if (-1 == iRet) {
						console.log("已登录过...");
						newVideoPreview(video.app_ip, streamType, iChannelID, bZeroChannel);
					 }
					 setTimeout(function(){
						var arrXml = [],
						szInfo = "";
						arrXml.push("<LocalConfigInfo>");
						arrXml.push("<RecordPath>c:\camera\</RecordPath>");
						arrXml.push("<CapturePath>c:\camera\</CapturePath>");
						arrXml.push("</LocalConfigInfo>");
						var iRet = WebVideoCtrl.I_SetLocalCfg(arrXml.join(""));
						if (0 == iRet) {
							szInfo = "本地配置设置成功！";
						} else {
							szInfo = "本地配置设置失败！";
						}
						console.log(szInfo);
					 },0);
					
				 }
			 }else{
				 alert("系统或浏览器不支持视频播放");
				 jQuery('.play-control span').show();
		     }
		}else if(video.type == 1){
			jQuery(".videoimg").html("");
			 if(isWindow == 1 && isIE == 1){
				 //硬盘视频
				 jQuery(".videoimg").append("<object classid='clsid:D5E14042-7BF6-4E24-8B01-2F453E8154D7' id='PlayViewOCX' width='100%' height='100%' style='margin-top:-25px' name='ocx'/>");
				 if(document.all.PlayViewOCX.object != null){
					 jQuery(".btns-lt1").hide();
					 jQuery(".btns-lt2").hide();
					 jQuery(".btns-line").hide();
					 jQuery(".btns-lt3").hide();
					 jQuery(".btns-lt4").hide();
					 setTimeout(function(){
						 jQuery("#videoimg")[0].style["border-top"]="1px solid #FF8A24";
						 },1);
					 whattype = 1;
					 var OCXobj = document.getElementById("PlayViewOCX");
			 	     OCXobj.SetOcxMode(0); 
			 	     OCXobj.SetWndNum(1);  
			 	     OCXobj.SetCapturParam("C:\\camera",0);
			    	 var strName = video.video_name;										//设备名称
			         var strIP = video.app_ip;    				        					//设备ip
			         var strAppName = video.app_username;									//用户名 
			         var strAppPwd = video.app_password;					    			//密码 
			         var strPort = video.app_port;				    						//设备端口号
			         var ChanNum1 = video.app_device_video_channel_no;  					//通道号 
			         var cameraID1 = video.app_device_video_channel_no;
			         var strXML = "<?xml version='1.0'?><Parament><CameraName>"+strName+"</CameraName><CameraID>" + cameraID1 + "</CameraID><DeviceIP>" + 
			   	 	     strIP + "</DeviceIP><DevicePort>" + strPort + "</DevicePort><User>"+ strAppName +"</User><Password>" + 
			   	 		 strAppPwd + "</Password><ChannelNum>"+ ChanNum1 +"</ChannelNum><ProtocolType>0</ProtocolType><StreamType>0</StreamType><Transmits></Transmits></Parament>";
			  	     //var win = OCXobj.GetSelWnd();  
			       	 //OCXobj.StopRealPlay(win); 
			       	 OCXobj.StartTask_Preview_InWnd(strXML,0);  
					 }else{ 
						 jQuery(".videoimg").html("");
						 jQuery(".videoimg").append('<img src="#{request.contextPath}/asset/images/nosp.png" id="imgShow"/><a class="Download" id="videoActiveX" href="http://img1.farmeasy.cn/plugin/cmsocx.exe">视频插件下载</a>');
					 }
			 	}else{
			 		alert("系统或浏览器不支持视频播放");
			 		jQuery('.play-control span').show();
				}
		}else{
			alert("系统或浏览器不支持视频播放");
			jQuery('.play-control span').show();
		}
	}
	
	jQuery(function(){
		if(!(navigator.platform == "Win32" || navigator.platform == "Windows")){
			isWindow = 2;
		}
		if ((navigator.userAgent.indexOf('MSIE') >= 0) && (navigator.userAgent.indexOf('Opera') < 0)){
			
		}else if (navigator.userAgent.indexOf('Safari') >= 0 && navigator.userAgent.indexOf('Chrome')<0){
			isIE = 3;   
			jQuery("#videoActiveX").hide();  
		}else{
			isIE = 2;
			jQuery("#videoActiveX").hide();  
		}
		
		if(video.type == 3){
			 whattype = 3;
		}else{
			 if(isIE == 1){
				 if(video.type == 1){
					 jQuery(".btns-lt1").hide();
					 jQuery(".btns-lt2").hide();
					 jQuery(".btns-line").hide();
					 jQuery(".btns-lt3").hide();
					 jQuery(".btns-lt4").hide();
					 whattype = 1;
				 }else{
					 whattype = 2;
					 jQuery(".btns-lt1").hide();
					 jQuery(".btns-lt2").hide();
					 jQuery(".btns-line").hide();
					 jQuery(".btns-lt3").hide();
					 jQuery(".btns-lt4").hide();
				 }
			 }else{ 
				whattype = 4;
				webcam_url = video.webcam_url; 
				if(webcam_url!="" && webcam_url != null){ 
					jQuery(".video-btns-control").hide();
					jQuery(".video-btns-control").hide();
					jQuery(".videoimg").html(""); 
					var height = jQuery("#videoimg").height();
					var width = jQuery("#videoimg").width();   
					var scriptAdd = "<script> var vID = 'videoimg';var vWidth = '"+width+"';var vHeight = '"+height+"';var vPlayer = '#{request.contextPath}/document/player.swf?autostart=true';var vHLSset = '#{request.contextPath}/document/HLS.swf';var vPic = ''; var vHLSurl = '"
						+ webcam_url +"';a.init('videoimg');<\/script>";   
					jQuery("#videoimg").html(scriptAdd);   
				}
			} 
		}
		//视频控制按钮
		function onoroff(obj,elem,noelem,func1,func2){
			jQuery(obj).click(function(){  //视频左侧声音按钮控制
				if(jQuery(elem).is(':visible')){
					jQuery(elem).hide();	
					jQuery(noelem).show();	
					func1();
				}else{
					jQuery(elem).show();	
					jQuery(noelem).hide();
					func2();
				}
			});	
		};
		onoroff('.btns-lt1','.btn-noHD','.btn-HD',hd2,hd1);
		onoroff('.btns-lt2','.btn-camera','.btn-nocamera',none,none);
		onoroff('.btns-lt3','.btn-speech','.btn-nospeech',clickStartVoiceTalk,clickStopVoiceTalk);
		onoroff('.btns-lt4','.btn-voice','.btn-novoice',openVoice,closeVoice);
		
		jQuery('.direction-control span').click(function(){  //视频中间四个方向按钮控制
			jQuery(this).siblings().removeClass('cur');
			jQuery(this).addClass('cur');
		});
		
		jQuery('.resize-control span').click(function(){  //视频中间缩小放大按钮控制
			jQuery(this).siblings().removeClass('cur');
			jQuery(this).addClass('cur');
		});
		  
		jQuery('.play-control').click(function(){  //视频中间暂停和播放按钮控制
			if( jQuery('.play-control span').is(":hidden")){
				jQuery('.play-control span').show();
				stopVideo();
				//kongzhi();
			}else{
				//showVideo();
				kongzhi();
				jQuery('.play-control span').hide();		
			}
		});	
		jQuery('.play-control span').hide();
		//计算视频内容大小
		videoWidth();
		jQuery('.control_qhbtn li').each(function(index, elem) {
			jQuery(elem).click(function(){
				jQuery(this).addClass('i_cur').siblings().removeClass('i_cur');	
				if(jQuery(this).html().indexOf('监控') >= 0){
					jiankong();
					jQuery(".btns-control-ct").hide();
					jQuery(".btns-control-lt").hide();
					jQuery('.play-control span').hide();
					WebVideoCtrl.I_Stop();
				}else{
					kongzhi();
					jQuery(".btns-control-ct").show();
					jQuery(".btns-control-lt").show();
				}
				
			});
        });

		showVideo();
	});
	window.onresize = function(){
		videoWidth()	
		jQuery("#videoimg").css({height:'100%'});
	};
	function none(){
		
	}

		//计算视频内容大小
		function videoWidth(){
			try{
				var oWidth = parent.jquery(".main_wp").width()-parent.jquery(".fixedTd").width();	
				var oHeight = parent.document.body.offsetHeight;	
				var aVideoWt = oWidth;
				var aVideoHt = oHeight - 60 - (jQuery('.video-btns-control').is(':visible')?jQuery('.video-btns-control').height():0);
				var aVideoWtMin = 1002;
				var aVideoHtMin = oHeight -60 - (jQuery('.video-btns-control').is(':visible')?jQuery('.video-btns-control').height():0);
				jQuery('.jian-video-body').css({
					'height' : aVideoHt,
					'min-width' : aVideoWtMin,
					'min-height' : jQuery(window).height()-(jQuery('.video-btns-control').is(':visible')?jQuery('.video-btns-control').height():0)
				});
			}catch(e){
				
			}
		};
		
		//新硬盘录像机开始预览方法
		function newVideoPreview(szIP, iStreamType, iChannelID, bZeroChannel){
			// 开始预览 
			var iRet = WebVideoCtrl.I_StartRealPlay(szIP, {iStreamType: iStreamType, iChannelID: iChannelID, bZeroChannel: bZeroChannel});
			if (iRet == 0) { 
				console.log("开启阅览成功...");
			} else {
				console.log("开启阅览失败...");
			}
		}
		function PTZControlOn(temp)
		{
			//channelNo:函数设备通道号
			//temp：命令控制号（11 - 焦距变大，12 - 焦距变小 ，13 - 焦点变大  ，14 - 焦点变小 ， 15 - 光圈变大，16 - 光圈变小 ，21 - 云台向上， 22 - 云台向下， 23 - 云台左转， 24 - 云台右转）
			//alert(channelNo+'  '+temp);	
			var PlayOCX = document.getElementById("ppvs");
			PlayOCX.PTZControl(channelNo,temp,0,1);
		}
		function stopVideo(){
			if(whattype == 1){
				 var OCXobj = document.getElementById("PlayViewOCX");
			     OCXobj.StopAllPreview();
			}else if(whattype == 2){
				var PlayOCX = document.getElementById("ppvs");
				try{
					PlayOCX.StreamPlayStop();
					PlayOCX.RealPlayStop();
					iPlayHandle = -1;
				}catch(e){
				}
				if( iPlayHandle>=0 ){
					if (parseInt(iPlayConnMode) == 0){
						if(PlayOCX.RealPlayStop()){      
							iPlayHandle = -1;}
					}
					else{
						if(PlayOCX.StreamPlayStop()){
							iPlayHandle = -1;
						}
					}
				}
			}else if(whattype == 3){
				var oWndInfo = WebVideoCtrl.I_GetWindowStatus(g_iWndIndex),
				szInfo = "";
				if (oWndInfo != null) {
					var iRet = WebVideoCtrl.I_Stop();
					if (0 == iRet) {
						szInfo = "停止预览成功！";
					} else {
						szInfo = "停止预览失败！";
					}
					console.log(oWndInfo.szIP + " " + szInfo);
				}
			}else if(whattype == 4){
				
			}
		}
		
		function PTZStop()
	    {
	        var OCXobj = document.getElementById("PlayViewOCX");
	        OCXobj.StartTask_PTZ(-21,3);
	    }
		
		function up(){
			if(whattype == 1){
				var OCXobj = document.getElementById("PlayViewOCX");
		        OCXobj.StartTask_PTZ(21,3);
			}else if(whattype == 2){
				PTZControlOn(21)
			}else if(whattype == 3){
				mouseDownPTZControl(1);
			}else if(whattype == 4){
				
			}
		}
		
		function stopup(){
			if(whattype == 1){
				PTZStop();
			}else if(whattype == 2){
				PTZControlOn(-21)
			}else if(whattype == 3){
				mouseUp();
			}else if(whattype == 4){
				
			}
		}
		
		function down(){
			if(whattype == 1){
				var OCXobj = document.getElementById("PlayViewOCX");
		        OCXobj.StartTask_PTZ(22,3);
			}else if(whattype == 2){
				PTZControlOn(22)
			}else if(whattype == 3){
				mouseDownPTZControl(2);
			}else if(whattype == 4){
				
			}
		}
		
		function stopdown(){
			if(whattype == 1){
				PTZStop();
			}else if(whattype == 2){
				PTZControlOn(-22)
			}else if(whattype == 3){
				mouseUp();
			}else if(whattype == 4){
				
			}
		}
		
		function left(){
			if(whattype == 1){
				var OCXobj = document.getElementById("PlayViewOCX");
		        OCXobj.StartTask_PTZ(23,3);
			}else if(whattype == 2){
				PTZControlOn(23)
			}else if(whattype == 3){
				mouseDownPTZControl(3);
			}else if(whattype == 4){
				
			}
		}
		
		function stopleft(){
			if(whattype == 1){
				PTZStop();
			}else if(whattype == 2){
				PTZControlOn(-23)
			}else if(whattype == 3){
				mouseUp();
			}else if(whattype == 4){
				
			}
		}
		
		function right(){
			if(whattype == 1){
				var OCXobj = document.getElementById("PlayViewOCX");
		        OCXobj.StartTask_PTZ(24,3);
			}else if(whattype == 2){
				PTZControlOn(24)
			}else if(whattype == 3){
				mouseDownPTZControl(4);
			}else if(whattype == 4){
				
			}
		}
		
		function stopright(){
			if(whattype == 1){
				PTZStop();
			}else if(whattype == 2){
				PTZControlOn(-24)
			}else if(whattype == 3){
				mouseUp();
			}else if(whattype == 4){
				
			}
		}
		
		function zoomin(){
			if(whattype == 1){
			 	var OCXobj = document.getElementById("PlayViewOCX");
		        OCXobj.StartTask_PTZ(11,3);
			}else if(whattype == 2){
				PTZControlOn(11)
			}else if(whattype == 3){
				var oWndInfo = WebVideoCtrl.I_GetWindowStatus(g_iWndIndex);
			    if (oWndInfo != null) {
			        WebVideoCtrl.I_PTZControl(10, false, {
			            iWndIndex: g_iWndIndex,
			            success: function (xmlDoc) {
			                console.log(oWndInfo.szIP + " 调焦+成功！");
			            },
			            error: function () {
			                console.log(oWndInfo.szIP + "  调焦+失败！");
			            }
			        });
			    }
			}else if(whattype == 4){
				
			}
		}
		
		function stopzoomin(){
			if(whattype == 1){
				PTZStop();
			}else if(whattype == 2){
				PTZControlOn(-11)
			}else if(whattype == 3){
				mouseUp();
			}else if(whattype == 4){
				
			}
		}
		
		function zoomout(){
			if(whattype == 1){
				var OCXobj = document.getElementById("PlayViewOCX");
		        OCXobj.StartTask_PTZ(12,3);
			}else if(whattype == 2){
				PTZControlOn(12)
			}else if(whattype == 3){
			 	var oWndInfo = WebVideoCtrl.I_GetWindowStatus(g_iWndIndex);
			    if (oWndInfo != null) {
			        WebVideoCtrl.I_PTZControl(11, false, {
			            iWndIndex: g_iWndIndex,
			            success: function (xmlDoc) {
			                console.log(oWndInfo.szIP + " 调焦-成功！");
			            },
			            error: function () {
			                console.log(oWndInfo.szIP + "  调焦-失败！");
			            }
			        });
			    }
			}else if(whattype == 4){
				
			}
		}
		
		function stopzoomout(){
			if(whattype == 1){
				PTZStop();
			}else if(whattype == 2){
				PTZControlOn(-12)
			}else if(whattype == 3){
				mouseUp();
			}else if(whattype == 4){
				
			}
		}
		
		function openVoice(){
			if(whattype == 1){
				var OCXobj = document.getElementById("PlayViewOCX");
		        OCXobj.FireOpenSound(1);
			}else if(whattype == 2){
				var PlayOCX = document.getElementById("ppvs");
				if( iPlayHandle<0 ){
					alert( "请确保正在预览视频!" );
					return;
				}
				if( false == PlayOCX.OpenSound() ){
					alert("打开声音失败!");
				}
			}else if(whattype == 3){
				var oWndInfo = WebVideoCtrl.I_GetWindowStatus(g_iWndIndex),
				szInfo = "";
				if (oWndInfo != null) {
					var allWndInfo = WebVideoCtrl.I_GetWindowStatus();
					// 循环遍历所有窗口，如果有窗口打开了声音，先关闭
					var iRet = WebVideoCtrl.I_OpenSound();
					if (0 == iRet) {
						szInfo = "打开声音成功！";
					} else {
						szInfo = "打开声音失败！";
					}
					console.log(oWndInfo.szIP + " " + szInfo);
				}
			}else if(whattype == 4){
				
			}
		}
		
		function closeVoice(){
			if(whattype == 1){
				var OCXobj = document.getElementById("PlayViewOCX");
		        OCXobj.FireCloseSound(1);
			}else if(whattype == 2){
				var PlayOCX = document.getElementById("ppvs");
				if( iPlayHandle<0 ){
					alert( "请确保正在预览视频!" );
					return;
				}
				if( false == PlayOCX.StopSound() ){
					alert("关闭声音失败!");
				}
			}else if(whattype == 3){
				var oWndInfo = WebVideoCtrl.I_GetWindowStatus(g_iWndIndex),
				szInfo = "";
				if (oWndInfo != null) {
					var iRet = WebVideoCtrl.I_CloseSound();
					if (0 == iRet) {
						szInfo = "关闭声音成功！";
					} else {
						szInfo = "关闭声音失败！";
					}
					console.log(oWndInfo.szIP + " " + szInfo);
				}
			}else if(whattype == 4){
				
			}
		}
		
		function startRecording(){
			if(whattype == 1){
				var OCXobj = document.getElementById("PlayViewOCX");
		        OCXobj.FireStartRecord(1);
			}else if(whattype == 2){
				var PlayOCX = document.getElementById("ppvs");
				var bRet = PlayOCX.StartRecord( "录像设备", 1, "C:\\TestRecord" );
				if( !bRet )
				{
					alert("录像失败!");
				}
			}else if(whattype == 3){
				var oWndInfo = WebVideoCtrl.I_GetWindowStatus(g_iWndIndex),
				szInfo = "";
				if (oWndInfo != null) {
						szFileName = oWndInfo.szIP + "_" + new Date().getTime(),
						iRet = WebVideoCtrl.I_StartRecord(szFileName);
					if (0 == iRet) {
						szInfo = "开始录像成功！";
					} else {
						szInfo = "开始录像失败！";
					}
					console.log(oWndInfo.szIP + " " + szInfo);
				}
			}else if(whattype == 4){
				
			}
		}
		
		function stopRecording(){
			if(whattype == 1){
				var OCXobj = document.getElementById("PlayViewOCX");
		        OCXobj.FireStopRecord(1)
			}else if(whattype == 2){
				var PlayOCX = document.getElementById("ppvs");
				PlayOCX.StopRecord();
			}else if(whattype == 3){
				var oWndInfo = WebVideoCtrl.I_GetWindowStatus(g_iWndIndex),
				szInfo = "";
				if (oWndInfo != null) {
					var iRet = WebVideoCtrl.I_StopRecord();
					if (0 == iRet) {
						szInfo = "停止录像成功！";
					} else {
						szInfo = "停止录像失败！";
					}
					console.log(oWndInfo.szIP + " " + szInfo);
				}
			}else if(whattype == 4){
				
			}
		}
		
		function fetchPicture(){
			if(whattype == 1){
				var OCXobj = document.getElementById("PlayViewOCX");
		        OCXobj.FireCatchPic("C:\\TestRecord",1);
			}else if(whattype == 2){
				
			}else if(whattype == 3){
				var oWndInfo = WebVideoCtrl.I_GetWindowStatus(0),
				szInfo = "";
				if (oWndInfo != null) {
						szPicName = oWndInfo.szIP + "_"  + new Date().getTime(),
						iRet = WebVideoCtrl.I_CapturePic(szPicName);
					if (0 == iRet) {
						szInfo = "抓图成功！";
					} else {
						szInfo = "抓图失败！";
					}
					console.log(oWndInfo.szIP + " " + szInfo);
				}
			}else if(whattype == 4){
				
			}
		}
		var g_bPTZAuto = false;
		function mouseDownPTZControl(iPTZIndex) {
			var oWndInfo = WebVideoCtrl.I_GetWindowStatus(g_iWndIndex),
				bZeroChannel = false,
				iPTZSpeed = 4,
				bStop = false;
			if (bZeroChannel) {// 零通道不支持云台
				return;
			}
			if (oWndInfo != null) {
				if (9 == iPTZIndex && g_bPTZAuto) {
					iPTZSpeed = 0;// 自动开启后，速度置为0可以关闭自动
					bStop = true;
				} else {
					g_bPTZAuto = false;// 点击其他方向，自动肯定会被关闭
					bStop = false;
				}

				WebVideoCtrl.I_PTZControl(iPTZIndex, bStop, {
					iPTZSpeed: iPTZSpeed,
					success: function (xmlDoc) {
						if (9 == iPTZIndex) {
							g_bPTZAuto = !g_bPTZAuto;
						}
						console.log(oWndInfo.szIP + " 开启云台成功！");
					},
					error: function () {
						console.log(oWndInfo.szIP + " 开启云台失败！");
					}
				});
			}
		}
		
		function mouseUp(){
				var oWndInfo = WebVideoCtrl.I_GetWindowStatus(g_iWndIndex);
				if (oWndInfo != null) {
					WebVideoCtrl.I_PTZControl(1, true, {
						success: function (xmlDoc) {
							console.log(oWndInfo.szIP + " 停止云台成功！");
						},
						error: function () {
							console.log(oWndInfo.szIP + " 停止云台失败！");
						}
					});
				}
		}
		
		function hd1(){
			streamType = 1;
			stopVideo();
			showVideo();
		}
		
		function hd2(){
			streamType = 2;
			stopVideo();
			showVideo();
		}
		var iAudioChannel;
		//开始对讲
		function clickStartVoiceTalk() {
			var szIP = video.app_ip;
			if ("" == szIP) {
				return;
			}
			WebVideoCtrl.I_GetAudioInfo(szIP, {
				success: function (xmlDoc) {
					var oAudioChannels = jQuery(xmlDoc).find("TwoWayAudioChannel"),
						oSel = jQuery("#audiochannels").empty();
					jQuery.each(oAudioChannels, function () {
						var id = jQuery(this).find("id").eq(0).text();
						oSel.append("<option value='" + id + "'>" + id + "</option>");
					});
					iAudioChannel = parseInt(jQuery("#audiochannels").val(), 10);
					if(isNaN(iAudioChannel)){
						alert("无对讲通道！");
						return;
					}
					var iRet = WebVideoCtrl.I_StartVoiceTalk(szIP, iAudioChannel);

					if (0 == iRet) {
						szInfo = "开始对讲成功！";
					} else {
						szInfo = "开始对讲失败！";
					}
					console.log(szIP + " " + szInfo);
				},
				error: function () {
					console.log(szIP + " 获取对讲通道失败！");
				}
			});
		}
		
		// 停止对讲
		function clickStopVoiceTalk() {
			var szIP = video.app_ip;
				iRet = WebVideoCtrl.I_StopVoiceTalk(),
				szInfo = "";

			if ("" == szIP) {
				return;
			}

			if (0 == iRet) {
				szInfo = "停止对讲成功！";
			} else {
				szInfo = "停止对讲失败！";
			}
			console.log(szIP + " " + szInfo);
		}
		//]]> 
	</script>
	<script language="javascript" for="PlayViewOCX" event="FireWindowsNumber(iSel)">   
	szMsg = "窗口分割消息,窗口数" + iSel;  
</script>
<script language="javascript" for="PlayViewOCX" event="FireSelectWindow(iSel)"> 
	szMsg = "窗口选择消息,窗口" + iSel;  
</script>
<script language="javascript" for="PlayViewOCX" event="FireStartRealPlay(iSel)">
	szMsg = "开始预览消息" + iSel;  
</script>
<script language="javascript" for="PlayViewOCX" event="FireStopRealPlay(iSel)">   
	szMsg = "停止预览消息" + iSel ;  
</script>
<script language="javascript" for="PlayViewOCX" event="FireStopPreviewAll()">   
	szMsg = "停止所有预览消息" ;  
</script>
<script language="javascript" for="PlayViewOCX" event="FireOpenSound(iSel)">   
	szMsg = "打开声音消息" ;  
</script>
<script language="javascript" for="PlayViewOCX" event="FireCloseSound(iSel)">   
	szMsg = "关闭声音消息" ;  
</script>
<script language="javascript" for="PlayViewOCX" event="FireChangeWindow(iFrom,iTo)">   
	szMsg = "互换窗口消息"+ "从" +iFrom+"到"+iTo;  
</script>
<script language="javascript" for="PlayViewOCX" event="FirePTZCtrl(iWindowID,iCtrlID,iSpeed)">   
	szMsg = "云台控制消息:"+ "窗口:" +iWindowID+"控制:"+iCtrlID+"速度:"+ iSpeed;  
</script>
<script language="javascript" for="PlayViewOCX" event="FireStartRecord(iWindowID)">   
	szMsg = "开始录像"+ iWindowID;  
</script>
<script language="javascript" for="PlayViewOCX" event="FireStopRecord(iWindowID)">   
	szMsg = "停止录像"+ iWindowID;  
</script>
<script language="javascript" for="PlayViewOCX" event="FireCatchPic(szPath,iWindowID)">   
	szMsg = "抓图"+ "路径" +szPath+"窗口"+iWindowID;  
</script>
<script language="javascript" for="PlayViewOCX" event="FireStartPlayBack(lWindowID)">  
</script>
<script language="javascript" for="PlayViewOCX" event="FireStopPlayBack(lWindowID)">  
</script>
	<script type='text/javascript' src='#{request.contextPath}/asset/js/hls.min.js'/>  
	<script type="text/javascript" src="#{request.contextPath}/asset/monitoring/js/webVideoCtrl.js"/>
	</ui:define>
</ui:composition>
