<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template_new.xhtml">
	<ui:define name="foot">
		<!-- 选择基地 开始 -->
		<ui:include src="/layout/BaseIframe.xhtml"></ui:include>
		<!-- 选择基地 结束 -->  
	</ui:define>
	<ui:define name="body">
	<style>
	/*下拉搜索样式09-04*/
	.input-group .form-control:first-child, .input-group-addon:first-child, .input-group-btn:first-child > .btn, .input-group-btn:first-child > .btn-group > .btn, .input-group-btn:first-child > .dropdown-toggle, .input-group-btn:last-child > .btn:not(:last-child):not(.dropdown-toggle), .input-group-btn:last-child > .btn-group:not(:last-child) > .btn {
	    border-bottom-right-radius: 0;
	    border-top-right-radius: 0;
	}.input-group .form-control:last-child, .input-group-addon:last-child, .input-group-btn:last-child > .btn, .input-group-btn:last-child > .btn-group > .btn, .input-group-btn:last-child > .dropdown-toggle, .input-group-btn:first-child > .btn:not(:first-child), .input-group-btn:first-child > .btn-group:not(:first-child) > .btn {
	    border-bottom-left-radius: 0;
	    border-top-left-radius: 0;
	}
	.form-control{  
	border-bottom-left-radius: 0;
	    border-top-left-radius: 0;
	    height:31px;
	    }
/*     .select_input07 .form-control{width:300px;} */
	</style>
	
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/contract/tubiaoFx.css" />
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/contract/superTables_compressed.css" />
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/contract/contractMenu.css" />
	<script type="text/javascript" src="#{request.contextPath}/asset/js/contract/contractLeftMenu.js"></script>
	<style>
	 .bootstrap-select{ width:140px;}
	 .selectpickerList .selectpickerLi .bootstrap-select:not([class*="span"]):not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) {width:140px;}
	 .nw100{ width:140px;}
	 .btn-success{width:40px}
	 i.icon-th2{margin-right:20px;}
	 .dr-pnl-b {font-family:'微软雅黑'}
	 .tjan_01{height: 30px;margin-bottom: 15px;margin-right: 15px;margin-top: -60px;text-align: right;}
	 
	 .datetimepicker{margin-top:0; margin-left:5px;}
	 [class*=" datetimepicker-dropdown"]:before{ border-left: 7px solid transparent;border-right: 7px solid transparent;border-bottom: 7px solid #ccc;border-bottom-color: rgba(0, 0, 0, 0.2);}
	 [class*=" datetimepicker-dropdown"]:after{ border-left: 6px solid transparent;border-right: 6px solid transparent;border-bottom: 6px solid #ffffff;}
	</style>
	
	
	
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal2" class="modal fade in w600na" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="productMsg">*号部分为必填项！</span>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
      </div>
    </div>
  </div>
</div>

       <td valign="top" >
			<div class="inbentory_file_main">
                <!-- 左侧二级导航 -->
                <div class="inbentory_level_wap">
                    <div class="inbentory_level">
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_pc"></i>排产</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onClick="window.open('#{request.contextPath}/map/GanttSum.seam','_self')" ><i class="icon_sed"></i>产量汇总</li>
                            <li class="sed_item sed_cur" onClick="window.open('#{request.contextPath}/map/PlantInfoList.seam','_self')"><i class="icon_sed"></i>排产管理</li>
                            <li class="sed_item" onClick="window.open('#{request.contextPath}/map/Gantt.seam','_self')"><i class="icon_sed"></i>计划表</li>
                        </ol>                    
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_qk"></i>缺口</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onClick="window.open('#{request.contextPath}/contract/LackSum.seam','_self')"><i class="icon_sed"></i>缺口产量表</li>
                            <li class="sed_item" onClick="window.open('#{request.contextPath}/contract/LackChartAnalysis.seam','_self')"><i class="icon_sed"></i>图表分析</li>
                        </ol>
                    </div>
                    <i class="collapse_btn"></i>
                </div>
                <!--左侧二级导航 -->
				<div class="inbentory_content">
				<!-- 公用头部 开始 -->
                	<div class="r_title clear">
                    	<div class="r_t_l fl">&#160;&#160;生产计划&#160;&gt;&#160;&#160;排产&#160;&gt;&#160;&#160;<font size="3">排产管理</font></div>
                    <!-- 公用头部 结束 -->
              </div>
               <br />
<!-- 					#{planPlantList.queryResultFind()} -->
                    <div class="z_r_ser">
                    <h:form id="storageTypeSearch">
                    	<table cellpadding="0" cellspacing="0">
                            <tr>
                                <td>
							  <div class="select_input07" >
							    <div class="input-group">
							         <ul class="selectpickerList">
                                        <!-- 	#{plantSelects.queryPlantSelects()} -->
                                        <li class="selectpickerLi">
											<select id="plantIdStr"  name="plantIdStr2"  data-live-search="true"  class="selectpicker nw100"  onchange="gainResult()">
													<a4j:repeat value="#{plantSelects.plantList}" var="var">
														<optgroup label="#{var}">
															<a4j:repeat value="#{plantSelects.allPlant[var]}" var="_var">
																<option value="#{_var.plantId}">#{_var.name}</option>
															</a4j:repeat>
														</optgroup>
													</a4j:repeat>
											</select>
                                        </li>
                                         <li class="selectpickerLi">
											<select id="plantStauts"  name="plantStauts2"  class="selectpicker nw100"  onchange="gainResult()">
													<option value="3">历史种植</option>
													<option value="1">当前种植</option>
													<option value="2">计划种植</option>
											</select>
                                        </li>
                                         <li class="selectpickerLi">
                                         	<table cellpadding="0" cellspacing="0" style="float:left;">
			                                     <tr>
<!-- 			                                        <td align="right" class="tpcc_font">排产时间：</td> -->
			                                        <td align="left" class="tc_strong" width="136">
			                                        	<div class="input-append date form_datetime " style="position:relative; width:124px;">
													    	<h:inputText readonly="#{facesContext.renderResponse}" styleClass="new_time nw123" id="beginTime" value="#{planPlantList.beginTime}" onchange="gainResult()" style="height:32px; line-height:32px;"/>
													    	<span class="add-on" style="position:absolute; right:10px; top:9px;"><i class="icon-th icon-th2" style="margin:0;"></i></span>
													    </div>
			                                        </td>
			                                        <td>~</td>
			                                        <td align="left" class="tc_strong" width="136">
			                                           <div class="input-append date form_datetime " style="position:relative; width:124px;" >
													    	<h:inputText readonly="#{facesContext.renderResponse}" styleClass="new_time nw123" id="endTime" value="#{planPlantList.endTime}" onchange="gainResult()" style="height:32px; line-height:32px;"/>
													    	<span class="add-on" style="position:absolute; right:10px; top:9px;"><i class="icon-th icon-th2" style="margin:0;"></i></span>
													    </div>
			                                        </td>
			                                    </tr>
			                                </table>
                                         </li>
                                         <li>
                                         	  <input type="hidden" value="#{planPlantList.plantIdStr}" id="plantIdStrHidden" name="plantIdStr"/>
                                         	  <input type="hidden" value="#{planPlantList.plantStauts}" id="plantStautsHidden" name="plantStauts"/>
                                         	  <h:commandButton rendered="#{s:hasRole('gantt_exp')}" id="export" styleClass="btn btn-primary" action="#{planPlantList.exportExcel()}" onclick="checkTime()" value="导出" style="display:none">                                	
	                                		</h:commandButton> 
                                         </li>
                                    </ul>
							    </div>
							</div>
                                </td>
                           </tr>
                       </table> 
                    </h:form>                         
                    </div>
                     <!--添加按钮开始-->
                    <div class="tjan_01">
	                   	<div class="btn-group">
						      	<s:link rendered="#{s:hasRole('gantt_add')}" onclick="return checkBase(this)"   styleClass="btn btn-success mr5 fr" value="添加" view="/map/PlantInfoEdit.xhtml" propagation="none">
		                    	<f:param name="plantInfoPlantInfoId" />
		                    	<f:param name="baseId" value="#{planPlantList.baseId}"/>
		                    	<f:param name="page" value="#{planPlantList.page}"/>
		                    	</s:link>
						</div>
                    	<!-- <s:link style="margin-left:5px;" styleClass="btn btn-default" value="模型库" view="/model/ModelInfoOne.xhtml"/> -->
                    	<input type="button" id="export" class="btn btn-default" onclick="exportCheck();jquery('#storageTypeSearch\\:export').trigger('click')" value="导出" style="#{s:hasRole('gantt_exp')?'':'display:none;'}"/>
                    </div>
                    <!--添加按钮结束-->
                    
                <!--  数据遍历start  -->  
				<rich:panel id="showPanel" style="margin:0; border:none; padding: 0;margin-left:10px;">
                    <table width="100%" class="ze_table" cellpadding="0" cellspacing="0">
                    	<tr>
                    		<td width="5" height="4"><img src="#{request.contextPath}/asset/images/table_d_40.jpg" width="5" height="4" /></td>
                    		<td colspan="8" style="border-top:1px solid #e1e1e1; background:#f0f5fb;"></td>
                            <td width="5" height="4"><img src="#{request.contextPath}/asset/images/table_d_43.jpg" width="5" height="4" /></td>
                    	</tr>
                    	<tr>
                    		<th class="ze_bg ze_bt_le" width="5" height="4"></th>
                    		<th class="ze_bg" width="15%">所在大棚</th>
                    		<th class="ze_bg" width="15%">排产作物</th>
                    		<th class="ze_bg" width="15%">排产品种</th>
                    		<th class="ze_bg" width="10%">排产标准</th>
                    		<th class="ze_bg" width="10%">排产面积</th>
                    		<th class="ze_bg" width="10%">排产时间</th>
                    		<th class="ze_bg" width="10%">结束时间</th>
                    		
                    		<th class="ze_bg" width="15%">操作</th>
                            
                            <th class="ze_bg ze_bt_ri" width="5" height="4"></th>
                    	</tr>
                    	
						<ui:repeat value="#{planPlantList.resultList}" var="_plantInfo" rendered="#{not empty planPlantList.resultList}" rowKeyVar="_index">
                    	<tr>
                    		<td class="ze_bg2 ze_bt_le" width="5" height="4"></td>
                            
                            <td class="ze_bg2"><h:outputText  value="#{_plantInfo[1].tunnelName}" /></td>
                             <td class="ze_bg2"><h:outputText  rendered="#{planPlantList.realPlantType lt 4}" value="#{_plantInfo[0].breedBreedId.plant.name}" /></td>
                    		<td class="ze_bg2"><h:outputText rendered="#{planPlantList.realPlantType lt 4}" value="#{_plantInfo[0].breedBreedId.name}" /></td>
                    		<td class="ze_bg2">#{_plantInfo[0].plantStandard==122 &amp;&amp; planPlantList.realPlantType lt 4?'有机':''}
                    							#{_plantInfo[0].plantStandard==123 &amp;&amp; planPlantList.realPlantType lt 4?'绿色':''}
                    							#{_plantInfo[0].plantStandard==124 &amp;&amp; planPlantList.realPlantType lt 4?'无公害':''}</td>
                    		<td class="ze_bg2"><h:outputText rendered="#{planPlantList.realPlantType lt 4}" value="#{_plantInfo[0].cropArea}亩" /></td>
                    		<td class="ze_bg2">
                    		<h:outputText rendered="#{planPlantList.realPlantType lt 4}" value="#{_plantInfo[0].plantBeginTime}">
								<s:convertDateTime type="both" dateStyle="short" pattern="yyyy-MM-dd" />
						    </h:outputText></td>
						    <td class="ze_bg2">
                    		<h:outputText rendered="#{planPlantList.realPlantType lt 4}" value="#{_plantInfo[0].plantEndTime}">
								<s:convertDateTime type="both" dateStyle="short" pattern="yyyy-MM-dd" />
						    </h:outputText></td>
						   
                    		<td class="ze_bg2">
                    		<s:div rendered="#{planPlantList.realPlantType lt 4}">
                            	<s:link rendered="#{s:hasRole('gantt_show')}" propagation="none" includePageParams="none" view="/#{empty from ? 'map/PlantInfo' : from}.xhtml" styleClass="list_view"  id="plantInfoViewId" title="查看">
								<f:param name="plantInfoPlantInfoId" value="#{_plantInfo[0].realPlantId}" />
								<f:param name="baseId" value="#{planPlantList.baseId}"/>
								<f:param name="pageNum" value="#{planPlantList.page}"/>
								</s:link>&#160;
                                <s:link propagation="none" includePageParams="false" view="/map/PlantInfoEdit.xhtml"     styleClass="list_edit" id="plantInfoEdit" rendered="#{empty from and s:hasRole('gantt_edit')}" title="编辑">
                                <f:param name="plantInfoPlantInfoId" value="#{_plantInfo[0].realPlantId}" />
                                <f:param name="baseId" value="#{planPlantList.baseId}"/>
                                <f:param name="page" value="#{planPlantList.page}"/>
								</s:link>&#160;
								<s:link propagation="none"  rendered="#{s:hasRole('gantt_del') and empty from}" view="/map/PlantInfoEdit.xhtml"   title="删除"  styleClass="list_delete" action="#{realPlantHome.remove}" onclick="return confirm('确定删除吗？');" id="plantInfoDelete">
                                <f:param name="plantInfoPlantInfoId" value="#{_plantInfo[0].realPlantId}" />
                                <f:param name="baseId" value="#{planPlantList.baseId}"/>
                                </s:link>
                                </s:div>
                            </td>
                            <td class="ze_bg2 ze_bt_ri" width="5" height="4"></td>
                    	</tr>
                    	</ui:repeat>
                    </table>
                    <!--翻页开始-->
					<h:form id="pageFrom">
                    <table style="height:30px; margin:40px auto 0 auto;" cellpadding="0" cellspacing="0">
                    	<tr>
                    	<ui:fragment rendered="#{not empty planPlantList.resultList}"> 
			               <ui:fragment rendered="#{!planPlantList.hasPreviousPage}">
			               			<td><img src="#{request.contextPath}/asset/images/page_68.jpg" width="4" height="30" /></td>
			                </ui:fragment>
		                   <ui:fragment rendered="#{planPlantList.hasPreviousPage}">
		               			<td><img src="#{request.contextPath}/asset/images/page_67.jpg" width="4" height="30" /></td>
			                </ui:fragment>
			                  <ui:fragment rendered="#{planPlantList.hasPreviousPage}">
	                            <td class="td_t_b">
		                            <a4j:commandLink id="firstPage" action="#{planPlantList.pageFind(1)}"  reRender="showPanel" status="ajaxStatus">首页</a4j:commandLink>
	                            </td>
	                            <td class="td_t_b td_t_t" style="padding:0; width:30px;">
		                           <a4j:commandLink  id="previousPage" action="#{planPlantList.pageFind(planPlantList.previousPage)}"  reRender="showPanel" status="ajaxStatus">&lt;</a4j:commandLink>
	                            </td>
	                        </ui:fragment>
	                         <a4j:repeat var="_page" value="#{planPlantList.pageList}" rowKeyVar="_index">
								<td class="td_t_b #{planPlantList.hasPreviousPage or _index >0 ?'td_t_t':''} #{_page eq planPlantList.page?'onp':''}">
									<a4j:commandLink  id="previousPage" action="#{planPlantList.pageFind(_page)}"  reRender="showPanel" status="ajaxStatus">#{_page}</a4j:commandLink>
								</td>
							</a4j:repeat>
							<ui:fragment rendered="#{planPlantList.hasNextPage}" >
	                            <td class="td_t_b td_t_t">
		                            	<a4j:commandLink  id="nextPage" action="#{planPlantList.pageFind(planPlantList.nextPage)}"  reRender="showPanel" status="ajaxStatus">&gt;</a4j:commandLink>
	                            </td>
	                          
	                            <td class="td_t_b td_t_t">
									<a4j:commandLink  id="lastPage" action="#{planPlantList.pageFind(planPlantList.totalPages)}"  reRender="showPanel" status="ajaxStatus">尾页 </a4j:commandLink>
								</td>
							</ui:fragment>
							<td class="td_t_b td_t_t" style=" color:#9a9a9c;">共#{planPlantList.totalPages}页</td>
                            <td ><img src="#{request.contextPath}/asset/images/page_70.jpg" width="4" height="30" /></td>
                    	</ui:fragment>
                    	</tr>
                    </table>
                    </h:form>
                   <!--翻页结束-->
                </rich:panel>
                <!--  数据遍历end  --> 
                  
                </div><!--right_c结束-->
                </div>
		
</td>
<a4j:status id="ajaxStatus" forceId="true" onstart="jquery('#login').show()" onstop="jquery('#login').hide()" />
<a4j:form>
		<a4j:queue requestDelay="10" ignoreDupResponses="true"/>
	<a4j:jsFunction status="ajaxStatus" name="queryResult" action="#{planPlantList.queryResultFind}" reRender="showPanel"   oncomplete="refreshAction();" >
		<a4j:actionparam name="baseId" assignTo="#{planPlantList.baseId}"/>
		<a4j:actionparam name="plantIdStr" assignTo="#{planPlantList.plantIdStr}"/>
		<a4j:actionparam name="plantStauts" assignTo="#{planPlantList.plantStauts}"/>
		<a4j:actionparam name="beginTime" assignTo="#{planPlantList.beginTime}"/>
		<a4j:actionparam name="endTime" assignTo="#{planPlantList.endTime}"/>
	</a4j:jsFunction>
</a4j:form>
	
<script type="text/javascript">
//<![CDATA[
           
 function exportCheck(){
	 var beginTime = document.getElementById("storageTypeSearch:beginTime").value;
		if (beginTime == null || beginTime == '') {
			alert("请选择开始时间...");
			return false;
		}
		var endTime = document.getElementById("storageTypeSearch:endTime").value;
		if (endTime == null || endTime == '') {
			alert("请选择结束时间...");
			return false;
		}
		var beginDate = beginTime + "-01";
		var endDate = endTime + "-01";
		var begin =toDate(beginDate);
		var end =toDate(endDate);
		if (begin > end) {
			alert("开始时间不能大于结束时间...");
			return false;
		}
	var plantIdStr = "";
	if(jquery("#plantIdStr").val() != null){
		plantIdStr = jquery("#plantIdStr").val().toString();
	}
	var plantStauts = "";
	if(jquery("#plantStauts").val() != null){
		plantStauts = jquery("#plantStauts").val().toString();
	}
   	jquery("#plantIdStrHidden").val(plantIdStr);
	jquery("#plantStautsHidden").val(plantStauts);
	return true;	
 }


//搜索提交方法 
 function gainResult(){
// 	submitCheck();
// 	 var plantStauts = jquery("#plantStauts").selectpicker("val");
// 	 var plantIdStr = jquery("#plantIdStr").selectpicker("val");
	 var beginTime = document.getElementById("storageTypeSearch:beginTime").value;
		if (beginTime == null || beginTime == '') {
			alert("请选择开始时间...");
			return false;
		}
		var endTime = document.getElementById("storageTypeSearch:endTime").value;
		if (endTime == null || endTime == '') {
			alert("请选择结束时间...");
			return false;
		}
		var beginDate = beginTime + "-01";
		var endDate = endTime + "-01";
		var begin =toDate(beginDate);
		var end =toDate(endDate);
		if (begin > end) {
			alert("开始时间不能大于结束时间...");
			return false;
		}
		var baseId = "#{sessionTake.baseModel.baseId}";
	 	var plantIdStr = "";
		if(jquery("#plantIdStr").val() != null){
			plantIdStr = jquery("#plantIdStr").val().toString();
		}
		if(baseId == "")   
			baseId = "0";
				
		var plantStauts = "";
		if(jquery("#plantStauts").val() != null){
			plantStauts = jquery("#plantStauts").val().toString();
		}
	 	queryResult(baseId,plantIdStr,plantStauts,beginTime,endTime);
	    return true;
	 }
//刷新
 function refreshAction(){
	 noSelectedTOall();
 }
 
 function toDate(str){
	    var sd=str.split("-");
	    return new Date(sd[0],sd[1],sd[2]);
	}
           
function noSelectedTOall(){
	jquery(".filter-option").each(
			function(){
				if(jquery(this).text() == "无可选择项目"){
					
					jquery(this).text('全部');
				}
			}
		);
}
  window.onload = function () {
	 jquery('#plantStauts').attr("multiple","multiple");
	 jquery('#plantIdStr').attr("multiple","multiple");
     jquery('.selectpicker').selectpicker('deselectAll');


    //非ajax 使用方式（已废弃）
//     alert('#{planPlantList.plantStauts}' + "===='#{planPlantList.plantIdStr}'");
    var status = '#{planPlantList.plantStauts}';
    var idStr = '#{planPlantList.plantIdStr}';
    var status_arr = status;
    var idStr_arr = idStr;
    if(status != null && status != "" && status.indexOf(",") >-1){
    	status_arr = status.split(",");
    }
    if(idStr != null && idStr != "" && idStr.indexOf(",") >-1){
    	idStr_arr = idStr.split(",");
    }
//    jquery("#plantStauts").selectpicker("val",status_arr);
//    jquery("#plantIdStr").selectpicker("val",idStr_arr);
    noSelectedTOall();
  };

  var urlbo = true;
  function goUrl(){
  	if(urlbo){
  		window.location.href="#{request.contextPath}/map/Gantt.seam";
  		urlbo = false;
  	}
  }
  jquery(document).ready(function(){
	 
		noSelectedTOall();
		
		jquery(".form_datetime").datetimepicker({
	    	format: "yyyy-mm-dd",
			autoclose: true,
			 weekStart: 1,
			 language:  'zh-CN',
			 startView: 3,
			minView: 2,
			maxView: 4,		
			pickerPosition: "bottom-left"
		 });
		 });
	 
//导出时间判断
	function checkTime(){
		var start = jquery("#storageTypeSearch\\:beginTime").val();
		var end = jquery("#storageTypeSearch\\:endTime").val();
		var beginDate = new Date(start);
		var endDate = new Date(end);
		var year = beginDate.getFullYear();
		var month = beginDate.getMonth();
		var oneYearLaterTime = new Date(end);
		oneYearLaterTime.setFullYear((year+1), month);
		if(endDate >= oneYearLaterTime){
			alert("最多可以导出一年的数据，如想导出多年的数据，请分步导出！");
		}
	}
	//]]>
			  
</script>
	</ui:define>

</ui:composition>
