<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	template="/layout/template_new.xhtml">
	<ui:define name="body">
	<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/map/add.css"/>
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/settings/EnterpriseSettings.css" />
    <script type="text/javascript" src="#{request.contextPath}/asset/js/EnterpriseLeftMenu.js"></script>
    
    <!-- #{certificationHome.editBegins()} -->
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="imageYz" class="modal fade in w600na" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="imageMessYz">*号部分为必填项！</span>
        
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
      </div>
    </div>
  </div>
</div>
	<td valign="top">
                <div class="inbentory_file_main">
                <!--左侧二级导航 -->
                <div class="inbentory_level_wap">
                    <div class="inbentory_level">
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_rkgl"></i>基础设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/user/UpdateEnterpriseSettings.seam?enterpriseId=#{sessionTake.enterpriseInfoId}','_self')" >
                            	<i class="icon_sed"></i>企业设置                   	
                            </li>
                            <!-- 管理版和以前的版本（标准、白金...)显示 -->
                            <h:panelGroup rendered="#{sessionTake.nowVersionService.basicService.basicServiceId==10 or sessionTake.nowVersionService.basicService.serviceType eq 1}">
                            	<li class="sed_item" onclick="window.open('#{request.contextPath}/user/ModuleSettings.seam','_self')" ><i class="icon_sed"></i>模块配置</li>
                            </h:panelGroup>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/dictionary/DataDicinfoList.seam','_self')" ><i class="icon_sed"></i>字段管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/user/EnterpriseCommunityList.seam','_self')" ><i class="icon_sed"></i>角色管理</li>
                            <s:fragment rendered="#{enterpriseInfoHome.enterpriseInfo.govState}">
	                        	<li class="sed_item" onclick="window.open('#{request.contextPath}/user/AuditInformationList.seam','_self')" ><i class="icon_sed"></i>审核信息</li>
	                        </s:fragment>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/system/RecycleInfoList_1.seam','_self')" ><i class="icon_sed"></i>回收站</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_ckgl"></i>生产管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <h:panelGroup rendered="#{s:hasRole('certification')}">
                            	<li class="sed_item sed_cur" onclick="window.open('#{request.contextPath}/map/CertificationList.seam','_self')" ><i class="icon_sed"></i>认证信息</li>
                            </h:panelGroup>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/message/TunnelGroupList.seam','_self')" ><i class="icon_sed"></i>分组管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/InputsInfoList.seam?goodsTypeInfoId=5','_self')" ><i class="icon_sed"></i>投入品信息</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_zkgl"></i>销售管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/GoodsInfoList.seam','_self')"><i class="icon_sed"></i>物料信息</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/ProductInfoList.seam','_self')" ><i class="icon_sed"></i>商品信息</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_pdgl"></i>硬件管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/device/DeviceList.seam','_self')"><i class="icon_sed"></i>设备管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/device/VideoList.seam','_self')" ><i class="icon_sed"></i>视频管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/farming/AmRfidInfoList.seam','_self')" ><i class="icon_sed"></i>RFID卡管理</li>
                        </ol>
                    </div>
                    <i class="collapse_btn"></i>
                </div>
                <!--左侧二级导航 -->
				<!--右侧 -->
                <div class="inbentory_content">
		<div class="right_c clear" style="padding:20px 30px;">
        	<!-- 面包屑导航 开始 -->
			<div class="r_title clear" style="margin-top:0;">
	        	<div class="r_t_l fl"><font size="3">认证信息</font></div>   
	        </div>
        <!-- 农场信息主体 开始 -->
        	<h:form id="ch">
            <table class="org_content" width="100%" cellpading="0" cellspacing="0" style="width:750px;margin:0 auto;">
            	<tr>
                	<td class="product_org" >认证产品</td>
                    <td colspan="2">
                    	<h:inputHidden value="#{certificationHome.instance.floristicsIds}" id="flor"/>
						<select  id="dataDicid"  class="selectpicker" onchange="changes();" data-live-search="true" style="display: none;" multiple="multiple">
							<a4j:repeat value="#{certificationHome.florList}" var="var">
								<option value="#{var[1]}">#{var[0]}</option>
							</a4j:repeat>
						</select>
                    </td>
				</tr>
                <tr>
	                <td class="product_org">认证种类</td>
	                <td width="240">
	                    <h:selectOneMenu  styleClass="selectpicker" value="#{certificationHome.instance.standard}">
							<s:selectItems value="#{certificationHome.dataDicList}" var="_obj" label="#{_obj.name}" itemValue="#{_obj.dataDicId}"/>
						</h:selectOneMenu>
                	</td>
                	<td>
                		<input type="checkbox" name="land" id="land" onchange="landChange()" />地标产品
                		<h:inputHidden id="landproduct" value="#{certificationHome.instance.landProducts}" />
                	</td>
				</tr>
				<tr id="landImage" style="display:none">
	               
                    <td class="product_org" style="vertical-align:top;">地标认证图片</td>
                    <td colspan="2">
	                    <div id="lo_yz" class="clear">
                            	<h:inputHidden value="#{certificationHome.instance.landProductsimg}" id="landImg"/>
	                        	<iframe src="#{request.contextPath}/map/landProductImages.seam?chId=#{certificationHome.instance.companyHouonrId==null ? 0 :certificationHome.instance.companyHouonrId}" id="myframe3" name="myframe3" frameBorder="0" scrolling="no" width="" height="155" onLoad="" style="width:100%; height:155px"></iframe>
                        </div>
                       <p style="color:red; font-size:12px;">图片标准：276*77（像素）支持格式：jpg,gif,png,jpeg,bmp,3gp</p>
                       
                	</td>
				</tr>
				 <tr>
	               
                    <td class="product_org">认证机构</td>
                    <td colspan="2">
                    	<h:inputText value="#{certificationHome.instance.from}" id="issueId" styleClass="form-control nw220"/>
                    </td>
				</tr>
                <tr>
                	<td class="product_org">认证时间</td>
                    <td colspan="2">
                        <div class="input-append date form_datetime " >
						    <h:inputText  styleClass="new_time" value="#{certificationHome.instance.getTime}"/>
						    <span class="add-on"><i class="icon-th"></i></span>
					    </div>
                    </td>
				</tr>
				<tr>
                    <td class="product_org">证件有效期</td>
                    <td colspan="2">
                        <div class="input-append date form_datetime " >
							<h:inputText  styleClass="new_time" value="#{certificationHome.instance.validPeriod}" />
							<span class="add-on"><i class="icon-th"></i></span>
						</div>
                    </td>
				</tr>
                <tr>
                	<td class="product_org" style="vertical-align:top;"> 认证图片</td>
                    <td colspan="2">
                            <div class="clear">
                            	<h:inputHidden value="#{certificationHome.instance.imageUrl}" id="imageUrl"/>
	                        	<iframe src="#{request.contextPath}/map/CertificationImages.seam?chId=#{certificationHome.instance.companyHouonrId==null ? 0 :certificationHome.instance.companyHouonrId}" id="myframe2" name="myframe2" frameBorder="0" scrolling="no" onLoad="" style="width:100%; height:100%;"></iframe>
                            </div>
                            <p style="color:red; font-size:12px;">图片标准：276*77（像素）支持格式：jpg,gif,png,jpeg,bmp,3gp</p>
                        </td>
                    </tr>
                    <tr>
                        <td class="product_org" style="vertical-align:top;">
                        	 其他说明
                        </td>
                        <td colspan="2">
                        	<h:inputTextarea id="comment" styleClass="form-control nw450" rows="4" value="#{certificationHome.instance.comment}" />
                        </td>
                    </tr>
                </table>  
                <!-- 按钮 -->
                <div class="addBtn">
		    			
                    <h:commandButton value="提交" action="#{certificationHome.persist}" styleClass="btn btn-primary mr15" onclick="if(!save())return false;" rendered="#{!certificationHome.managed}"/>
                    <h:commandButton value="提交" action="#{certificationHome.update}" styleClass="btn btn-primary mr15" onclick="if(!save())return false;" rendered="#{certificationHome.managed}"/>
                    <s:button view="/map/CertificationList.xhtml" styleClass="btn btn-default" value="返回" ></s:button>   
                </div>
            </h:form>
            </div>
            </div>
            </div>
		</td>  
		
		
		<script>
		//<![CDATA[	
		
   jquery(function(){
	   jquery('.selectpicker').selectpicker();
	   
		var aaa=#{certificationHome.instance.landProducts};
		if(aaa){
			jquery('#land').attr("checked", true);
		}
		landChange();
	   if(jquery('#ch\\:flor').val()=='' || jquery('#ch\\:flor').val()==null || jquery('#ch\\:flor').val()==0){
		   jquery('#dataDicid').selectpicker({noneSelectedText:"全部"});
		   jquery('#dataDicid').selectpicker('deselectAll');
		}else{
			var v=jquery('#ch\\:flor').val().split(',');
			var newV=new Array();
			for(var i=0;i<v.length ;i++){
				newV.push(v[i].substring(1,v[i].length-1));
			}
			jquery('#dataDicid').selectpicker('val',newV);
		}
	   jquery(".form_datetime").datetimepicker({
        format: "yyyy-mm-dd",  /* 控制显示格式，默认为空，显示小时分钟 */
        autoclose: true,
        weekStart: 1,
        //startDate: "2014-08-14 10:00",
        language:  'zh-CN',
        startView: 3,
        minView: 2,
        maxView: 4,     
        pickerPosition: "bottom-left"
    });  
	   jquery(".add-on").click(function(event) {
       if(!-[1,]){
        setTimeout(function(){jquery(window).trigger("resize");}, 10)
       }
       
    });
});

	function landChange(){
		if(jquery('#land').is(':checked')){
			
			jquery('#landImage').show();
		}else{
			
			jquery('#landImage').hide();
		}
	}

   function save(){
	   
	   jquery('#ch\\:landproduct').val(jquery('#land').is(':checked'));
	   if(jquery('#ch\\:comment').val().length>200){
		   alert("其他说明字数不能超过200字！");
		   return false;
	   }
	   if(jquery('#ch\\:issueId').val().length>20){
		   alert("认证机构字数不能超过20字！");
		   return false;
	   }
	   var v = "";
	   var img = "";
		
		jquery("#myframe2").contents().find(".plant_imgbd").each(function(){
			v +=jquery(this).attr('src')+",";
		})
		jquery("#myframe3").contents().find(".plant_imgbd").each(function(){
			img +=jquery(this).attr('src')+",";
		})
		if(v == ''){
			alert("认证图片不能为空");
			   return false;
		}
	   if(jquery('#land').is(':checked')){
		   if(img == ''){
			   alert("地标认证图片不能为空");
			   return false;
			}
		}
	   if(v!=""){
			v=v.substring(0, v.length);
			jquery('#ch\\:imageUrl').val(v);
		}
		if(img!=""){
			img=img.substring(0, img.length);
			jquery('#ch\\:landImg').val(img);
		}
		
		if(jquery('#dataDicid').val()==null){
			jquery('#ch\\:flor').val(0);
		}else{
			jquery('#ch\\:flor').val(jquery('#dataDicid').val());
		}
		
		return true;
	}

   function imageyz(){
		jquery("#imageYz").modal('show');
	}

	function changes(){
		if(jquery('#dataDicid').val() == null || jquery('#dataDicid').val() == ''){
			jquery('#dataDicid').selectpicker({noneSelectedText:"全部"});
			jquery('#dataDicid').selectpicker('deselectAll');
		}
	}
 //]]> 
</script>
	</ui:define>
</ui:composition>
