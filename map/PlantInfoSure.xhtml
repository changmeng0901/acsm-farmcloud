<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:c="http://java.sun.com/jstl/core"
	template="/layout/template_new.xhtml">


	<ui:define name="body">
	<style>
	.sw80{width:80px;}
	.sw80 .bootstrap-select:not([class*="span"]):not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) {
    width: 80px;
}
	.inputW{ float: left;
    font-weight: normal;
    width:80px;}
	</style>
		<script type="text/javascript">
	document.getElementById("selectBaseDiv").style.display="none";
	</script>
	
		<td valign="top">
		<h:form id="user">
			<!-- Modal -->
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal" class="modal fade in w600na" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="productMsg">*号部分为必填项！</span>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
      </div>
    </div>
  </div>
</div>
		<!-- #{realPlantHome.work()} -->
		<!-- #{realPlantHome.work4()} -->
		<!-- #{realPlantHome.methods()} -->
		<script type="text/javascript">
		function selchange(){
			getModelByTime(document.getElementById('breedBreedId').value,document.getElementById('plant_tunnel_id').value,document.getElementById('plant:plant_beginInputDate').value,document.getElementById('plant_standard').value,document.getElementById('plant:plant_endInputDate').value,document.getElementById('plant_real_id').value)
		} 
		
		function getModelByTime (v1,v2,v3,v4,v5,v6){
			if(v5=="")
				return;
			else{
				jquery("#plant\\:but").attr('disabled',"true");
				getModelByTime_ (v1,v2,v3,v4,v5,v6);
			}
		}
		</script>
                <div class="right_c">
                	<div class="r_title">
                    	<div class="r_t_l">计划&#160;&gt;&#160;&#160;<a href="#{request.contextPath}/map/PlantInfoList.seam">排产</a>
                    	&#160;&gt;&#160;&#160;<font size="3">排产信息</font><rich:messages styleClass="messages"></rich:messages></div>
                    </div>
				<!--入库订单列表开始-->
				<div class="all_d3" style="width: 868px; margin:30px auto;">
						<div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">区域：</td>
                                    <td>
                                    <input type="hidden" value="#{realPlantHome.instance.realPlantId}" id="plant_real_id" name="plant_real_id"/>
								<select  class="selectpicker" id="plant_tunnel_id" name="plant_tunnel_id" >
								<a:repeat  value="#{realPlantHome.tiList}" var="var" >
								<option value="#{var[0]}">#{var[1]}</option>
								</a:repeat>
								</select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01" style="display:none">
                        	<table>
                                <tr>
                                    <td class="all_te">排产类型：</td>
                                    <td>
								<select id="aps_type" name="aps_type" class="selectpicker">
														<option value="2" selected="selected">计划排产</option>
	                                                  	<option value="0">历史排产</option>
	                                                  	<option value="1">实际排产</option>
	                                                  	
	                                                  	</select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">作物种类：</td>
                                    <td>
								<select class="selectpicker" id="plant_plantId" data-live-search="true" name="plant:plantId"  >
														<a:repeat value="#{realPlantHome.pList}" var="var" >
	                                                      	<option value="#{var.plantId}">#{var.name}</option>
	                                                      	</a:repeat>
														</select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">排产品种：</td>
                                    <td>
								<select  class="selectpicker" name="breedBreedId" id="breedBreedId" >
								<a:repeat value="#{realPlantHome.breedInfoList}" var="var" >
	                                                      	<option value="#{var.breedId}">#{var.name}</option>
	                                                      	</a:repeat>
								</select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">排产标准：</td>
                                    <td>
								<select  class="selectpicker" id="plant_standard" name="plant_standard"  onchange="selchange()">
								<a:repeat  value="#{realPlantHome.ddList}" var="var" >
								<option value="#{var.dataDicId}">#{var.name}</option>
								</a:repeat>
								</select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">排产时间：</td>
                                    <td>
								    <div class="input-append date beginInput form_datetime "  >
    <input size="23" type="text" class="new_time" value="#{realPlantHome.instance.plantBeginTime}" readonly="readonly" id="plant:plant_beginInputDate" name="plant:plant_beginInputDate" autocomplete="off" />
    <span class="add-on" ><i class="icon-th"></i></span>
    </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">采收开始：</td>
                                    <td>
    <div class="input-append date harvestTime form_datetime "  >
    <input size="23"  class="new_time" type="text" value="#{realPlantHome.htime}" readonly="readonly" id="plant:harvest_timeInputDate" name="plant:harvest_timeInputDate" autocomplete="off" />
    <span class="add-on" style="height:14px"><i class="icon-th"></i></span>
    </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">排产结束：</td>
                                    <td>
                                   <div class="input-append date endInput form_datetime "  >
    <input size="23" type="text" value="#{realPlantHome.instance.plantEndTime}"  class="new_time" readonly="readonly" id="plant:plant_endInputDate" name="plant:plant_endInputDate" autocomplete="off" />
    <span class="add-on" ><i class="icon-th"></i></span>
    </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">排产面积：</td>
                                    <td>
										  <strong>
		                      <input type="text" value="#{realPlantHome.paramObj}" class="form-control nw221" style="width:100px;display: inline;" id="plant_area" name="plant_area" onkeyup="clearNoNum(this)"/>
		                                                      </strong>
                                                      		<span class="mu_mianji">&#160;亩/</span>
                                                           <span class="mu_mianji"  id="plantarea" name="plantarea" >#{realPlantHome.total}</span>
                                                     	  	<span class="mu_mianji" >亩可用</span>
                                                     	  	<input type="hidden" id="myarea"  value="#{realPlantHome.paramObj}"/>
                                                     	  	<input type="hidden" id="old_start"/>
                                                     	  	<input type="hidden" id="old_end" />
                                                     	  	<input type="hidden" id="model_name" name="model_name"/>
                                         </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">预估产量：</td>
                                    <td>
										   <select id="yield_type" name="yield_type"  class="selectpicker">
                                                        <option value="1">亩产量</option>
                                                        <option value="2">地块产量</option>
                                                    </select>kg
                                         </td>
                                </tr>
                            </table>
                        </div>
				</div>
				<ul>
                <li class="tc_li typ1" style="padding:0; height:0;"><div id="prompt" style="height:20px; color: red; text-align:left;  line-height:20px; position:relative; top:-20px;"></div></li>
	                                    <li class="tc_li typ1" style="height:auto; padding:0;">
	                                     	<table cellspacing="0" cellpadding="0" class="spctab_le table_2" id="plant_model" style="width:35%; margin-left: auto;margin-right: auto;"> 
                                                    <tr>
                                                        <td class="semxline">1月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month1}" class="input_out3" id="month1" name="month1" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">2月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month2}" class="input_out3" id="month2" name="month2" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">3月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month3}" class="input_out3" id="month3" name="month3" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="semxline">4月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month4}" class="input_out3" id="month4" name="month4" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">5月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month5}" class="input_out3" id="month5" name="month5" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">6月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month6}" class="input_out3" id="month6" name="month6" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="semxline">7月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month7}" class="input_out3" id="month7" name="month7" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">8月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month8}" class="input_out3" id="month8" name="month8" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">9月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month9}" class="input_out3" id="month9" name="month9" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="semxline">10月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month10}" class="input_out3" id="month10" name="month10" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">11月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month11}" class="input_out3" id="month11" name="month11" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">12月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month12}" class="input_out3" id="month12" name="month12" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                    </tr>
                                                </table>                                          
                     					</li>
				</ul>
				</div>
					<table width="650px;" class="r_c_table" cellpadding="0" cellspacing="0">
                       <tr>
							<td class="r_c_td"></td>
							
							<td style="text-align: center;">
		            	<h:commandButton id="update" value="确认" styleClass="btn btn-primary" action="#{realPlantHome.update}" rendered="#{realPlantHome.managed}" onclick="return checkSubmit();">
		            		<f:actionListener binding="#{realPlantHome.setPlantStu(1)}"/>
		            	</h:commandButton>
		    			&#160;<s:button view="/map/PlantInfoList.xhtml" styleClass="btn btn-default" value="返回" id="bn_left6" style="margin-left:10px" >
		    					<f:param name="pageNum" value="#{realPlantHome.pageNum}" />
		    			</s:button>
                            </td>
						</tr>
					</table>
				<!--入库订单列表结束-->
              <!--right_c结束-->
                <div class="clear"></div>
              </h:form>
              <script type="text/javascript" src="#{request.contextPath}/asset/js/tab.js"></script>
              <script  type="text/javascript">
//<![CDATA[
//获得下拉框中选中的itemLabel显示的值           

function jisuan(){
	var a1 = document.getElementById("month1").value;
	var a2 = document.getElementById("month2").value;
	var a3 = document.getElementById("month3").value;
	var a4 = document.getElementById("month4").value;
	var a5 = document.getElementById("month5").value;
	var a6 = document.getElementById("month6").value;
	var a7 = document.getElementById("month7").value;
	var a8 = document.getElementById("month8").value;
	var a9 = document.getElementById("month9").value;
	var a10 = document.getElementById("month10").value;
	var a11 = document.getElementById("month11").value;
	var a12 = document.getElementById("month12").value;
	var total = 0;
	if(a1 != null && a1 != ""){
		a1 = parseFloat(a1);
	}else{
		a1 = 0;
	}
	if(a2 != null && a2 != ""){
		a2 = parseFloat(a2);
	}else{
		a2 = 0;
	}
	if(a3 != null && a3 != ""){
		a3 = parseFloat(a3);
	}else{
		a3 = 0;
	}
	if(a4 != null && a4 != ""){
		a4 = parseFloat(a4);
	}else{
		a4 = 0;
	}
	if(a5 != null && a5 != ""){
		a5 = parseFloat(a5);
	}else{
		a5 = 0;
	}
	if(a6 != null && a6 != ""){
		a6 = parseFloat(a6);
	}else{
		a6 = 0;
	}
	if(a7 != null && a7 != ""){
		a7 = parseFloat(a7);
	}else{
		a7 = 0;
	}
	if(a8 != null && a8 != ""){
		a8 = parseFloat(a8);
	}else{
		a8 = 0;
	}
	if(a9 != null && a9 != ""){
		a9 = parseFloat(a9);
	}else{
		a9 = 0;
	}
	if(a10 != null && a10 != ""){
		a10 = parseFloat(a10);
	}else{
		a10 = 0;
	}
	if(a11 != null && a11 != ""){
		a11 = parseFloat(a11);
	}else{
		a11 = 0;
	}
	if(a12 != null && a12 != ""){
		a12 = parseFloat(a12);
	}else{
		a12 = 0;
	}
	total = a1 + a2 + a3 + a4 + a5 + a6 + a7 + a8 + a9 + a10 + a11 + a12;
	jquery("#total").html(total);
}

function checkSubmit(){
	var asp_type = jquery('#aps_type').val();
	asp_type = 2;
	var nowD = new Date();
	var nowD_ = new Date(nowD.getFullYear(),nowD.getMonth()+1,nowD.getDate());
		var beginTime = document.getElementById("plant:plant_beginInputDate").value;
	    var endTime = document.getElementById("plant:plant_endInputDate").value;
	    var harvestTime = document.getElementById("plant:harvest_timeInputDate").value;
	    var plantarea = document.getElementById("plant_area").value;
	    var edittype = jquery("#edittype").val();
	    var breedId = jquery("#breedBreedId").val();
	    var arr = beginTime.split("-");
	    var starttime = new Date(arr[0], arr[1], arr[2]);
	    var starttimes = starttime.getTime();
	    var arrs = endTime.split("-");
	    var lktime = new Date(arrs[0], arrs[1], arrs[2]);
	    var lktimes = lktime.getTime();
	    var flag = true;
	    var allarea =  parseFloat(jquery("#plantarea").text());
	    if (starttimes >= lktimes) {
	    	alert("定植时间不能大于结束时间！");
			return false;
	    }
	    if(beginTime == ""){
	    	alert("定植时间不能为空！");
			return false;
	    }
	    if(endTime == ""){
        	alert("结束时间不能为空！");
			return false;
	    }
	    if(harvestTime == ""){
	    	alert("采收开始时间不能为空！");
			return false;
	    }
	    var nowT = nowD_.getTime();
	    if(starttimes<nowT){
	    	if(lktimes<nowT){
	    		jquery('#aps_type').val(0);
	    	}else{
	    		jquery('#aps_type').val(1);
	    	}
	    }else{
	    	jquery('#aps_type').val(2);
	    }
	    if(asp_type == 1){
		    if(starttimes>nowT){
	        	//alert("实际排产开始日期不能大于今天！");
	        	//return false;
	        }
		    if(lktimes<nowT){
	        	//alert("实际排产结束日期不能小于今天！");
	        	//return false;
	        }
	    }else if(asp_type==0){
        	if(lktimes>nowT){
            	//alert("历史排产结束日期不能大于今天！");
            	//return false;
                }
            }else if(asp_type==2){
        	if(starttimes<nowT){
	        	alert("计划排产开始日期不能小于今天！");
	        	return false;
	        }
            }
	    if(plantarea == 0){
        	alert("排产面积不能为0！");
			return false;
        }
	    if(plantarea == ""){
	    	alert("排产面积不能为空！");
			return false;
	    }
	    //if(parseFloat(plantarea) > parseFloat(jquery("#tunnel_area").val())){
	    //	jquery("#prompt").text("排产面积不能大于区域面积！");
		//	return false;
	    //}
	    
	    
	    	if(parseFloat(plantarea) > allarea){
	            alert("排产面积不能大于剩余排产面积！");
				return false;
	        }
	    
	    if(jquery("#modelId").val()==""||jquery("#modelId").val()==0){
	    	alert("请先预估每月产量！");
			return false;
	    }
	    var year = parseInt(jquery("#checkStart").val(),10)<parseInt(jquery("#checkMonth").val())?arr[0]:parseInt(arr[0],10)+1;
		var date1 = new Date(arrs[0],parseInt(arrs[1],10)-1,arrs[2]);
		var date2 ;
		if(jquery("#checkDays").val()==3){
			date2 = new Date(year,jquery("#checkMonth").val(),0);
		}else {
			date2 = new Date(year,(jquery("#checkMonth").val()-1),jquery("#checkDays").val()*10);
		}
		var month1 = parseInt(arr[0]) * 12 + parseInt(arr[1]);
		var month2 = parseInt(arrs[0]) * 12 + parseInt(arrs[1]);
		var cha = Math.abs(month2 - month1);
		if(cha<12){
		    if(date1>date2){
		    	alert("结束时间未在模型区间内！");
		    	return false;
		    }
		}
	   jquery('#model_name').val(jquery("#plant_standard option:selected").html()+'-'+arr[1]+'-'+arr[2]);
	   jquery("#plant_plantId").removeAttr("disabled");
		 jquery("#breedBreedId").removeAttr("disabled");
		 jquery("#plant_plantId").selectpicker("refresh");
		 jquery("#breedBreedId").selectpicker("refresh");
  return true;
}

function clearNoNum(obj){
	obj.value = obj.value.replace(/[^\d.]/g,"");  //清除“数字”和“.”以外的字符  
	obj.value = obj.value.replace(/^\./g,"");  //验证第一个字符是数字而不是. 
	obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个. 清除多余的.   
	obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
	if(obj.value=="")
		return ;
	jquery(".table_0 .mul").each(function(){
		var mu = parseFloat(jquery(this).attr("mul"));
		var total = mu*parseFloat(obj.value);
		jquery(this).html(total.toFixed(2)+"kg");
	});
}

function changeYield(obj){
	var area = jquery("#plant_area").val();
	if(obj.value==1){
		jquery(".semxnene input").each(function(){
			var val = jquery(this).val()
			if(val!=""){
				var tempv = parseFloat(val)/parseFloat(area);
				tempv = tempv.toFixed(2);
				jquery(this).val(tempv);
			}
		});
	}else if(obj.value==2){
		jquery(".semxnene input").each(function(){
			var val = jquery(this).val()
			if(val!=""){
				var tempv = parseFloat(val)*parseFloat(area);
				tempv = tempv.toFixed(2);
				jquery(this).val(tempv);
			}
		});
	}
}

Date.prototype.format = function(format)
{
	var o = {
	"M+" : this.getMonth()+1, //month
	"d+" : this.getDate(),    //day
	"h+" : this.getHours(),   //hour
 	"m+" : this.getMinutes(), //minute
	"s+" : this.getSeconds(), //second
 	"q+" : Math.floor((this.getMonth()+3)/3),  //quarter
 	"S" : this.getMilliseconds() //millisecond
	}

	if(/(y+)/.test(format)) 
	{
		format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4 - RegExp.$1.length));
	}
	
 	for(var k in o)
	{
		if(new RegExp("("+ k +")").test(format))
		{
 			format = format.replace(RegExp.$1,RegExp.$1.length==1 ? o[k] : ("00"+ o[k]).substr((""+ o[k]).length));
		}
	}
	return format;
}

function linkage (data){
	var str = data.split("-~_");
	jquery("#breedBreedId").empty().append(str[0]);
	jquery('#breedBreedId')[0].selectedIndex = 0;
	jquery('#breedBreedId').selectpicker('refresh');
}

function begin_end(){
	var a = jquery("#plant\\:harvest_timeInputDate").val();
      var b = jquery("#plant\\:plant_endInputDate").val();
      a = a.split("-")[1];
      b = b.split("-")[1];
		a = parseInt(a,10);
		b = parseInt(b,10);
	var arr = [];
	if(b>=a){
		for(var i = a ;i<=b;i++){
			arr.push(i);
		}
	}else if(b<a){
		for(var i = a ;i<=12;i++){
			arr.push(i);
		}
		for(var i = 1 ;i<=b;i++){
			arr.push(i);
		}
	}
	jquery(".semxnene input").each(function(){
		for(var i = 0;i<arr.length;i++){
			if(arr[i]==jquery(this).attr("name").replace("month","")){
				break;
			}else if(i==arr.length-1){
				jquery(this).val("");
			}
		}
	});
}

function getModelByRealId_next(data){
	begin_end();
	var datas = data.split("-~_");
	jquery("#plantarea").html(datas[0]);
	jquery("#plant_area").val(datas[0]);
	if(datas.length==1){
		jquery(".semxnene input").val("");
		return;
	}
		
	var start = datas[5];
	var starts = start.split("-");
	var ht = "";
	if(jquery("#plant\\:harvest_timeInputDate").val()==""){
		if(starts[0]=="null"){
			var val = jquery("#plant\\:plant_beginInputDate").val();
			var vals = val.split("-");
			if(parseInt(vals[1],10)<=parseInt(starts[1],10)){
				ht+=vals[0];
			}else{
				ht+=(parseInt(vals[0],10)+1);
			}
			if(starts[1].length==1){
				ht+="-0"+starts[1];
			}else{
				ht+="-"+starts[1];
			}
			if(parseInt(starts[2],10)==1){
				ht+="-01";
			}else if(parseInt(starts[2],10)==2){
				ht+="-11";
			}else if(parseInt(starts[2],10)==3){
				ht+="-21";
			}
			if(ht.length>4)
				jquery("#plant\\:harvest_timeInputDate").val(ht);
		}else{
			ht = starts[0]+"-"+starts[1]+"-";
			if(parseInt(starts[2],10)<10){
				ht+="0"+starts[2];
			}else{
				ht+=starts[2];
			}
			_Q("#plant\\:harvest_timeInputDate").val(ht);
		}
	}
	if(datas[2]==1){
		jquery("#yield_type").selectpicker('val', 1);
		eval("var tempData="+datas[3]);
		if(tempData.month1&&parseFloat(tempData.month1)>0){
			jquery("#month1").val(tempData.month1);
		}
		if(tempData.month2&&parseFloat(tempData.month2)>0){
			jquery("#month2").val(tempData.month2);
		}
		if(tempData.month3&&parseFloat(tempData.month3)>0){
			jquery("#month3").val(tempData.month3);
		}
		if(tempData.month4&&parseFloat(tempData.month4)>0){
			jquery("#month4").val(tempData.month4);
		}
		if(tempData.month5&&parseFloat(tempData.month5)>0){
			jquery("#month5").val(tempData.month5);
		}
		if(tempData.month6&&parseFloat(tempData.month6)>0){
			jquery("#month6").val(tempData.month6);
		}
		if(tempData.month7&&parseFloat(tempData.month7)>0){
			jquery("#month7").val(tempData.month7);
		}
		if(tempData.month8&&parseFloat(tempData.month8)>0){
			jquery("#month8").val(tempData.month8);
		}
		if(tempData.month9&&parseFloat(tempData.month9)>0){
			jquery("#month9").val(tempData.month9);
		}
		if(tempData.month10&&parseFloat(tempData.month10)>0){
			jquery("#month10").val(tempData.month10);
		}
		if(tempData.month11&&parseFloat(tempData.month11)>0){
			jquery("#month11").val(tempData.month11);
		}
		if(tempData.month12&&parseFloat(tempData.month12)>0){
			jquery("#month12").val(tempData.month12);
		}
	}else{
		jquery("#yield_type").selectpicker('val', 2);
		eval("var tempData="+datas[3]);
		var d_ = jquery("#myarea").val() ;
		d_ = parseFloat(d_,10);
		if(tempData.month1&&parseFloat(tempData.month1)>0){
			var tempv = parseFloat(tempData.month1)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month1").val(tempv);
		}
		if(tempData.month2&&parseFloat(tempData.month2)>0){
			var tempv = parseFloat(tempData.month2)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month2").val(tempv);
		}
		if(tempData.month3&&parseFloat(tempData.month3)>0){
			var tempv = parseFloat(tempData.month3)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month3").val(tempv);
		}
		if(tempData.month4&&parseFloat(tempData.month4)>0){
			var tempv = parseFloat(tempData.month4)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month4").val(tempv);
		}
		if(tempData.month5&&parseFloat(tempData.month5)>0){
			var tempv = parseFloat(tempData.month5)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month5").val(tempv);
		}
		if(tempData.month6&&parseFloat(tempData.month6)>0){
			var tempv = parseFloat(tempData.month6)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month6").val(tempv);
		}
		if(tempData.month7&&parseFloat(tempData.month7)>0){
			var tempv = parseFloat(tempData.month7)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month7").val(tempv);
		}
		if(tempData.month8&&parseFloat(tempData.month8)>0){
			var tempv = parseFloat(tempData.month8)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month8").val(tempv);
		}
		if(tempData.month9&&parseFloat(tempData.month9)>0){
			var tempv = parseFloat(tempData.month9)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month9").val(tempv);
		}
		if(tempData.month10&&parseFloat(tempData.month10)>0){
			var tempv = parseFloat(tempData.month10)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month10").val(tempv);
		}
		if(tempData.month11&&parseFloat(tempData.month11)>0){
			var tempv = parseFloat(tempData.month11)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month11").val(tempv);
		}
		if(tempData.month12&&parseFloat(tempData.month12)>0){
			var tempv = parseFloat(tempData.month12)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month12").val(tempv);
		}
	}
    
}

function getAreaMethod_next(data){
	var objArea = data;
	jquery("#plantarea").html(objArea);
	jquery("#plant_area").val(objArea);
}

jquery(".semxnene input").focus(function(){
    var a = jquery("#plant\\:harvest_timeInputDate").val();
    var b = jquery("#plant\\:plant_endInputDate").val();
    a = a.split("-")[1];
    b = b.split("-")[1];
		a = parseInt(a,10);
		b = parseInt(b,10);
		var arr = [];
		if(parseInt(b,10)>=parseInt(a,10)){
			for(var i = parseInt(a,10) ;i<=parseInt(b,10);i++){
				arr.push(i);
			}
		}else if(parseInt(b,10)<parseInt(a,10)){
			for(var i = parseInt(a,10) ;i<=12;i++){
				arr.push(i);
			}
			for(var i = 1 ;i<=parseInt(b,10);i++){
				arr.push(i);
			}
		}
		for(var i = 0;i<arr.length;i++){
			if(arr[i]==jquery(this).attr("name").replace("month","")){
				break;
			}else if(i==arr.length-1){
				alert("该月份不在采收开始和结束时间之内");
				jquery(this).blur();
			}
		}
})

//]]>
</script>
<!-- #{realPlantHome.work3()} -->
     <a:form id="formid" >
<a:queue requestDelay="10" ignoreDupResponses="true" id="mainQueue"/>
<a:jsFunction name="getModelByTime_"  eventsQueue="mainQueue"  action="#{realPlantHome.getModelByTime()}" data="#{realPlantHome.return1}" oncomplete="jquery('#plant\\:but').removeAttr('disabled');getModelByRealId_next(data)">
        <a:actionparam name="param1" assignTo="#{realPlantHome.param1}"></a:actionparam>
        <a:actionparam name="param2" assignTo="#{realPlantHome.param2}"></a:actionparam>
        <a:actionparam name="param3" assignTo="#{realPlantHome.param3}"></a:actionparam>
        <a:actionparam name="param4" assignTo="#{realPlantHome.param4}"></a:actionparam>
        <a:actionparam name="param5" assignTo="#{realPlantHome.param5}"></a:actionparam>
        <a:actionparam name="param6" assignTo="#{realPlantHome.param6}"></a:actionparam>
		</a:jsFunction>
		<a:jsFunction name="getBreedByPlantId" eventsQueue="mainQueue" action="#{realPlantHome.getBreedByPlantId()}" data="#{realPlantHome.breedStr}" oncomplete="linkage(data)">
				<a:actionparam name="param1" assignTo="#{realPlantHome.breed_Id}"></a:actionparam>
		</a:jsFunction>
		
		<a:jsFunction name="getAreaMethod2"  eventsQueue="mainQueue"  action="#{realPlantHome.getAreaMethod()}" data="#{realPlantHome.areaParam}" oncomplete="getAreaMethod_next(data)" >
<a:actionparam name="tunnelParamId" assignTo="#{realPlantHome.tunnelParamId}"></a:actionparam>
</a:jsFunction>
</a:form>
	 <script type="text/javascript">
	//<![CDATA[
	var dateTime = new Date().format("yyyy-MM-dd ");
	
	 jquery(document).ready(function(){
		 if(#{realPlantHome.managed}){
			 var val1 = jquery('#plant\\:plant_beginInputDate');
			 var val2 = jquery('#plant\\:plant_endInputDate');
			 var val3 = jquery('#plant\\:harvest_timeInputDate');
			 val1.val(val1.val().split(" ")[0]);
			 val2.val(val2.val().split(" ")[0]);
			 val3.val(val3.val().split(" ")[0]);
			 
			 
			var nowD = new Date();
			var nowD_ = new Date(nowD.getFullYear(),nowD.getMonth()+1,nowD.getDate());
			var endTime = val2.val();
			var arrs = endTime.split("-");
		    var lktime = new Date(arrs[0], arrs[1], arrs[2]);
		    var lktimes = lktime.getTime();
		    
		    var beginTime = val1.val();
		    var arr = beginTime.split("-");
		    var bt = new Date(arr[0], arr[1], arr[2]);
		    var bts = bt.getTime();
		    if(lktimes<=nowD_.getTime()){
		    	jquery("#aps_type")[0].selectedIndex=0;
		    }else{
		    	if(bts<nowD_.getTime()){
		    		jquery("#aps_type")[0].selectedIndex=1;
		    	}else{
		    		jquery("#aps_type")[0].selectedIndex=2;
		    	}
		    } 
			
			 jquery("#plant_tunnel_id").val('#{realPlantHome.instance.tunnelInfoId.tunnelInfoId}');
			 jquery("#plant_tunnel_id").change(function(){getAreaMethod2(jquery(this).val());selchange()});
			 
			 jquery("#plant_plantId").val("#{realPlantHome.instance.breedBreedId.plant.plantId}");
			 jquery("#plant_plantId").change(function(){getBreedByPlantId(jquery(this).val())});
			 
			 jquery("#breedBreedId").val("#{realPlantHome.instance.breedBreedId.breedId}");
			 jquery("#breedBreedId").change(function(){selchange()});
			 
			 if("#{realPlantHome.instance.realPlantId}"!=''){
				 if("#{realPlantHome.instance.plantStauts}" == '1'){
					 jquery("#plant_plantId").prop("disabled","disabled");
					 jquery("#breedBreedId").prop("disabled","disabled");
					 jquery("#plant_plantId").selectpicker("refresh");
					 jquery("#breedBreedId").selectpicker("refresh");
					 }
			 }
			 
			 jquery("#plant_standard").val("#{realPlantHome.instance.plantStandard}");
			 jquery("#plant_standard").change(function(){selchange()});
			 
			 var temp1 = "#{realPlantHome.instance.schedulingModelId.yieldType}";
			 if(temp1=="")
				 temp1 = 1;
			 jquery("#yield_type").val(temp1);
			 jquery("#yield_type").change(function(){changeYield(this)});
			 //selchange();
		 }else{
			 jquery("#plant_tunnel_id").change(function(){getAreaMethod2(jquery(this).val());selchange()});
			 jquery("#plant_plantId").change(function(){getBreedByPlantId(jquery(this).val())});
			 jquery("#breedBreedId").change(function(){selchange()});
			 jquery("#plant_standard").change(function(){selchange()});
			 jquery("#yield_type").change(function(){changeYield(this)});
		 }
		 
		 jquery(".beginInput").datetimepicker({
			    format: "yyyy-mm-dd",
			    autoclose: true,
				 weekStart: 1,
				 tartDate: dateTime,
				 language:  'zh-CN',
			   minView:2,
			    pickerPosition: "bottom-left"
			    }).on('changeDate', function(ev){
			    	 var time = new Date(ev.date);
					 if(time!=null)
			    		 time = time.format("yyyy-MM-dd");
					 else
						time = jquery('#plant\\:plant_beginInputDate').val()
				getModelByTime(jquery('#breedBreedId').val(),jquery('#plant_tunnel_id').val(),time,jquery('#plant_standard').val(),jquery('#plant\\:plant_endInputDate').val(),jquery('#plant_real_id').val())
				});
	 
	    	
		 jquery(".endInput").datetimepicker({
			    format: "yyyy-mm-dd",
			    autoclose: true,
				 weekStart: 1,
				 tartDate: dateTime,
				 language:  'zh-CN',
			   minView:2,
			    pickerPosition: "bottom-left"
			    }).on('changeDate', function(ev){
			    var time = new Date(ev.date);
			    if(time!=null)
		    		 time = time.format("yyyy-MM-dd");
				 else
					time = jquery('#plant\\:plant_endInputDate').val()
				getModelByTime(jquery('#breedBreedId').val(),jquery('#plant_tunnel_id').val(),jquery('#plant\\:plant_beginInputDate').val(),jquery('#plant_standard').val(),time,jquery('#plant_real_id').val())
				});
	    	
	    	
		 jquery(".harvestTime").datetimepicker({
			    format: "yyyy-mm-dd",
			    autoclose: true,
				 weekStart: 1,
				 tartDate: dateTime,
				 language:  'zh-CN',
			   minView:2,
			    pickerPosition: "bottom-left"
			    });
		 jquery('.selectpicker').selectpicker();
		 
		});

	//]]>
</script>

            </td> 
             <style>
  
 </style>
<style>
	  .ts_div2{width:240px; height: 125px; border: 1px solid #81C5E9; margin: 0px auto; padding: 0 15px 15px;  background: url(#{request.contextPath}/asset/images/tck_bg_14.jpg) #ffffff repeat-x scroll center top;}
	  .dr-mpnl-shadow{background:none;}
	  .dr-mpnl-pnl{background:none; border:none;}
	  .dr-mpnl-pnl-b{padding:0;}
	  .dr-mpnl-shadow{top:0; left:0;}
	  .rich-picklist-source-items{margin:0;}
	  .ui-selectmenu{*float:left;}
	  .all_w01 {
    width: 371px;
	}
.all_te {
    width: 100px;
	}
	</style>
	</ui:define>

</ui:composition>
