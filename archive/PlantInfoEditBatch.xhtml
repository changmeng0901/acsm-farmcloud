<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template_new.xhtml">


	<ui:define name="body">
	<style>
	.sw80{width:80px;}
	.sw80 .bootstrap-select:not([class*="span"]):not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) {
    width: 80px;
}
	.inputW{ float: left;
    font-weight: normal;
    width:80px;}
	</style>
		<td valign="top">
		<h:form id="user">
			<!-- Modal -->
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal" class="modal fade in w600na" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="productMsg">*号部分为必填项！</span>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
      </div>
    </div>
  </div>
</div>
		<!-- #{realPlantHome.work()} -->
		<!-- #{realPlantHome.work4()} -->
		<!-- #{realPlantHome.methods()} -->
		<script type="text/javascript">
		function selchange(){
			var ps = "";
			if(jquery('#plant_tunnel_id').val()!=null)
				ps = jquery('#plant_tunnel_id').val().toString();
			if(jquery("#plant_plantId option:selected").attr("cc")=="2"){
				var tim = jquery('#zzend').val();
				if(tim=="")
					tim="2050-12-31";
				
			}else{
			}
		} 
		
		</script>
                <div class="right_c">
                	<div class="r_title">
                    	<div class="r_t_l">数字农场&#160;&gt;&#160;&#160;<a href="#{request.contextPath}/archive/PlantInfoList.seam"><font size="3">种植档案</font></a><rich:messages styleClass="messages"></rich:messages></div>
                    </div>
				<div class="r_title" style="width:95%;margin-left:auto;margin-right:auto">
                    	<div class="r_t_l">
                    	<font size="3">基本信息</font><rich:messages styleClass="messages"></rich:messages></div>
                    </div>
				<div class="all_d3" style="width: 868px; margin:30px auto;">
						<div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">区域：</td>
                                    <td>
                                    <input type="hidden" value="#{realPlantHome.instance.realPlantId}" id="plant_real_id" name="plant_real_id"/>
                                     <input type="hidden" value="" id="tunnel_id" name="plant_tunnel_id"/>
								<select multiple="multiple" data-live-search="true" class="selectpicker" id="plant_tunnel_id" name="plant_tunnel_id_" onchange="changeTunnel(event)">
								<a:repeat value="#{realPlantHome.tlistBatch}" var="par" >
							    	<option value="#{par[0]}" ty="#{par[2]}" pid="#{par[3]}" style="padding-left:#{par[2]=='tunnelInfo'?'40px;':'20px;'}">#{par[1]}</option>
					      		</a:repeat>
								</select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01" style="display:none">
                        	<table>
                                <tr>
                                    <td class="all_te">种植类型：</td>
                                    <td>
								<select id="aps_type" name="aps_type" class="selectpicker">
	                                                  	<option value="0">历史种植</option>
	                                                  	<option value="1" selected="selected">实际种植</option>
	                                                  	<option value="2">计划种植</option>
	                                                  	</select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">作物种类：</td>
                                    <td>
								<select class="selectpicker" id="plant_plantId" data-live-search="true" name="plant:plantId"  >
														<a:repeat value="#{realPlantHome.pList}" var="var" >
	                                                      	<option value="#{var.plantId}"  cc="#{var.floristicsType}">#{var.name}</option>
	                                                      	</a:repeat>
														</select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">种植品种：</td>
                                    <td>
								<select style="width:220px" class="" name="breedBreedId" id="breedBreedId" >
								</select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">种植标准：</td>
                                    <td>
								<select  class="selectpicker" id="plant_standard" name="plant_standard"  onchange="">
								<a:repeat  value="#{realPlantHome.ddList}" var="var" >
								<option value="#{var.dataDicId}">#{var.name}</option>
								</a:repeat>
								</select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">种苗来源：</td>
                                    <td>
                                    	<h:inputHidden value="#{realPlantHome.instance.sproutSource}" id="sproutSource"/>
										<select id="sproutSel" name="sproutSel" class="selectpicker" onchange="sproutChange(this.value);">
											<option value="0" selected="selected">无</option>
                                            <option value="1" >自繁</option>
                                            <option value="2" >市场购买</option>
                                        </select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01" id="purchaseSourceDiv" style="display:none;">
                        	<table>
                                <tr>
                                    <td class="all_te">购买来源：</td>
                                    <td>
										<h:inputText value="#{realPlantHome.instance.purchaseSource}" styleClass="form-control nw221" style="display: inline;" id="purchaseSource" name="purchaseSource" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                       </div>
                        <div class="r_title duonian" style="width:95%;margin-left:auto;margin-right:auto">
                    	<div class="r_t_l ">
                    	<font size="3">幼苗时期</font></div>
                    </div>
                        <div class="all_d3 duonian" style="width: 868px; margin:30px auto;"> 
                        <div class="all_da all_w01">
                        	<table>
                                <tr><td class="all_te ">开始时间：</td>
                                    <td>
								    <div class="input-append date ymstart form_datetime "  >
    <input size="23" type="text" class="new_time" value="#{realPlantHome.ymstart}" readonly="readonly" id="ymstart" name="ymstart" autocomplete="off" />
    <span class="add-on" ><i class="icon-th"></i></span>
    </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01 " >
                        	<table>
                                <tr>
                                    <td class="all_te">结束时间：</td>
                                    <td>
    <div class="input-append date ymend form_datetime "  >
    <input size="23"  class="new_time" type="text" value="#{realPlantHome.ymend}" readonly="readonly" id="ymend" name="ymend" autocomplete="off" />
    <span class="add-on" style="height:14px"><i class="icon-th"></i></span>
    </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        </div>
                        <div class="r_title" style="width:95%;margin-left:auto;margin-right:auto">
                    	<div class="r_t_l">
                    	<font size="3" class="plantinfo_thirdfloor">采收信息：</font></div>
                    </div>
                   <div class="all_d3" style="width: 868px; margin:30px auto;"> 
                        <div class="all_da all_w01 yinian">
                        	<table>
                                <tr>
                                    <td class="all_te modehidename_1">种植时间：</td>
                                    <td>
								    <div class="input-append date beginInput form_datetime "  >
    <input size="23" type="text" class="new_time" value="#{realPlantHome.instance.plantBeginTime}" readonly="readonly" id="plant:plant_beginInputDate" name="plant:plant_beginInputDate" autocomplete="off" />
    <span class="add-on" ><i class="icon-th"></i></span>
    </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01 modehide yinian" >
                        	<table>
                                <tr>
                                    <td class="all_te">采收开始：</td>
                                    <td>
    <div class="input-append date harvestTime form_datetime "  >
    <input size="23"  class="new_time" type="text" value="#{realPlantHome.htime}" readonly="readonly" id="plant:harvest_timeInputDate" name="plant:harvest_timeInputDate" autocomplete="off" />
    <span class="add-on" style="height:14px"><i class="icon-th"></i></span>
    </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01 yinian">
                        	<table>
                                <tr>
                                    <td class="all_te modehidename_2">种植结束：</td>
                                    <td>
                                   <div class="input-append date endInput form_datetime "  >
    <input size="23" type="text" value="#{realPlantHome.instance.plantEndTime}"  class="new_time" readonly="readonly" id="plant:plant_endInputDate" name="plant:plant_endInputDate" autocomplete="off" />
    <span class="add-on" ><i class="icon-th"></i></span>
    </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01 duonian">
                        	<table><tr>
                                    <td class="all_te ">落叶休眠：</td>
                                    <td>
                                    <div class="input-append date xiumian form_datetime "  >
    <input size="23" type="text" value="#{realPlantHome.xiumian}"  class="new_time" readonly="readonly" id="xiumian" name="xiumian" autocomplete="off" />
    <span class="add-on" ><i class="icon-th"></i></span>
    </div>
                                    </td></tr>
                            </table>
                        </div>
                        <div class="all_da all_w01 duonian">
                        	<table><tr>
                                    <td class="all_te ">采收开始：</td>
                                    <td>
                                    <div class="input-append date csstart form_datetime "  >
    <input size="23" type="text" value="#{realPlantHome.csstart}"  class="new_time" readonly="readonly" id="csstart" name="csstart" autocomplete="off" />
    <span class="add-on" ><i class="icon-th"></i></span>
    </div>
                                    </td></tr>
                            </table>
                        </div>
                        <div class="all_da all_w01 duonian">
                        	<table><tr>
                                    <td class="all_te ">采收结束：</td>
                                    <td>
                                    <div class="input-append date csend form_datetime "  >
    <input size="23" type="text" value="#{realPlantHome.csend}"  class="new_time" readonly="readonly" id="csend" name="csend" autocomplete="off" />
    <span class="add-on" ><i class="icon-th"></i></span>
    </div>
                                    </td></tr>
                            </table>
                        </div>
                        <div class="all_da all_w01 duonian">
                        	<table><tr>
                                    <td class="all_te ">种植结束：</td>
                                    <td>
                                    <div class="input-append date zzend form_datetime "  >
    <input size="23" type="text" value="#{realPlantHome.zzend}"  class="new_time" readonly="readonly" id="zzend" name="zzend" autocomplete="off" />
    <span class="add-on" ><i class="icon-th"></i></span>
    </div>
                                    </td></tr>
                            </table>
                        </div>
                        <div class="all_da all_w01" style="display:none;">
                        	<table>
                                <tr>
                                    <td class="all_te">种植面积：</td>
                                    <td>
										  <strong>
		                      <input type="text" value="" class="form-control nw221" style="width:100px;display: inline;" id="plant_area" name="plant_area" onkeyup="clearNoNum(this)"/>
		                                                      </strong>
                                                      		<span class="mu_mianji">&#160;亩</span>
                                                           <span class="mu_mianji"  id="plantarea" name="plantarea" style="display:none">#{realPlantHome.total}</span>
                                                     	  	<span class="mu_mianji" ></span>
                                                     	  	<input type="hidden" id="myarea"  value="#{realPlantHome.paramObj}"/>
                                                     	  	<input type="hidden" id="old_start"/>
                                                     	  	<input type="hidden" id="old_end" />
                                                     	  	<input type="hidden" id="model_name" name="model_name"/>
                                         </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01 modehide">
                        	<table>
                                <tr>
                                    <td class="all_te">预估产量：</td>
                                    <td>
										   <select id="yield_type" name="yield_type"  class="selectpicker">
                                                        <option value="1">亩产量</option>
                                                    </select>
                                         </td>
                                </tr>
                            </table>
                        </div>
				</div>
				<ul class="modehide yugu">
                <li class="tc_li typ1" style="padding:0; height:0;"><div id="prompt" style="height:20px; color: red; text-align:left;  line-height:20px; position:relative; top:-20px;"></div></li>
	                                    <li class="tc_li typ1" style="height:auto; padding:0;">
	                                     	<table cellspacing="0" cellpadding="0" class="spctab_le table_2" id="plant_model" style="width:35%; margin-left: auto;margin-right: auto;"> 
                                                    <tr>
                                                        <td class="semxline">1月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month1}" class="input_out3" id="month1" name="month1" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};allNum()" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">2月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month2}" class="input_out3" id="month2" name="month2" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};allNum()" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">3月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month3}" class="input_out3" id="month3" name="month3" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};allNum()" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="semxline">4月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month4}" class="input_out3" id="month4" name="month4" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};allNum()" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">5月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month5}" class="input_out3" id="month5" name="month5" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};allNum()" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">6月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month6}" class="input_out3" id="month6" name="month6" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};allNum()" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="semxline">7月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month7}" class="input_out3" id="month7" name="month7" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};allNum()" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">8月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month8}" class="input_out3" id="month8" name="month8" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};allNum()" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">9月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month9}" class="input_out3" id="month9" name="month9" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};allNum()" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="semxline">10月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month10}" class="input_out3" id="month10" name="month10" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};allNum()" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">11月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month11}" class="input_out3" id="month11" name="month11" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};allNum()" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                        <td class="semxline">12月份</td>
                                                        <td class="semxnene">
                                                            <input value="#{realPlantHome.month12}" class="input_out3" id="month12" name="month12" type="text" onfocus="this.className='input_on3';this.onmouseout=''" onblur="this.className='input_off3';this.onmouseout=function(){this.className='input_out3'};allNum()" onmousemove="this.className='input_move3'" onmouseout="this.className='input_out3'" />
                                                        </td>
                                                    </tr>
                                                </table>                                          
                     					</li>
                     					<li class="tc_li typ1" style="height:auto; padding:0;">
	                     					<div style="width: 35%; margin-right: auto;font-size: 15px;margin-left: auto;">
	                     						<div style="float: right;">总产量:<span class="num">0</span>kg</div>
	                     					</div>
                     					</li>
				</ul>
				</div>
					<table width="650px;" class="r_c_table" cellpadding="0" cellspacing="0">
                       <tr>
							<td class="r_c_td"></td>
							
							<td style="text-align: center;">
							<input type="button" class="btn btn-primary" value="提交" onclick="return checkSubmit();"/>
						<h:commandButton id="persist" style="display:none" value="提交" styleClass="btn btn-primary but_" action="#{realPlantHome.persist}"  onclick="" />
		            	
		    			&#160;<s:button view="/archive/PlantInfoList.xhtml" styleClass="btn btn-default" value="返回" id="bn_left6" style="margin-left:10px" >
		    					<f:param name="pageNum" value="#{realPlantHome.pageNum}" />
		    			</s:button>
                            </td>
						</tr>
					</table>
				<!--入库订单列表结束-->
              <!--right_c结束-->
                <div class="clear"></div>
              </h:form>
              <script type="text/javascript" src="#{request.contextPath}/asset/js/tab.js"></script>
              <script  type="text/javascript">
//<![CDATA[
//获得下拉框中选中的itemLabel显示的值           

function jisuan(){
	var a1 = document.getElementById("month1").value;
	var a2 = document.getElementById("month2").value;
	var a3 = document.getElementById("month3").value;
	var a4 = document.getElementById("month4").value;
	var a5 = document.getElementById("month5").value;
	var a6 = document.getElementById("month6").value;
	var a7 = document.getElementById("month7").value;
	var a8 = document.getElementById("month8").value;
	var a9 = document.getElementById("month9").value;
	var a10 = document.getElementById("month10").value;
	var a11 = document.getElementById("month11").value;
	var a12 = document.getElementById("month12").value;
	var total = 0;
	if(a1 != null && a1 != ""){
		a1 = parseFloat(a1);
	}else{
		a1 = 0;
	}
	if(a2 != null && a2 != ""){
		a2 = parseFloat(a2);
	}else{
		a2 = 0;
	}
	if(a3 != null && a3 != ""){
		a3 = parseFloat(a3);
	}else{
		a3 = 0;
	}
	if(a4 != null && a4 != ""){
		a4 = parseFloat(a4);
	}else{
		a4 = 0;
	}
	if(a5 != null && a5 != ""){
		a5 = parseFloat(a5);
	}else{
		a5 = 0;
	}
	if(a6 != null && a6 != ""){
		a6 = parseFloat(a6);
	}else{
		a6 = 0;
	}
	if(a7 != null && a7 != ""){
		a7 = parseFloat(a7);
	}else{
		a7 = 0;
	}
	if(a8 != null && a8 != ""){
		a8 = parseFloat(a8);
	}else{
		a8 = 0;
	}
	if(a9 != null && a9 != ""){
		a9 = parseFloat(a9);
	}else{
		a9 = 0;
	}
	if(a10 != null && a10 != ""){
		a10 = parseFloat(a10);
	}else{
		a10 = 0;
	}
	if(a11 != null && a11 != ""){
		a11 = parseFloat(a11);
	}else{
		a11 = 0;
	}
	if(a12 != null && a12 != ""){
		a12 = parseFloat(a12);
	}else{
		a12 = 0;
	}
	total = a1 + a2 + a3 + a4 + a5 + a6 + a7 + a8 + a9 + a10 + a11 + a12;
	jquery("#total").html(total);
}

function checkSubmit(){
	var asp_type = jquery('#aps_type').val();
	var nowD = new Date();
	
	if(jquery("#plant_plantId").val()==0){
        document.getElementById("plant:harvest_timeInputDate").value = document.getElementById("plant:plant_beginInputDate").value;
    }
	if(jquery("#breedBreedId").val() == ""){
    	alert("请选择品种！");
		return false;
    }
    var sproutSel=jquery("#sproutSel").val();
    var purchaseSource=jquery("#user\\:purchaseSource").val();

    jquery("#user\\:sproutSource").val(sproutSel);
    if(sproutSel!=2){
    	jquery("#user\\:purchaseSource").val("");
    }else if(sproutSel==2 && purchaseSource.length>0 && purchaseSource.length>50){
		alert("购买来源不能大于50字！");
		return false;
    }
	if(jquery("#plant_plantId option:selected").attr("cc")=="2"){
		var ymstart = jquery("#ymstart").val();
		var ymend = jquery("#ymend").val();
		var xiumian = jquery("#xiumian").val();
		var csstart = jquery("#csstart").val();
		var csend = jquery("#csend").val();
		var zzend = jquery("#zzend").val();
		if(ymstart == ""){
			alert("请填写幼苗开始时间!");
			return false;
		}
		if(ymend == ""){
			alert("请填写幼苗结束时间!");
			return false;
		}
		if(xiumian == ""){
			alert("请填写落叶休眠期!");
			return false;
		}
		if(csstart == ""){
			alert("请填采收开始时间!");
			return false;
		}
		if(csend == ""){
			alert("请填采收结束时间!");
			return false;
		}
		if(ymstart>ymend){
			alert("幼苗开始时间不能大于结束时间!");
			return false;
		}
		if(csstart<=xiumian<=csend){
			alert("落叶休眠期不能在采收范围内!");
			return false;
		}
		var yme = ymend.split("-");
		var yme_ = yme[1]+"-"+yme[2];
		if(csstart<yme_){
			if(csstart>csend){
				alert("幼苗结束时间不能在采收区间内!");
				return false;
			}
		}
		if(csstart>yme_){
			if(csstart>csend&&yme<csend){
				alert("幼苗结束时间不能在采收区间内!");
				return false;
			}
		}
		var arr = xiumian.split("-");
		jquery('#model_name').val(jquery("#plant_standard option:selected").html()+'-'+arr[0]+'-'+arr[1]);
	}else{
		var nowD_ = new Date(nowD.getFullYear(),nowD.getMonth()+1,nowD.getDate());
		var beginTime = document.getElementById("plant:plant_beginInputDate").value;
	    var endTime = document.getElementById("plant:plant_endInputDate").value;
	    var harvestTime = document.getElementById("plant:harvest_timeInputDate").value;
	    var plantarea = document.getElementById("plant_area").value;
	    var edittype = jquery("#edittype").val();
	    var breedId = jquery("#breedBreedId").val();
	    var arr = beginTime.split("-");
	    var starttime = new Date(arr[0], arr[1], arr[2]);
	    var starttimes = starttime.getTime();
	    var arrs = endTime.split("-");
	    var lktime = new Date(arrs[0], arrs[1], arrs[2]);
	    var lktimes = lktime.getTime();
	    var flag = true;
	    var allarea =  parseFloat(jquery("#plantarea").text());
	    if (starttimes >= lktimes) {
	    	alert("定植时间不能大于结束时间！");
			return false;
	    }
	    if(beginTime == ""){
	    	alert("定植时间不能为空！");
			return false;
	    }
	    if(endTime == ""){
        	alert("结束时间不能为空！");
			return false;
	    }
	    if(harvestTime == ""){
	    	alert("采收开始时间不能为空！");
			return false;
	    }
	    var nowT = nowD_.getTime();
	    if(starttimes<nowT){
	    	if(lktimes<nowT){
	    		jquery('#aps_type').val(0);
	    	}else{
	    		jquery('#aps_type').val(1);
	    	}
	    }else{
	    	jquery('#aps_type').val(2);
	    }
	    if(asp_type == 1){
		    if(starttimes>nowT){
	        	//alert("实际种植开始日期不能大于今天！");
	        	//return false;
	        }
		    if(lktimes<nowT){
	        	//alert("实际种植结束日期不能小于今天！");
	        	//return false;
	        }
	    }else if(asp_type==0){
        	if(lktimes>nowT){
            	//alert("历史种植结束日期不能大于今天！");
            	//return false;
                }
            }else if(asp_type==2){
        	if(starttimes<nowT){
	        	//alert("计划种植开始日期不能小于今天！");
	        	//return false;
	        }
            }
	    if((lktimes-starttimes)/60/60/24/1000>365){
	    	alert("一年生作物生长周期不超过一年!")
	    	return false;
	    }
/* 	    if(plantarea == 0){
        	alert("种植面积不能为0！");
			return false;
        }
	    if(plantarea == ""){
	    	alert("种植面积不能为空！");
			return false;
	    } */
	    //if(parseFloat(plantarea) > parseFloat(jquery("#tunnel_area").val())){
	    //	jquery("#prompt").text("种植面积不能大于区域面积！");
		//	return false;
	    //}
	    
	    if(jquery("#modelId").val()==""||jquery("#modelId").val()==0){
	    	alert("请先预估每月产量！");
			return false;
	    }
	    var year = parseInt(jquery("#checkStart").val(),10)<parseInt(jquery("#checkMonth").val())?arr[0]:parseInt(arr[0],10)+1;
		var date1 = new Date(arrs[0],parseInt(arrs[1],10)-1,arrs[2]);
		var date2 ;
		if(jquery("#checkDays").val()==3){
			date2 = new Date(year,jquery("#checkMonth").val(),0);
		}else {
			date2 = new Date(year,(jquery("#checkMonth").val()-1),jquery("#checkDays").val()*10);
		}
		var month1 = parseInt(arr[0]) * 12 + parseInt(arr[1]);
		var month2 = parseInt(arrs[0]) * 12 + parseInt(arrs[1]);
		var cha = Math.abs(month2 - month1);
		if(cha<12){
		    if(date1>date2){
		    	alert("结束时间未在模型区间内！");
		    	return false;
		    }
		}
			   jquery('#model_name').val(jquery("#plant_standard option:selected").html()+'-'+arr[1]+'-'+arr[2]);
	}
	if(jquery("#plant_tunnel_id").val()!=null){
		var tunval=jquery('#plant_tunnel_id').val();
		var tunids=""
		for(var i=0;i<tunval.length;i++){
			if(jquery("[value="+tunval[i]+"]").attr("ty")!="partition" && tunval[i]!=0){
				tunids+=tunval[i]+",";
			}
		}
		if(tunids!=""){
			tunids=tunids.substring(0,tunids.length-1);
		}
		jquery("#tunnel_id").val(tunids);
	}else{
		alert("请选择大棚!");
		return false;
	}
	 var flag2=false;
		if(jquery('#yield_type').val()==1){
			jquery('.semxnene :input').each(function(){
			    if(jquery(this).val()>30000){
			    	flag2=true;
				}
			})
		}else{
			jquery('.semxnene :input').each(function(){
				if((jquery(this).val()/jquery('#plant_area').val())>30000){
					flag2=true;
				}
			})
		}
		if(flag2){
			alert("产量每亩不能大于30000！");
			return false;
		}
	selchange();
	jquery("#plant_plantId").removeAttr("disabled");
	 jquery("#breedBreedId").prop("disabled",false);
	 jquery("#plant_plantId").selectpicker("refresh");
	 jquery(".but_").click();

	 
  return true;
}

function clearNoNum(obj){
	obj.value = obj.value.replace(/[^\d.]/g,"");  //清除“数字”和“.”以外的字符  
	obj.value = obj.value.replace(/^\./g,"");  //验证第一个字符是数字而不是. 
	obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个. 清除多余的.   
	obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
	if(obj.value==""||parseFloat(obj.value)==0 || jquery("#plant_plantId").val()==0){
		jquery(".yugu").hide();
		jquery("#plant_model input").val("");	
		changeYield(1);
		return ;
	}else{
		jquery(".yugu").show();	
	}
	jquery(".table_0 .mul").each(function(){
		var mu = parseFloat(jquery(this).attr("mul"));
		var total = mu*parseFloat(obj.value);
		jquery(this).html(total.toFixed(2)+"kg");
	});
}

function changeYield(obj){
	var area = jquery("#plant_area").val();
	if(obj.value==1){
		jquery(".semxnene input").each(function(){
			var val = jquery(this).val()
			if(val!=""){
				var tempv = parseFloat(val)/parseFloat(area);
				tempv = tempv.toFixed(2);
				jquery(this).val(tempv);
			}
		});
	}else if(obj.value==2){
		jquery(".semxnene input").each(function(){
			var val = jquery(this).val()
			if(val!=""){
				var tempv = parseFloat(val)*parseFloat(area);
				tempv = tempv.toFixed(2);
				jquery(this).val(tempv);
			}
		});
	}
	allNum();
}

Date.prototype.format = function(format)
{
	var o = {
	"M+" : this.getMonth()+1, //month
	"d+" : this.getDate(),    //day
	"h+" : this.getHours(),   //hour
 	"m+" : this.getMinutes(), //minute
	"s+" : this.getSeconds(), //second
 	"q+" : Math.floor((this.getMonth()+3)/3),  //quarter
 	"S" : this.getMilliseconds() //millisecond
	}

	if(/(y+)/.test(format)) 
	{
		format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4 - RegExp.$1.length));
	}
	
 	for(var k in o)
	{
		if(new RegExp("("+ k +")").test(format))
		{
 			format = format.replace(RegExp.$1,RegExp.$1.length==1 ? o[k] : ("00"+ o[k]).substr((""+ o[k]).length));
		}
	}
	return format;
}


function begin_end2(c,a,b){
	if(!c||c==""){
		c = jquery("#xiumian").val();
	}
	if(!a||a==""){
		a = jquery("#csstart").val();
	}
	if(!b||b==""){
		b = jquery("#csend").val();
	}
	c1 = c.split("-");
    a1 = a.split("-");
    b1 = b.split("-");
    
    c = parseInt(c1[0],10);
	a = parseInt(a1[0],10);
	b = parseInt(b1[0],10);
	
	var arr = [];
	if(b>=a){
		for(var i = a ;i<=b;i++){
			arr.push(i);
		}
	}else if(b<a){
		for(var i = a ;i<=12;i++){
			arr.push(i);
		}
		for(var i = 1 ;i<=b;i++){
			arr.push(i);
		}
	}
	jquery(".semxnene input").each(function(){
		for(var i = 0;i<arr.length;i++){
			if(arr[i]==jquery(this).attr("name").replace("month","")){
				break;
			}else if(i==arr.length-1){
				jquery(this).val("");
			}
		}
	});
}

jquery(".semxnene input").keyup(function(){
 	var obj = jquery(this)[0];	
    obj.value = obj.value.replace(/[^\d.]/g,"");  //清除“数字”和“.”以外的字符  
	obj.value = obj.value.replace(/^\./g,"");  //验证第一个字符是数字而不是. 
	obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个. 清除多余的.   
	obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
});

function begin_end(){
	var a = jquery("#plant\\:harvest_timeInputDate").val();
      var b = jquery("#plant\\:plant_endInputDate").val();
      a = a.split("-")[1];
      b = b.split("-")[1];
		a = parseInt(a,10);
		b = parseInt(b,10);
	var arr = [];
	if(b>=a){
		for(var i = a ;i<=b;i++){
			arr.push(i);
		}
	}else if(b<a){
		for(var i = a ;i<=12;i++){
			arr.push(i);
		}
		for(var i = 1 ;i<=b;i++){
			arr.push(i);
		}
	}
	jquery(".semxnene input").each(function(){
		for(var i = 0;i<arr.length;i++){
			if(arr[i]==jquery(this).attr("name").replace("month","")){
				break;
			}else if(i==arr.length-1){
				jquery(this).val("");
			}
		}
	});
}

function getModelByRealId_next(data){
	if(jquery("#plant\\:plantId option:selected").attr("cc")=="2"){
		begin_end2();
	}else{
		begin_end();
	}
	
	var datas = data.split("-~_");
	jquery("#plantarea").html(datas[0]);
	jquery("#plant_area").val(datas[0]);
	if(datas.length==1){
		jquery(".semxnene input").val("");
		return;
	}
		
	var start = datas[5];
	var starts = start.split("-");
	var ht = "";
	if(jquery("#plant\\:harvest_timeInputDate").val()==""){
		if(starts[0]=="null"){
			var val = jquery("#plant\\:plant_beginInputDate").val();
			var vals = val.split("-");
			if(parseInt(vals[1],10)<=parseInt(starts[1],10)){
				ht+=vals[0];
			}else{
				ht+=(parseInt(vals[0],10)+1);
			}
			if(starts[1].length==1){
				ht+="-0"+starts[1];
			}else{
				ht+="-"+starts[1];
			}
			if(parseInt(starts[2],10)==1){
				ht+="-01";
			}else if(parseInt(starts[2],10)==2){
				ht+="-11";
			}else if(parseInt(starts[2],10)==3){
				ht+="-21";
			}
			if(ht.length>4)
				jquery("#plant\\:harvest_timeInputDate").val(ht);
		}else{
			ht = starts[0]+"-"+starts[1]+"-";
			if(parseInt(starts[2],10)<10){
				ht+="0"+starts[2];
			}else{
				ht+=starts[2];
			}
			jquery("#plant\\:harvest_timeInputDate").val(ht);
		}
	}
	if(datas[2]==1){
		jquery("#yield_type").selectpicker('val', 1);
		eval("var tempData="+datas[3]);
		if(tempData.month1&&parseFloat(tempData.month1)>0){
			jquery("#month1").val(tempData.month1);
		}
		if(tempData.month2&&parseFloat(tempData.month2)>0){
			jquery("#month2").val(tempData.month2);
		}
		if(tempData.month3&&parseFloat(tempData.month3)>0){
			jquery("#month3").val(tempData.month3);
		}
		if(tempData.month4&&parseFloat(tempData.month4)>0){
			jquery("#month4").val(tempData.month4);
		}
		if(tempData.month5&&parseFloat(tempData.month5)>0){
			jquery("#month5").val(tempData.month5);
		}
		if(tempData.month6&&parseFloat(tempData.month6)>0){
			jquery("#month6").val(tempData.month6);
		}
		if(tempData.month7&&parseFloat(tempData.month7)>0){
			jquery("#month7").val(tempData.month7);
		}
		if(tempData.month8&&parseFloat(tempData.month8)>0){
			jquery("#month8").val(tempData.month8);
		}
		if(tempData.month9&&parseFloat(tempData.month9)>0){
			jquery("#month9").val(tempData.month9);
		}
		if(tempData.month10&&parseFloat(tempData.month10)>0){
			jquery("#month10").val(tempData.month10);
		}
		if(tempData.month11&&parseFloat(tempData.month11)>0){
			jquery("#month11").val(tempData.month11);
		}
		if(tempData.month12&&parseFloat(tempData.month12)>0){
			jquery("#month12").val(tempData.month12);
		}
	}else{
		jquery("#yield_type").selectpicker('val', 2);
		eval("var tempData="+datas[3]);
		var d_ = jquery("#myarea").val() ;
		d_ = parseFloat(d_,10);
		if(tempData.month1&&parseFloat(tempData.month1)>0){
			var tempv = parseFloat(tempData.month1)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month1").val(tempv);
		}
		if(tempData.month2&&parseFloat(tempData.month2)>0){
			var tempv = parseFloat(tempData.month2)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month2").val(tempv);
		}
		if(tempData.month3&&parseFloat(tempData.month3)>0){
			var tempv = parseFloat(tempData.month3)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month3").val(tempv);
		}
		if(tempData.month4&&parseFloat(tempData.month4)>0){
			var tempv = parseFloat(tempData.month4)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month4").val(tempv);
		}
		if(tempData.month5&&parseFloat(tempData.month5)>0){
			var tempv = parseFloat(tempData.month5)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month5").val(tempv);
		}
		if(tempData.month6&&parseFloat(tempData.month6)>0){
			var tempv = parseFloat(tempData.month6)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month6").val(tempv);
		}
		if(tempData.month7&&parseFloat(tempData.month7)>0){
			var tempv = parseFloat(tempData.month7)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month7").val(tempv);
		}
		if(tempData.month8&&parseFloat(tempData.month8)>0){
			var tempv = parseFloat(tempData.month8)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month8").val(tempv);
		}
		if(tempData.month9&&parseFloat(tempData.month9)>0){
			var tempv = parseFloat(tempData.month9)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month9").val(tempv);
		}
		if(tempData.month10&&parseFloat(tempData.month10)>0){
			var tempv = parseFloat(tempData.month10)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month10").val(tempv);
		}
		if(tempData.month11&&parseFloat(tempData.month11)>0){
			var tempv = parseFloat(tempData.month11)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month11").val(tempv);
		}
		if(tempData.month12&&parseFloat(tempData.month12)>0){
			var tempv = parseFloat(tempData.month12)*d_;
			tempv = tempv.toFixed(2);
			jquery("#month12").val(tempv);
		}
	}
	if(jquery("#plant\\:plantId option:selected").attr("cc")=="2"){
		begin_end2();
	}else{
		begin_end();
	}
}

function getAreaMethod_next(data){
	var objArea = data;
	jquery("#plantarea").html(objArea);
	jquery("#plant_area").val(objArea);
}

jquery(".semxnene input").focus(function(){
	var a,b;
  	if(jquery("#plant_plantId option:selected").attr("cc")=="2"){
  		a = jquery("#csstart").val();
  		b = jquery("#csend").val();
  		a = a.split("-")[0];
  		b = b.split("-")[0];
  	}else{
  		a = jquery("#plant\\:harvest_timeInputDate").val();
  	  	b = jquery("#plant\\:plant_endInputDate").val();
  	    a = a.split("-")[1];
  		b = b.split("-")[1];
  	}
    
		a = parseInt(a,10);
		b = parseInt(b,10);
		var arr = [];
		if(parseInt(b,10)>=parseInt(a,10)){
			for(var i = parseInt(a,10) ;i<=parseInt(b,10);i++){
				arr.push(i);
			}
		}else if(parseInt(b,10)<parseInt(a,10)){
			for(var i = parseInt(a,10) ;i<=12;i++){
				arr.push(i);
			}
			for(var i = 1 ;i<=parseInt(b,10);i++){
				arr.push(i);
			}
		}
		for(var i = 0;i<arr.length;i++){
			if(arr[i]==jquery(this).attr("name").replace("month","")){
				break;
			}else if(i==arr.length-1){
				alert("该月份不在采收开始和结束时间之内");
				jquery(this).blur();
			}
		}
})

//]]>
</script>
<!-- #{realPlantHome.work3()} -->
     <a:form id="formid" >
<a:queue requestDelay="10" ignoreDupResponses="true" id="mainQueue"/>
		
		<a:jsFunction name="getAreaMethod2"  eventsQueue="mainQueue"  action="#{realPlantHome.getAreaMethod()}" data="#{realPlantHome.areaParam}" oncomplete="getAreaMethod_next(data)" >
<a:actionparam name="tunnelParamId" assignTo="#{realPlantHome.tunnelParamId}"></a:actionparam>
</a:jsFunction>
</a:form>
<link rel="stylesheet" href="#{request.contextPath}/asset/css/webgis/select2.css" />
<script type="text/javascript" src="#{request.contextPath}/asset/js/webgis/select2.full.min.js" ></script>
	<script type="text/javascript" src="#{request.contextPath}/asset/js/webgis/i18n/zh-CN.js" ></script>
	 <script type="text/javascript">
	//<![CDATA[
	 jquery(document).ready(function(){
			 jquery("#plant_tunnel_id").change(function(){});
			 jquery("#plant_plantId").change(function(){changeBreed();initComplex()});
			 jquery("#breedBreedId").change(function(){});
			 jquery("#plant_standard").change(function(){});
			 jquery("#yield_type").change(function(){changeYield(this)});
		 
		 jquery(".beginInput").datetimepicker({
			    format: "yyyy-mm-dd",
			    autoclose: true,
				 weekStart: 1,
				  //startDate: "2014-08-14 10:00",
				 language:  'zh-CN',
			   minView:2,
			    pickerPosition: "bottom-left"
			    }).on('changeDate', function(ev){
			    	 var time = new Date(ev.date);
					 if(time!=null)
			    		 time = time.format("yyyy-MM-dd");
					 else
						time = jquery('#plant\\:plant_beginInputDate').val()
				});
	 
	    	
		 jquery(".endInput").datetimepicker({
			    format: "yyyy-mm-dd",
			    autoclose: true,
				 weekStart: 1,
				 language:  'zh-CN',
			   minView:2,
			    pickerPosition: "bottom-left"
			    }).on('changeDate', function(ev){
			    var time = new Date(ev.date);
			    if(time!=null)
		    		 time = time.format("yyyy-MM-dd");
				 else
					time = jquery('#plant\\:plant_endInputDate').val()
				});
	    	
	    	
		 jquery(".harvestTime").datetimepicker({
			    format: "yyyy-mm-dd",
			    autoclose: true,
				 weekStart: 1,
				  //startDate: "2014-08-14 10:00",
				 language:  'zh-CN',
			   minView:2,
			    pickerPosition: "bottom-left"
			    });
		 jquery(".ymstart").datetimepicker({
			    format: "yyyy-mm-dd",autoclose: true,weekStart: 1,language:  'zh-CN',minView:2,pickerPosition: "bottom-left"
			    }).on('changeDate', function(ev){
			    	 var time = new Date(ev.date);
					 if(time!=null)
			    		 time = time.format("yyyy-MM-dd");
					 else
						time = jquery('#ymstart').val()
					var end =  jquery("#zzend").val();
					 if(end==""){
						 end = "2050-12-31"
					 }
				})
			    
			    jquery(".ymend").datetimepicker({
			    	format: "yyyy-mm-dd",autoclose: true,weekStart: 1,language:  'zh-CN',minView:2,pickerPosition: "bottom-left"
			    })
			    
			    jquery(".xiumian").datetimepicker({
			    	format: "mm-dd",autoclose: true,weekStart: 1,language:  'zh-CN',minView:2,pickerPosition: "bottom-left"
			    }).on('changeDate', function(ev){
			    	 var time = new Date(ev.date);
					 if(time!=null)
			    		 time = time.format("MM-dd");
					 else
						time = jquery('#xiumian').val()
					begin_end2(time,'','')
				})
			    
			    jquery(".csstart").datetimepicker({
			    	format: "mm-dd",autoclose: true,weekStart: 1,language:  'zh-CN',minView:2,pickerPosition: "bottom-left"
			    }).on('changeDate', function(ev){
			    	 var time = new Date(ev.date);
					 if(time!=null)
			    		 time = time.format("MM-dd");
					 else
						time = jquery('#csstart').val()
					begin_end2('',time,'')
				})
			    
			    jquery(".csend").datetimepicker({
			    	format: "mm-dd",autoclose: true,weekStart: 1,language:  'zh-CN',minView:2,pickerPosition: "bottom-left"
			    }).on('changeDate', function(ev){
			    	 var time = new Date(ev.date);
					 if(time!=null)
			    		 time = time.format("MM-dd");
					 else
						time = jquery('#csend').val()
					begin_end2('','',time)
				})
			    
			    jquery(".zzend").datetimepicker({
			    	format: "yyyy-mm-dd",autoclose: true,weekStart: 1,language:  'zh-CN',minView:2,pickerPosition: "bottom-left"
			    }).on('changeDate', function(ev){
			    	 var time = new Date(ev.date);
					 if(time!=null)
			    		 time = time.format("yyyy-MM-dd");
					 else
						time = jquery("#zzend").val()
					if(time==""){
						time = "2050-12-31";
					}
					 if(jquery('#ymstart').val()=="")
						 return ;
				})
		 
		 jquery('.selectpicker').selectpicker();
		 initComplex(0,"无品种");
		 changeBreed();
		 allNum();
		});


	 function changeBreed(){
		 if(jquery("#plant_plantId").val()==0){
				jquery(".modehidename_1").html("开始时间：");
				jquery(".modehidename_2").html("结束时间：");
				jquery(".yinian").show();
				jquery(".modehide").hide();
				jquery("#plant_model input").val("");	
				jquery(".duonian").hide();
				jquery(".plantinfo_thirdfloor").html("休耕时间");
			}else if(jquery("#plant_plantId option:selected").attr("cc")=="2"){
				jquery(".modehide").show();
				jquery(".yinian").hide();
				jquery(".duonian").show();
				jquery(".plantinfo_thirdfloor").html("成苗时期");
			}else{
				jquery(".modehide").show();
				jquery(".modehidename_1").html("定植时间：");
				jquery(".modehidename_2").html("种植结束：");
				jquery(".yinian").show();
				jquery(".duonian").hide();
				jquery(".plantinfo_thirdfloor").html("采收信息");
			}
	 }
	 function sproutChange(selValue){
		if(selValue==2){
			jquery("#purchaseSourceDiv").show();
		}else{
			jquery("#purchaseSourceDiv").hide();
		}
	 }

	 function changeTunnel(event){
			var tunnelIds=jquery('#tunnel_id').val();//历史数据

			//长度相等 全部选中
		//	if(jquery("#plant_tunnel_id").val().length==event.target.childElementCount){
		//		jquery("#tunnel_id").val(jquery("#plant_tunnel_id").val().toString());
		//	}else{
				//没有选中数据
				if(jquery("#plant_tunnel_id").val()==null){
					jquery('#tunnel_id').val("");
				}else{//选中数据
					var ids3=jquery("#plant_tunnel_id").val();//选中数据
					//历史数据中长度为0  新增数据
					if(tunnelIds.length==0){
						var ids="";
						/*循环选中数据  为0的  全部选中
						    有attr("ty") =partition  区域选中
						    其他为单独地块选中
						*/
						for(var i=0;i<ids3.length;i++){
							if(ids3[i]==0){
								ids="";
								jquery("#plant_tunnel_id").find('option').each(function(){
									ids+=jquery(this).val()+",";
								})
								break;
							}
							ids+=ids3[i]+",";
							if(jquery("#plant_tunnel_id").find("[value="+ids3[i]+"]").attr("ty")=="partition"){
								jquery("#plant_tunnel_id").find("[pid="+ids3[i]+"]").each(function(){
									ids+=jquery(this).attr('value')+",";
								})
							}
						}

						/*选中长度 = 总长度-1
						    如果选中数据中 没有 0（全部）
						    把0加进去
						
						
						if(jquery("#plant_tunnel_id").val()==event.target.childElementCount-1){
							var ids0=ids.split(',');
							var flag=true;
							for(var i=0;i<ids0.length;i++){
								if(ids0[i]==0){
									flag=false;
								}
							}
							if(flag){
								ids+="0,";
							}
						}*/
						//赋值
						ids=ids.substring(0,ids.length-1);
						jquery('#plant_tunnel_id').removeAttr('onchange');
						jquery('#plant_tunnel_id').selectpicker('val',ids.split(','));
						jquery("#tunnel_id").val(ids);
						jquery('#plant_tunnel_id').attr('onchange','changeTunnel(event)');
					}else{//历史数据中长度！=0   修改数据
						var tunnelIds_0=tunnelIds.split(","); //历史数据
						var ids="";//新生成数据
						//历史数据长度 > 新选中数据长度  为去掉勾选
						if(tunnelIds_0.length>ids3.length){
							var difference =""; //去掉勾选的value
							//循环 查找被去掉勾选的值
						    for (key in tunnelIds_0) {
						        var stra = tunnelIds_0[key];
						        var count = 0;  
						        for(var j= 0; j < ids3.length; j++){  
						            var strb = ids3[j];  
						            if(stra == strb) {  
						                count++;  
						            }  
						        }  
						        if(count==0) {
						        	difference=stra;  
						        }  
							}
						  //去掉勾选值不为0
							//if(difference!=0){
								//去掉勾选值 为区域  把区域及其下级地块和全部去掉
								if(jquery("#plant_tunnel_id").find("[value="+difference+"]").attr("ty")=="partition"){
									for(var i=0;i<ids3.length;i++){
										if(ids3[i]!=difference && jquery("[value="+ids3[i]+"]").attr('pid')!=difference && ids3[i]!=0){
											ids+=ids3[i]+",";
										}
									}
								}else{//去掉勾选值 为地块 把地块及其上级区域和全部去掉
									for(var i=0;i<ids3.length;i++){
										if(ids3[i]!=difference && jquery("[value="+difference+"]").attr('pid')!=ids3[i] && ids3[i]!=0){
											ids+=ids3[i]+",";
										}
									}
								}
							//}
						}else{//历史数据长度 > 新选中数据长度  为添加勾选
							var difference =""; //添加勾选的value
							//循环 查找添加勾选的值
						    for (key in ids3) {
						        var stra = ids3[key];
						        var count = 0;  
						        for(var j= 0; j < tunnelIds_0.length; j++){  
						            var strb = tunnelIds_0[j];  
						            if(stra == strb) {  
						                count++;  
						            }  
						        }  
						        if(count==0) {
						        	difference=stra;  
						        }  
							}
						  	//添加勾选值不为0
						  //  if(difference!=0){
						    	//添加勾选为 区域  区域及下级地块 全部添加
								if(jquery("#plant_tunnel_id").find("[value="+difference+"]").attr("ty")=="partition"){
									for(var i=0;i<ids3.length;i++){
										if(jquery("[value="+ids3[i]+"]").attr('pid')!=difference && ids3[i]!=0){
											ids+=ids3[i]+",";
										}
									}
									jquery("#plant_tunnel_id").find("[pid="+difference+"]").each(function(){
										ids+=jquery(this).attr('value')+",";
									})
								}else{//添加勾选 为 地块  单独添加
									for(var i=0;i<ids3.length;i++){
										ids+=ids3[i]+",";
									}
								}
								
							//}else{//添加勾选值为0  全部添加
							//	jquery("#plant_tunnel_id").find('option').each(function(){
							//		ids+=jquery(this).val()+",";
							//	})
							//}
						    
						}

						//赋值
						if(ids!=""){
							ids=ids.substring(0,ids.length-1);
							jquery('#plant_tunnel_id').removeAttr('onchange');
							jquery('#plant_tunnel_id').selectpicker('val',ids.split(','));
							jquery('#tunnel_id').val(ids);
							jquery('#plant_tunnel_id').attr('onchange','changeTunnel(event)');
						}else{
							jquery('#plant_tunnel_id').removeAttr('onchange');
							jquery('#plant_tunnel_id').selectpicker('val',null);
							jquery('#tunnel_id').val("");
							jquery('#plant_tunnel_id').attr('onchange','changeTunnel(event)');
						}
					}
				}
		//	}
		}

	 function allNum(){
			var num=0
			jquery('.semxnene input').each(function(){
				if(jquery(this).val()!=null && jquery(this).val()!=""){
					num+=parseFloat(jquery(this).val());
				}
			})
			jquery('.num').text(num.toFixed(2));
		}
	 
	 var breed_select ;
		function initComplex(id,value){
			jquery('#breedBreedId').empty();
			if(typeof(id) == "undefined"){
				jquery('#breedBreedId').append("<option value=''></option>");
			}else{
				jquery('#breedBreedId').append("<option value='"+id+"'>"+value+"</option>");
			}
			
			
			
			breed_select = jquery('#breedBreedId').select2({
				language : "zh-CN",
				ajax : {
					url : "/rest/1.0/breedList",
					delay : 450,
					dataType : 'json',
					data : function(params) {
						var param = "";
						var page = "";
						if(typeof(params.term) != "undefined"){
							param = params.term;
							param = param.replace("'","\'");
						}
						if(typeof(params.page) != "undefined"){
							page = params.page;
						}
						return {
							'method' : 'breed_list',
							'field' : "{'enterprise_info_id':#{sessionTake.enterpriseInfoId},'search':'"+param+"','plant_id':"+jquery("#plant_plantId").val()+",'page':'"+page+"'}",
						};
					},
					processResults : function(data, params) {
						if(typeof(params.page) == "undefined"){
							params.page = 1
						}
						return {
							results : data.result_data,
							pagination : {
								more : (params.page * 50) < data.total_count
							}
						};
					}
				},
				escapeMarkup : function(markup) {
					return markup;
				}, // let our custom formatter work
				//minimumInputLength : 2,
				templateResult : formatData,
				templateSelection : formatDataSelection
			});
		}
		function formatData(result) {
			if (result.loading) return result.text;
				var html = '<div>'+result.text+'</div>';
		    return html;
		}

		function formatDataSelection(data) {
			if(data.id == "" || data.id == "-1")
				return '搜索品种的名称！';
			return data.text;
		}
	//]]>
</script>

            </td> 
             <style>
  .glyphicon-ok:before {
    content: "";
    }
 </style>
<style>
	  .ts_div2{width:240px; height: 125px; border: 1px solid #81C5E9; margin: 0px auto; padding: 0 15px 15px;  background: url(#{request.contextPath}/asset/images/tck_bg_14.jpg) #ffffff repeat-x scroll center top;}
	  .dr-mpnl-shadow{background:none;}
	  .dr-mpnl-pnl{background:none; border:none;}
	  .dr-mpnl-pnl-b{padding:0;}
	  .dr-mpnl-shadow{top:0; left:0;}
	  .rich-picklist-source-items{margin:0;}
	  .ui-selectmenu{*float:left;}
	  .all_w01 {
    width: 371px;
	}
.all_te {
    width: 100px;
	}
	</style>
	</ui:define>

</ui:composition>
