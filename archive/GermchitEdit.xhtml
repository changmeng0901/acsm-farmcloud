<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:c="http://java.sun.com/jstl/core"
	template="/layout/template_new.xhtml">


	<ui:define name="body">
	<script type="text/javascript" src="#{request.contextPath}/asset/js/checkBox/icheck.js"></script>
	<link rel="stylesheet" href="#{request.contextPath}/asset/css/webgis/select2.css" />
	<style>
	.sw80{width:80px;}
	.sw80 .bootstrap-select:not([class*="span"]):not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) {
    width: 80px;
}
	.inputW{ float: left;
    font-weight: normal;
    width:80px;}
    .new_time {width: 221px;float: left;margin-top: -8px;}
	</style>
<!--  #{germchitHome.plantList()} -->
		<td valign="top">
		<h:form id="user">
			<!-- Modal -->
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal" class="modal fade in w600na" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="productMsg">*号部分为必填项！</span>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
      </div>
    </div>
  </div>
</div>
	
		
                <div class="right_c">
                	<div class="r_title">
                    	<div class="r_t_l">生产管理&#160;&gt;&#160;&#160;<a href="#{request.contextPath}/archive/GermchitList.seam"><font size="3">种苗</font></a><rich:messages styleClass="messages"></rich:messages></div>
                    </div>
				
				<div class="r_title" style="width:95%;margin-left:auto;margin-right:auto">
                    	<div class="r_t_l">
                    	<font size="3">种苗信息</font><rich:messages styleClass="messages"></rich:messages></div>
                    </div>
                   
				<div class="all_d3" style="width: 868px; margin:30px auto;">
						<div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">选择品种：</td>
                                    <td>
                                    <h:inputHidden id="plant_real_id" name="plant_real_id" value="#{germchitHome.typeId}" />
									<select data-live-search="true" style="width:220px" id="variety" name="variety" >
									</select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                	<td class="all_te">类别：<h:inputHidden value="#{germchitHome.instance.germchitType}" id="gerType"/></td>
                        			<td>
                        				<div style="float:left;" >
                                        	<input type="radio" value="0" name="germType" id="germType0"  />
                                        	<label style="font-weight: 100; margin: 0 5px;" for="germType0"  name="sex_nomales">种子</label>
                                        </div>
                                        <div style="float:left;">
                                            <input type="radio" value="1" name="germType" id="germType1" />
                                            <label style="font-weight: 100; margin: 0 5px;" for="germType1"  name="sex_nomales">种苗</label>
                                        </div>
                        			</td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                        		<tr>
                        			<td class="all_te">来源：<h:inputHidden value="#{germchitHome.instance.sourceType}" id="souType"/></td>
                        			<td>
                        				<div style="float:left;">
                                        	<input type="radio" value="0" name="sourceType" id="sourceType0"  />
                                        	<label style="font-weight: 100; margin: 0 5px;" for="sourceType0"  name="sex_nomales" >自繁</label>
                                        </div>
                                        <div style="float:left;">
                                            <input type="radio" value="1" name="sourceType" id="sourceType1" />
                                            <label style="font-weight: 100; margin: 0 5px;" for="sourceType1"  name="sex_nomales">外采</label>
                                        </div>
                        			</td>
                        		</tr>
                            </table>
                        </div>
                         <div class="all_da all_w01 scqy_block"  style="display:none" >
                         	<div>
	                        	<table>
	                        		<tr>
	                        			<td class="all_te" >生产企业：</td>
	                        			 <td>
	                        				<span class="bootSelt21" >
	                            				<h:inputText id="seedling_company" styleClass="form-control" style="width:220px;" value="#{germchitHome.instance.seedlingCompany}"/>
	                           				 </span>
	                       				 </td>
	                        		</tr>
	                        	</table>
                        	</div>
                        </div>
                        <div class="all_da all_w01 cmsj_block" style="display:none-" >
                        	<div>
                        		<table>
	                                <tr>
	                                    <td class="all_te" id="germTime">成苗时间：</td>
	                                    <td>
	    <div class="input-append date germchitTime form_datetime "  >
	    <h:inputHidden value="#{germchitHome.instance.seedlingTime}" id="germchit_time"/>
	    <input size="23"  class="new_time" type="text"  readonly="readonly" id="germchit_timeInputDate" name="germchit_timeInputDate" autocomplete="off" />
	    <span class="add-on" style="height:14px"><i class="icon-th"></i></span>
	    </div>
	                                    </td>
	                                </tr>
	                            </table>
                        	</div>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                        		<tr>
                        			 <td class="all_te" id="germPlace">生产基地：</td>
                        			 <td>
                        				<span class="bootSelt21">
                            				<h:inputText id="seedling_address" styleClass="form-control" style="width:220px;" value="#{germchitHome.instance.seedlingAddress}"/>
                           				 </span>
                       				 </td>
                        		</tr>
                        	</table>
                        </div>
                        <br />
                        <div class="all_da all_w01" style="width: 740px;">
                        	<table>
                        		<tr>
                        			<td class="all_te">图片：</td>
                                    <td colspan="3">
	                                    <iframe src="#{request.contextPath}/archive/GermchitImages.seam?germchitImgId=#{germchitHome.instance.id}" id="myframPic" name="myframPic" frameBorder="0" scrolling="no" height="150" width="480" />
                                    </td>
                                	<h:inputHidden value="#{germchitHome.instance.seedlingImage}" id="imageUrl"/>
                        		</tr>
                        	</table>
                        </div>
                        </div>
                        <div class="r_title" style="width:95%;margin-left:auto;margin-right:auto">
                    	<div class="r_t_l">
                    	<font size="3" class="plantinfo_thirdfloor">检疫信息：</font></div>
                    </div>
                   <div class="all_d3" style="width: 868px; margin:30px auto;"> 
                        <div class="all_da all_w01">
                        	<table>
                        		<tr>
                        			 <td class="all_te" align="right">检疫机构：</td>
                        			 <td>
                        				<span class="bootSelt21">
                            				<h:inputText id="qua_agencies" styleClass="form-control" style="width:220px;" value="#{germchitHome.instance.quarantineAgencies}"/>
                           				 </span>
                       				 </td>
                        		</tr>
                        	</table>
                        </div>
                        <div class="all_da all_w01 " >
                        	<table>
                                <tr>
                                    <td class="all_te">检疫时间：</td>
                                    <td>
    <div class="input-append date quarantineTime form_datetime "  >
    <h:inputHidden value="#{germchitHome.instance.quarantineTime}"  id="quaTime"/>
    <h:inputText  id="quarantineTime" styleClass="new_time"  readonly="true" name="quarantineTime" autocomplete="off"/>
    <span class="add-on" style="height:14px"><i class="icon-th"></i></span>
    </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                        	 <tr>
                                	<td class="all_te">检疫结果：<h:inputHidden value="#{germchitHome.instance.quarantineResult}" id="apsType"/></td>
                        			<td>
                        				<div style="float:left;" >
                                        	<input type="radio" value="0" name="quares" id="quaresult0"   />
                                        	<label style="font-weight: 100; margin: 0 5px;" for="quaresult0"  name="sex_nomales">合格</label>
                                        </div>
                                        <div style="float:left;">
                                            <input type="radio" value="1" name="quares" id="quaresult1" />
                                            <label style="font-weight: 100; margin: 0 5px;" for="quaresult1"  name="sex_nomales">不合格</label>
                                        </div>
                        			</td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01" style="width: 740px;">
                        	<table>
                        		<tr>
                        			<td class="all_te">检疫图片：</td>
                                    <td colspan="3">
	                                    <iframe  id="myquaPic"  src="#{request.contextPath}/archive/GermchitImages.seam?germchitquaId=#{germchitHome.instance.id}"  name="myquaPic" frameBorder="0" scrolling="no" height="150" width="480" />
                                    </td>
                                	<h:inputHidden value="#{germchitHome.instance.quarantineImgae}" id="quaImage"/>                  			 
                        		</tr>
                        	</table>
                        </div>
				</div>
				</div>
					<table width="650px;" class="r_c_table" cellpadding="0" cellspacing="0">
                       <tr>
							<td class="r_c_td"></td>
							
							<td style="text-align: center;">
		    		
                            </td>
						</tr>
					</table>
					<table width="650px;" class="r_c_table" cellpadding="0" cellspacing="0">
                       <tr>
							<td class="r_c_td"></td>
							
							<td style="text-align: center;">
						<h:commandButton id="persist" value="保存" styleClass="btn btn-primary" action="#{germchitHome.persist}" style="#{germchitHome.germchitId == null || param.saveagain == 1?'':'display:none'}" onclick="return checkSubmit();" />
		            	<h:commandButton id="update" value="保存" styleClass="btn btn-primary" action="#{germchitHome.update}" style="#{germchitHome.germchitId  != null?'':'display:none'}" onclick="return checkSubmit();" />
		    			&#160;<a href="#{request.contextPath}/archive/GermchitList.seam"  class="btn btn-default" id="bn_left6" style="margin-left:10px" >返回
		    					  <f:param name="pageNum" value="#{germchitList.pageNum}" />
		    				  </a>
                            </td>
						</tr>
					</table>
				<!--入库订单列表结束-->
              <!--right_c结束-->
                <div class="clear"></div>
              </h:form>
             
            </td> 
            <script type="text/javascript" src="#{request.contextPath}/asset/js/webgis/select2.full.js" ></script>
	<script type="text/javascript" src="#{request.contextPath}/asset/js/webgis/i18n/zh-CN.js" ></script>
    	<script type="text/javascript">
	//<![CDATA[
		// 页面加载完成
		jQuery(document).ready(function() {

			jQuery('.selectpicker').selectpicker();
			
			jquery(".germchitTime").datetimepicker({
			    format: "yyyy-mm-dd",
			    autoclose: true,
				 weekStart: 1,
				  //startDate: "2014-08-14 10:00",
				 language:  'zh-CN',
			   minView:2,
			    pickerPosition: "bottom-left"
			    });
			
			jquery(".quarantineTime").datetimepicker({
			    format: "yyyy-mm-dd",
			    autoclose: true,
				 weekStart: 1,
				  //startDate: "2014-08-14 10:00",
				 language:  'zh-CN',
			   minView:2,
			    pickerPosition: "bottom-left"
			    });

			if(#{germchitHome.germchitId != null}){

				var germchitTimeHide = jQuery("#user\\:germchit_time").val();
				jQuery("#germchit_timeInputDate").val(germchitTimeHide);
				var germchitTimeHide = jQuery("#user\\:quaTime").val();
				jQuery("#user\\:quarantineTime").val(germchitTimeHide);

				var variety = "#{germchitHome.instance.breedId.breedId}";
				var breed_name = "#{germchitHome.instance.breedId.name}";
				var plant_name = "#{germchitHome.instance.breedId.plant.name}";
				var plant_id = "#{germchitHome.instance.breedId.plant.plantId}";
				var floristicsType = "#{germchitHome.instance.breedId.plant.floristicsType}";
				initComplex(variety,breed_name);
				plant_select.select2("trigger", "select", {
				    data:{"id": variety,"plantName":plant_name,"plantId":plant_id,"breedName":breed_name,"type":floristicsType}
				});
				var quaResult = jQuery("#user\\:apsType").val();
				jQuery("input:radio[name='quares'][value="+quaResult+"]").attr("checked","checked");
				
				var germTypeHide = jQuery("#user\\:gerType").val();
				var sourceTypeHide = jQuery("#user\\:souType").val();
				jQuery("input:radio[name='germType'][value="+germTypeHide+"]").attr("checked","checked");
				jQuery("input:radio[name='sourceType'][value="+sourceTypeHide+"]").attr("checked","checked");
				if(germTypeHide == 0 && sourceTypeHide==0){
					jQuery("#germTime").html("生产时间：");
					jQuery("#germPlace").html("生产地点：");
					jQuery(".scqy_block").css("display","none");
				}else if(germTypeHide == 0 && sourceTypeHide==1){
					jQuery(".scqy_block").css("display","");
					jQuery("#germTime").html("生产时间：");
					jQuery("#germPlace").html("生产地点：");
				}else if(germTypeHide == 1 && sourceTypeHide==0){
					jQuery(".scqy_block").css("display","none");
					jQuery("#germTime").html("成苗时间：");
					jQuery("#germPlace").html("生产基地：");
				}else if(germTypeHide == 1 && sourceTypeHide==1){
					jQuery(".scqy_block").css("display","");
					jQuery("#germTime").html("生产时间：");
					jQuery("#germPlace").html("生产地点：");
				}

				
				var imageUrlHide = jQuery("#user\\:imageUrl").val();
				var quaImageHide = jQuery("#user\\:quaImage").val();
				jQuery("#myframPic").contents().find("#plant0").attr("src",imageUrlHide);
				jQuery("#myquaPic").contents().find("#plant0").attr("src",quaImageHide);
			}else{
				jQuery("input:radio[name='germType']:eq(1)").attr("checked","checked");
				jQuery("input:radio[name='sourceType']:eq(0)").attr("checked","checked");
				jQuery("input:radio[name='quares']:eq(0)").attr("checked","checked");
				initComplex();
			}	
			
		    
			
			jQuery("input:radio[name='germType']").change(function(){
				var germType = jQuery("input:radio[name='germType']:checked").val();
				var sourceType = jQuery("input:radio[name='sourceType']:checked").val();
				if(germType != null && germType == 0){
					if(sourceType != null && sourceType ==0 ){
						jQuery("#germTime").html("生产时间：");
						jQuery("#germPlace").html("生产地点：");
						jQuery("#user\\:seedling_company").val("");
						jQuery(".scqy_block").css("display","none");
					}else if(sourceType != null && sourceType == 1){
						jQuery(".scqy_block").css("display","");
						jQuery("#germTime").html("生产时间：");
						jQuery("#germPlace").html("生产地点：");
					}
				}else if(germType != null && germType == 1){
					if(sourceType != null && sourceType == 0){
						jQuery("#user\\:seedling_company").val("");
						jQuery(".scqy_block").css("display","none");
						jQuery("#germTime").html("成苗时间：");
						jQuery("#germPlace").html("生产基地：");
					}else if(sourceType != null && sourceType == 1){
						jQuery(".scqy_block").css("display","");
						jQuery("#germTime").html("生产时间：");
						jQuery("#germPlace").html("生产地点：");
					}
				}
			});

			jQuery("input:radio[name='sourceType']").change(function(){
				var sourceType = jQuery("input:radio[name='sourceType']:checked").val();
				var germType = jQuery("input:radio[name='germType']:checked").val();
				if(sourceType != null && sourceType == 0){
					if(germType != null && germType == 0){
						jQuery("#germTime").html("生产时间：");
						jQuery("#germPlace").html("生产地点：");
						jQuery("#user\\:seedling_company").val("");
						jQuery(".scqy_block").css("display","none");
					}else if(germType != null && germType == 1){
						jQuery("#user\\:seedling_company").val("");
						jQuery(".scqy_block").css("display","none");
						jQuery("#germTime").html("成苗时间：");
						jQuery("#germPlace").html("生产基地：");
					}
				}else if(sourceType != null && sourceType == 1){
					if(germType != null && germType == 0){
						jQuery(".scqy_block").css("display","");
						jQuery("#germTime").html("生产时间：");
						jQuery("#germPlace").html("生产地点：");
					}else if(germType != null && germType ==1){
						jQuery(".scqy_block").css("display","");
						jQuery("#germTime").html("生产时间：");
						jQuery("#germPlace").html("生产地点：");
					}
				}
			});	

			
			
		});
		
		
		function checkSubmit(){
			var selectVal = jQuery("#variety").val();
			if(selectVal == null || selectVal == ""){
				alert("请选择品种");
				return false;
			}
			jQuery("#user\\:plant_real_id").val(selectVal);
			var germType = jQuery("input:radio[name='germType']:checked").val();
			var sourceType = jQuery("input:radio[name='sourceType']:checked").val();
			jQuery("#user\\:gerType").val(germType);
			jQuery("#user\\:souType").val(sourceType);

			var timeInputDate = jQuery("#germchit_timeInputDate").val();
			jQuery("#user\\:germchit_time").val(timeInputDate);
			
			
			var address = jQuery("#user\\:seedling_address").val();
			var company = jQuery("#user\\:seedling_company").val();
			if(germType == 1 && sourceType == 0){
				if(address == null || address == ""){
					/* alert("请输入生产基地");
					return false; */
				}else if(address.length > 50){
					alert("生产基地不能超过50字");
					return false;
				}
			}else if((germType == 0 && sourceType == 1) || (germType == 1 && sourceType == 1)){
				if(company == null || company == ""){
					/* alert("请输入生产企业");
					return false; */
				}else if(company.length > 50){
					alert("生产企业不能超过50字");
					return false;
				}
				if(address == null || address == ""){
					/* alert("请输入生产地点");
					return false; */
				}else if(address.length > 50){
					alert("生产地点不能超过50字")
					return false;
				}
				
			}else if(germType == 0 && sourceType == 0){
				if(address == null || address == ""){
					/* alert("请输入生产地点");
					return false; */
				}else if(address.length > 50){
					alert("生产地点不能超过50字")
					return false;
				}
			}
			var agencies = jQuery("#user\\:qua_agencies").val();
			if(agencies == null || agencies == ""){
				/* alert("请输入检疫机构");
				return false; */
			}else if(agencies.length > 50){
				alert("检疫机构不能超过50字");
				return false;
			}

			var quarantineTime = jQuery("#user\\:quarantineTime").val();
			jQuery("#user\\:quaTime").val(quarantineTime);

			var quaResult = jQuery("input:radio[name='quares']:checked").val();
			jQuery("#user\\:apsType").val(quaResult);

			var myquaPic = jQuery("#myquaPic").contents().find("#plant0").attr("src");
			var myframPic = jQuery("#myframPic").contents().find("#plant0").attr("src");
			/* if(myframPic == null || myframPic == ""){
				alert("请上传图片！");
				return false;
			}
			if(myquaPic == null || myquaPic == ""){
				alert("请上传检疫图片！");
				return false;
			} */
			jQuery("#user\\:imageUrl").val(myframPic);
			jQuery("#user\\:quaImage").val(myquaPic);
			
			return true;
		}
		
		var plant_select ;
		var currentQuery;
		function initComplex(id,value){
			plant_select = jQuery('#variety').select2({
				placeholder: {
				    id: '',
				    text: '搜索作物或品种的名称！'
				  },
				language : "zh-CN",
				ajax : {
					url : "/rest/1.0/breedList",
					delay : 450,
					dataType : 'json',
					data : function(params) {
						var param = "";
						var page = "";
						if(typeof(params.term) != "undefined"){
							param = params.term;
							param = param.replace("'","\'");
						}
						if(typeof(params.page) != "undefined"){
							page = params.page;
						}
						return {
							'method' : 'breed_plant_list',
							'field' : "{'enterprise_info_id':#{sessionTake.enterpriseInfoId},'search':'"+param+"','page':'"+page+"','type':'1'}",
						};
					},
					processResults : function(data, params) {
						if(typeof(params.page) == "undefined"){
							params.page = 1
						}
						return {
							results : data.result_data,
							pagination : {
								more : (params.page * 50) < data.total_count
							}
						};
					}
				},
				escapeMarkup : function(markup) {
					return markup;
				}, 
				//minimumInputLength : 2,
				templateResult : formatData,
				templateSelection : formatDataSelection
			})
		}
		function formatData(result) {
			if (result.loading) return result.text;
				var html = '<div>'+result.plantName+"-"+result.breedName+'</div>';
		    return html;
		}

		function formatDataSelection(data) {
			if(data.id == "")
				return '搜索作物或品种的名称！';
			return data.plantName+"-"+data.breedName;
		}

	//]]>
	</script>

	</ui:define>

</ui:composition>

