<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template_new.xhtml">
<ui:define name="head">
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/model/purchase.css" />
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/model/sort.css" />
	
</ui:define>
	<ui:define name="body">
	<style>
	 .form-control{
			float:left;
		}
	.all_te{width: 100px;}
	 html{height:auto;}	
	 .bootstrap-select.btn-group .dropdown-menu {height: 500px;}
	  ul.dropdown-menu.inner.selectpicker {height: 450px;}
		.crop_title{ margin-bottom:0; padding:8px 0; border-bottom:1px solid #ccc;font-size:14px;
		font-weight:normal; color:#666;}
		.crop_sort{ padding:10px 30px;}
		.crop_sort .sort_btn{ display:block;width:30px;padding:2px 8px;font-size:12px;border:1px solid #ccc;
		border-radius:5px;margin-bottom:10px; text-align:center;cursor:pointer;}
		.crop_sort .sort_btn:hover{background: #f1f1f1;}
		.sort_table_wap{border:1px solid #ccc;padding:10px;}
		.sort_table{border-collapse:collapse ;border:1px solid #ccc;font-size:12px;}
		.sort_table thead th{padding:8px 5px;background: #eef5fb;border-bottom:1px solid #ccc;text-align:center;font-weight:normal;}
		.sort_table tbody td{padding:5px;border-bottom:1px solid #ccc;text-align:center;}
	</style>
	#{plantHome.wire()}
		<td valign="top">
		<div class="box_back" id="login" style="display: none; z-index: 1000;position: absolute;left: 0;top: 0;right: 0;bottom: 0;background: rgba(0,0,0,0.5);">
				<div id="login2" style="width: 128px;height: 168px;margin: -84px auto 0 -64px;position: absolute;left: 50%;top: 50%;">
					<img src="../asset/images/loginda.gif" />
				</div>
		</div>
		<h:form id="user" enctype="multipart/form-data">
						<!-- Modal -->
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal" class="modal fade in w600na" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="spanValue">*号部分为必填项！</span>
        
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
      </div>
    </div>
  </div>
</div>
                <div class="right_c">
                	<div class="r_title">
                    	<div class="r_t_l">数字农场&#160;&gt;&#160;&#160;种植档案
                    	&#160;&gt;&#160;&#160;<font size="3">作物种类</font><rich:messages styleClass="messages"></rich:messages></div>
                    </div>
                    
				<!--入库订单列表开始-->
                	<div class="all_44">
                        <div class="all_da all_w01">
                        	<table>
                        	<!-- #{plantHome.getFfloristicsListNew()} -->
                                <tr>
                                    <td class="all_te">所属类型：</td>
                                    <td>
										<select id="parnetIdItem" class="selectpicker" data-live-search="true">
											<option value="-1">请选择</option>
												<a:repeat value="#{plantHome.floristicsList2}" var="_floristics">
													<s:fragment rendered="#{_floristics[2]}">
													<option value="#{_floristics[0]}" disabled="disabled">#{_floristics[1]}</option>
													</s:fragment>
													<s:fragment rendered="#{!_floristics[2]}">
													<option value="#{_floristics[0]}">#{_floristics[1]}</option>
													</s:fragment>
												</a:repeat>
			                                </select>
			                                <h:inputHidden value="#{plantHome.fId}" id="fId"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">生产年限：</td>
                                    <td>
                                       <h:selectOneMenu immediate="true" styleClass="selectpicker"  style="width:146px;" value="#{plantHome.instance.floristicsType}">
											<f:selectItem itemLabel="一年生" itemValue="1" />
											<f:selectItem itemLabel="多年生" itemValue="2" />
										</h:selectOneMenu>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    	<div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">种名：</td>
                                    <td>
                                       <h:inputText styleClass="form-control nw221" id="name" value="#{plantHome.instance.name}"/>
                                       <span class="finput" style="color:#FF0000">*</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                            	<tr>
                                	<td class="all_te">拉丁文名：</td>
                                    <td><h:inputText class="form-control nw221" value="#{plantHome.instance.formalName}" /></td>
                            	</tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                            	<tr>
                                	<td class="all_te">英文名：</td>
                                    <td><h:inputText class="form-control nw221" value="#{plantHome.instance.englishName}" /></td>
                            	</tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                            	<tr>
                                	<td class="all_te">学名：</td>
                                    <td><h:inputText class="form-control nw221" value="#{plantHome.instance.scientificName}" /></td>
                            	</tr>
                            </table>
                        </div>
                    	<div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">别名：</td>
                                    <td>
                                        <h:inputText id="suitableCrops"
						size="45" maxlength="45" value="#{plantHome.instance.byname}"
						styleClass="form-control nw221" /> 
                                    </td>
                                </tr>
                            </table>
                        </div>
                       <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">科：</td>
                                    <td>
                                     <h:inputText id="faculty"  value="#{plantHome.instance.faculty}"
						styleClass="form-control nw221" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">属：</td>
                                    <td>
                                     <h:inputText id="genus"  value="#{plantHome.instance.genus}"
						styleClass="form-control nw221" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01" style="width:auto; display:block;">
                        	<table>
                                <tr>
                                    <td class="all_te">图片：</td>
                                    <td width="250" align="left">
										<s:fileUpload id="picture" size="30"
											accept="image/jpg,image/jpeg,image/gif"
											contentType="image/jpg,image/jpeg,image/gif"
											fileName="#{plantHome.instance.pictureName}"
											data="#{plantHome.instance.pictureByte}"
											onchange="previewImage(this);">
										</s:fileUpload>
						            </td>
						            <td align="left" style="padding-left:10px;">	
										<font color="#FF0000">图片宽高标准：370x228(像素) 支持格式：jpg,gif,jpeg,bmp</font>
						            </td>
                                </tr>
                            </table>
                        </div>
                       <!-- 产出品 -->
			   				 <h4 class="crop_title" >产出品</h4>
			   				<div class="crop_sort">
			   					<h:inputHidden value="#{plantHome.cropsjson}"  id="cropsjsonhidden" />
			   					<span class="sort_btn" onclick="showpx()">排序</span>
			   					<rich:panel id="croppanel" style="margin:0; border:none; padding: 0;">
			   					<input type="text" value="#{plantHome.imgDataJson}" id="imgDataJson" style="display:none"/>
			   					<h:inputHidden value="#{plantHome.imgDataJson}"  id="imgDataJson" />
			   					<div class="sort_table_wap">
			   						<input type="text" value="#{plantHome.outputsList}" id="croplist" style="display:none"/>
			   						<table class="sort_table" cellpadding="0" cellspacing="0" width="100%">
			   							<thead>
			   								<th width="20%">产出品名称</th>
			   								<th width="20%">部位</th>
			   								<th width="20%">图片</th>
			   								<th width="25%">创建时间</th>
			   								<th width="15%">操作</th>
			   							</thead>
			   							<tbody>
			   							<a:repeat value="#{plantHome.outputsList}" var="_outputs"  rowKeyVar="_index">
			   							<tr name="croptr">
			   								<td width="20%">
			   									<input type="text" value="#{_outputs[4]}" id="cropid#{_index}" style="display:none"/>
			   									<input type="text" value="#{_outputs[0]}" class="form-control nw221" maxlength="20" id="cropName#{_index}" onblur="checkCropName(#{_index})"/>
			   								</td>
			   								<td width="20%"> 
			   									<input type="text" value="#{_outputs[1]}" id="cropSite#{_index}" style="display:none"/>
			   									 <select class="selectpicker" style="display: none;" multiple="multiple" title="请选择" id="crop#{_index}" >
			   										<a:repeat value="#{plantHome.cropList}" var="_crop"  >
			   											<option value="#{_crop[0]}">#{_crop[1]}</option>
			   										</a:repeat>
			   									</select>
			   								</td>
			   								<td width="20%">
			   									<input type="text" value="#{_index}" id="cropindex#{_index}" style="display:none"/>
			   									<iframe id="cropimgIframe#{_index}" ind="#{_index}" src="#{request.contextPath}/model/CropImage.seam" style ="height:30px; width:60px;border:0;overflow:hidden;">
			                					</iframe><p id="cropImgName#{_index}">#{_outputs[2]}</p>
			   								</td>
			   								<td width="25%">
			   									<h:outputText value="#{_outputs[3]}" id="cropDate#{_index}" >
													<s:convertDateTime type="both" dateStyle="short" pattern="yyyy-MM-dd HH:mm" />
												</h:outputText>
			   								</td>
			   								<td width="15%">
			   									<a href="javascript:void(0);" onclick="addCrop(#{_index})"><img src="../images/crop_tableadd.jpg"/></a>
			   									<s:fragment rendered="#{_index ne 0}">
			   										<a href="javascript:void(0);" onclick="delCrop(#{_index})"><img src="../images/02_62.png"/></a>
			   									</s:fragment>
			   								</td>
			   								</tr>
			   							</a:repeat>
			   							</tbody>
			   						</table>
			   					</div>
			   					</rich:panel>
			   				</div>
                         <div class="all_da all_w01" style="width:724px;">
                        	<table>
                            	<tr>
                                	<td class="all_te">产地及分布：</td>
                                    <td  colspan="3"><h:inputTextarea  styleClass="form-control nw420" rows="3" value="#{plantHome.instance.producingArea}" /></td>
                            	</tr>
                            </table>
                        </div>
                         <div class="all_da all_w01" style="width:724px;">
                        	<table>
                            	<tr>
                                	<td class="all_te">生态习性：</td>
                                    <td  colspan="3"><h:inputTextarea  styleClass="form-control nw420" rows="3" value="#{plantHome.instance.habit}" /></td>
                            	</tr>
                            </table>
                        </div>
                        <div class="all_da all_w01" style="width:724px;">
                        	<table>
                                <tr>
                                    <td class="all_te">形态特征：</td>
                                    <td  colspan="3"><h:inputTextarea id="fastness"  styleClass="form-control nw420" rows="3"  value="#{plantHome.instance.shape}" /></td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01" style="width:724px;">
                        	<table>
                                <tr>
                                    <td class="all_te">根：</td>
                                    <td  colspan="3"><h:inputTextarea id="root"  styleClass="form-control nw420" rows="3"  value="#{plantHome.instance.root}" /></td>
                                </tr>
                            </table>
                        </div>
                        
                         <div class="all_da all_w01" style="width:724px;">
                        	<table>
                                <tr>
                                    <td class="all_te">茎：</td>
                                    <td  colspan="3"><h:inputTextarea id="stem"  styleClass="form-control nw420" rows="3"  value="#{plantHome.instance.stem}" /></td>
                                </tr>
                            </table>
                        </div>
                         <div class="all_da all_w01" style="width:724px;">
                        	<table>
                                <tr>
                                    <td class="all_te">叶：</td>
                                    <td  colspan="3"><h:inputTextarea id="leaf"  styleClass="form-control nw420" rows="3"  value="#{plantHome.instance.leaf}" /></td>
                                </tr>
                            </table>
                        </div>
                         <div class="all_da all_w01" style="width:724px;">
                        	<table>
                                <tr>
                                    <td class="all_te">花：</td>
                                    <td  colspan="3"><h:inputTextarea id="flower"  styleClass="form-control nw420" rows="3"  value="#{plantHome.instance.flower}" /></td>
                                </tr>
                            </table>
                        </div>
                         <div class="all_da all_w01" style="width:724px;">
                        	<table>
                                <tr>
                                    <td class="all_te">种子：</td>
                                    <td  colspan="3"><h:inputTextarea id="seed"  styleClass="form-control nw420" rows="3"  value="#{plantHome.instance.seed}" /></td>
                                </tr>
                            </table>
                        </div>
                         <div class="all_da all_w01" style="width:724px;">
                        	<table>
                                <tr>
                                    <td class="all_te">果实：</td>
                                    <td  colspan="3"><h:inputTextarea id="fruit"  styleClass="form-control nw420" rows="3"  value="#{plantHome.instance.fruit}" /></td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="all_da all_w01" style="width:724px;">
                        	<table>
                                <tr>
                                    <td class="all_te">描述：</td>
                                    <td colspan="3"><h:inputTextarea id="description"  styleClass="form-control nw420" rows="3"  value="#{plantHome.instance.description}"  /></td>
                                </tr>
                            </table>
                        </div>
                        <div class="clear"></div>
                   </div>
                         <table width="180" style="margin:35px auto 0 auto;">
						<tr>
							<td>
								<h:commandButton id="persist1" style="float:left;" value="下一步" styleClass="btn btn-primary" action="#{plantHome.savePlant}"  onclick="return checkSubmit()"/>
		    			        &#160;<s:button view="/model/ModelInfoOne.xhtml" value="返回" styleClass="btn btn-default" id="bn_left6" style="margin-left:10px" />
                            </td>
						</tr>
                   </table> 

				<!--入库订单列表结束-->
                    <div class="clear"></div>
                </div><!--right_c结束-->
                <div class="clear"></div>
    <!--右边结束-->
    
    </h:form>
    <!-- 排序管理模态框 -->
<div class="modal fade" id="SortModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<div class=" pano_dialog sort_dialog">
<div class="modal-content">
    <div class="modal-header clear">
        <h4 class="modal-title fl">排序图片</h4>
        <i class="i_close" data-dismiss="modal"></i>
    </div>
    <div class="modal-body modal_body">
    
        <!--<div id="messageValue"></div>-->
        <div class="sp_px">
        <div class="ordering-list select-list" tabindex="-1">
            <div class="content with-handle">
                <div class="scroll-box">
                	
                    <ol id="list_dragselect" class="list ui-sortable ui-selectable">
                    	<rich:panel id="croppanelpx" style="margin:0; border:none; padding: 0;">
	                    	<a:repeat value="#{plantHome.outputsList}" var="_outputs"  rowKeyVar="_index">
	                        	<li class="ui-selectee" data-key="7"><p class="croppx" ind="#{_index}">#{_outputs[0]}</p><input type="hidden" value="4084_1_6" id="parIdObj_7" class="testClass"/></li>
                        	</a:repeat>
                        </rich:panel>
                    </ol>
                    
                </div>
            </div>
        </div>
        </div>
        
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary"  onclick="picSort()">确定</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">返回</button>
    </div>
</div>
</div>
</div>
        </td> 
    <a:form>
		<a:jsFunction name="addCropByIndex" action="#{plantHome.addCropByIndex()}"   reRender="croppanel"  oncomplete="initselect()">
			<a:actionparam name="outputIndex" assignTo="#{plantHome.outputIndex}"/>
			<a:actionparam name="cropsjson" assignTo="#{plantHome.cropsjson}"/>
			<a:actionparam name="imgDataJson" assignTo="#{plantHome.imgDataJson}"/>
		</a:jsFunction>
		<a:jsFunction name="delCropByIndex" action="#{plantHome.delCropByIndex()}"   reRender="user:croppanel"  oncomplete="initselect()">
			<a:actionparam name="outputIndex" assignTo="#{plantHome.outputIndex}"/>
			<a:actionparam name="cropsjson" assignTo="#{plantHome.cropsjson}"/>
			<a:actionparam name="imgDataJson" assignTo="#{plantHome.imgDataJson}"/>
		</a:jsFunction>
		<a:jsFunction name="setCropValueByIndex" action="#{plantHome.setCropValueByIndex()}"   reRender="croppanel"  oncomplete="initselect()">
			<a:actionparam name="outputIndex" assignTo="#{plantHome.outputIndex}"/>
			<a:actionparam name="cropCol" assignTo="#{plantHome.cropCol}"/>
			<a:actionparam name="cropValue" assignTo="#{plantHome.cropValue}"/>
		</a:jsFunction>
		<a:jsFunction name="sortModal" action="#{plantHome.sortModal()}"   reRender="croppanelpx"  oncomplete="showpxcomplete()">
			<a:actionparam name="cropsjson" assignTo="#{plantHome.cropsjson}"/>
		</a:jsFunction>
		<a:jsFunction name="corpSort" action="#{plantHome.corpSort()}"    reRender="croppanel" oncomplete="picSortcomplete()">
			<a:actionparam name="cropindex" assignTo="#{plantHome.cropindex}"/>
		</a:jsFunction>
	</a:form>
	<script type="text/javascript" src="#{request.contextPath}/asset/js/richwidgets-demo.min.js"></script> 
<script type="text/javascript">
//<![CDATA[
           
	 		jQuery(function(){
	 			//(11)dragSelect,js需要在其他控件之上
		 		 jQuery('#list_dragselect').orderingList({
		 			dragSelect: true
		 		});
		 		jQuery(".btn-first").text("置顶");
		 		jQuery(".btn-up").text("向上");
		 		jQuery(".btn-down").text("向下");
		 		jQuery(".btn-last").text("置底"); 
	 		});
var promptMessage = "#{plantHome.promptMessage}";
if(promptMessage != ""){
	document.getElementById("spanValue").innerHTML = promptMessage;
	jquery("#myModal").modal('show');
}
function trim(str){
   	return str.replace(/(^\s+)|\s+$/g,"");
 }
function checkSubmit(){
	if(jquery('#parnetIdItem').val()==-1){
		alert("请选择类型！")
		return false;
		}
   jquery('#user\\:fId').val(jquery('#parnetIdItem').val());
   var a1 =  document.getElementById("user:name").value;
   if(trim(a1) == ""){
	   document.getElementById("spanValue").innerHTML = "种类名称不能为空";
	   jquery("#myModal").modal('show');return false;
   }
   nextCheck();
}
function closeMethod(){
	var a1 =  document.getElementById("user:name");
    if(a1.value==""){
   		a1.focus();
   }
}
function previewImage(file){
	 if(!/\.(gif|jpg|jpeg|bmp|GIF|JPG)$/.test(file.value))
     {
       alert("图片类型必须是.gif,jpeg,jpg中的一种")
       return false;
     }

}

//添加产出品
function addCrop(index){
	jquery("#login").show();
	var json = getValueCropList();
	var map = jquery("#user\\:imgDataJson").val();
	addCropByIndex(index,json,map);
}
//删除产出品
function delCrop(index){
	var json = getValueCropList();
	var map = jquery("#user\\:imgDataJson").val();
	delCropByIndex(index,json,map);
}
//产出品回调
function initselect(){
	jquery('.selectpicker').selectpicker();
	setValueCrop();
}

//产出品列表赋值
function setValueCrop(){
	jquery("tr[name='croptr']").each(function(i){
		var cropsite = jquery("#cropSite"+i).val();
		var cropimgname = jquery("#cropImgName"+i).val();
		if(cropsite.indexOf(',') >= 0){
			var cropsiteArr = cropsite.split(",")
			jquery("#crop"+i).selectpicker("val",cropsiteArr)
		}else{
			jquery("#crop"+i).selectpicker("val",cropsite)
		}
	});
	 setTimeout('jquery("#login").hide()', 800);
}
//获取产出品列表值
function getValueCropList(){
	var json = '{"cropsList":[';
	jquery("tr[name='croptr']").each(function(i){
		var cropid = jquery("#cropid"+i).val();
		var cropname = jquery("#cropName"+i).val().trim();
		var cropsite = jquery("#crop"+i).val();
		var cropimgname = jquery("#cropImgName"+i).text();
		var cropDate = jquery("#cropDate"+i).val();
		json += '{"cropid":';
		if(cropid == ''){
			json += '"","cropname":'
		}else{
			json += '"' + cropid +'","cropname":'
		}
		if(cropname == ''){
			json += '"","cropsite":'
		}else{
			json +='"' + cropname + '","cropsite":'
		}
		if(cropsite == ''){
			json += '"","cropimgname":'
		}else{
			json +='"' + cropsite + '","cropimgname":'
		}
		if(cropimgname == '' || cropimgname == undefined){
			json += '"","cropDate":'
		}else{
			json += '"' + cropimgname + '","cropDate":'
		}
		if(cropDate == '' || cropDate == undefined){
			json += '""},';
		}else{
			json += '"' + cropDate + '"},';
		}
	});
	json = json.substring(0,json.length-1);
	json += "]}";
	return json;
}

//下一步  cropsjsonhidden
function nextCheck(){
	var json = getValueCropList();
	jquery("#user\\:cropsjsonhidden").val(json);
}

//弹出提示信息
function showMesg(mesg){
		document.getElementById("spanValue").innerHTML = mesg;
		jquery("#myModal").modal('show');
}
//产出品名字不能重复
function checkCropName(index){
	var thisName = jquery("#cropName"+index).val();
	jquery("tr[name='croptr']").each(function(i){
    	if(i != index){
    		var cropimgname = jquery("#cropName"+i).val();
			if(cropimgname == thisName){
				jquery("#cropName"+index).val("");
				jquery("#showMessage").html("已经存在同名的产出品");
	     		jquery("#showMessageDiv").modal('show');
			}
        }
	});
}

//排序弹出框
function showpx(){
	var json = getValueCropList();
	sortModal(json);
}
//排序弹出回调
function showpxcomplete(){
	jquery("#SortModal").modal('show');
}

//图片排序
function picSort(){
	var indexarr="";
	jquery("#list_dragselect").find(".croppx").each(function(){
		indexarr += $(this).attr("ind")+",";
	});
	if(indexarr != ""){
		indexarr = indexarr.substring(0,indexarr.length-1);
	}
	corpSort(indexarr);
}
//图片排序回调
function  picSortcomplete(){
	jquery("#SortModal").modal('hide');
	jquery('.selectpicker').selectpicker();
	setValueCrop();
}

//获取子页面对应iframe的id
function getId(f) {
    var frames = document.getElementsByTagName("iframe");
    for(var i=0;i<(frames.length);i++){ 
        if(frames[i].contentWindow == f){
            return (frames[i].id);
        }
    }
} 
//]]>
</script>

<script type="text/javascript">
			  window.onload = function () {
				  jquery('.aaa').attr("data-live-search","true");
			    jquery('.selectpicker').selectpicker();
			    
			  };
			</script>
        
	</ui:define>

</ui:composition>
