<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template_enterprise_new.xhtml">

	<ui:define name="body">
	<style>
	  .form-control{
			float:left;
		}
	.all_da{min-width: 430px;}
	.all_te{width: 100px;}
	.pb20{padding-top: 30px;}
	.fr{float:right;}
	.r_ulli1{float:right;}
	
	</style>
		<td valign="top">

									<!-- Modal -->
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal" class="modal fade in w600na" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="spanValue">*号部分为必填项！</span>
        
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
      </div>
    </div>
  </div>
</div>
				#{harmfulModelHome.wire()}
	<div class="right_c">
   		<h:form id="harmfulModelFrom" enctype="multipart/form-data">
  			<div class="r_title clear">
		        <div class="r_t_l" style="width:100%;">
		        	<font size="4" style="font-family:微软雅黑;">
		        		<strong>病害信息</strong>
		        	</font>
		        </div>
		    </div>
		    <div class="all_d3">
                    	<div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">名称：</td>
                                    <td>
                                       <h:inputText styleClass="form-control nw221" id="modelName" value="#{harmfulModelHome.instance.modelName}"></h:inputText>
                                       <span class="finput" style="color:#FF0000">*</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">图片：</td>
                                    <td>
		                             <s:fileUpload id="modelUpload" size="30"
										accept="image/png,image/jpeg,image/gif"
										contentType="image/png,image/jpeg,image/gif"
										fileName="#{harmfulModelHome.instance.imgUrlName}"
										data="#{harmfulModelHome.instance.imgData}">
									</s:fileUpload>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te" id="causeTd">病原：</td>
                                    <td>
                                      <h:inputTextarea styleClass="form-control" id="cause" rows="3" cols="60" size="30" value="#{harmfulModelHome.instance.cause}" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te" id="symptomTd">症状：</td>
                                    <td>
                                      <h:inputTextarea styleClass="form-control" id="symptom" rows="3" cols="60" size="30" value="#{harmfulModelHome.instance.symptom}" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te" id="attackCriteriaTd">发病条件：</td>
                                    <td>
                                      <h:inputTextarea styleClass="form-control" id="attackCriteria" rows="3" cols="60" size="30" value="#{harmfulModelHome.instance.attackCriteria}" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">农业防治：</td>
                                    <td>
                                      <h:inputTextarea styleClass="form-control" id="agricultureControl" rows="3" cols="60" size="30" value="#{harmfulModelHome.instance.agricultureControl}" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">物理防治：</td>
                                    <td>
                                      <h:inputTextarea styleClass="form-control" id="physicsControl" rows="3" cols="60" size="30" value="#{harmfulModelHome.instance.physicsControl}" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">生物防治：</td>
                                    <td>
                                      <h:inputTextarea styleClass="form-control" id="biologyControl" rows="3" cols="60" size="30" value="#{harmfulModelHome.instance.biologyControl}" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">化学防治：</td>
                                    <td>
                                      <h:inputTextarea styleClass="form-control" id="chemistryControl" rows="3" cols="60" size="30" value="#{harmfulModelHome.instance.chemistryControl}" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">有机防治：</td>
                                    <td>
                                      <h:inputTextarea styleClass="form-control" id="organicControl" rows="3" cols="60" size="30" value="#{harmfulModelHome.instance.organicControl}" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">病虫害类型：</td>
                                    <td>
                                       <h:selectOneMenu  class="selectpicker" id="type" value="#{harmfulModelHome.instance.type}" onchange="changeHarmfulType(this.value);">
							        		<f:selectItem itemLabel="病害" itemValue="1"/>
							        		<f:selectItem itemLabel="虫害" itemValue="2"/>
							        		<f:selectItem itemLabel="草害" itemValue="3"/>
							        	</h:selectOneMenu>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">病虫害损失率：</td>
                                    <td>
                                      <h:inputText styleClass="form-control nw221"  id="lossRatio" value="#{harmfulModelHome.instance.lossRatio}"></h:inputText>
                                    	<span class="finput">%</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">作物类型：</td>
                                    <td>
                                    
                                      <select id="floristicsId" class="selectpicker" onchange="changeFloristicId(this.value);" data-live-search="true" disabled="disabled">
		                                		<a:repeat value="#{harmfulModelHome.selectFloristicItems}" var="_floristics">
		                                			<option value="#{_floristics[0]}">#{_floristics[1]}</option>
		                                		</a:repeat>
		                                	</select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">作物类别：</td>
                                    <td>
                                      <h:panelGroup id="plantSelect">
								            	<h:selectOneMenu styleClass="selectpicker" id="communityId" style="width:146px;" value="#{harmfulModelHome.plantId}">
													<s:selectItems value="#{harmfulModelHome.plantList}" var="_plant" label="#{_plant.name}" itemValue="#{_plant.plantId}"/>
												</h:selectOneMenu>
								            </h:panelGroup>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
             </div>
   			<div class="r_title clear">
		        <div class="r_t_l" style="width:100%;">
		        	<font size="4" style="font-family:微软雅黑;">
		        		<strong>发育阶段易患病害管理</strong>
		        	</font>
		        </div>
		    </div>
		    <div class="pt30 pb30 font14">    
   				<table width="100%" cellpadding="0" cellspacing="0">
   					<tr>
   						<td width="50%">
		                    <div class="pb20">
		                        <table>
		                            <tr>
		                                <td valign="middle">
		                                	<rich:pickList id="plantPeriodSourceResult" value="#{harmfulModelHome.plantPeriodSourceResult}" sourceListWidth="200" listsHeight="200" targetListWidth="200" copyAllControlLabel="全部选择" removeAllControlLabel="全部清除" copyControlLabel="选择" removeControlLabel="清除" >
												<f:selectItems value="#{harmfulModelHome.plantPeriodTargetResult}"/> 
											</rich:pickList>
		                                </td> 
		                            </tr>
		                        </table>
		                    </div>
		                </td>
   					</tr>
   				</table>
	   		</div>
	   		<div class="r_title clear">
		        <div class="r_t_l" style="width:100%;">
		        	<font size="4" style="font-family:微软雅黑;">
		        		<strong>病害生长环境信息</strong>
		        	</font>
		        </div>
		    </div>
		    <div class="all_d3">
                    	<div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">最低温度：</td>
                                    <td>
                                       <h:inputText styleClass="form-control nw221" id="tempLower" value="#{harmfulModelHome.instance.tempLower}"></h:inputText>
                                       <span class="finput">℃</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">最高温度：</td>
                                    <td>
                                       <h:inputText styleClass="form-control nw221" id="tempUpper" value="#{harmfulModelHome.instance.tempUpper}"></h:inputText>
                                       <span class="finput">℃</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">最低湿度：</td>
                                    <td>
                                       <h:inputText styleClass="form-control nw221" id="humiLower" value="#{harmfulModelHome.instance.humiLower}"></h:inputText>
                                       <span class="finput">%</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">最高湿度：</td>
                                    <td>
                                       <h:inputText styleClass="form-control nw221" id="humiUpper" value="#{harmfulModelHome.instance.humiUpper}"></h:inputText>
                                       <span class="finput">%</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">爆发时间：</td>
                                    <td>
                                       <h:inputText styleClass="form-control nw221" id="eruptTime" value="#{harmfulModelHome.instance.eruptTime}"></h:inputText>
                                       <span class="finput">小时</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
             </div>
              <table width="180" style="margin:35px auto 0 auto;">
						<tr>
							<td>
							<h:inputHidden id="floristicIdHidden" value="#{harmfulModelHome.floristicId}" />
		                	
		                	<a href="#" class="btn btn-primary mr15"  onclick="return checkSubmit();">提交</a>
		                	<h:commandButton class="btn btn-primary mr15" value="提交"  action="#{harmfulModelHome.saveHarmful()}" disabled="#{!harmfulModelHome.wired}" style="display:none;" id="editHarmFulBtn"/>
		                	<s:button style="margin-left:10px;" id="cancel" styleClass="btn btn-default" value="返回" propagation="end" view="/model/ModelDetail.xhtml">
		                		<f:param name="plantPlantId" value="#{harmfulModelHome.plantId}" />
		                	</s:button>
                            </td>
						</tr>
                   </table> 
   		</h:form>
   	</div>
	<a:form>
		<a:queue requestDelay="100" ignoreDupResponses="true" id="mainQueue"/>
		<a:jsFunction eventsQueue="mainQueue" name="changeFloristicSelect" action="#{harmfulModelHome.changeFloristicSelect}" reRender="plantPeriodSourceResult,plantSelect" oncomplete="jquery('.selectpicker').selectpicker();">
			<a:actionparam name="floristicId" assignTo="#{harmfulModelHome.floristicId}"/>
		</a:jsFunction>
		<a:jsFunction eventsQueue="mainQueue" name="checkRepeatHarmful" action="#{harmfulModelHome.checkRepeatHarmful}" data="#{harmfulModelHome.messageStr}" oncomplete="checkRepeatCallBack(data);">
			<a:actionparam name="harmfulModelId" assignTo="#{harmfulModelHome.harmModel.harmfulModelId}"/>
			<a:actionparam name="modelName" assignTo="#{harmfulModelHome.harmModel.modelName}"/>
			<a:actionparam name="type" assignTo="#{harmfulModelHome.harmModel.type}"/>
			<a:actionparam name="floristicId" assignTo="#{harmfulModelHome.floristicId}"/>
		</a:jsFunction>
	</a:form>
	
	
   	<script type="text/javascript">
	//<![CDATA[
		jquery(function(){
			jquery('.selectpicker').selectpicker();	 
			//作物品种
			var floristicId = #{harmfulModelHome.floristicId};
			jquery("#floristicsId").val(floristicId);
			jquery("#floristicsId").selectpicker("refresh");
		});

		jquery(document).ready(function(){
			//验证用户名昵称等不能为空
			jquery("#harmfulModelFrom\\:modelName").blur(function(){
          	 	 if(this.value == ""){
          		 	 jquery("#showMessage").html("病害名称不能为空！");
	         		 jquery("#showMessageDiv").modal('show');
			     } 
		    }); 
			changeHarmfulType(jquery("#harmfulModelFrom\\:type").val());
		});
		var causeWords="病原";
		var symptomWords="症状";
		var attackCriteriaWords="发病条件";
		
		 function checkSubmit(){
			var modelId="#{harmfulModelHome.instance.harmfulModelId}";
			var floristicsId=jquery("#floristicsId").val();
			jquery("#harmfulModelFrom\\:floristicIdHidden").val(floristicsId);
			var modelName = jquery("#harmfulModelFrom\\:modelName").val();//病害名称
			var lossRatio = jquery("#harmfulModelFrom\\:lossRatio").val();//病害损失率
			var tempLower = jquery("#harmfulModelFrom\\:tempLower").val();//最低温度
			var tempUpper = jquery("#harmfulModelFrom\\:tempUpper").val();//最高温度
			var humiLower = jquery("#harmfulModelFrom\\:humiLower").val();//最低湿度
			var humiUpper = jquery("#harmfulModelFrom\\:humiUpper").val();//最高湿度
			var eruptTime = jquery("#harmfulModelFrom\\:eruptTime").val();//爆发时间
			var cause=jquery("#harmfulModelFrom\\:cause").val();//病原
			var symptom=jquery("#harmfulModelFrom\\:symptom").val();//症状	
			var attackCriteria=jquery("#harmfulModelFrom\\:attackCriteria").val();//发病条件
			var agricultureControl=jquery("#harmfulModelFrom\\:agricultureControl").val();//农业防治
			var physicsControl=jquery("#harmfulModelFrom\\:physicsControl").val();//物理防治
			var biologyControl=jquery("#harmfulModelFrom\\:biologyControl").val();//生物防治
			var chemistryControl=jquery("#harmfulModelFrom\\:chemistryControl").val();//化学防治
			var organicControl=jquery("#harmfulModelFrom\\:organicControl").val();//有机防治
			var type=jquery("#harmfulModelFrom\\:type").val();//有机防治
			
			if(modelName == ""){
				  document.getElementById("spanValue").innerHTML ="病害名称不能为空!";
	    		   jquery("#myModal").modal('show');return false;
				return false;
			}
			if(cause.length>500){
				document.getElementById("spanValue").innerHTML = causeWords+"字数不可大于500字!";
	    		jquery("#myModal").modal('show');return false;
				return false;
			}
			if(symptom.length>500){
				document.getElementById("spanValue").innerHTML = symptomWords+"字数不可大于500字!";
	    		jquery("#myModal").modal('show');return false;
				return false;
			}
			if(attackCriteria.length>500){
				document.getElementById("spanValue").innerHTML = attackCriteriaWords+"字数不可大于500字!";
	    		jquery("#myModal").modal('show');return false;
				return false;
			}
			if(agricultureControl.length>500){
				document.getElementById("spanValue").innerHTML = "农业防治字数不可大于500字!";
	    		jquery("#myModal").modal('show');return false;
				return false;
			}
			if(physicsControl.length>500){
				document.getElementById("spanValue").innerHTML = "物理防治字数不可大于500字!";
	    		jquery("#myModal").modal('show');return false;
				return false;
			}
			if(biologyControl.length>500){
				document.getElementById("spanValue").innerHTML = "生物防治字数不可大于500字!";
	    		jquery("#myModal").modal('show');return false;
				return false;
			}
			if(chemistryControl.length>500){
				document.getElementById("spanValue").innerHTML = "化学防治字数不可大于500字!";
	    		jquery("#myModal").modal('show');return false;
				return false;
			}
			if(organicControl.length>500){
				document.getElementById("spanValue").innerHTML = "有机防治字数不可大于500字!";
	    		jquery("#myModal").modal('show');return false;
				return false;
			}
			if(lossRatio != null && lossRatio != ""){
				if(isNaN(lossRatio) || lossRatio <0 ){
					document.getElementById("spanValue").innerHTML = "病害损失率必须为数字!";
		    		   jquery("#myModal").modal('show');return false;
				}  
			}
			if(tempLower != null && tempLower != ""){
				if(isNaN(tempLower) || tempLower <0 ){
					document.getElementById("spanValue").innerHTML = "最低温度必须为数字!";
		    		   jquery("#myModal").modal('show');return false;
				}  
			}
			if(tempUpper != null && tempUpper != ""){
				if(isNaN(tempUpper) || tempUpper <0 ){
					document.getElementById("spanValue").innerHTML = "最高温度必须为数字!";
		    		   jquery("#myModal").modal('show');return false;
				}else if(Number(tempUpper) <= Number(tempLower)){
					document.getElementById("spanValue").innerHTML = "最高温度必须大于最低温度!";
		    		   jquery("#myModal").modal('show');return false;
				}
			}
			if(humiLower != null && humiLower != ""){
				if(isNaN(humiLower) || humiLower <0 ){
					document.getElementById("spanValue").innerHTML = "最低湿度必须为数字!";
		    		   jquery("#myModal").modal('show');return false;
				}
			}
			if(humiUpper != null && humiUpper != ""){
				if(isNaN(humiUpper) || humiUpper <0 ){
					document.getElementById("spanValue").innerHTML = "最高湿度必须为数字!";
		    		   jquery("#myModal").modal('show');return false;
				}else if(Number(humiUpper) <= Number(humiLower)){
					document.getElementById("spanValue").innerHTML = "最高湿度必须大于最低湿度!";
		    		   jquery("#myModal").modal('show');return false;
				}
			}
			if(eruptTime != null && eruptTime != ""){
				if(isNaN(eruptTime) || eruptTime <0 ){
					document.getElementById("spanValue").innerHTML = "爆发时间必须为数字!";
		    		   jquery("#myModal").modal('show');return false;
				}
			}
			checkRepeatHarmful(modelId,modelName,type,floristicsId);
			return true;
		}
		//作物种类ID
		function changeFloristicId(id){
			changeFloristicSelect(Number(id));
		}

		function addFloristicId(){
			
		}
		function changeHarmfulType(type){
			if(type==2){
				jquery("#causeTd").html("形态特征：");
				jquery("#symptomTd").html("症状：");
				jquery("#attackCriteriaTd").html("发病条件：");
				causeWords="形态特征";
				symptomWords="症状";
				attackCriteriaWords="发病条件";
			}else if(type==3){
				jquery("#causeTd").html("形态特征：");
				jquery("#symptomTd").html("发生特点：");
				jquery("#attackCriteriaTd").html("危害情况：");
				causeWords="形态特征";
				symptomWords="发生特点";
				attackCriteriaWords="危害情况";
			}else{
				jquery("#causeTd").html("病原：");
				jquery("#symptomTd").html("症状：");
				jquery("#attackCriteriaTd").html("发病条件：");
				causeWords="病原";
				symptomWords="症状";
				attackCriteriaWords="发病条件";
			}
		}
		function checkRepeatCallBack(msg){			
			if(null!=msg && ""!=msg){
				document.getElementById("spanValue").innerHTML = msg;
	    		jquery("#myModal").modal('show');	    		   
			}else{
				jquery("#harmfulModelFrom\\:editHarmFulBtn").click();
			}
		}
	//]]>
	</script>
	</td>
	</ui:define>

</ui:composition>
