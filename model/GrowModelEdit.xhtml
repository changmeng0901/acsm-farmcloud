<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template_new.xhtml">

	<ui:define name="body">
	<style>
	  .form-control{
			float:left;
		}
	 .rich-calendar-button{
     margin-left:-8px
    }
    .all_44{margin-top: 20px;}
    .all_te{width: 100px;}
    .iptName132 {
    width: 100px;
    float:right;
    text-align: right;
}

	</style>
		<td valign="top">
									<!-- Modal -->
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal" class="modal fade in w600na" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="spanValue">*号部分为必填项！</span>
        
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
      </div>
    </div>
  </div>
</div>

				#{growModelHome.growModelInit()}
				<h:form id="growModelFrom" enctype="multipart/form-data">
                <div class="right_c">
                	<div class="r_title">
                    	<div class="r_t_l"><s:link propagation="none"  view="#{sessionTake.urlTemp}" style="text-decoration:none;color:black;" value="工作 ">
                    	</s:link>&#160;&gt;&#160;&#160;<font size="3">生长环境</font><rich:messages styleClass="messages"></rich:messages></div>
                    </div>
				<!--入库订单列表开始-->
                	<div style="margin-top: 30px;">
                        	<table>
                            	<tr>
                                	 <td>名称：</td>
                                    <td>
										<h:inputText styleClass="form-control nw221" id="modelName" value="#{growModelHome.modelName}"></h:inputText>
										<span class="finput" style="color:#FF0000">*</span>
                                    </td>
                            	</tr>
                            </table>
                   </div>
                   <s:div id="plantPeriodId">
	   			<a:repeat value="#{growModelHome.plantPeriodList}" var="_plantPeriodInfoId" rowKeyVar="_growModelIndex">
	   				<div id="plantPeriodInfoDiv#{_plantPeriodInfoId[0]}" class="pt30 pb30 font14">
	   					<h4>#{_plantPeriodInfoId[1]}</h4>  
						<ul class="nav nav-tabs" role="tablist" id="myTab">
							<a:repeat value="#{growModelHome.getrelustMapKeyList(_plantPeriodInfoId[0])}" var="_growEnv" rowKeyVar="_index">
								<li id="growEnvDiv#{_index + 1}" class="#{_index == 0 ? 'active':''}">
									<a href="#tab_pane#{_growModelIndex + 1}_#{_index + 1}" role="tab" data-toggle="tab">#{alarmTypeConstant.getType(_index + 1)} </a>
								</li>
							</a:repeat>
						</ul>
						<div class="tab-content" style="padding-top: 30px;">
							<a:repeat value="#{growModelHome.getrelustMapKeyList(_plantPeriodInfoId[0])}" var="_growEnv" rowKeyVar="_index2">
								<div class="tab-pane #{_index2 == 0 ? 'active':''}"  id="tab_pane#{_growModelIndex + 1}_#{_index2 + 1}">
									<table width="80%" cellpadding="0" cellspacing="0">
									<ui:fragment rendered="#{_index2!=8}">
		 								<tr>
		 									<td width="50%">
							                    <div class="pb20">
							                        <table>
							                            <tr>
							                                <td valign="middle"><span class="iptName132">适合最低值：</span></td>
						 									<td valign="middle">
						 										<input type="text" class="form-control nw221" id="suitLower_#{_plantPeriodInfoId[0]}_#{_index2 + 1}" onfocus="hiddenButton();" onblur="showButton();" onchange="changeInputValue(this.id,this.value);" />
						 									</td>
						 									<td valign="middle">
						 										<s:fragment rendered="#{_index2 + 1 == 1 || _index2 + 1 == 3}">
						 											<font style="margin-left: 3px;">℃</font>
						 										</s:fragment>
						 										<s:fragment rendered="#{_index2 + 1 == 2 || _index2 + 1 == 4}">
						 											<font style="margin-left: 3px;">%</font>
						 										</s:fragment>
						 										<s:fragment rendered="#{_index2 + 1 == 5}">
						 											<font style="margin-left: 3px;">PPM</font>
						 										</s:fragment>
						 										<s:fragment rendered="#{_index2 + 1 == 6}">
						 											<font style="margin-left: 3px;">LUX</font>
						 										</s:fragment>
						 										<s:fragment rendered="#{_index2 + 1 == 8}">
						 											<font style="margin-left: 3px;">ms/cm</font>
						 										</s:fragment>
						 									</td>
							                            </tr>
							                        </table>
							                    </div>
							                </td>
							                <td width="50%">
							                    <div class="pb20">
							                        <table>
							                            <tr>
							                                <td valign="middle"><span class="iptName132">适合最高值：</span></td>
						 									<td valign="middle">
						 										<input type="text" class="form-control nw221" id="suitUpper_#{_plantPeriodInfoId[0]}_#{_index2 + 1}" onfocus="hiddenButton();" onblur="showButton();" onchange="changeInputValue(this.id,this.value);" />
						 									</td>
						 									<td valign="middle">
						 										<s:fragment rendered="#{_index2 + 1 == 1 || _index2 + 1 == 3}">
						 											<font style="margin-left: 3px;">℃</font>
						 										</s:fragment>
						 										<s:fragment rendered="#{_index2 + 1 == 2 || _index2 + 1 == 4}">
						 											<font style="margin-left: 3px;">%</font>
						 										</s:fragment>
						 										<s:fragment rendered="#{_index2 + 1 == 5}">
						 											<font style="margin-left: 3px;">PPM</font>
						 										</s:fragment>
						 										<s:fragment rendered="#{_index2 + 1 == 6}">
						 											<font style="margin-left: 3px;">LUX</font>
						 										</s:fragment>
						 										<s:fragment rendered="#{_index2 + 1 == 8}">
						 											<font style="margin-left: 3px;">ms/cm</font>
						 										</s:fragment>
						 									</td>
							                            </tr>
							                        </table>
							                    </div>
							                </td>
		 								</tr>
		 								<tr>
	 									<td width="50%">
						                    <div class="pb20">
						                        <table>
						                            <tr>
						                                <td valign="middle"><span class="iptName132">告警最低值：</span></td>
					 									<td valign="middle">
					 										<input type="text" class="form-control nw221" id="alarmLower_#{_plantPeriodInfoId[0]}_#{_index2 + 1}" onfocus="hiddenButton();" onblur="showButton();" onchange="changeInputValue(this.id,this.value);" />
					 									</td>
					 									<td valign="middle">
					 										<s:fragment rendered="#{_index2 + 1 == 1 || _index2 + 1 == 3}">
					 											<font style="margin-left: 3px;">℃</font>
					 										</s:fragment>
					 										<s:fragment rendered="#{_index2 + 1 == 2 || _index2 + 1 == 4}">
					 											<font style="margin-left: 3px;">%</font>
					 										</s:fragment>
					 										<s:fragment rendered="#{_index2 + 1 == 5}">
					 											<font style="margin-left: 3px;">PPM</font>
					 										</s:fragment>
					 										<s:fragment rendered="#{_index2 + 1 == 6}">
					 											<font style="margin-left: 3px;">LUX</font>
					 										</s:fragment>
					 										<s:fragment rendered="#{_index2 + 1 == 8}">
					 											<font style="margin-left: 3px;">ms/cm</font>
					 										</s:fragment>
					 									</td>
						                            </tr>
						                        </table>
						                    </div>
						                </td>
						                <td width="50%">
						                    <div class="pb20">
						                        <table>
						                            <tr>
						                                <td valign="middle"><span class="iptName132">告警最高值：</span></td>
					 									<td valign="middle">
					 										<input type="text" class="form-control nw221" id="alarmUpper_#{_plantPeriodInfoId[0]}_#{_index2 + 1}" onfocus="hiddenButton();" onblur="showButton();" onchange="changeInputValue(this.id,this.value);" />
					 									</td>
					 									<td valign="middle">
					 										<s:fragment rendered="#{_index2 + 1 == 1 ||  _index2 + 1 == 3}">
					 											<font style="margin-left: 3px;">℃</font>
					 										</s:fragment>
					 										<s:fragment rendered="#{_index2 + 1 == 2 || _index2 + 1 == 4}">
					 											<font style="margin-left: 3px;">%</font>
					 										</s:fragment>
					 										<s:fragment rendered="#{_index2 + 1 == 5}">
					 											<font style="margin-left: 3px;">PPM</font>
					 										</s:fragment>
					 										<s:fragment rendered="#{_index2 + 1 == 6}">
					 											<font style="margin-left: 3px;">LUX</font>
					 										</s:fragment>
					 										<s:fragment rendered="#{_index2 + 1 == 8}">
					 											<font style="margin-left: 3px;">ms/cm</font>
					 										</s:fragment>
					 									</td>
						                            </tr>
						                        </table>
						                    </div>
						                </td>
	 								</tr>
	 								<tr>
	 									<td width="50%">
						                    <div class="pb20">
						                        <table>
						                            <tr>
						                                <td valign="middle"><span class="iptName132">告警最低消息：</span></td>
					 									<td valign="middle">
						                                	<select id="alarmLowerInfoId_#{_plantPeriodInfoId[0]}_#{_index2 + 1}" class="selectpicker" onchange="changeInputValue(this.id,this.value);">
						                                		<a:repeat value="#{growModelHome.alarmLowerListFind()}" var="_lower">
																	<option value="#{_lower[0]}">#{alarmTypeConstant.getType(_lower[1])}#{alarmTypeConstant.getAlarmType(_lower[2])}</option>
																</a:repeat>
						                                	</select>
					 									</td>
						                            </tr>
						                        </table>
						                    </div>
						                </td>
						                <td width="50%">
						                    <div class="pb20">
						                        <table>
						                            <tr>
						                                <td valign="middle"><span class="iptName132">告警最高消息：</span></td>
					 									<td valign="middle">
						                                	<select id="alarmUpperInfoId_#{_plantPeriodInfoId[0]}_#{_index2 + 1}" class="selectpicker" onchange="changeInputValue(this.id,this.value);">
						                                		<a:repeat value="#{growModelHome.alarmUpperListFind()}" var="_upper">
																	<option value="#{_upper[0]}">#{alarmTypeConstant.getType(_upper[1])}#{alarmTypeConstant.getAlarmType(_upper[2])}</option>
																</a:repeat>
						                                	</select>
					 									</td>
						                            </tr>
						                        </table>
						                    </div>
						                </td>
	 								</tr>
	 								</ui:fragment>
	 								<ui:fragment rendered="#{_index2==8}">
	 								<tr>
		 									<td width="50%">
							                    <div class="pb20">
							                        <table>
							                            <tr>
							                                <td valign="middle"><span class="iptName132" style="width:160px;">适合降水量（平均值）：</span></td>
						 									<td valign="middle">
						 										<input type="text" class="form-control nw221" id="rainfallCapacity_#{_plantPeriodInfoId[0]}_#{_index2 + 1}" onfocus="hiddenButton();" onblur="showButton();" onchange="changeInputValue(this.id,this.value);" />
						 									</td>
						 									<td valign="middle">
					 											<font style="margin-left: 3px;">mm</font>
						 									</td>
							                            </tr>
							                        </table>
							                    </div>
							                </td>
		 								</tr>
		 								</ui:fragment>
		 							</table>
								</div>
							</a:repeat>
						</div>
	   				</div>
	   			</a:repeat>
   			</s:div>
   			<h:inputHidden id="floristicIdHidden" value="#{growModelHome.floristicId}" />
		                	<h:inputHidden id="plantIdHidden" value="#{growModelHome.plantId}" />
		                	<h:inputHidden id="breedIdHidden" value="#{growModelHome.breedId}" />
                         <table style="margin:35px auto 0 auto;width:200px;">
						<tr>
							<td>
		    			    <h:commandButton id="save" class="btn btn-primary" value="提交" onclick="return submitResult();" action="#{growModelHome.saveModel}"/>
		                	<s:button id="cancel" styleClass="btn btn-default" value="返回" style="margin-left:10px;" propagation="end" view="#{growModelHome.reflag==0 ?'/model/ModelDetail.xhtml':'/model/ModelInfoTwo.xhtml'}">
		                		<f:param name="plantPlantId" value="#{growModelHome.plantId}" />
		                		<f:param name="breedId" value="#{growModelHome.breedId}" />
		                	</s:button>
                            </td>
                            
						</tr>
                   </table> 

				<!--入库订单列表结束-->
                    <div class="clear"></div>
                </div><!--right_c结束-->
                <div class="clear"></div>
    <!--右边结束-->
    </h:form>
    <a:form>
		<a:queue requestDelay="100" ignoreDupResponses="true"/>
		<a:jsFunction name="changeGrowEnvFind" action="#{growModelHome.changeGrowEnvFind}">
			<a:actionparam name="modifyKey" assignTo="#{growModelHome.modifyKey}"/>
			<a:actionparam name="modifyValue" assignTo="#{growModelHome.modifyValue}"/>
		</a:jsFunction>
		<a:jsFunction name="findGrowModelAction" action="#{growModelHome.findGrowModelAction}">
			<a:actionparam name="breedId" assignTo="#{growModelHome.breedId}"/>
		</a:jsFunction>
	</a:form>
   	<script type="text/javascript" src="#{request.contextPath}/js/common-acsm.js"></script>  
	<script type="text/javascript" language="javascript">
	//<![CDATA[
		jQuery(function(){
			/* 下拉框js */
			jQuery('.selectpicker').selectpicker();	  

			/* tab切换 */
			jQuery('#myTab a:first').tab('show');

			jQuery("#growModelFrom\\:save,#growModelFrom\\:update").click(function(){
				var modelName = jQuery("#growModelFrom\\:modelName").val();
				if(modelName == ""){
               	     jQuery("#showMessage").html("模板名称不能为空！");
	         		 jQuery("#showMessageDiv").modal('show');
					 return false;
		        }
		    });
			
			var resultJson = #{growModelHome.resultJsonObject};
			
			jQuery("#plantId").empty();
			jQuery(resultJson.plantSelectItem).appendTo("#plantId");//添加下拉框的option 
			jQuery("#plantId").selectpicker("refresh");
			jQuery("#plantId").val(resultJson.selectPlantId);
			jQuery('#plantId').selectpicker('render');

			jQuery("#breedId").empty();
			jQuery(resultJson.breedSelectItem).appendTo("#breedId");//添加下拉框的option 
			jQuery("#breedId").selectpicker("refresh");
			jQuery("#breedId").val(resultJson.selectBreedId);
			jQuery('#breedId').selectpicker('render');

			if (resultJson.firstFlag == true) {
				jsonArray = resultJson.resultArray;
				for(i = 0; i < jsonArray.length; i++){
					var jsonData = jsonArray[i];
					var updateId = "_" + jsonData.plantPeriodId + "_" + jsonData.typeId;
					jQuery("#suitLower" + updateId).val(jsonData.suitLower);
					jQuery("#suitUpper" + updateId).val(jsonData.suitUpper);
					jQuery("#alarmUpper" + updateId).val(jsonData.alarmUpper);
					jQuery("#alarmLower" + updateId).val(jsonData.alarmLower);
					jQuery("#rainfallCapacity" + updateId).val(jsonData.rainfallCapacity);
					jQuery("#alarmUpperInfoId" + updateId).val(jsonData.alarmUpperInfoId);
					jQuery("#alarmLowerInfoId" + updateId).val(jsonData.alarmLowerInfoId);
					jQuery("#alarmUpperInfoId" + updateId).selectpicker("refresh");
					jQuery("#alarmLowerInfoId" + updateId).selectpicker("refresh");
				}
			}

			var modifyFlag = #{growModelHome.managed};
			if (modifyFlag == true) {
				jQuery("#floristicId").val(#{growModelHome.floristicId});
				jQuery('#floristicId').selectpicker('render');
			}
		});


		//刷新标签
		function onRefreshPlantTab(item){
			if(item.messageStr != ""){
				jQuery("#showMessage").html(item.messageStr);
       		    jQuery("#showMessageDiv").modal('show');
			}
			if (item != null && item != '') {
				jQuery("#plantId").empty();
				jQuery(item.plantSelectItem).appendTo("#plantId")//添加下拉框的option 
				jQuery("#plantId")[item.selectPlantId].selectedIndex = 0;
				jQuery(".selectpicker").selectpicker();
				jQuery("#plantId").selectpicker("refresh");

                //刷新品种列表
				jQuery("#breedId").empty();
				jQuery(item.breedSelectItem).appendTo("#breedId")//添加下拉框的option 
				jQuery("#breedId")[item.selectBreedId].selectedIndex = 0;
				jQuery(".selectpicker").selectpicker();
				jQuery("#breedId").selectpicker("refresh");
			}
 		}
 		

		//刷新标签
		function onRefreshBreedTab(item){
			if(item.messageStr != ""){
				jQuery("#showMessage").html(item.messageStr);
       		    jQuery("#showMessageDiv").modal('show');
			}
			if (item != null && item != '') {
				jQuery("#breedId").empty();
				jQuery(item.breedSelectItem).appendTo("#breedId")//添加下拉框的option 
				jQuery("#breedId")[item.selectBreedId].selectedIndex = 0;
				jQuery(".selectpicker").selectpicker();
				jQuery("#breedId").selectpicker("refresh");
			}
 		}

		
		//查询品种
 		function findGrowModel(breedId){
 			alert(breedId);
 			if(breedId != null && breedId != "")
 			findGrowModelAction(Number(breedId));
 		}
		function submitResult(){
			var model = jQuery("#growModelFrom\\:modelName").val();
			if(model == ""){
				document.getElementById("spanValue").innerHTML = "名称不能为空";
	    		   jquery("#myModal").modal('show');return false;
			}
			return true;
		}

		
 		function changeInputValue(modifyKey,modifyValue){
 			changeGrowEnvFind(modifyKey,modifyValue);
 	 	}

 	 	function hiddenButton(){
			jQuery("#growModelFrom\\:save").attr("disabled", true);
 	 	}

 	 	function showButton(){
 	 		jQuery("#growModelFrom\\:save").attr("disabled", false);
 	 	}
	//]]>
	</script>
            </td> 
	</ui:define>

</ui:composition>
