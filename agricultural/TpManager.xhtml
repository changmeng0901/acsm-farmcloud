<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	template="/layout/template_left.xhtml">
	<ui:define name="head">
	<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/base.css"/>
	<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/FarmingManage.css"/>
	<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/skinBlue.css"/>	
	
	</ui:define>
	<ui:define name="body">
	<!--右边开始-->
            <td valign="top">
  <style>
  body{
  font-size:14px;
  }
 .list_frozen {background: url(#{request.contextPath}/asset/images/frozen_show.png) no-repeat; cursor: pointer; display: inline-block; height: 15px; width: 16px;}
  .r_t #topModel{width:600px;}
  .r_t #topModel .modal-dialog{ width:600px;}
  .glyphicon-ok:before{ content:normal;}
  .borderBt{ border-bottom:2px solid #33aedc;}
  .nstupian_div,.tourupin_div{padding-left:15px;}
  .nstupian_div img,.tourupin_div .img{ float:left; width:128px; margin:0 10px 10px 0;}
  .tourupin_div p{ margin:0; height:40px; line-height: 20px; overflow:hidden; text-align:center;}
  
  .designEdit1 {background: #3e97eb;border: 1px solid #206fbc;display: none;height: 19px;overflow: hidden;padding: 4px 0;position: absolute; right:0; top:0;z-index: 3;}
  .designEdit1 a {cursor: pointer;float: right;height: 14px;padding: 2px 6px 3px 10px; width: 17px;}
  .designEdit1 img {height: 14px;width: 17px;}
  .designEdit1 .designBj {border-right: 1px solid #8abff5;}
  .designEdit1 .designDlt {}
  
  .btn-group .btn {border-radius: 4px; display: inline-block; padding: 6px 3px;}

.farmingMageTab td { background: #f8f8f8 none repeat scroll 0 0;border-bottom: 1px solid #eee; padding: 8px 5px;vertical-align: top;}
.MagnifierBox{position: relative;}
  .MagnifierBox .mask{position: absolute; left:0; bottom:0; width:100%; height:auto; z-index:2000; background:url(#{request.contextPath}/asset/images/archive/mask.png) repeat; box-sizing:border-box; padding:5px; line-height:24px;  color: #fff; border-radius:0 0 5px 5px;}
   .farmPics{float: left; max-width:560px;}
   .farmRecord {width: 830px;top: 65px;margin-left: -415px;color: #333;}
   .jl .bootstrap-select.btn-group .dropdown-menu.inner{height:280px;}
  </style>
  <link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/agricultural/easyFarm.css" />
            <script src="#{request.contextPath}/asset/new/bootstrap-popver.js"></script>
	<script type="text/javascript" src="#{request.contextPath}/asset/js/checkBox/icheck.js"></script>
	<script src="#{request.contextPath}/asset/js/jquery.lazyloadxt.js"></script>
	
            #{tpOperateHome.mainList()}
            <div style="width:100%;">
                <div class="right_c clear">
                
                	<!-- 公用头部 开始 -->
                	 <div class="r_title clear"><!-- <span>农事管理分析</span><em>&gt;</em> -->
		                <div class="r_t_l fl"><font size="3">透明管理</font></div>
		                
		                <a4j:form>
			            <s:div styleClass="fr all_select" style="margin-bottom:-1px;" rendered="#{sessionTake.levelId ge dataDicConstant.getUserLevelBase()}">
			            <input type="hidden" value="#{tpOperateHome.baseId}" class="base_Id"/>
			            </s:div>
			            
				           
			            </a4j:form>
		            </div>
					<!-- 公用头部 结束 -->
                    <!-- 农事管理内容 开始 -->
                    <table width="100%" cellpadding="0" cellspacing="0">
                    	<tr>
                    		
                        	<td width="" valign="top">
                        	 <a4j:form id="headid">
                        	 
                        	  <table cellpadding="0" cellspacing="0" style="float:left; margin-top:20px;">
	                        	<tbody>
	                            	<tr>
	                            	<td>日期选择：</td>
	                                	<td width="180">
	                                     <div class="input-append date form_datetime dt1" style="position:relative;" >
		                                	<input id="beginTime" size="26" type="text" readonly="readonly" value="#{tpOperateHome.beginTime}" style="height:34px;border-radius:0;" />
		                                	<span class="add-on" style="position:absolute; right:5px; top:10px;"><i class="icon-th" style="margin:0;"></i></span>
		                                	<h:inputHidden id="beginTimes" value="#{tpOperateHome.beginTime}" />
		                                 </div>
	                                    </td>
	                                    <td width="20" style="text-align:center;">—</td>
	                                    <td width="180">
	                                     <div class="input-append date form_datetime dt1" style="position:relative;"  >
	                                     
		                                	<input id="endTime" size="26" type="text" readonly="readonly" value="#{tpOperateHome.endTime}" style="height:34px;border-radius:0;"/>
		                                	<span class="add-on" style="position:absolute; right:5px; top:10px;"><i class="icon-th" style="margin:0;"></i></span>
		                                	<h:inputHidden id="endTimes" value="#{tpOperateHome.endTime}" />
		                                 </div> 
	                                    </td>
	                                    
	                                    <h:inputHidden  value="#{tpOperateHome.partitionId}" id="partitionId"/>
							            <h:inputHidden  value="#{tpOperateHome.plantId}" id="plantId"/>
							            <h:inputHidden  value="#{tpOperateHome.fiId}" id="fiId"/>
							            <h:inputHidden  value="#{tpOperateHome.arfId}" id="arfId"/>
							            <h:inputHidden  value="#{tpOperateHome.statId}" id="statId"/>
	                                    <td style="padding-left: 5px;"><h:commandButton id="search" onclick="if(!searchComit())return false" styleClass="btn btn-primary" value="搜索" action="/agricultural/TpManager.xhtml" style="height:34px;padding-left: 18px;"></h:commandButton></td>
	                                </tr>
	                            </tbody>
	                        </table> 
			         	   
			            	<h:inputHidden value="#{tpOperateHome.allId}" id="allId"/> 
                        	 <h:commandButton id="manyexport" styleClass="btn btn-primary" action="#{tpOperateHome.manyExportExcel()}" value="批量导出" onclick="if(!allexp())return false" style="float: right;height:34px;margin-top: 20px;">   
			            	 <h:commandButton id="manyexport2" styleClass="btn btn-default" action="#{tpOperateHome.imagesExport()}" value="导出图片" onclick="if(!allexp())return false" style="float: right;height:34px;margin-top: 20px;margin-right:5px;"/>   
		                </h:commandButton>
		                </a4j:form>
                            <div class="cm_resumeLt pr20 pt20 clear" style="min-width:500px;padding-right:0px;">
                            <!-- 农事管理内容 左侧 开始 -->
                                
                                <div class="cm_resumeLtBt clear"  >
	                                <div class="cm_resumeMore clearfix">
	                                 	<span style="padding-left: 5px;float:left;width:25px;margin: 8px auto;">
	                                 		<input type="checkbox" id="cheAll" name="iCheck"  />
	                                 	</span>
	                                    <span style="float:left;display:block;width:35%;">农事管理表</span>
	                                    <div style="float:right;">
		                                    <div style="min-width:500px;" id="searchSelect">
		                                    <!-- onchange="addM(1,this)" -->
			                                    <select style="display: none;" id="partitionIds" class="selectpicker" data-live-search="true" multiple="multiple"    title="区域">
		                                            <!--  <option value="-1">区域</option>  -->
		                                            <a4j:repeat value="#{tpOperateHome.areaList}" var="var">
		                                            	<option value="#{var.tunnelInfoId}">#{var.tunnelName}</option>
		                                            </a4j:repeat>
		                                        </select>
		                                        <!-- onchange="addM(2,this)" -->
		                                         <select style="display: none;" id="plantIds" class="selectpicker" data-live-search="true" multiple="multiple"  title="作物名称">
		                                            <!-- <option value="-1">作物名称</option> -->
		                                            <a4j:repeat value="#{tpOperateHome.allPlantList}" var="var">
		                                            <option value="#{var.plantId}">#{var.name}</option>
		                                            </a4j:repeat>
		                                        </select>
		                                       <!--  onchange="addM(3,this)" -->
		                                       <select style="display: none;" id="fiIds" class="selectpicker" data-live-search="true" multiple="multiple"  title="操作人">
		                                           <!--  <option value="-1">操作人</option> -->
		                                           <a4j:repeat value="#{tpOperateHome.farmerInfoList}" var="var">
		                                           <option value="#{var[0]}">#{var[1]}</option>
		                                           </a4j:repeat>
		                                       </select>
		                                       <!-- onchange="addM(4,this)" -->
		                                        <select style="display: none;" id="arfIds" class="selectpicker" data-live-search="true" multiple="multiple"  title="操作内容">
		                                            <!-- <option value="-1">操作内容</option>  -->
		                                           <a4j:repeat value="#{tpOperateHome.amRfidInfoList}" var="var">
		                                           <option value="#{var.id}">#{var.name}</option>
		                                           </a4j:repeat>
		                                       </select>
		                                       
		                                       
		                                       <div class="btn-group" style="padding-right:12px;">
		                                         <input type="button" style="width:54px;background:none;" class="btn dropdown-toggle" value="审核状态" id="statIds" data-toggle="dropdown">
		                                         </input> <span class="caret" style="margin-top:13px;"></span>
		                                         <ul class="dropdown-menu" role="menu">
		                                          <li onclick="stat(2);"><a href="#">审核状态</a></li>
		                                           <li onclick="stat(1);"><a href="#">已审核</a></li>
		                                           <li onclick="stat(0);"><a href="#">未审核</a></li>
		                                         </ul>
		                                       </div>
			                                    
			                                    <span style="float:right;display:block;width:70px;text-align:center;">操作</span>
		                                    </div>
	                                    </div>
	                                   <!--  <span style="float:right;display:block;width:90px;text-align:center;">审核状态</span> -->
	                                       
	                                </div>
                                    <!-- 农事管理表表格1 开始 -->
                                    <a4j:outputPanel id="refreshList" style="display: block; border-right: 1px solid green;">
                                    <s:div styleClass="farming_nodata" rendered="#{empty tpOperateHome.objList}">
                                    	<div class="warning_noData">
                                        	<em>很遗憾，没有农事计划和记录</em>
                                            <p>完整的农事计划和记录可以帮助您有效进行人员管理，全程追溯农事内容，保证蔬菜安全放心，快来添加吧！</p>
                                        </div>
                                    </s:div>
                                    <h:panelGroup id="stateId" style="display: block;">
                                    <table width="100%" class="farmingMageTab" cellpadding="0" cellspacing="0" style="margin:0; float: left;">
                                        <tbody>
                                        <a4j:repeat var="var" value="#{tpOperateHome.objList}" rowKeyVar="_row">
                                        <ui:fragment rendered="#{var[19]==null}">
                                        <ui:fragment rendered="#{_row==0}">
                                        <tr >
                                        <td  colspan="5" class="cm_printDate clear" style="background-color: white;border-bottom: 1px solid #d8e6ec;color: #888;line-height: 18px;padding: 5px 10px;text-indent: 8px;">
                                        <img src="#{request.contextPath}/asset/images/cm_lsllIco02.png" />#{var[1]}<span style="padding-left:10px; ">#{var[18]}</span>
                                        </td>
                                        </tr>
                                        </ui:fragment>
                                        <ui:fragment rendered="#{(var[0] ne tpOperateHome.objList[_row-1][0] || var[18] ne tpOperateHome.objList[_row-1][18]) &amp;&amp; _row!=0 }">
                                        <tr >
                                        <td  colspan="5" class="cm_printDate clear" style="background-color: white;border-bottom: 1px solid #d8e6ec;color: #888;line-height: 18px;padding: 5px 10px;text-indent: 8px;">
                                        <img src="#{request.contextPath}/asset/images/cm_lsllIco02.png" />#{var[1]}<span style="padding-left:10px; ">#{var[18]}</span>
                                        </td>
                                        </tr>
                                        </ui:fragment>
                                            <tr>
	                                            <td style="padding-left: 5px;width: 1px">
													<input type="checkbox" id="cheOne" exid="#{var[13]}" name="iCheck"/>
					                            </td>
                                                <td valign="middle" width="45%">
                                                    <dl class="baseDl_jl">
                                                    	<dt>
	                                                    		<a style="cursor : pointer;" onclick="lockToView(#{_row})">
	                                                        	<f:param name="id" value="#{var[13]}"></f:param>
	                                                        	<span>#{var[2]}(#{var[3]})</span><strong>#{var[4]}</strong>
	                                                        	</a>
	                                                        	<ui:fragment rendered="#{var[6]==1||var[6]==null}">
	                                                        	<em class="bgBlue_jl">记录</em>
	                                                        	</ui:fragment>
	                                                        	<ui:fragment rendered="#{var[6]==3}">
	                                                        	<em class="bgPurple_jh">计划</em><em class="bgGreen_ywc">已完成</em>
	                                                        	</ui:fragment>
                                                        </dt>
                                                        <dd><span style="padding-left: 0px;"><h:panelGroup rendered="#{var[6]==1 || var[6]==null}">#{var[11]}发布</h:panelGroup></span><span style="padding-left:#{var[6]==1 || var[6]==null?'10px' :'0px'}">用时#{var[5]==null?2:var[5]}小时</span><span style="padding-left:10px">来自#{var[14]==null||var[14]==0||var[14]==1?"网站":""}#{var[14]==2?"手机":""}#{var[14]==3?"农事终端":""}#{var[14]==4?"系统推送":""}</span>
                                                        	<span style="padding-left:10px">添加人：#{var[14]==4?'系统':var[15]}</span>
                                                        </dd>
                                                    </dl>
                                                </td>
                                                <td width="">
                                                    <ul class="farmingMage_pics" style="width:auto">
                                                    <a4j:repeat value="#{var[7]}" var="_var">
                                                        <li>
                                                            <a href="javascript:;">
	                                                            <h:panelGroup rendered="#{_var.imgWidth==null || _var.imgHeight==null || _var.imgWidth=='' || _var.imgHeight==''}">
	                                                            	<img data-src="#{_var.pictureUrl}" class="lazyloadimg" wi="#{_var.imgWidth}" he="#{_var.imgHeight}"/>
	                                                            </h:panelGroup>
	                                                            <h:panelGroup rendered="#{_var.imgWidth!=null &amp;&amp; _var.imgHeight!=null &amp;&amp; _var.imgWidth!='' &amp;&amp; _var.imgHeight!=''}">
	                                                            	<h:panelGroup rendered="#{_var.minPictureUrl==null || _var.minPictureUrl==''}">
	                                                            		<img data-src="#{_var.pictureUrl}" class="lazyloadimg" wi="#{_var.imgWidth}" he="#{_var.imgHeight}"/>
	                                                            	</h:panelGroup>
	                                                            	<h:panelGroup rendered="#{_var.minPictureUrl!=null &amp;&amp; _var.minPictureUrl!=''}">
	                                                            		<img data-src="#{_var.minPictureUrl}" class="lazyloadimg" wi="#{_var.imgWidth}" he="#{_var.imgHeight}"/>
	                                                            	</h:panelGroup>
	                                                            </h:panelGroup>
                                                            </a>
                                                            <div class="farmingMage_Magnifier" style="z-index:1000">
                                                            	<em class="MagnifierClose" style="z-index: 1"><img src="#{request.contextPath}/asset/images/farmingIco05.png" width="28" height="28" /></em>
                                                                <div class="MagnifierBox"><img   id="zoomId" sr="#{_var.pictureUrl}"/>
                                                                <div class="mask">
                                                                <h:panelGroup rendered="#{_var.dateTime !=null}">
                                                               		<div class="fl mr20"><span> 拍摄时间：</span><span>#{_var.dateTime}</span></div>
                                                                </h:panelGroup>
                                                               	<h:panelGroup rendered="#{_var.model !=null}">
                                                               		<div class="fl mr20"><span>相机：</span><span>#{_var.model}</span></div>
                                                               	</h:panelGroup>
                                                               	<h:panelGroup rendered="#{_var.fnumber !=null}">
                                                               		<div class="fl mr20"><span>光圈：</span><span>#{_var.fnumber}</span></div>
                                                               	</h:panelGroup>
                                                               	<h:panelGroup rendered="#{_var.lensModel !=null}">
                                                               		<div class="fl mr20"><span>镜头：</span><span>#{_var.lensModel}</span></div>
                                                               	</h:panelGroup>
                                                               	<h:panelGroup rendered="#{_var.focalLength !=null}">
                                                               		<div class="fl mr20"><span> 焦距：</span><span>#{_var.focalLength}</span></div>
                                                               	</h:panelGroup>
                                                               	<h:panelGroup rendered="#{_var.iso !=null}">
                                                               	 	<div class="fl mr20"><span>ISO：</span><span>#{_var.iso}</span></div>
                                                               	</h:panelGroup>
                                                               	<h:panelGroup rendered="#{_var.exposureTime !=null}">
                                                               		<div class="fl mr20"><span>曝光时间：</span><span>#{_var.exposureTime}</span></div>
                                                               	</h:panelGroup>
                                                               		<h:panelGroup rendered="#{_var.longitude !=null &amp;&amp; _var.longitude !=(null) &amp;&amp; _var.longitude !=''}">
                                                               	<div class="fl mr20"><span>经度：</span><span>#{_var.longitude}</span></div>
                                                               	</h:panelGroup>
                                                               	<h:panelGroup rendered="#{_var.latitude !=null &amp;&amp; _var.latitude !=(null) &amp;&amp; _var.latitude !=''}">
                                                               		<div class="fl mr20"><span>纬度：</span><span>#{_var.latitude}</span></div>
                                                               	</h:panelGroup>
                                                                </div>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </a4j:repeat>    
                                                    </ul>
                                                </td>
                                                <td width="90" style="text-align:center;">
                                                
                                               		<ui:fragment rendered="#{var[16]}">
                                               			<span style="color:#00DD00;" >已审核</span>
                                               		</ui:fragment>
                                               		<ui:fragment rendered="#{!var[16]}">
                                               			<span style="color:#FF3333;">未审核</span>
                                               		</ui:fragment>
                                                
                                                </td>
                                                <td width="70" style="text-align:center;">
                                                	<a class="list_frozen"  title="#{var[16]?'取消审核':'审核'}" onclick="changeAuditstate(#{var[13]},#{var[16]})" href="#"/> 
	                              					<ui:fragment rendered="#{!var[16]}">
                                               			<a class="list_edit" title="编辑"  onclick="editToView(#{var[13]})"/>
                                               		</ui:fragment>
	                              					<s:link propagation="none"  style="text-decoration: none;" view="/agricultural/TpManager.xhtml"  action="#{tpOperateHome.aloneExportExcel}" title="导出" >
						                                <img style="vertical-align:top;" src="#{request.contextPath}/asset/images/dc_.png" ></img>
						                                	<f:param name="idMy" value="#{var[13]}"/>
													</s:link>
                                                </td>
                                            </tr>
                                            </ui:fragment>
                                            </a4j:repeat>
                                        </tbody>
                                    </table>
                                    </h:panelGroup>
                                    </a4j:outputPanel>
                                    <!-- 农事管理表表格2 结束 -->
                                </div>
                                <!-- 分页 开始 -->
                                <a4j:outputPanel id="refreshPage">
                                <table style="height:30px; margin:40px auto 0 auto;" cellpadding="0" cellspacing="0">
                    	<tr>
                    	<ui:fragment rendered="#{not empty tpOperateHome.objList}">
			                <ui:fragment rendered="#{!tpOperateHome.previousExists }">
			                <td><img src="#{request.contextPath}/asset/images/page_68.jpg" width="4" height="30" /></td>
			                </ui:fragment>
			                 <ui:fragment rendered="#{tpOperateHome.previousExists }">
			                <td><img src="#{request.contextPath}/asset/images/page_67.jpg" width="4" height="30" /></td>
			                </ui:fragment>
			                <ui:fragment rendered="#{tpOperateHome.previousExists }">
	                            <td class="td_t_b">
		                            <a href="#" onclick="jump(0);return false;">首页</a>
	                            </td>
	                            <td class="td_t_b td_t_t" style="padding:0; width:30px;">
		                            <a href="#" onclick="jump(#{tpOperateHome.previousFirstResult});return false;" class="no_n">
		                            	&lt;
		                            </a>
	                            </td>
	                        </ui:fragment>
					       <a4j:repeat var="_page" value="#{tpOperateHome.pageList}" rowKeyVar="_index">
								<td class="td_t_b #{tpOperateHome.previousExists or _index >0 ?'td_t_t':''} #{_page eq tpOperateHome.pageNum?'onp':''}">
									<a href="#" onclick="jump(#{_page});return false;">
										#{_page}
									</a>
								</td>
							</a4j:repeat>
							<ui:fragment rendered="#{tpOperateHome.nextExists}">
                            <td class="td_t_b td_t_t">
	                            <a href="#" class="no_d" onclick="jump(#{tpOperateHome.nextFirstResult});return false;">
	                            &gt;
	                            </a>
                            </td>
                            <td class="td_t_b td_t_t">
								 <a href="#" onclick="jump(#{tpOperateHome.PAGE_COUNT});return false;">
								 尾页
								 </a>
							</td>
							</ui:fragment>
							<td class="td_t_b td_t_t" style=" color:#9a9a9c;">共#{tpOperateHome.PAGE_COUNT}页</td>
                            <td ><img src="#{request.contextPath}/asset/images/page_70.jpg" width="4" height="30" /></td>
                            </ui:fragment>
                    	</tr>
                    </table>
                    </a4j:outputPanel>
                                <!-- 分页 结束 -->
                            <!-- 农事管理内容 左侧 结束 -->
                            </div>
                            </td>
                         
                        </tr>
                    </table>
                    <!-- 农事管理内容 结束 -->
					
                </div><!--right_c结束-->
            </div>
            <h:form id="fy">
            <input type="hidden" value="#{tpOperateHome.pageNum}" id="pageNum" name="pageNum"/>
            <input type="hidden" value="#{tpOperateHome.baseId}" id="baseId" name="baseId"/>
            <h:inputHidden  value="#{tpOperateHome.allId}" id="allId"/>
            <h:commandButton value="" action="/agricultural/TpManager.xhtml" styleClass="but_" style="display:none"/>
            </h:form>
            <div></div>
            
            
                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                              <h:panelGroup id="loadId">
                    <div class="modal-dialog" id="addJilu" style="width:795px;">
                    	<div class="modal-content">
                           <div class="modal-header">
                           <input type="button" class="close" data-dismiss="modal"> </input>
                           <h4 class="modal-title font14" id="myModalLabel">农事记录</h4>
                           </div>
                              <div class="modal-body" style="padding-bottom:0; padding-left:20px;">
                              <a4j:repeat var="var_" value="#{tpOperateHome.loadList}" rowKeyVar="row">
                             		<table class="farmingMageTab_jl" width="100%" cellpadding="0" cellspacing="0">
                             		<tr>
                             			<td style="padding-right:15px;" colspan="2"><img src="#{request.contextPath}/asset/images/farmingIco26.png" /><span style="padding-left: 5px;">操作人</span>：#{var_[0]}</td>
                             		</tr>
                             		<tr>
                             			<td colspan="2" ><img src="#{request.contextPath}/asset/images/farmingIco21.png"/><span style="padding-left: 5px;">#{var_[1]}</span><span style="padding-left: 12px;">#{var_[5]}</span></td>
                             		</tr>
                             		<tr>
                             			<td  width="52" align="right" style="padding-right:15px;">备<span style="display: inline-block; width:24px;"></span>注 </td>
                             			<td style="word-break: break-all; word-wrap:break-word;">#{var_[2]}</td>
                             		</tr>
                             		<tr>
                             			<td align="right" style="padding-right:15px;">农事图片</td>
                             			<td>
                             			<div class="nstupian_div" style="padding-left:0;">
                             			 <a4j:repeat value="#{var_[3]}" var="var" id="farmingPicList" rowKeyVar="row">
                                               <img src="#{var.pictureUrl}" width="128" height="128" />
                                         </a4j:repeat>
                                         </div>
                                         </td>
                             		</tr>
                             		<tr>
                             			<td align="right" style="padding-right:15px;">投<span style="display:inline-block;width:6px;"></span>入<span style="display:inline-block;width:6px;"></span>品</td>
                             			<td>
                             			<div class="tourupin_div" style="padding-left:0;">
                             			 <a4j:repeat value="#{var_[4]}" var="vari_"  rowKeyVar="rowi">
                             			 	   <span class="img">
                                               <img src="#{vari_[1]}" width="128" height="128" />
                                               <p>#{vari_[0]}</p>
                                               </span>
                                         </a4j:repeat>
                                         </div>
                                         </td>
                             		</tr>
                             		<tr>
                             			<td align="right" style="padding-right:15px;">空气温度</td>
                                        <td style="word-break: break-all; word-wrap:break-word;">#{var_[9]}</td>
                             		</tr>
                             		<tr>
                             			<td align="right" style="padding-right:15px;">空气湿度</td>
                             			<td style="word-break: break-all; word-wrap:break-word;">#{var_[10]}</td>
                             		</tr>
                             		<tr>
	                                   	<td colspan="2" align="right">
	                                       	<em>发布人：#{var_[6]}</em>
	                                       	<span style="padding:0 10px;">#{var_[7]}</span>
	                                       	<span>来自#{var_[8]}</span>
	                                     </td>
	                                  </tr>
                                  </table>
                                  </a4j:repeat>
                              </div>
                          </div>
                      </div>
                     </h:panelGroup>
                </div>
                
                
                
                
                
                
                <div class="modal fade record" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                	<h:panelGroup id="editId">
                     	<div class="modal-dialog farmRecord" id="addJilu">
		                	<div class="modal-content">
		                		<h:form id="agr">
		                  			<div class="modal-header clear">
					                    <input type="button" class="close" data-dismiss="modal"> </input>
                                        <h4 class="modal-title font14" id="myModalLabel">编辑农事记录</h4>
		                  			</div>
		                  			<div class="modal-body clear" style="max-height: 507px;height: auto;">
		                    			<div class="choice jl">
					                        <p class="item">区域</p>
					                        <select style="display: none;" class="selectpicker" id="record_tunnel" name="record_tunnel" data-live-search="true" onchange="tunnelValue()">
                                                 <option value="" disabled="disabled">正在种植</option>
                                                 <a4j:repeat value="#{tpOperateHome.plantList}" var="var">
                                                 	<option value="#{var[0]}" aa="#{var[9]}" va="#{var[0]}" fa="#{var[10]}">&#160;#{var[2]}--#{var[4]}(#{var[3]})-#{var[8]}</option>
                                                 </a4j:repeat>
                                                 <option value="" disabled="disabled">计划种植</option>
                                                 <a4j:repeat value="#{tpOperateHome.planPlantList}" var="var">
                                                 	<option value="#{var[0]}" aa="#{var[9]}" va="#{var[0]}" fa="#{var[10]}">&#160;#{var[2]}--#{var[4]}(#{var[3]})-#{var[8]}</option>
                                                 </a4j:repeat>
                                             </select>
					                    </div>
					                    <div class="choice" style="display:#{tpOperateHome.enterpriseSettings.farmerChecked?'block;':'none;'}" dis="#{tpOperateHome.enterpriseSettings.farmerChecked}">
					                        <p class="item">操作人</p>
					                       	<select style="display: none;" class="selectpicker" multiple="multiple" data-live-search="true" id="record_name" name="record_name">
	                          					<a4j:repeat value="#{tpOperateHome.farmerList}" var="var">
	                          						<option value="#{var[0]}">#{var[1]}</option>
	                          					</a4j:repeat>
                                          	</select>
					                    </div>
					                    <div class="choice">
					                        <p class="item">操作内容</p>
						                        <s:div id="refreshOlist" styleClass="jl">
	                                            	<select class="selectpicker" style="display: none;" id="record_operate" name="record_operate" data-live-search="true">
	                                                	<a4j:repeat value="#{tpOperateHome.allTypeList}" var="var">
	                                                    	<option value="#{var[0]}">#{var[1]}</option>
	                                                    </a4j:repeat>
	                                                </select>
	                                            </s:div>
					                   </div>
					                    <div class="choice" style="display:#{tpOperateHome.enterpriseSettings.workTimeChecked?'block;':'none;'}" dis="#{tpOperateHome.enterpriseSettings.workTimeChecked}">
					                        <p class="item">工时</p>
					                        	<input class="form-control nw130" type="text" id="record_time" name="record_time"/>
					                        <p class="unit">小时</p>
					                        <p class="unit" style="color:red;">*</p>
					                    </div>
					                    <div class="choice">
					                        <p class="item">操作时间</p>
					                        <div class="input-append date form_datetime record_date" >
                                            	<input size="26" type="text" value="" readonly="readonly" id="record_date" name="record_date" />
                                                <span class="add-on"><i class="icon-th"></i></span>
                                        	</div>
					                    </div>
					                    <div class="choice" style="display:#{tpOperateHome.enterpriseSettings.environmentChecked?'block;':'none;'}" dis="#{tpOperateHome.enterpriseSettings.environmentChecked}"> 
					                        <p class="item">环境温度</p>
					                        <input class="form-control nw130" type="text" id="record_temp" name="record_temp"/>
					                        <p class="unit">℃</p>
					                    </div>
					                    <div class="choice" style="display:#{tpOperateHome.enterpriseSettings.environmentChecked?'block;':'none;'}" dis="#{tpOperateHome.enterpriseSettings.environmentChecked}">
					                        <p class="item">环境湿度</p>
					                        <input class="form-control nw130" type="text" id="record_humi" name="record_humi"/>
					                        <p class="unit">%</p>
					                    </div>
					                    <div class="tup clear">
					                    	<div class="choice" style="margin-bottom: 0px;">
					                        	<p class="item farmHeight">农事图片</p>
					                        	<div class="farmPics">
						                            <h:panelGroup id="picId">
                                                    	<a4j:repeat value="#{tpOperateHome.farmingPicList}" var="var" id="farmingPicList" rowKeyVar="row">
                                                        	<div class="farmingInputs fl">
                                                             	<a class="farmingInputs_pic" href="javascript:;">
                                                             		<img class="pic" src="#{var[0]}" width="128" height="128" />
                                                             	</a>
                                                                <div class="designEdit1">
									                                <a class="designDlt" onclick="delfarmingPic(this,#{row})" href="javascript:void(0);"><img src="#{request.contextPath}/asset/images/dele_15.jpg" /></a>
									                            	<a class="designBj" onclick="addFarming2('#{var[0]}','#{var[1]}','#{row}')" href="javascript:void(0);"><img src="#{request.contextPath}/asset/images/bj_12.jpg" /></a>
									                            </div>
                                                             </div>
                                                         </a4j:repeat>
                                                         <input type="button" class="farmingInputs_add3" style="margin-bottom:25px;float:none;" onclick="addFarming()"></input>
                                                	</h:panelGroup>
					                        	</div>
					                   		</div> 
					                        <div class="choice" style="margin-bottom: 0px;display:#{tpOperateHome.enterpriseSettings.inputsInfoChecked?'block;':'none;'}" >
					                            <p class="item farmHeight">投入品</p>
					                            <div class="farmPics">
				                            	<s:div id="farmingInputs_wp" styleClass="farmingInputs_wp">
                                                	<a4j:repeat value="#{tpOperateHome.inpList}" var="var" id="recordList" rowKeyVar="row">
                                                    	<ui:fragment rendered="#{!var.deleted}">
                                                        		<div class="farmingInputs fl"  >
                                                                	<a class="farmingInputs_pic" href="javascript:;">
                                                                	<s:fragment rendered="#{var.inputsInfoId.packingImagesUrl eq null or var.inputsInfoId.packingImagesUrl eq ''}"><img src="#{request.contextPath}/asset/images/inputs/tourupin.jpg" width="128" height="128" /></s:fragment>
                                                                	<s:fragment rendered="#{var.inputsInfoId.packingImagesUrl ne null and var.inputsInfoId.packingImagesUrl ne ''}"><img src="#{var.inputsInfoId.packingImagesUrl}" width="128" height="128" /></s:fragment>
                                                                	<p>#{var.inputsInfoId.name} #{var.amount}#{var.inputsInfoId.unitInfo.name}</p>
                                                                	</a>
                                                                    <div class="designEdit1">
				                                						<a class="designDlt" onclick="delRecordList(this,#{row})" href="javascript:void(0);"><img src="#{request.contextPath}/asset/images/dele_15.jpg" /></a>
				                            						</div>
                                                            	</div>
                                                        	</ui:fragment>
                                                        </a4j:repeat>
                                                            	
	                                                    <div class="farmingInputs_add" style="position:static;">
	                                                    	<input type="button" class="farmingInputs_add3" style="margin-bottom:25px;" onclick="addRecord()"></input>
	                                       				</div>
                                                	</s:div>
                                            	</div>
					                        </div> 
					                    </div>
					                    <div class="choice" style="display:#{tpOperateHome.enterpriseSettings.inputsInfoChecked?'block;':'none;'}">
					                        <p class="item">农资成本</p>
					                        <s:div id="nsInputsCost">
					                        	<p class="unit" id="nsInputsCostVal"><h:outputText value="#{tpOperateHome.inputsCost}" ><f:convertNumber pattern="#.##"/></h:outputText>元</p>
					                        </s:div>
					                    </div>
					                    <div class="choice" style="display:#{tpOperateHome.enterpriseSettings.costChecked?'block;':'none;'}" dis="#{tpOperateHome.enterpriseSettings.costChecked}">
					                        <p class="item">其他成本</p>
					                        <input type="text" class="form-control nw130" id="record_costing" name="record_costing"/>
					                        <p class="unit">元</p>
					                    </div>
		                    			<div class="choice" style="width:100%;">
		                        			<p class="item">备注</p>
		                        			<textarea class="form-control nw300"  rows="3" id="record_remark" name="record_remark"></textarea>
		                    			</div>
		                  			</div>
		                  			<div class="modal-footer">
				                    	<h:commandButton id="hidEditAgrBtn" style="display:none;" styleClass="btn btn-success" action="#{tpOperateHome.editAgricultural}" value="提交"  oncomplete="jquery('.completeNum1').tooltip();jsZoom();jquery('#myModal2').modal('hide');"></h:commandButton>
                                        <a4j:commandButton  styleClass="btn btn-success"  value="提交" onclick="if(!checkAgr())return false;" ></a4j:commandButton>
                                        <input class="btn btn-default" type="button" value="返回" onclick="jquery('#myModal2').modal('hide')"></input>
                                     </div>
                            	</h:form>
		                  	</div>
		                </div>                       
                	</h:panelGroup>
					<!-- 添加投入品开始-->
				 	<div class="farmingInputs_mini modal-dialog" id="addInputRecord" style="z-index:101;position:absolute; left:50%; top:50%; width:828px; margin-left:-414px; margin-top:-363px;">
				       <a4j:form ajaxSubmit="true" id="record_" autocomplete="on">
				           <div class="farmingInputs_miniHd"><h3>添加投入品</h3><input type="button" class="butt" onclick="jquery('#addInputRecord').hide()"/></div>
				                <div class="farmingInputs_miniBd" style="padding:0;">
				                    <div class="box_padding20">
				                     <div id="iradio-InputProductInfo">
				                            <!-- 投入品搜索 -->
				                            <div class="farminputs_search clear">
				                                 	<div class="public-search">
													<span class="octicon-search02"></span>
													<input class="form-control srarchfont" id="searchInputText" type="text" value="请输入查询内容" onfocus="FocusFn(this,'#333','请输入查询内容')" onblur="BlurFn(this,'#a8a8a8','请输入查询内容')"></input>
												</div>
												<p class="txt_name fl">投入品类型</p>
												<div class="inputs_selectpicker">
													<select class="selectpicker" id="inputType">
				                                         <option value="2">农药</option>
				                                         <option value="3">肥料</option>
				                                         <option value="5">种子</option>
				                                         <option value="4">其他</option>
				                                       </select>
				                                   </div>
				                                    <input type="button" class="btn btn-primary fl" onclick="searchInputs(1);" value="搜索"/>
				                            </div>
				                            <!-- 投入品表格上 -->
				                          <h:panelGroup id="recordInputList">
				                              <div class="inputs_table" id="inputs_table">
				                                   <table width="100%" cellpadding="0" cellspacing="0" id="inputsTable">
				                                       <tr>
				                                       	<th width="30" class="br_bt br_rt radius_lt"><span id="mn_checkall" class="mn_checkall" onclick="OutputCheckAll(this,'#inputs_table')"></span></th>
				                                       	<th width="164" class="br_bt br_rt">投入品编号</th>
				                                       	<th width="170" class="br_bt br_rt">投入品名称</th>
				                                       	<th width="176" class="br_bt br_rt">投入品规格</th>
				                                       	<th class="br_bt radius_lt">生产厂家</th>
				                                       </tr>
				                                       <a4j:repeat value="#{tpOperateHome.goodsInfoList}" var="var">
				                                        <tr id="trp_#{var[0]}">
				                                        	<td class="br_bt br_rt"><span class="mn_check" id="check_#{var[0]}" onclick="OutputCheck(this,'#inputs_table','#mn_checkall','#{var[0]}')"></span>
				                                        		<input type="hidden" value="#{var[0]}"/>
				                                        		<input type="hidden" value="#{var[9]}"/>
				                                        	</td>
				                                        	<td class="br_bt br_rt"><p class="ellipsis">#{var[11]}</p></td>
				                                        	<td class="br_bt br_rt"><p class="ellipsis">#{var[1]}</p> </td>
				                                        	<td class="br_bt br_rt"><p class="ellipsis">#{var[5]}#{var[10]}<s:fragment rendered="#{not empty var[7]}">/#{var[7]}</s:fragment></p></td>
				                                        	<td class="br_bt"><p class="ellipsis">#{var[8]}</p></td>
				                                        </tr>
				                                       </a4j:repeat>
				                                    </table>
				                              </div>
				                             	<!-- 分页 开始 -->
									    	<table class="pageModel-wap fr" cellpadding="0" cellspacing="0">
										        <tr>
										            <td>
										                <div style="width:auto;">
										                    <table class="pageModel" cellpadding="0" cellspacing="0">
										                        <tr>
										                            <td>
										                            	<s:fragment rendered="#{tpOperateHome.inputsPageNum ne 1 and tpOperateHome.inputsTotalPageNum gt 0}">
										                            		<span class="page_num"><a id="lastPage" href="javascript:inputsJump(1);">首页</a></span>
											                            	<span class="page_num"><a href="javascript:inputsJump(#{tpOperateHome.inputsPageNum-1});">&lt;&lt;</a></span>
											                            </s:fragment>
											                            <a4j:repeat value="#{tpOperateHome.inputsPageList}" var="_page">
											                            	<span class="page_num #{tpOperateHome.inputsPageNum eq _page? 'page_Cur':''}"><a href="javascript:inputsJump(#{_page});">#{_page}</a></span>
											                            </a4j:repeat>
											                            <s:fragment rendered="#{tpOperateHome.inputsPageNum ne tpOperateHome.inputsTotalPageNum and tpOperateHome.inputsTotalPageNum gt 0}">
											                            	<span class="page_num"><a href="javascript:inputsJump(#{tpOperateHome.inputsPageNum+1});">&gt;&gt;</a></span>
											                            	<span class="page_num"><a id="lastPage" href="javascript:inputsJump(#{tpOperateHome.inputsTotalPageNum});">尾页</a></span>
											                            </s:fragment>																						                               
										                                <span class="page_num pageCount page_last" style="border-right:0;"><a href="javascript:;" style="cursor:default;">共#{tpOperateHome.inputsTotalPageNum}页</a></span>
										                             </td>
										                    	</tr>
										                    </table>
										                </div>
										            </td>
										        </tr>
									    	</table>
										</h:panelGroup>
									</div>
				                   </div>
								<!-- 投入品表格下 -->
								<div class="box_padding20 br_dd mb20 clear">
									<div class="inputs_table mt20">
				                         	<table width="100%" cellpadding="0" cellspacing="0" id="addInputsTable">
				                               <tr>
				                               	<th width="40" class="br_bt br_rt radius_lt">序号</th>
				                               	<th width="80" class="br_bt br_rt">投入品类型</th>
				                               	<th width="80" class="br_bt br_rt">规格</th>
				                               	<th width="60" class="br_bt br_rt">使用量</th>
				                               	<th width="60" class="br_bt br_rt">成本</th>
				                               	<th width="120" class="br_bt br_rt">出库</th>
				                               	<th width="150" class="br_bt br_rt">入库批次</th>
				                               	<th width="90" class="br_bt br_rt">经办人</th>
				                               	<th width="50" class="br_bt br_rt">库存量</th>
				                               	<th class="br_bt radius_lt">操作</th>
				                               </tr>
				                           </table>
				                       </div>
								</div>
							</div>                                                                               
				               <div class="farmingInputs_miniFt">                                                                           						
								<h:inputHidden value="#{tpOperateHome.inputsInfoData}" id="inputsInfoData"/>
				               	<a4j:commandButton id="submitInputs" value="提交" onclick="if(!submitRecord()){return false;}" reRender="farmingInputs_wp,nsInputsCost" 
						         oncomplete="jquery('#addInputRecord').hide();document.getElementById('record_:submitInputs').disabled = false;farpicref()" 
						         action="#{tpOperateHome.addInputsRecord_edit()}" styleClass="btn btn-success"/>
					         <input class="btn btn-default" onclick="jquery('#addInputRecord').hide();" type="button" value="返回" style="margin-left:5px"></input>
					        </div>
				           </a4j:form>
				        </div>
				    	<!-- 添加投入品结束-->                                         
                                            
                                              
                                            <div class="farmingInputs_mini modal-dialog" id="addMyFarming" style="z-index:101;position:absolute; left:50%; top:50%; margin-left:-235px; margin-top:-260px;width:487px;">
		                                       	<a4j:form ajaxSubmit="true" id="pic" autocomplete="on">
		                                       	<div class="farmingInputs_miniHd"><h3>添加农事图片</h3><input type="button" class="butt" onclick="jquery('#addMyFarming').hide()"/></div>
		                                           <div class="farmingInputs_miniBd_min">
		                                           <table>
		                                           <iframe src="#{request.contextPath}/agricultural/farmingPic.seam" id="myframPic" name="myframPic" frameBorder="0" scrolling="no" height="228px" width="320" onLoad="" ></iframe>
		
			 										<tr>
		                                           	<td width="100"><h3 class="all_te">图片说明:</h3></td>
		                                               <td width="230" >
		                                               	<h:inputTextarea value="#{tpOperateHome.centent}" styleClass="form-control" id="contentId" style="width:319px; float:left; display:inline; margin-right:5px;"/>
		                                               	<h:inputHidden value="#{tpOperateHome.imgUrl}" id="imgUrl"/>
		                                               	<h:inputHidden value="#{tpOperateHome.picJson}" id="picJson"/>
		                                                <span style="color:#f00;font-size:12px;font-family:'微软雅黑';">最多不能超过70字</span>
		                                               </td>
		                                           </tr>
		                                           </table>
		                                           </div>
		                                           <div class="farmingInputs_miniFt">
		                                           <a4j:commandButton value="提交"  onclick="if(!myPicUrl())return false" oncomplete="farpicref()" reRender="picId"  action="#{tpOperateHome.farmingPic()}" styleClass="btn btn-success"/>
		                                           <input class="btn btn-default" onclick="jquery('#addMyFarming').hide();" type="button" value="返回" style="margin-left:5px"></input>
		                                           </div>
		                                           </a4j:form>
	                                       </div> 
	                                       
	                                       <div class="farmingInputs_mini modal-dialog" id="editMyFarming" style="z-index:101;position:absolute; left:50%; top:50%; margin-left:-235px; margin-top:-260px;width:487px;">
		                                       	<a4j:form ajaxSubmit="true" id="pic2" autocomplete="on">
		                                       	<div class="farmingInputs_miniHd"><h3>添加农事图片</h3><input type="button" class="butt" onclick="jquery('#editMyFarming').hide()"/></div>
		                                           <div class="farmingInputs_miniBd">
		                                           <table>
		                                           <iframe src="#{request.contextPath}/agricultural/farmingPic.seam" id="myframPic2" name="myframPic2" frameBorder="0" scrolling="no" height="228px" width="320" onLoad="" ></iframe>
		
			 										<tr>
		                                           	<td width="100"><h3 class="all_te">图片说明:</h3></td>
		                                               <td width="230" >
		                                               	<h:inputTextarea value="#{tpOperateHome.centent}" styleClass="form-control" id="contentId" style="width:319px; float:left; display:inline; margin-right:5px;"/>
		                                               	<h:inputHidden value="#{tpOperateHome.imgUrl}" id="imgUrl"/>
		                                               	<h:inputHidden value="#{tpOperateHome.index}" id="editIndex"/>
		                                               	<h:inputHidden value="#{tpOperateHome.picJson}" id="picJson"/>
		                                                <span style="color:#f00;">最多不能超过70字</span>
		                                               </td>
		                                           </tr>
		                                           </table>
		                                           </div>
		                                           <div class="farmingInputs_miniFt">
		                                           <a4j:commandButton value="提交"  onclick="if(!myPicUrl2())return false" oncomplete="farpicref()" reRender="picId"  action="#{tpOperateHome.editFarmingPic()}" styleClass="btn btn-success"/>
		                                           <input class="btn btn-default" onclick="jquery('#editMyFarming').hide();" type="button" value="返回" style="margin-left:5px"></input>
		                                           </div>
		                                           </a4j:form>
	                                       </div>                           
                                        
                                        </div>
                                        <h:panelGroup id="reeditId">
                                        <script type="text/javascript">
                                      //<![CDATA[
                                        function huidiao2(){
											jquery('#myModal2').modal('show');
											jquery('.selectpicker').selectpicker();
											jquery("#record_time").val('#{tpOperateHome.ai.work_time}');
											jquery("#record_temp").val('#{tpOperateHome.ai.airTemp}');
											jquery("#record_humi").val('#{tpOperateHome.ai.airHumi}');
											jquery("#record_costing").val('#{tpOperateHome.ai.costing}');
											jquery("#nsInputsCostVal").html('#{tpOperateHome.inputsCost}元');
											jquery("#record_date").val("#{dateUtil.getDateFormat(tpOperateHome.ai.operatingTime,'yyyy-MM-dd HH:mm')}");
											jquery("#record_tunnel").selectpicker("val",'#{tpOperateHome.ai.realPlantId.realPlantId}');
											var v = new Array();
											var names="#{tpOperateHome.record_names}";
											v=names.split(",");
											jquery("#record_name").selectpicker("val",v);
											jquery("#record_operate").selectpicker("val",'#{tpOperateHome.ai.rfidTypeId.id}');
											if(jquery("#record_operate").val()==null){
												jquery("#record_operate")[0].selectedIndex=0;
												jquery("#record_operate").selectpicker("refresh");
											}
											jquery("#record_remark").val('#{tpOperateHome.ai.description}');
											farpicref();
										}
                                      //]]>
                                        </script>
                                        </h:panelGroup>
                
            
            
<a4j:form>
         <a4j:jsFunction name="changeAuditState" reRender="stateId"  action="#{tpOperateHome.changeAuditState()}" oncomplete="huidiao3()">
      		<a4j:actionparam name="id" assignTo="#{tpOperateHome.idMy}"/>
      		<a4j:actionparam name="stat" assignTo="#{tpOperateHome.stat}"/>
        </a4j:jsFunction>
 	</a4j:form>
 	<a4j:form>
         <a4j:jsFunction name="loadView" reRender="loadId"  action="#{tpOperateHome.loadView()}" oncomplete="huidiao()">
      		<a4j:actionparam name="index" assignTo="#{tpOperateHome.index}"/>
        </a4j:jsFunction>
 	</a4j:form>
 		<a4j:form>
         <a4j:jsFunction name="editView" reRender="editId,reeditId" action="#{tpOperateHome.editToView()}" oncomplete="huidiao2()">
      		<a4j:actionparam name="idMy" assignTo="#{tpOperateHome.idMy}"/>
        </a4j:jsFunction>
 	</a4j:form>
 	<a4j:form>
         <a4j:jsFunction name="delfarmingPicList" reRender="picId" action="#{tpOperateHome.delfarmingPicList()}" oncomplete="farpicref()">
      		<a4j:actionparam name="index" assignTo="#{tpOperateHome.index}"/>
        </a4j:jsFunction>
 	</a4j:form>
 	<a4j:form>
	 	<a4j:jsFunction eventsQueue="mainQueue" name="delRecordList_next" action="#{tpOperateHome.delRecordList_edit()}" reRender="nsInputsCost" oncomplete="jquery('#login').hide();">
			<a4j:actionparam name="index" assignTo="#{tpOperateHome.index}" />
		</a4j:jsFunction>
	</a4j:form>
	<a4j:form>
		<a4j:jsFunction eventsQueue="mainQueue" name="searchInputsList" action="#{tpOperateHome.searchGoodsInfoList()}" oncomplete="searchInputsList_next()" reRender="recordInputList">
			<a4j:actionparam name="param" assignTo="#{tpOperateHome.param}" />
			<a4j:actionparam name="dataStandard" assignTo="#{tpOperateHome.dataStandard}" />
			<a4j:actionparam name="searchInfo" assignTo="#{tpOperateHome.searchInfo}" />
			<a4j:actionparam name="inputsPageNum" assignTo="#{tpOperateHome.inputsPageNum}" />
		</a4j:jsFunction>
		<a4j:jsFunction eventsQueue="mainQueue" name="changeStorageRoom" action="#{tpOperateHome.changeStorageRoom()}" data="#{tpOperateHome.resultData}" oncomplete="changeRoom_next(data)" >
			<a4j:actionparam name="storageRoomId" assignTo="#{tpOperateHome.storageRoomId}" />
			<a4j:actionparam name="inputsInfoId" assignTo="#{tpOperateHome.inputsInfoId}" />
		</a4j:jsFunction>
		<a4j:jsFunction eventsQueue="mainQueue" name="searchGoodsCount" action="#{tpOperateHome.searchGoodsCount()}" data="#{tpOperateHome.resultData}" oncomplete="changeGoodsBatch_next(data)">
			<a4j:actionparam name="goodsBatchIds" assignTo="#{tpOperateHome.goodsBatchIds}" />
			<a4j:actionparam name="inputsInfoId" assignTo="#{tpOperateHome.inputsInfoId}" />
		</a4j:jsFunction>
		<a4j:jsFunction eventsQueue="mainQueue" name="changeGoodsInfo" action="#{tpOperateHome.searchStorageRoomList()}" data="#{tpOperateHome.resultData}" oncomplete="storageCallback(data);">
			<a4j:actionparam name="inputsIds" assignTo="#{tpOperateHome.inputsIds}" />
		</a4j:jsFunction>
		
		<a4j:jsFunction name="checkStorage"  action="#{tpOperateHome.checkStorage()}" data="#{tpOperateHome.promptMessage}" oncomplete="submitAgr(data)" ></a4j:jsFunction>
		
	</a4j:form>
<script type="text/javascript">
//<![CDATA[
           
       jquery(function(){
		/* jquery("#partitionIds").next().bind("input propertychange",function(){
			var a = jquery("#partitionIds").next().attr("class");
			/* var partitionIds = jquery("#partitionIds").val();
			if(jquery('#headid\\:partitionId').val()!=partitionIds){
				jquery('#headid\\:partitionId').val(partitionIds);
				jquery('#headid\\:search').trigger("click");
			} 
		}); 
		jquery("#partitionIds").next().find("input").blur(function(){
			var flag = false;
			$(this).parent().next().find("li").each(function(){
				if(){
					
				}
			});
		});*/
   		var partitionIds = "#{tpOperateHome.partitionId}";
   		var plantId = "#{tpOperateHome.plantId}";
   		var fiId = "#{tpOperateHome.fiId}";
   		var arfId = "#{tpOperateHome.arfId}";
   		if(partitionIds != "-1"){
   	   		var partitionIdsArr = partitionIds.split(",");
   			jquery("#partitionIds").selectpicker('val',partitionIdsArr);
   	   	}
   		if(plantId != "-1"){
   			var plantIdArr = plantId.split(",");
   			jquery("#plantIds").selectpicker('val',plantIdArr);
   	   	}
   		if(fiId != "-1"){
   			var fiIdArr = fiId.split(",");
   			jquery("#fiIds").selectpicker('val',fiIdArr);
   	   	}
   		if(arfId != "-1"){
   			var arfIdArr = arfId.split(",");
   			jquery("#arfIds").selectpicker('val',arfIdArr);
   	   	}
     });  
	function jump(index){
		var str=jquery("#headid\\:allId").val();
		var strs=new Array();
		if(str!=""){
			strs=str.split(',');
		}
	
	jquery("input[id='cheOne']:checkbox:checked").each(function(){
		if(str!=""){
			var flag=true;
			for ( var i=0;i<strs.length-1;i++) {
				if(strs[i]==jquery(this).attr('exid')){
					flag=false;
				}
			}
			if(flag){
				str+=jquery(this).attr('exid')+",";
			}
		}else{
			str+=jquery(this).attr('exid')+",";
		}
   	});

   	
   	jquery("#fy\\:allId").val(str);
	jquery("#pageNum").val(index);
	jquery(".but_").trigger("click");
}



/* 投入品点击删除和农事图片点击放大 */
jquery(function(){
	jquery(".lazyloadimg").lazyLoadXT();
	jquery('.selectpicker').selectpicker();
});

/* 添加投入品弹窗显示关闭 */



/* 文本框获取焦点变化 js */
jquery(function(){
	jquery('.public-search .form-control').focus(function(){
		var txt_value = jquery(this).val();
		if(txt_value == '请输入搜索条件'){
			jquery(this).val('');	
		}	
	});
	jquery('.public-search .form-control').blur(function(){
		var txt_value = jquery(this).val();
		if(txt_value == ''){
			jquery(this).val('请输入搜索条件');	
		}	
	});
});

/*  放大镜js */
function jsZoom(){
	jquery('.farmingMage_pics li a').click(function(){
		var img = jquery(this).find("img");
		var pic = jquery(this).find("img").attr('src');
		var _th = jquery(this);
		var realWidth;//真实的宽度
		var realHeight;//真实的高度
		jquery("<img/>").attr("src", jquery(img).attr("src")).load(function() {
		var _w=jquery(img).attr('wi');
		var _h=jquery(img).attr('he');	

		if(_w !=null && _h !=null && _w !='' && _h !=''){
			realWidth = parseInt(_w.substring(0,_w.indexOf('p')));
			realHeight = parseInt(_h.substring(0,_h.indexOf('p')));
		}else{
			realWidth = this.width;
			realHeight = this.height;
		}
		
		var width = jquery(window).width()-30;
		var height = jquery(window).height()-40;
		var a1 = realWidth/width;
		var a2 = realHeight/height;
		//console.log(a1+"+++"+a2);
		
		if(a1>a2){
			_th.next().css("max-width",width+"px");
			_th.next().find(".MagnifierBox").css("max-width",width+"px");
			_th.next().find("#zoomId").css("max-width",width+"px");
			if(realWidth>width){
				_th.next().css("left","15px");
				var x = width/realWidth*realHeight;
				_th.next().css("top",(height-x)/2+"px");
			}else{
				_th.next().css("top",(height-realHeight)/2+"px");
				_th.next().css("left",(width-realWidth)/2+"px");
			}
		}else{
			_th.next().css("max-height",height+"px");
			_th.next().find(".MagnifierBox").css("max-height",height+"px");
			_th.next().find("#zoomId").css("max-height",height+"px");
			if(realHeight>height){
				_th.next().css("top","15px");
				var x = height/realHeight*realWidth;
				_th.next().css("left",(width-x)/2+"px");
			}else{
				_th.next().css("top",(height-realHeight)/2+"px");
				_th.next().css("left",(width-realWidth)/2+"px");
			}
		}
		if(realWidth<230){
			_th.next().find(".mask").css('display','none');
		}
		_th.next().find("#zoomId").attr('src',_th.next().find("#zoomId").attr('sr'));
		_th.next().css('display','block')
		.parent().siblings().children('a').next().hide();
		jquery('.MagnifierClose').click(function(){
			jquery(this).parent().hide();	
		});
		});
	});
	//jquery('.farmingMage_pics li a').blur(function(){
		//jquery(this).next('.farmingMage_Magnifier').fadeOut();	
	//});
	
}
jsZoom();

	
	
/* 投入品点击删除 */
jquery(function(){
	jquery('.farmingInputs').mouseover(function(){
		jquery(this).children('.designEdit1').css('display','block');	
	});
	jquery('.farmingInputs').mouseout(function(){
		jquery(this).children('.designEdit1').css('display','none');	
	});
	jquery('.farmingInputs .closeInputs').click(function(){
		jquery(this).parent().css('display','none');
	});	
	jquery('.farmingInputs .closeInputs').click(function(){
		jquery(this).parent('.farmingInputs').css('display','none');
		jquery(this).parent('.farmingInputs').next('.farmingMage_Magnifier2').css('display','none');	
	});	
	jquery('.farmingInputs a img').click(function(){
		jquery('.farmingMage_Magnifier2').css('display','none');
		jquery(this).parents('.farmingInputs').next('.farmingMage_Magnifier2').css('display','block');	
		jquery('.farmingInputs_mini').css('display','none');
	});
	jquery('.MagnifierClose').click(function(){
		jquery(this).parent('.farmingMage_Magnifier2').css('display','none');	
	});	
});

/* 添加投入品弹窗显示关闭 */
jquery(function(){
	
});

/* 添加投入品弹窗显示关闭 */
jquery(function(){
	jQuery('.addPerson_selt .bootstrap-select').click(function(){	
		jQuery('.farmingbgIco18').next('.farmingInputs_mini').css('display','none');
		jQuery('.farmingInputs_addtj button').next('.farmingInputs_mini').css('display','none');		
	});
});


<!-- 农事管理表  完成人提示框 -->
jquery(function(){
	jquery(".completeNum1,.tooltip_").tooltip();
});


/* 时间控件 */

jquery(".dt1").datetimepicker({
	format: "yyyy-mm-dd",
    autoclose: true,
	weekStart: 1,
	//startDate: "2014-08-14 10:00",
	language:  'zh-CN',
	minView:2,
    pickerPosition: "bottom-left"
});
    
jquery(".record_date").datetimepicker({
	format: "yyyy-mm-dd hh:ii",  
	autoclose: true,
	 weekStart: 1,
	 language:  'zh-CN',
	pickerPosition: "bottom-left"
});
    
    
Date.prototype.format = function(format)
{
	var o = {
	"M+" : this.getMonth()+1, //month
	"d+" : this.getDate(),    //day
	"h+" : this.getHours(),   //hour
 	"m+" : this.getMinutes(), //minute
	"s+" : this.getSeconds(), //second
 	"q+" : Math.floor((this.getMonth()+3)/3),  //quarter
 	"S" : this.getMilliseconds() //millisecond
	}

	if(/(y+)/.test(format)) 
	{
		format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4 - RegExp.$1.length));
	}
	
 	for(var k in o)
	{
		if(new RegExp("("+ k +")").test(format))
		{
 			format = format.replace(RegExp.$1,RegExp.$1.length==1 ? o[k] : ("00"+ o[k]).substr((""+ o[k]).length));
		}
	}
	return format;
}




jquery(document).ready(function(){
	/* jquery('#partitionIds').selectpicker('val',jquery('#headid\\:partitionId').val());
	jquery('#plantIds').selectpicker('val',jquery('#headid\\:plantId').val());
	jquery('#fiIds').selectpicker('val',jquery('#headid\\:fiId').val());
	jquery('#arfIds').selectpicker('val',jquery('#headid\\:arfId').val()); */
	/* if(jquery('#headid\\:statId').val()==1){
		jquery('#statIds').val('已审核');
	}
	if(jquery('#headid\\:statId').val()==0){
		jquery('#statIds').val('未审核');
	}
	if(jquery('#headid\\:statId').val()==2){
		jquery('#statIds').val('审核状态');
	}
 */
	
	jquery('input[name=iCheck]').iCheck({
	  checkboxClass: 'icheckbox_minimal-blue',
	  radioClass: 'iradio_minimal-blue',
	  increaseArea: '20%' // optional
	});
	jquery('input[id=cheAll]').on("ifClicked", function(event){
		if(this.checked){
			jquery(".icheckbox_minimal-blue").each(function(){
				jquery(this).iCheck("uncheck");
			});
			var str=jquery("#headid\\:allId").val();
			var strs=new Array();
			if(str!=""){
				strs=str.split(',');
				for ( var i=0;i<strs.length-1;i++) {
					jquery(".icheckbox_minimal-blue").each(function(){
						if(strs[i]==jquery(this).find('#cheOne').attr('exid')){
							strs.splice(i,1) 
						}
					});
				}
			jquery("#headid\\:allId").val(strs+"");
			}
		}else{
			jquery(".icheckbox_minimal-blue").each(function(){
				jquery(this).iCheck("check");
			});
		}
	});

	jquery('input[id=cheOne]').on("ifClicked", function(event){
		if(this.checked){
			jquery('#cheAll').parent().iCheck("uncheck");
			var str=jquery("#headid\\:allId").val();
			var strs=new Array();
			if(str!=""){
				strs=str.split(',');
			}
			if(str!=""){
				for ( var i=0;i<strs.length-1;i++) {
					if(strs[i]==jquery(this).attr('exid')){
						strs.splice(i,1) 
					}
				}
				jquery("#headid\\:allId").val(strs+"");
			}
		}else{
			jquery(this).iCheck("check");
			jquery('#cheAll').parent().iCheck("check");
			var i=0;
			jquery(".icheckbox_minimal-blue").each(function(){
				i++;
				if(i!=1){
					if(jquery(this).attr('class').indexOf('checked')==-1){
						jquery('#cheAll').parent().iCheck("uncheck");
					}
				}
			});
		}
	});

	var str=jquery("#headid\\:allId").val();
	if(str!=""){
		var strs=str.split(',');
		for ( var i=0;i<strs.length-1;i++) {
			jquery('[exid='+strs[i]+']').parent().iCheck("check");
		}
		jquery('#cheAll').parent().iCheck("check");
		jquery(".icheckbox_minimal-blue").each(function(){
				if(jquery(this).attr('class').indexOf('checked')==-1){
					jquery('#cheAll').parent().iCheck("uncheck");
				}
		});
	}
	
});

var checall="";
function changeAuditstate(id,stat){
	if(jquery('#cheAll').parent().attr('class').indexOf('checked')!=-1){
		checall="cheAll";
	}else{
		var str="";
		jquery("input[id='cheOne']:checkbox:checked").each(function(){
			str+=jquery(this).attr('exid')+","
	   	});
		checall=str;
	}
	if(stat){
		changeAuditState(id,0);
	}else{
		changeAuditState(id,1);
	}
}
function lockToView(index){
	loadView(index);
}
function huidiao(){
	jquery('#myModal').modal('show');
}
function editToView(id){
	editView(id);
}

function addFarming(){
	jquery("#pic\\:imgUrl").val(jquery("#myframPic").contents().find("#imgUrl_id").attr("src","../asset/images/farmingIco15.jpg"));
	jquery("#pic\\:contentId").val('');
	jquery('#addMyFarming').show();
}

function addFarming2(img,cont,index){
	jquery("#myframPic2").contents().find("#imgUrl_id").attr("src",img);
	jquery("#pic2\\:imgUrl").val(jquery("#myframPic2").contents().find("#imgUrl_id").attr("src",img));
	jquery("#pic2\\:editIndex").val(index);
	jquery("#pic2\\:contentId").val(cont);
	jquery('#editMyFarming').show();
}

function myPicUrl(){
	jquery("#pic\\:imgUrl").val(jquery("#myframPic").contents().find("#imgUrl_id").attr("src"));
	jquery("#pic\\:picJson").val(jquery("#myframPic").contents().find("#inputsImages\\:picJson").val());
	jquery('#addMyFarming').hide();
	if(jquery('#pic\\:contentId').val().length>70){
      	alert("图片说明字数需小于70字");
		return false;
     }
	if(jquery("#myframPic").contents().find("#imgUrl_id").attr("src")=='../asset/images/farmingIco15.jpg'){
		alert("上传图片不能为空！");
		return false;
     }
	return true;
}
function myPicUrl2(){
	jquery("#pic2\\:imgUrl").val(jquery("#myframPic2").contents().find("#imgUrl_id").attr("src"));
	jquery("#pic2\\:picJson").val(jquery("#myframPic2").contents().find("#inputsImages\\:picJson").val());
	
	jquery('#editMyFarming').hide();
	if(jquery('#pic2\\:contentId').val().length>70){
      	alert("图片说明字数需小于70字");
		return false;
     }
	return true;
}

function farpicref(){
	jquery('.farmingInputs').mouseover(function(){
		jquery(this).children('.designEdit1').css('display','block');	
	});
	jquery('.farmingInputs').mouseout(function(){
		jquery(this).children('.designEdit1').css('display','none');	
	});
	jquery(".record_date").datetimepicker({
		format: "yyyy-mm-dd hh:ii",  
		autoclose: true,
		 weekStart: 1,
		 language:  'zh-CN',
		pickerPosition: "bottom-left"
	});
}  

function delfarmingPic(obj,index){
	   delfarmingPicList(index);
	}  
	   
function addRecord(){
	//将投入品信息置为默认值
	jquery('#inputType').selectpicker('val',2);
	jquery("#searchInputText").val("");
	jquery("#addInputsTable .Output_tr").remove();
	searchInputs(1);
	jquery("#addInputRecord").show();
}

function delRecordList(obj,index){
	jquery('#login').show();
	jquery(obj).parents('.farmingInputs').css('display','none');
	delRecordList_next(index);
}

function allexp(){
	
	var str=jquery("#headid\\:allId").val();
	var strs=new Array();
	if(str!=""){
		strs=str.split(',');
	}
	jquery("input[id='cheOne']:checkbox:checked").each(function(){
		if(str!=""){
			flag=true;
			for ( var i=0;i<strs.length-1;i++) {
				if(strs[i]==jquery(this).attr('exid')){
					flag=false;
				}
			}
			if(flag){
				str+=jquery(this).attr('exid')+",";
			}
		}else{
			str+=jquery(this).attr('exid')+",";
		}
		
   	});
   	if(str==''){
   	   	alert("请选择要导出文件");
   	   	return false;
   	}
   	jquery("#headid\\:allId").val(str);

   	jquery("#login").show();
	jquery.extend({              
		   referesh1: function () {              
				 jquery.ajax({
						type :'get',
						url :'#{request.contextPath}/AutoShackServlet.do',
						success : function(msg){
							if(msg==1){
								jquery("#login").hide();
								 window.clearInterval(timerID);
							}
						}
					});
		        }       
		 
		      });
		 
	 timerID = setInterval("jquery.referesh1()", 1000 * 2);
   	return true;
}
function checkAgr(){
	var v = "";
	//jquery("#myframe2").contents().find(".plant_imgbd").each(function(){
	//	v +=jquery(this).attr('src')+",";
	//})
	jquery("#record_url").val(v);
	if(jquery("#record_tunnel").val()==null||jquery("#record_tunnel").val()==""){
		alert("请选择区域!");
		return false;
	}
//	if(jquery("#record_name").val()==null||jquery("#record_name").val()==""){
//		alert("请选择操作人!");
//		return false;
//	}
	if(jquery("#record_time").val()==""){
		alert("请填写工时!");
		return false;
	}
	var rtime = jquery("#record_time").val();
	if(isNaN(rtime)){
		alert("工时请填写数字!");
		return false;
	}else{
		rtime = parseFloat(rtime);
		if(rtime>200){
			alert("工时不能超过200!");
			return false;
		}
	}
	var temp = jquery("#record_temp").val();
	if(isNaN(temp)){
		alert("空气温度请填写数字!");
		return false;
	}else{
		temp = parseFloat(temp);
		//if(temp>99){
		//	alert("工时不能超过99!");
		//	return false;
		//}
	}
	
	var humi = jquery("#record_humi").val();
	if(isNaN(humi)){
		alert("空气湿度请填写数字!");
		return false;
	}else{
		humi = parseFloat(humi);
		//if(humi>99){
		//	alert("工时不能超过99!");
		//	return false;
		//}
	}
	checkStorage();
	return true;
}
function submitAgr(data){
	if(""!=data){
		alert(data);			
	}else{
		jquery("#agr\\:hidEditAgrBtn").click(); 
	}
}
function huidiao3(){
	jquery('input[name=iCheck]').iCheck({
		  checkboxClass: 'icheckbox_minimal-blue',
		  radioClass: 'iradio_minimal-blue',
		  increaseArea: '20%' // optional
		});
		jquery('input[id=cheAll]').on("ifClicked", function(event){
			if(this.checked){
				jquery(".icheckbox_minimal-blue").each(function(){
					jquery(this).iCheck("uncheck");
	  
				});
			}else{
				jquery(".icheckbox_minimal-blue").each(function(){
					jquery(this).iCheck("check");
				});
			}
		});

		if(checall=="cheAll"){
			jquery(".icheckbox_minimal-blue").each(function(){
				
				jquery(this).iCheck("check");
			});
		}else if(checall !=""){
			var cheAlls=checall.substring(0,checall.length-1).split(',');
			for ( var i=0;i<cheAlls.length;i++) {
				jquery(".icheckbox_minimal-blue").each(function(){
					if(jquery(this).find('#cheOne').attr('exid')==cheAlls[i]){
						jquery(this).iCheck("check");
					}
				});
			}
		}
		jquery(".lazyloadimg").lazyLoadXT();
		jsZoom();
}
function searchComit(){
	if(jquery('#beginTime').val()>jquery('#endTime').val()){
		alert("开始时间不能大于结束时间")
		return false;
	}
	var partitionIds = jquery('#partitionIds').val();
	var plantIds = jquery('#plantIds').val();
	var fiIds = jquery('#fiIds').val();
	var arfIds = jquery('#arfIds').val();
	if(partitionIds != null){
		jquery('#headid\\:partitionId').val(partitionIds);
	}else{
		jquery('#headid\\:partitionId').val("");
	}
	if(plantIds != null){
		jquery('#headid\\:plantId').val(plantIds);
	}else{
		jquery('#headid\\:plantId').val("");
	}
	if(fiIds != null){
		jquery('#headid\\:fiId').val(fiIds);
	}else{
		jquery('#headid\\:fiId').val("");
	}
	if(arfIds != null){
		jquery('#headid\\:arfId').val(arfIds);
	}else{
		jquery('#headid\\:arfId').val("");
	}
	jquery("#headid\\:allId").val("");
	return true;
}

 jquery('#searchSelect').find("input").keydown(function(e){
	if(e.keyCode==13){
		jquery('#headid\\:search').trigger("click");
	}
});  
function addM(num,val){
	if(num==1){
		if(jquery('#headid\\:partitionId').val()!=val.value){
			jquery('#headid\\:partitionId').val(val.value);
			jquery('#headid\\:search').trigger("click");
		}
	}else if(num==2){
		if(jquery('#headid\\:plantId').val()!=val.value){
			jquery('#headid\\:plantId').val(val.value);
			jquery('#headid\\:search').trigger("click");
		}
	}else if(num==3){
		if(jquery('#headid\\:fiId').val()!=val.value){
			jquery('#headid\\:fiId').val(val.value);
			jquery('#headid\\:search').trigger("click");
		}
	}else if(num==4){
		if(jquery('#headid\\:arfId').val()!=val.value){
			jquery('#headid\\:arfId').val(val.value);
			jquery('#headid\\:search').trigger("click");
		}
	}
	
}

function stat(val){
	if(jquery('#headid\\:statId').val()!=val){
		jquery('#headid\\:statId').val(val);
		jquery('#headid\\:search').trigger("click");
	}
}

function changeGoodsBatch(obj,inputsId){
    var batch=jquery(obj).val();
    if(null==batch){
    	batch="";
    }       
    searchGoodsCount(batch.toString(),inputsId);
}
function changeRoom_next(data){
	var inputsId=data.inputsInfoId;   
	var goodsBatchSel="<select class='selectpicker' multiple='multiple' onchange='changeGoodsBatch(this,"+inputsId+")'>";
	var farmerInfoSel="<select class='selectpicker' >";

	if(typeof(data.goodsBatch) != "undefined"){
		goodsBatchSel+=data.goodsBatch;
	}
	if(typeof(data.farmerInfo) != "undefined"){
		farmerInfoSel+=data.farmerInfo;
	}  	
	if(typeof(data.goodsCount) != "undefined"){
		jquery('#goodsCount_'+inputsId).html(data.goodsCount);
		jquery('#goodsCount_'+inputsId).attr("title",data.goodsCount);
	}  
	if(typeof(data.unitinfoId) != "undefined"){
		jquery('#unit_'+inputsId).val(data.unitinfoId);
	}  		
	goodsBatchSel+="</select>";
	farmerInfoSel+="</select>";	
	jquery('#batch_'+inputsId).html(goodsBatchSel);
	jquery('#farmer_'+inputsId).html(farmerInfoSel);
	jquery('.selectpicker').selectpicker();	
}
function changeGoodsBatch_next(data){
	var inputsId=data.inputsInfoId; 
	var msg=data.promptMessage;   
	if(typeof(data.goodsCount) != "undefined"){
		jquery('#goodsCount_'+inputsId).html(data.goodsCount);
		jquery('#goodsCount_'+inputsId).attr("title",data.goodsCount);
	}   
	if(msg!=""){
		alert("请选择同一单位的入库批次!");
		var goodsBatchids=jquery("#batch_"+inputsId+" select").val().toString();
		var batchValue=goodsBatchids.replace(","+msg,"").split(",");
		jquery("#batch_"+inputsId+" select").selectpicker('val',batchValue);			
	}
}
function isFloat(value){
	var mny =RegExp(/^([0-9]+(\.?))?[0-9]+$/);
	return mny.test(value);
}
var goodsCount=0.0;
//农事投入品提交验证
function submitRecord(){
	var trLength=jQuery("#addInputsTable tr").length;
	if(trLength<=1){
		alert("请选择投入品！");
		return false;
	}
	var inputsRecordStr='{"inputsDatas":[';
   	for(var i=1;i<trLength;i++){   	   	
   		var inputsId=jQuery("#addInputsTable tr:eq("+i+") td:eq(0) input:eq(0)").val();
   		var unitId=jQuery("#addInputsTable tr:eq("+i+") td:eq(0) input:eq(1)").val();
   		var inputsName=jQuery("#addInputsTable tr:eq("+i+") td:eq(1) p").html();
   		var useNum=jQuery("#addInputsTable tr:eq("+i+") td:eq(3) input:eq(0)").val();
   		var cost=jQuery("#addInputsTable tr:eq("+i+") td:eq(4) input:eq(0)").val();
   		var roomId=jQuery("#addInputsTable tr:eq("+i+") td:eq(5) select").val();
   		var batchId=jQuery("#addInputsTable tr:eq("+i+") td:eq(6) select").val();
   		var farmerId=jQuery("#addInputsTable tr:eq("+i+") td:eq(7) select").val();
   		var goodsCount=jQuery("#addInputsTable tr:eq("+i+") td:eq(8)").html();
			
   		if(""==goodsCount){
   			goodsCount=0;
   		}
   		if(null==useNum || ""==useNum){
   			alert(inputsName+"的使用量不能为空！");
   			return false;
   		}else if(!isFloat(useNum)){
   			alert("请输入正确的"+inputsName+"使用量！");
   			return false;
   		}else if(parseFloat(useNum)>9999999){
   			alert(inputsName+"的使用量不能大于9999999！");
   			return false;
   	   	}
   		if(null==cost || ""==cost){
   			alert(inputsName+"的成本不能为空！");
   			return false;
   		}else if(!isFloat(cost)){
   			alert("请输入正确的"+inputsName+"成本！");
   			return false;
   		}else if(parseFloat(cost)>9999999){
   			alert(inputsName+"的成本不能大于9999999！");
   		   	return false;
   		}
   		if("0"!=roomId){		
   			if(null==batchId || ""==batchId){
   				alert(inputsName+"的入库批次不能为空！");
   				return false;
   			}
   			if(null==farmerId || ""==farmerId){
   				alert(inputsName+"的经办人不能为空！");
   				return false;
   			}
   			if(parseFloat(useNum)>parseFloat(goodsCount)){
   				alert(inputsName+"库存不足，请重新输入使用量！");
   				return false;
   			} 			
   		}	
   		inputsRecordStr+= "{'inputsId':'" +inputsId + "','useNum':'"+ useNum +"','cost':'"+ cost +"','roomId':'"+ roomId +
			"','batchId':'"+ batchId +"','farmerId':'"+ farmerId +"','unitId':'"+ unitId +"'},";	 	
   	}
   	inputsRecordStr = inputsRecordStr.substring(0, inputsRecordStr.length-1) + ']}';
   	jquery("#record_\\:inputsInfoData").val(inputsRecordStr);
 	 var showHid=jquery("#home").css("display");
	 if(showHid=="block"){//农事
		 jquery("#agricultralType").val("1");
	 }else{
		 jquery("#agricultralType").val("2");
     }	 	 	
	document.getElementById('record_:submitInputs').disabled = true;
	return true;
}
function clearNoNum(obj){
 	obj.value = obj.value.replace(/[^\d.]/g,"");//清除“数字”和“.”以外的字符  
 	obj.value = obj.value.replace(/^\./g,"");  //验证第一个字符是数字而不是. 
 	obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个. 清除多余的.   
 	obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
 }

function changeRoom(room,inputsId){
	if(room=="0"){
		var goodsBatchSel="<select class='selectpicker' multiple='multiple' onchange='changeGoodsBatch(this,"+inputsId+")'></select>";
    	var farmerInfoSel="<select class='selectpicker' ></select>";
		jquery('#batch_'+inputsId ).html(goodsBatchSel);
		jquery('#farmer_'+inputsId).html(farmerInfoSel); 	
		jquery('#goodsCount_'+inputsId).html("0"); 
		jquery('#goodsCount_'+inputsId).attr("title",0);
		jquery('.selectpicker').selectpicker();			
	}else{
		changeStorageRoom(room,inputsId);
	}
}

function tunnelValue(){
	var tunVal=jquery('#record_tunnel').val();
	var faVal=jquery('#record_name').val();
	if(faVal!=null){
		jquery('#record_tunnel option').each(function(){
			if(jquery(this).attr('fa')!=null){
				for(var i=0;i<faVal.length;i++){
					if(faVal[i]==jquery(this).attr('fa')){
						faVal.splice(i,1);
						i--;
					}
				}
				
			}
		})
	}else{
		faVal=new Array();
	}
	
	if(tunVal!=null){
		if(jquery('[va='+tunVal+']').attr('fa')!=null){
			faVal.push(jquery('[va='+tunVal+']').attr('fa'));
		}
	}
	jquery('#record_name').selectpicker("val",faVal);
}

//新版添加农事投入品------
window.onload = function (){
	var searchStr = jQuery("#searchInfo_").val();
	if(searchStr == "" || searchStr == null){
		jQuery("#searchInfo_").val("请输入搜索条件");
		jQuery("#searchInfo_").css("color","#a8a8a8");
	}else if(searchStr == "请输入搜索条件"){
		jQuery("#searchInfo_").css("color","#a8a8a8");
	}else{
		jQuery("#searchInfo_").css("color","#000");
	}
}

//(1)删除投入品
function DeleteOutput(obj,inputsId){
	jQuery(obj).parents('.Output_tr').remove();
	jQuery("#check_"+inputsId).removeClass('checked');
	//取消全选
	if(jQuery("#mn_checkall").hasClass('checked')){   		
		jQuery("#mn_checkall").removeClass('checked');
	}
	resetIndex();  	
}
//添加投入品，由于删除，添加操作序号变乱，重新排序
function resetIndex(){
	var trLength=jQuery("#addInputsTable tr").length;
	for(var i=1;i<trLength;i++){
		jQuery("#addInputsTable tr:eq("+i+") td:eq(0) span").html(i);
}
}
//(2-1)投入品表格复选框，全选功能
function OutputCheckAll(obj,oparents){
	if(jQuery(obj).hasClass('checked')){
		//取消全选
		jQuery(obj).removeClass('checked');
		jQuery(oparents).find('td .mn_check').removeClass('checked');
		//只取消本页的
		//jQuery("#addInputsTable .Output_tr").remove();
		var trLength=jQuery("#inputsTable tr").length;
		for(var i=0;i<trLength;i++){
			var inputIds=jQuery("#inputsTable tr:eq("+i+") td:eq(0) input:eq(0)").val();
			jQuery("#addtr_"+inputIds).remove();
		}
		resetIndex();  	
	}else{   		
		//var trLength=jQuery("#inputsTable tr").length;
		//全选时，判断没有选中的添加到投入品，已添加的不在查询
		var inputIds="";   		
		var noCheckObj=jQuery("#inputs_table").find('td .mn_check ').not(".checked");
		var trLength=noCheckObj.length;
		
		for(var i=0;i<trLength;i++){
			//inputIds+=jQuery("#inputsTable tr:eq("+i+") td:eq(0) input:eq(0)").val()+",";
			inputIds+=jQuery(noCheckObj).eq(i).siblings("input:eq(0)").val()+",";
    } 
    if(trLength>1){
    	inputIds=inputIds.substring(0,inputIds.length-1);
    }
		//如果是空，则是没有选中状态,点击后全选
		jQuery(obj).addClass('checked');
		jQuery(oparents).find('td .mn_check').addClass('checked');
		//添加多个投入品，获取库存信息
		changeGoodsInfo(inputIds);  
		jQuery("#login").show();
	}
}
var tableStr="";
//(2-2)如果有一个复选框没有选中，则全选按钮为取消状态，否则相反
function OutputCheck(obj,oparents,oAll,inputsId){
	if(jQuery(obj).hasClass('checked')){
		//取消全选
		jQuery(obj).removeClass('checked');
		//如果一个取消，那么全选为取消状态
		jQuery(oAll).removeClass('checked');
		jQuery('#addtr_'+inputsId).remove();
		resetIndex();  	
	}else{
		jQuery(obj).addClass('checked');
		//如果是空，则是没有选中状态,点击后选择
		var allNum = jQuery(oparents).find('td .mn_check').length;
		var allLen = jQuery(oparents).find('td .mn_check.checked').length;
		//alert('allNum:'+allNum+'allLen:'+allLen)
		//如果个数和选中的个数相等，则全选为选中状态
		if(allLen == allNum){
		jQuery(oAll).addClass('checked');
		}else{
		jQuery(oAll).removeClass('checked');
		}
		//添加一个投入品，获取库存信息
		changeGoodsInfo(inputsId);    		
		jQuery("#login").show();
	}
}
//添加投入品-获取库存信息回调
function storageCallback(resultData){
var inputList=resultData.result;
jquery(inputList).each(function(index, data){
		var inputsId=data.inputsInfoId;
	        var rowNum=jQuery("#addInputsTable tr").length;
	    	var inputName=jQuery("#trp_"+inputsId+" td:eq(2) p").html();
	    	var unitName=jQuery("#trp_"+inputsId+" td:eq(3) p").html();
	    	var storageRoomSel="<select class='selectpicker'  onchange='changeRoom(this.value,"+inputsId+")'><option value='0'>无</option>";
	    	var goodsBatchSel="<select class='selectpicker' multiple='multiple' onchange='changeGoodsBatch(this,"+inputsId+")'>";
	    	var farmerInfoSel="<select class='selectpicker' >";
	    	if(typeof(data.storageRoom) != "undefined"){
	    		storageRoomSel+=data.storageRoom;
	    	} 
	    	if(typeof(data.goodsBatch) != "undefined"){
	    		goodsBatchSel+=data.goodsBatch;
	    	}
	    	if(typeof(data.farmerInfo) != "undefined"){
	    		farmerInfoSel+=data.farmerInfo;
	    	}  	
	    	storageRoomSel+="</select>";
	    	goodsBatchSel+="</select>";
	    	farmerInfoSel+="</select>";
	    	
	    	tableStr="<tr class=\"Output_tr\" id='addtr_"+inputsId+"'>"+
		    	"<td class=\"br_bt br_rt\">"+
	    		"<input type='hidden' value='"+inputsId+"'/>"+
		    		"<input type='hidden' value='' id='unit_"+inputsId+"'/><span>"+rowNum+"</span></td>"+
	    		"<td class=\"br_bt br_rt\"><p class=\"ellipsis\" title='"+inputName+"'>"+inputName+"</p></td>"+
			    "<td class=\"br_bt br_rt\"><p class=\"ellipsis\" title='"+unitName+"'>"+unitName+"</p></td>"+  	
		    	"<td class=\"br_bt br_rt\">"+
		    		"<input class=\"Output_input\"></input>"+
		    	"</td>"+
		    	"<td class=\"br_bt br_rt\">"+
		    		"<input class=\"Output_input\" value='0'></input>"+
		    	"</td>"+
		    	"<td class=\"br_bt br_rt\">"+
			    	"<div class=\"Output_selectpicker\" id='room_"+inputsId+"'>"+storageRoomSel+"</div>"+
		    	"</td>"+
		    	"<td class=\"br_bt br_rt\">"+
		    		"<div class=\"Output_selectpicker\" id='batch_"+inputsId+"'>"+goodsBatchSel+"</div>"+
		    	"</td>"+
		    	"<td class=\"br_bt br_rt\">"+
					"<div class=\"Output_selectpicker\" id='farmer_"+inputsId+"'>"+farmerInfoSel+"</div>"+
				"</td>"+
		    	"<td class=\"br_bt br_rt\" style='overflow: hidden;' id='goodsCount_"+inputsId+"'>0</td>"+
		    	"<td class=\"br_bt\">"+
		    		"<a href=\"javascript:;\" onclick=\"DeleteOutput(this,"+inputsId+")\">删除</a>"+
		    	"</td>"+
	    	"</tr>";
	    	jquery("#addInputsTable").append(tableStr);
	});    
	jquery('.selectpicker').selectpicker();			
	jQuery("#login").hide();
}
//(3)获取焦点，失去焦点
function FocusFn(obj,oColor,txt_val){
	if(jQuery(obj).val()==txt_val){
		jQuery(obj).val('');
		jQuery(obj).css('color',oColor)
	}
}
function BlurFn(obj,oColor,txt_val){
	if(jQuery(obj).val()==''){
		jQuery(obj).val(txt_val);
		jQuery(obj).css('color',oColor)
	}
}
//投入品列表信息查询
function searchInputs(pageNum){
	var dataStandard=jquery("#record_tunnel").find("option:selected").attr("aa");
	var inputType=jquery("#inputType").val();
	var searchText=jquery("#searchInputText").val();
	if(searchText=="请输入查询内容"){
		searchText="";
	}
	searchInputsList(inputType,dataStandard,searchText,pageNum);
	jquery("#login").show();
}
//翻页
function inputsJump(inputsPageNum){
	searchInputs(inputsPageNum);
}
function searchInputsList_next(){
	var trLength=jQuery("#inputsTable tr").length;
	for(var i=1;i<trLength;i++){
		var inputIds=jQuery("#inputsTable tr:eq("+i+") td:eq(0) input:eq(0)").val();
		if(jquery("#addtr_"+inputIds).length>0){
			jquery("#check_"+inputIds).addClass('checked');
		}
	}
	var allNum = jQuery("#inputs_table").find('td .mn_check').length;
	var allLen = jQuery("#inputs_table").find('td .mn_check.checked').length;
	//alert('allNum:'+allNum+'allLen:'+allLen)
	//如果个数和选中的个数相等，则全选为选中状态
	if(allLen == allNum && allNum>0){
		jQuery("#mn_checkall").addClass('checked');
	}else{
		jQuery("#mn_checkall").removeClass('checked');
	}
	jQuery("#login").hide();
}
//]]>
</script>
            </td>
	</ui:define>

</ui:composition>
