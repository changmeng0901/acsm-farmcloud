<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template.xhtml">
	<ui:define name="body">
<style>
.ts_div2{width:240px; height: 125px; border: 1px solid #81C5E9; margin: 0px auto; padding: 0 15px 15px;  background: url(#{request.contextPath}/asset/images/tck_bg_14.jpg) #ffffff repeat-x scroll center top;}
.ui-selectmenu{*position:static; *margin:0 auto; *display:block;}
.sh_d_d{ width:100%; padding:10px 0; line-height:45px; font-family:"微软雅黑"; font-size:14px;}
.sh_01{ height:45px; line-height:45px; float:left; text-align:left; margin-right:25px; display:inline-block;}
.sh_02{ min-width: 150px; border-bottom:1px solid #373737; display: inline-block; height: 33px; *height: 30px; *line-height:33px;}
.ts_div2{width:210px; height: 125px; border: 1px solid #81C5E9; margin: 0px auto; padding: 0 15px 15px;  background: url(#{request.contextPath}/asset/images/tck_bg_14.jpg) #ffffff repeat-x scroll center top;}
.dr-mpnl-shadow{background:none;}
.dr-mpnl-pnl{background:none; border:none;}
.dr-mpnl-pnl-b{padding:0;}
.dr-mpnl-shadow{top:0; left:0;}
.rich-picklist-source-items{margin:0;}

.custom-combobox {
    position: relative;
    display: inline-block;
  }
  .custom-combobox-toggle {
    position: absolute;
    top: 0;
    bottom: 0;
    margin-left: -1px;
    padding: 0;
    height: 32px;
    /* support: IE7 */
    *top:1px;
  }
	 
	</style>
	<td valign="top" width="210" style=" border-right:1px solid #e1e4eb;">
                <div class="left_c2">
                	<ul class="lt_c_ul">
                		<li>
                        	<a href="#{request.contextPath}/agricultural/InputsInfoList.seam"><img class="tbimg"  src="#{request.contextPath}/asset/images/trp2.png"/>&#160;投入品信息</a>
                        </li>
                	    <li>
                        	<a href="#{request.contextPath}/agricultural/SeedsRecordList.seam"><img class="tbimg"  src="#{request.contextPath}/asset/images/seeds.png"/>&#160;种子记录</a>
                        </li>
                        <li>
                        	<a href="#{request.contextPath}/agricultural/PesticidesRecordList.seam"><img class="tbimg"  src="#{request.contextPath}/asset/images/nongyao.png"/>&#160;农药记录</a>
                        </li>
                        <li>
                        	<a href="#{request.contextPath}/agricultural/FertilizersRecordList.seam" class="fon_07" ><strong><img class="tbimg"  src="#{request.contextPath}/asset/images/trp.png"/>&#160;肥料记录</strong></a>
                        </li>
                        <li>
                        	<a href="#{request.contextPath}/agricultural/OtherRecordList.seam"><img class="tbimg"  src="#{request.contextPath}/asset/images/qita.png"/>&#160;其它农资记录</a>
                        </li>
                    </ul>
                	<div class="clear"></div>
                </div>
            </td>
		<td valign="top">
		<h:form id="user">
		<rich:modalPanel id="products" autosized="true" height="125"
								width="240" headerClass="modalHeader">
								<div class="ts_div2" id="div2">
								<div class="tck_ti"><a href="#"> <h:outputLink value="#"
									onclick="#{rich:component('products')}.hide();return false;">
									
									<img src="#{request.contextPath}/asset/images/close_17.jpg"
										width="20" height="20" onclick="return closeMethod()" />
								</h:outputLink> </a></div>
				
								<table
									style="width: 100%; margin-top: 25px; table-layout: fixed; margin-left: 15px;">
									<tr>
										<td width="46" align="left"><img
											src="#{request.contextPath}/asset/images/tstc.jpg" width="46"
											height="46" /></td>
										<td align="left"
											style="font-family: '宋体'; color: #000000; font-size: 12px; padding-left: 15px;">
										<span id="productMsg">*号部分为必填项！</span></td>
									</tr>
								</table>
								</div>
		</rich:modalPanel>
                <div class="right_c">
                	<div class="r_title">
                    	<div class="r_t_l"><font size="4">肥料记录</font><rich:messages styleClass="messages"></rich:messages></div>
                    </div>
				<!--入库订单列表开始-->
				<!-- #{fertilizersRecordHome.work()} -->
				<div class="all_d3">
                    	<div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">投入品名称：</td>
                                    <td>
                                      		 <select id="combobox" style="display: none;">
											    <option value=""></option>
											    <a:repeat value="#{fertilizersRecordHome.inputsList}" var="_inputs">
											    	<option value="#{_inputs.id}">#{_inputs.name}</option>
											    </a:repeat>
											</select>
											<input type="hidden"  id="inputsId" name="inputsId" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">种植区域：</td>
                                    <td>
                                        <select id="combobox2" style="display: none;">
											    <option value=""></option>
											    <a:repeat value="#{fertilizersRecordHome.rpList}" var="_rp">
											    	<option value="#{_rp.realPlantId}">#{_rp.tunnelInfoId.tunnelName}--#{_rp.breedBreedId.plant.name}</option>
											    </a:repeat>
											</select>
											<input type="hidden" id="realPlantId" name="realPlantId"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">登记证号：</td>
                                    <td>
                                        <h:inputText styleClass="r_c_text" value="#{fertilizersRecordHome.instance.registrationNo}" id="registrationNo"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">养分含量：</td>
                                    <td>
                                        <h:inputText styleClass="r_c_text" value="#{fertilizersRecordHome.instance.nutrientContent}" id="nutrientContent"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">肥料类型：</td>
                                    <td>
                                        <h:inputText styleClass="r_c_text" value="#{fertilizersRecordHome.instance.fertilizerType}" id="fertilizerType"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">适用作物：</td>
                                    <td>
                                        <h:inputText styleClass="r_c_text" value="#{fertilizersRecordHome.instance.crops}" id="crops"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">施用方法：</td>
                                    <td>
                                        <h:inputText styleClass="r_c_text" value="#{fertilizersRecordHome.instance.applicationMethod}" id="applicationMethod"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                         <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">生产厂家：</td>
                                    <td>
                                        <h:inputText styleClass="r_c_text" value="#{fertilizersRecordHome.instance.manufacturers}" id="manufacturers"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01">
                        	<table>
                                <tr>
                                    <td class="all_te">保质期：</td>
                                    <td>
                                        <h:inputText styleClass="r_c_text" value="#{fertilizersRecordHome.instance.shelfLife}" id="shelfLife"/>天
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01" style="width:530px;">
                        	<table>
                                <tr>
                                    <td class="all_te">备注：</td>
                                   <td>
										<h:inputTextarea id="remarks"  styleClass="big"  value="#{fertilizersRecordHome.instance.remarks}" />
		                            </td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="clear"></div>
                        </div>
                        
                         <table width="280" style="margin:35px auto 0 auto;">
						<tr>
							<td>
						<h:commandButton id="persist"  styleClass="edit_save" action="#{fertilizersRecordHome.persist}" rendered="#{!fertilizersRecordHome.managed}"  onclick="return checkSubmit()"/>
		            	<h:commandButton id="update"  styleClass="edit_save" action="#{fertilizersRecordHome.update}" rendered="#{fertilizersRecordHome.managed}"   onclick="return checkSubmit()"/>
		    			&#160;<s:button view="/agricultural/FertilizersRecordList.xhtml" styleClass="edit_back" id="bn_left6" style="margin-left:10px" />
                            </td>
						</tr>
                   </table> 
				<!--入库订单列表结束-->
                    <div class="clear"></div>
                </div><!--right_c结束-->
                
                <div class="clear"></div>
                
                
              </h:form>
              <script src="#{request.contextPath}/asset/js/jquery-1.10.2.js"></script>
	<script src="#{request.contextPath}/asset/js/jquery-ui1.js"></script>
	<link rel="stylesheet" href="#{request.contextPath}/asset/css/jquery-ui_css.css"/>
	            <style>
    .rich-calendar-button{
     margin-left:-8px
    }
     .custom-combobox-input {
    margin: 0;
    padding:2px 5px; width:202px;
  }
  
  .ui-menu .ui-menu-item a{
   color: #5A5A5A;
    display: block;
    font: 100 12px/26px Arial;
    height: 26px;
    overflow: hidden;
    padding: 2px 7px;
    text-decoration: none;
    width: 210px;
  }
    </style>
<script type="text/javascript">
	   //<![CDATA[	
jq_Q = jQuery.noConflict();
  (function( jq_Q ) {
    jq_Q.widget( "custom.combobox", {
      _create: function() {
        this.wrapper = jq_Q( "<span>" )
          .addClass( "custom-combobox" )
          .insertAfter( this.element );
        this.element.hide();
        this._createAutocomplete();
        this._createShowAllButton();
      },
      _createAutocomplete: function() {
        var selected = this.element.children( ":selected" ),
          value = selected.val() ? selected.text() : "";
        this.input = jq_Q( "<input>" )
          .appendTo( this.wrapper )
          .val( value )
          .attr( "title", "" )
          .addClass( "custom-combobox-input ui-widget ui-widget-content1 ui-state-default1 input_bg" )
          .autocomplete({
            delay: 0,
            minLength: 0,
            source: jq_Q.proxy( this, "_source" )
          })
          .tooltip({
            tooltipClass: "ui-state-highlight"
          });
        this._on( this.input, {
          autocompleteselect: function( event, ui ) {
            ui.item.option.selected = true;
            this._trigger( "select", event, {
              item: ui.item.option
            });
          },
          autocompletechange: "_removeIfInvalid"
        });
      },
      _createShowAllButton: function() {
        var input = this.input,
          wasOpen = false;
        jq_Q( "<a>" )
          .attr( "tabIndex", -1 )
          .attr( "title", "显示全部信息" )
          .tooltip()
          .appendTo( this.wrapper )
          .button({
            icons: {
              primary: "ui-icon-triangle-1-s"
            },
            text: false
          })
          .removeClass( "ui-corner-all" )
          .addClass( "custom-combobox-toggle ui-corner-right" )
          .mousedown(function() {
            wasOpen = input.autocomplete( "widget" ).is( ":visible" );
          })
          .click(function() {
            input.focus();
            if ( wasOpen ) {
              return;
            }
            input.autocomplete( "search", "" );
          });
      },
      _source: function( request, response ) {
        var matcher = new RegExp( jq_Q.ui.autocomplete.escapeRegex(request.term), "i" );
        response( this.element.children( "option" ).map(function() {
          var text = jq_Q( this ).text();
          if ( this.value && ( !request.term || matcher.test(text) ) )
            return {
              label: text,
              value: text,
              option: this
            };
        }) );
      },
      _removeIfInvalid: function( event, ui ) {
        if ( ui.item ) {
          return;
        }
        var value = this.input.val(),
          valueLowerCase = value.toLowerCase(),
          valid = false;
        this.element.children( "option" ).each(function() {
          if ( jq_Q( this ).text().toLowerCase() === valueLowerCase ) {
            this.selected = valid = true;
            return false;
          }
        });
        if ( valid ) {
          return;
        }
        this.input
          .val( "" )
          .attr( "title", value + " 没有符合条件的项目" )
          .tooltip( "open" );
        this.element.val( "" );
        this._delay(function() {
          this.input.tooltip( "close" ).attr( "title", "" );
        }, 2500 );
        this.input.data( "ui-autocomplete" ).term = "";
      },
      _destroy: function() {
        this.wrapper.remove();
        this.element.show();
      }
    });
  })( jQuery );
  jq_Q(function() {
	  
    jq_Q( "#combobox" ).combobox();
    jq_Q( "#combobox2" ).combobox();
  });


  function checkSubmit(){
		   var regNum = /^[1-9]+[0-9]*]*$/; 
		   var bId = jq_Q( "#combobox" ).val();
		   var rpId = jq_Q( "#combobox2" ).val();
		   var shelfLife = document.getElementById("user:shelfLife").value;
		   if(bId == "" || bId == null){
				document.getElementById("productMsg").innerHTML = "请选择相应投入品";
				#{rich:component('products')}.show();
				return false;
			}
		   if(rpId == ""){
				document.getElementById("productMsg").innerHTML = "请选择种植区域";
				#{rich:component('products')}.show();
				return false;
			}
			if(shelfLife != "" && !regNum.test(shelfLife)){
				document.getElementById("productMsg").innerHTML = "保质期只能为数字";
				#{rich:component('products')}.show();
				return false;
				}
		   jquery("#inputsId").val(bId);
		   jquery("#realPlantId").val(rpId);
		   return true;
	}
	function closeMethod(){
		var regNum = /^[1-9]+[0-9]*]*$/; 
		   var shelfLife = document.getElementById("user:shelfLife").value; 
		   if(shelfLife != "" && !regNum.test(shelfLife)){
			   document.getElementById("user:shelfLife").focus();
			   return false;
			}
		}
	jquery(document).ready(function(){
		var bId = "#{fertilizersRecordHome.inputsId}";
		var bName = "#{fertilizersRecordHome.inputsName}";

		var rpId = "#{fertilizersRecordHome.realPlantId}";
		var rpName = "#{fertilizersRecordHome.rpName}";
		if(bId != null && bId != 0 && bName != null && bName != "0"){
			var html = jquery("#combobox").html();
			jquery("#combobox").empty().append(html);
			jquery("#combobox").val(bId);
			if(jquery("#combobox")[0].selectedIndex==-1)
				jquery("#combobox")[0].selectedIndex=0;
			//_Q("#plant_plantId").selectmenu("destroy").selectmenu({style:'dropdown'});
			jquery("#combobox ~ .custom-combobox").filter(":eq(0)").find("input").val(bName);
		}

		if(rpId != null && rpId != 0 && rpName != null && rpName != "0"){
			var html = jquery("#combobox2").html();
			jquery("#combobox2").empty().append(html);
			jquery("#combobox2").val(rpId);
			if(jquery("#combobox2")[0].selectedIndex==-1)
				jquery("#combobox2")[0].selectedIndex=0;
			//_Q("#plant_plantId").selectmenu("destroy").selectmenu({style:'dropdown'});
			jquery("#combobox2 ~ .custom-combobox").filter(":eq(0)").find("input").val(rpName);
			}
	});
	//]]>
</script>
            </td> 
	</ui:define>

</ui:composition>
