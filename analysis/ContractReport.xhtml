<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"	
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a="http://richfaces.org/a4j" 
    template="/layout/template_left.xhtml">
<ui:define name="body">
<style>
.bootstrap-select:not([class*="span"]):not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn){width: 100px;}
</style>
<!--右边开始-->
	<td valign="top">
 				<div class="right_c">
                	<div class="r_title">
                    	<div class="r_t_l"><font size="3">采购合同汇总</font></div>
                    </div>
                    <ui:fragment rendered="#{s:hasRole('purchase_contract_analyse_search')}">	
                    
                    <div style="width:100%; height:30px; margin:20px 0;">
                    	 <h:form id="contractReportSearch">
                            <table cellpadding="0" cellspacing="0" height="30">
                                <tr>
                                    <td align="left">
                                            <div>
												<h:selectOneMenu styleClass="selectpicker" style="width:146px;" value="#{contractReportHome.beginYearInfo}" id="beginYearInfoId">
					                            	<f:selectItems value="#{contractReportHome.beginYear}"></f:selectItems>
					                            </h:selectOneMenu>
                                            </div>
                                    </td>
                                    <td align="left">
                                            <div style="margin-left: 8px;">
                                                <h:selectOneMenu styleClass="selectpicker" style="width:146px;" value="#{contractReportHome.beginMonthInfo}" id="beginMonthInfoId">
													<f:selectItem itemLabel="1月" itemValue="01"></f:selectItem>
													<f:selectItem itemLabel="2月" itemValue="02"></f:selectItem>
													<f:selectItem itemLabel="3月" itemValue="03"></f:selectItem>
													<f:selectItem itemLabel="4月" itemValue="04"></f:selectItem>
													<f:selectItem itemLabel="5月" itemValue="05"></f:selectItem>
													<f:selectItem itemLabel="6月" itemValue="06"></f:selectItem>
													<f:selectItem itemLabel="7月" itemValue="07"></f:selectItem>
													<f:selectItem itemLabel="8月" itemValue="08"></f:selectItem>
													<f:selectItem itemLabel="9月" itemValue="09"></f:selectItem>
													<f:selectItem itemLabel="10月" itemValue="10"></f:selectItem>
													<f:selectItem itemLabel="11月" itemValue="11"></f:selectItem>
													<f:selectItem itemLabel="12月" itemValue="12"></f:selectItem>
												</h:selectOneMenu>
                                            </div>
                                    </td>
                                     <td style="padding:0 16px 0 8px;">——</td>
                                    <td align="left">
                                        
                                            <div>
                                            	<h:selectOneMenu styleClass="selectpicker" style="width:146px;" value="#{contractReportHome.endYearInfo}" id="endYearInfoId">
					                            	<f:selectItems value="#{contractReportHome.endYear}"></f:selectItems>
					                            </h:selectOneMenu>
                                            </div>
                                    </td>
                                    <td align="left">
                                            <div style="margin-left: 8px;">
                                                <h:selectOneMenu styleClass="selectpicker" style="width:146px;" value="#{contractReportHome.endMonthInfo}" id="endMonthInfoId">
													<f:selectItem itemLabel="1月" itemValue="01"></f:selectItem>
													<f:selectItem itemLabel="2月" itemValue="02"></f:selectItem>
													<f:selectItem itemLabel="3月" itemValue="03"></f:selectItem>
													<f:selectItem itemLabel="4月" itemValue="04"></f:selectItem>
													<f:selectItem itemLabel="5月" itemValue="05"></f:selectItem>
													<f:selectItem itemLabel="6月" itemValue="06"></f:selectItem>
													<f:selectItem itemLabel="7月" itemValue="07"></f:selectItem>
													<f:selectItem itemLabel="8月" itemValue="08"></f:selectItem>
													<f:selectItem itemLabel="9月" itemValue="09"></f:selectItem>
													<f:selectItem itemLabel="10月" itemValue="10"></f:selectItem>
													<f:selectItem itemLabel="11月" itemValue="11"></f:selectItem>
													<f:selectItem itemLabel="12月" itemValue="12"></f:selectItem>
												</h:selectOneMenu>
                                            </div>
                                    </td>
                                    
                                    <td><h:commandButton style="margin-left: 8px;" id="search" action="/analysis/ContractReport.xhtml"  styleClass="btn btn-primary" value="搜索" onclick="return judgeTime()"/></td>
                                </tr>
                            </table>
                          </h:form>
                    </div>
                    </ui:fragment>
				 <div class="clear"></div>
                   </div>          
                   <div class="htbbser">
                        <div class="list">
                            <ul>
                                <a:repeat value="#{contractReportHome.dateList}" var="_dateInfo" rowKeyVar="_dateindex">
                                   	<li><a href="javascript:void(0);" onclick="clickTow('#{_dateindex}');" >#{_dateInfo.dateString}</a></li>
                              	</a:repeat>
                            </ul>
                         </div>   
                         <div class="clear"></div>
                   </div>                      
                    <div class="right_c">               
                     <div class="boxmon" >
                     	<a:repeat value="#{contractReportHome.dateList}" var="_dateInfo" rowKeyVar="_dindex">
                     	<div id="dateAll#{_dindex}" class="dateAll" style="display:#{_dindex eq 0 ?'':'none'}">         
                        <div style="width:170px; float:left;">
                        <table cellpadding="0" cellspacing="0" class="khtable_01" width="170" height="80" style="border-bottom:none;">
	                         <tr>
	                             <td rowspan="2" class="kh_td kh_th_font kh_th_bg" width="70" style="border-bottom:none;">序号</td>
	                             <td rowspan="2" class="kh_td kh_th_font kh_th_bg" width="100" style="border-bottom:none;">名称</td>
	                         </tr>
                         </table>       
                            <table cellpadding="0" cellspacing="0" class="khtable_01" width="170">
                            	<a:repeat value="#{_dateInfo.productList}" var="_productInfo" rowKeyVar="_pindex">
	                                <tr>
	                                    <td class="kh_td kh_td_font kh_leftbg" width="70">#{_pindex+1}</td>
	                                    <td class="kh_td kh_td_font kh_leftbg" width="100">#{_productInfo.name}</td>
	                                </tr>
                                </a:repeat>
                                <tr>
                                	<td class="kh_td kh_td_font kh_leftbg" colspan="2"><b>总计</b></td>
                                </tr>                           
                             </table>
                        </div>
                        <div  class="scroll1" style=" padding-right:2px; *padding-bottom:17px; border-right:1px solid #e1e4eb;"> 
                              <table cellpadding="0" cellspacing="0" >
                                    <tr>
                                        <td>
                                            <table cellpadding="0" cellspacing="0" class="khtable_02" style="width:190px;">
                                                <tr>
                                                    <td colspan="2" class="kh_td kh_th_font kh_each_thbg" height="40" >总计</td>
                                                </tr>
                                                <tr>
                                                    <td class="kh_td kh_th_font kh_each_thbg" height="40">采购量(Kg)</td>
                                                    <td class="kh_td kh_th_font kh_each_thbg">金额(元)</td>
                                                </tr>
                                            	<a:repeat value="#{_dateInfo.productList}" var="_productInfo" rowKeyVar="_ppindex">
                                                <tr>
                                                    <td class="kh_td kh_td_font kh_each_tdbg">#{_dateInfo.purchasesMap.get(_productInfo.productInfoId)}</td>
                                                    <td class="kh_td all_Arial kh_each_tdbg">#{_dateInfo.subtotalMap.get(_productInfo.productInfoId)}</td>
                                                </tr>
                                                </a:repeat>
                                                <tr>
                                                    <td class="kh_td all_Arial kh_each_tdbg">#{_dateInfo.purchasesAll}</td>
                                                    <td class="kh_td all_Arial kh_each_tdbg">#{_dateInfo.subtotalAll}</td>
                                                </tr>
                                            </table>
                                          </td>
                                         <a:repeat value="#{contractReportHome.miList}" var="_mInfo" rowKeyVar="_mindex">  
                                         <td>
                                            <table cellpadding="0" cellspacing="0" class="khtable_02">
                                                <tr>
                                                    <td colspan="3" class="kh_td kh_th_font kh_each_thbg02" height="40">#{_mInfo.realname}</td>
                                                </tr>
                                                <tr>
                                                    <td class="kh_td kh_th_font kh_each_thbg02" height="40">采购量(Kg)</td>
                                                    <td class="kh_td kh_th_font kh_each_thbg02">单价(元)</td>
                                                    <td class="kh_td kh_th_font kh_each_thbg02">金额(元)</td>
                                                </tr>
                                            	<a:repeat value="#{contractReportHome.getcpList(_dindex,_mInfo.memberInfoId)}" var="_cpInfo" rowKeyVar="_cindex">
	                                                <tr>
	                                                    <td class="kh_td kh_td_font kh_each_tdbg02">#{_cpInfo.purchases}</td>
	                                                    <td class="kh_td kh_td_font kh_each_tdbg02">#{_cpInfo.unitPrice}</td>
	                                                    <td class="kh_td all_Arial kh_each_tdbg02">#{_cpInfo.subtotal}</td>
	                                                </tr>
                                                </a:repeat>
                                                <tr>
                                                	<td class="kh_td all_Arial kh_each_tdbg">#{_dateInfo.purchases}</td>
                                                    <td class="kh_td all_Arial kh_each_tdbg"></td>
                                                    <td class="kh_td all_Arial kh_each_tdbg">#{_dateInfo.subtotal}</td>
                                                </tr>
                                            </table>
                                          </td>
                                        </a:repeat>
                                    </tr>
                                 </table>   
						</div> 
						<div class="clear"></div>                         
                        </div>
                       </a:repeat>
                       <div class="clear"></div>  
                       
                     </div>    
                	
                    <div class="clear"></div>       
                </div>

                 

            </td>  
            <script type="text/javascript">
          //<![CDATA[
	jquery(".form_datetime").datetimepicker({
			    format: "yyyy-mm-dd",
			    autoclose: true,
				 weekStart: 1,
				  //startDate: "2014-08-14 10:00",
				 language:  'zh-CN',
				 minView:2,
			    pickerPosition: "bottom-left"
			    });
				  jquery('.selectpicker').selectpicker();

jquery(document).ready(function(){  
	var onLoadWidth = document.body.clientWidth;
	jquery('.scroll1').css("width",(onLoadWidth-524)+ "px"); 
	var obj = #{contractReportHome.miList.size()};
	var wi = jquery(".khtable_02").width();
	if(wi * obj < onLoadWidth-524){
		var newWi = (onLoadWidth-524)/(obj+1);
		jquery('.scroll1').css("border-right","0px"); 
	}
	
});

jquery(window).resize(function(){
   	var onLoadWidth = document.body.clientWidth;
	jquery('.scroll1').css("width",(onLoadWidth-524)+ "px");
});
function judgeTime(){
	var beginYearInfo = Number(jquery("#contractReportSearch\\:beginYearInfoId").val());
	var beginMonthInfo = Number(jquery("#contractReportSearch\\:beginMonthInfoId").val());
	var endYearInfo = Number(jquery("#contractReportSearch\\:endYearInfoId").val());
	var endMonthInfo = Number(jquery("#contractReportSearch\\:endMonthInfoId").val());
	var yearBetween = endYearInfo - beginYearInfo;
	var monthBetween = endMonthInfo - beginMonthInfo;
	if(yearBetween<0){
		alert("开始时间不能大于结束时间");
		return false;
		}
	else if(yearBetween==0){//同一年
		if(monthBetween<0){
			alert("开始时间不能大于结束时间");
	 		return false;
			}
		}
	else if(yearBetween==1){
			if((12-beginMonthInfo+endMonthInfo)>=12){
				alert("开始时间和结束时间相差不能超过12个月");
				return false;
				}
		}
	else if(yearBetween>1){
		alert("开始时间和结束时间相差不能超过12个月");
		return false;
	}
	return true;
}
//]]>
</script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/tab.js"></script>
<script >
//<![CDATA[
jquery(function(){
	jquery(".list").jTab({
        menutag: ".list li",
        boxtag: ".boxmon > div",
        cur: 0
    });
});
function clickTow(k){
	jquery(".dateAll").css("display","none");
	jquery("#dateAll"+k).css("display","block");
  	var onLoadWidth = document.body.clientWidth;
	jquery('.scroll1').css("width",(onLoadWidth-524)+ "px");
}
//]]>
</script>
    <!--右边结束-->
	
</ui:define>
</ui:composition>
