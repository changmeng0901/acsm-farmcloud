<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"	
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a="http://richfaces.org/a4j" 
    template="/layout/template_pack.xhtml">
    
<ui:define name="body">
<script type="text/javascript">
	var totalNum=0.0;
</script>
	#{inOutStorageRecordHome.queryDetailsFind()}
	<td valign="top" width="100%">
	<div id="rightPanel" class="right_c" style="width: 700px;margin:auto;">
		<div class="ckd_d" style="font-size:22px;">
			<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.storageType eq 1}">入库单</s:fragment>
			<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.storageType eq 2}">出库单</s:fragment>
		</div>
		<table width="700" cellpadding="0" cellspacing="0" style="margin:0 auto ; font-family:'宋体';">
		    <tr>
		    	<td width="250" height="30px;">
		    		<table width="100%" cellpadding="0" cellspacing="0" >
		        		<tr>
		                	<td width="80" height="28" align="center" style="font-size:14px;">
		                	<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.storageType eq 1}">入库编号：</s:fragment>
								<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.storageType eq 2}">出库编号：</s:fragment>
		                	</td>
		                    <td style=" font-size:14px;" >
		                    <h:outputText value="#{inOutStorageRecordHome.storageChangeForm.name}"></h:outputText>
		                    </td>
		                </tr>
		            </table>
		    	</td>
		        <td width="230">
		        	<!-- 年月日 开始 -->
		            <table width="100%" cellpadding="0" cellspacing="0" style="margin:0 auto;" align="center">
		            	<tr>
		                	<td width="80" height="28" align="center" style="font-size:14px;" >
		                	<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.storageType eq 1}">入库日期：</s:fragment>
								<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.storageType eq 2}">出库日期：</s:fragment>
							</td>
							<td style=" font-size:14px;" >
		                    <h:outputText value="#{inOutStorageRecordHome.storageChangeForm.insertTime}"><s:convertDateTime type="both" dateStyle="short" pattern="yyyy-MM-dd  HH:mm" /></h:outputText>
		                    </td>
		                </tr>
		            </table>
		        	<!-- 年月日 结束 -->
		        </td>
		        <td width="220">
		        	<!-- 操作人开始 -->
		        	<table width="100%" cellpadding="0" cellspacing="0" >
		        		<tr>
		                	<td width="64" height="28" align="center" style="font-size:14px;">
		                	经办人：
		                	</td>
		                    <td style=" font-size:14px;" >
							
								<h:outputText rendered="#{inOutStorageRecordHome.storageChangeForm.operater.name eq null}">
									系统自动操作
								</h:outputText>
								<h:outputText rendered="#{inOutStorageRecordHome.storageChangeForm.operater.name ne null}">
									#{inOutStorageRecordHome.storageChangeForm.operater.name}
								</h:outputText>
							</td>
		                </tr>
		            </table>
		            <!-- 操作人 结束 -->
		        </td>
		    </tr>
		</table>
		<hr/>
		<table width="700" cellpadding="0" cellspacing="0" style="margin:0 auto ; font-family:'宋体';">
		    <tr>
		    	<td width="250" height="30px;">
		    		<table width="100%" cellpadding="0" cellspacing="0" >
		        		<tr>
		                	<td width="80" height="28" align="center" style="font-size:14px;">
		                	<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.storageType eq 1}">入库类型：</s:fragment>
							<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.storageType eq 2}">出库类型：</s:fragment>		
		                	</td>
		                    <td style=" font-size:14px;" >
		                    #{inOutStorageRecordHome.storageChangeForm.storageRoom.name}
		                    </td>
		                </tr>
		            </table>
		    	</td>
		        <td width="230">
		        	<!-- 年月日 开始 -->
		            <table width="100%" cellpadding="0" cellspacing="0" style="margin:0 auto;" align="center">
		            	<tr>
		                	<td width="80" height="28" align="center" style="font-size:14px;" >
		                	<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.storageType eq 1}">入库类型：</s:fragment>
							<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.storageType eq 2}">出库类型：</s:fragment>		
							</td>
							<td style=" font-size:14px;" >
		                   <h:outputText value="#{publicStorageHome.getStorageChangeTypeName(inOutStorageRecordHome.storageChangeForm.storageChangeTypeId.storageChangeTypeId,inOutStorageRecordHome.storageChangeForm.storageType)}"></h:outputText>
		                    </td>
		                </tr>
		            </table>
		        	<!-- 年月日 结束 -->
		        </td>
		        <td width="220">
		        	<!-- 操作人开始 -->
		        	<table width="100%" cellpadding="0" cellspacing="0" >
		        		<tr>
		                	<td width="64" height="28" align="center" style="font-size:14px;">
		                	操作人：
		                	</td>
		                    <td style=" font-size:14px;" >
								<h:outputText value="#{sessionTake.nickname}"></h:outputText>
							</td>
		                </tr>
		            </table>
		            <!-- 操作人 结束 -->
		        </td>
		    </tr>
		</table>
		
		<table  width="700" cellpadding="0" cellspacing="0" style="margin:0 auto ; font-family:'宋体';">
			<tr>
				<td height="28"  style="font-size:14px;">备注：
					<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.comment eq ''}">无</s:fragment>
					<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.comment ne ''}">#{inOutStorageRecordHome.storageChangeForm.comment}</s:fragment>
				</td>
			</tr>
		</table>		
			
		<table width="700"  cellpadding="0" cellspacing="0"  style="margin:0 auto ; font-family:'宋体';">
			<tr>
				<td width="5" height="4"><img src="#{request.contextPath}/asset/images/table_d_40.jpg" width="5" height="4" /></td>
				<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.productType eq 1}">
					<td colspan="10" style="border-top:1px solid #e1e1e1; background:#f0f5fb;"></td>
				</s:fragment>
				<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.productType ne 1}">
					<td colspan="8" style="border-top:1px solid #e1e1e1; background:#f0f5fb;"></td>
				</s:fragment>
				<td width="5" height="4"><img src="#{request.contextPath}/asset/images/table_d_43.jpg" width="5" height="4" /></td>
			</tr>
			<tr>
				<th class="ze_bg ze_bt_le" width="5" height="4"></th>
				<th  class="ze_bg">序号</th>
				<th  class="ze_bg">批次编号</th>
				<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.productType eq 1}">
					<th class="ze_bg">来源</th>
					<th class="ze_bg">等级</th>
				</s:fragment>
				<th  class="ze_bg">物料名称</th>
				<th  class="ze_bg">保质期</th>
				<th  class="ze_bg">数量</th>
				<th  class="ze_bg">规格</th>
				<th  class="ze_bg">单价</th>
				<th  class="ze_bg">小计</th>
				<th class="ze_bg ze_bt_ri" width="5" height="4"></th>
			</tr>
			<a:repeat value="#{inOutStorageRecordHome.storageDetaiList}" var="_gpcr" rowKeyVar="_index">
				<tr>
					<td class="ze_bg2 ze_bt_le" width="5" height="4"></td>
					<td class="ze_bg2">#{_index+1}</td>
					<td class="ze_bg2"><h:outputText value="#{_gpcr[1]}" /></td>
					<s:fragment rendered="#{inOutStorageRecordHome.storageChangeForm.productType eq 1}">
						<td class="ze_bg2">
							<h:outputText value="--" rendered="#{null eq _gpcr[13]}"/>
							<h:outputText value="#{ _gpcr[13]}" rendered="#{null ne  _gpcr[13]}"/> 
						</td>
						<td class="ze_bg2">
							<h:outputText value="--" rendered="#{null eq  _gpcr[12]}"/>
							<h:outputText value="#{ _gpcr[12]}" rendered="#{null ne  _gpcr[12]}"/> 
						</td>
					</s:fragment>
					<td class="ze_bg2"><h:outputText value="#{_gpcr[2]}" /></td>
					<td class="ze_bg2"><h:outputText value="#{_gpcr[3]}天" /></td>
					<td class="ze_bg2">
						<s:fragment rendered="#{_gpcr[8] eq 1}">
							<h:outputText value="#{unitStranfer.outStranfer(_gpcr[7],_gpcr[5])}"><f:convertNumber pattern="#.###"/></h:outputText>
						</s:fragment>
						<s:fragment rendered="#{_gpcr[8] ne 1}">
							<h:outputText value="#{_gpcr[5]}"><f:convertNumber pattern="#.###"/></h:outputText>
						</s:fragment>
					</td>
					<td class="ze_bg2">
						<s:fragment rendered="#{_gpcr[8] eq 1}">
							#{_gpcr[6]}
						</s:fragment>
						<s:fragment rendered="#{_gpcr[8] ne 1}">
							#{_gpcr[10]}#{_gpcr[6]}
							<s:fragment rendered="#{_gpcr[11] ne null and _gpcr[11] ne ''}">
								/#{_gpcr[11]}
							</s:fragment>
						</s:fragment>
					</td>
					<td class="ze_bg2">￥<h:outputText value="#{_gpcr[9]}"><f:convertNumber pattern="#0.00"/></h:outputText></td>
					<td class="ze_bg2">
						<s:fragment rendered="#{_gpcr[8] eq 1}">
							<h:outputText value="#{unitStranfer.outStranfer(_gpcr[7],_gpcr[5]) * _gpcr[9]}"><f:convertNumber pattern="#0.00"/></h:outputText>
							<script type="text/javascript">
								totalNum+=#{unitStranfer.outStranfer(_gpcr[7],_gpcr[5]) * _gpcr[9]};
							</script>
						</s:fragment>
						<s:fragment rendered="#{_gpcr[8] ne 1}">	
							<h:outputText value="#{_gpcr[5] * _gpcr[9]}"><f:convertNumber pattern="#0.00"/></h:outputText>			
							<script type="text/javascript">
								totalNum+=#{_gpcr[5] * _gpcr[9]};
							</script>
						</s:fragment>
					</td>
					<td class="ze_bg2 ze_bt_ri" width="5" height="4"></td>
				</tr>
			</a:repeat>
		</table>
		<div  style="border:0px;margin-top:15px;margin:auto;font-weight: bold;width: 700px;" align="center">
				<table width="700">
					<tr>
						<td class="print_001" style="float:left;">金额合计：<h:outputText id="totalNumer" value=""><f:convertNumber pattern="#0.00"/></h:outputText> </td>
						<td class="print_001" style="float:right;margin-right:25%;">签字确认：</td>
					</tr>
				</table>		
			<div class="clear"></div>
		</div>
		<div id="printButton" class="car_button" style="text-align: center;margin-top:30px;">
			
			<s:button view="/inOut/InOutRecord.xhtml" styleClass="edit_back" id="bn_left6" style="margin-left:10px" onclick="window.close();return false;"/>&#160;
			<input type="button" id="btnPrint" onclick="printButtonClick();" style="background-image: url('#{request.contextPath}/asset/images/print03.jpg');width: 77px;height: 32px;cursor: pointer;" />
		</div>
	</div>
	</td>
	<script type="text/javascript">
		//总计赋值
	   jQuery("#totalNumer").html(totalNum.toFixed(2));
		var obj;
		function printButtonClick(){
			obj = jQuery("#printButton").clone();
			jQuery("#printButton").empty();
			jQuery("#rightPanel").printArea();
		}
		
		function closeAll(){
			if(confirm("是否关闭打印页面!")){
				window.close();
			}else{
				jQuery("#printButton").html(obj);
			}
		}
	</script>
</ui:define>
</ui:composition>
