<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	template="/layout/template_new.xhtml">
<ui:define name="body">
	#{purchaseQuoteInfoHome.initDetail()}
	<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/off.css" />
<style>
.star-r32{ float:left;margin-left:5px;height:32px;line-height:32px;color:red;font-size:12px;}
</style>	
<td valign="top">
<!--右边开始-->
<div class="right_c clear">
<!-- 面包屑导航 开始 -->
<!-- right_c 开始 -->
<div class="right_c" style="min-height:30px; padding-top:20px;">
    <div class="r_title clear" style="margin-top:0; height:48px; border-bottom:1px solid #f1f2f2;">
        <div class="r_t_l fl"><span>销售工具</span><em>&nbsp;&gt;&nbsp;</em><span>买手关注</span><em>&nbsp;&gt;&nbsp;</em><font size="3">求购信息</font></div>
    </div>
    
    <!-- 个人设置 开始 -->
    <div class="mt20">
    <input type="hidden" value="#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseQuoteInfoId}" id="purchaseQuoteInfoId" />
        <table width="100%" cellpadding="0" cellspacing="0">
            <tr>
                <td valign="top" width="200">
                <div class="grszLt" style="margin-top:25px;">
                	<h:outputText rendered="#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.plantImage ne null and purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.plantImage ne 'null' and purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.plantImage ne ''}">
	                    <img src="#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.plantImage}" />
                	</h:outputText>
                	<h:outputText rendered="#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.plantImage eq null or purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.plantImage eq 'null' or purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.plantImage eq ''}">
	                    <img src="../asset/images/851.jpg" />
                	</h:outputText>
                </div>
                </td>
                <td valign="top">
                <div class="grszRt clear">
                    <!-- 个人信息头部 开始 -->
                    <div class="grxxHt" style="border-bottom:0;">
                        <h3 style="color:#76c66d;">#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.plantName}</h3>
                        <div class="off_sum">
                            <span class="former">采购量</span>
                            <span class="latter">
                            <h:outputText rendered="#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.purchaseNumStr ne null and purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.purchaseNumStr ne ''}">
                            #{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.purchaseNumStr}#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.unitName}
                            </h:outputText>
        					<h:outputText rendered="#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.purchaseNumStr eq null or purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.purchaseNumStr eq ''}">
        					面议
        					</h:outputText>
        					</span>
                        </div>
                    </div>
                    <!-- 产品信息头部 结束 -->
                    <!-- 产品信息中部 开始 -->
                    <h:panelGroup id="baojia">
                    <div class="grxxCt">
                        <table width="100%" cellpadding="0" cellspacing="0">
                            <tr>
                                <td class="border58" width="50%">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>
                                            <td width="30" align="center"><img src="#{request.contextPath}/asset/images/supply/off_icon1.png" /></td>
                                            <td width="80" align="left">我的报价</td>
                                            <td class="blongsTxt" align="left">￥
                                            	<span style="color:#ff5000;font-size:22px;">#{purchaseQuoteInfoHome.purchaseQuoteInfo.price}</span>
                                            	<s:fragment rendered="#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.unitName ne null}">
                                            	元/#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.unitName}
                                            	</s:fragment> 
                                            	<s:fragment rendered="#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.unitName eq null}">
                                            	元/公斤
                                            	</s:fragment>
                                            	&#160;&#160;&#160;<img src="../asset/images/orderManage/table_ico101.png" width="18" height="18" style="padding-top: 0px; padding-bottom: 3px;cursor:pointer;" onclick="hdaccount();"/>
                                            	<img src="#{request.contextPath}/asset/images/02_62.png" width="18" height="18" style="padding-top: 0px; padding-bottom: 3px;cursor:pointer;" onclick="delPrice();"/>
                                            	
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td class="border58" width="50%">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>
                                            <td width="30" align="center"><img src="#{request.contextPath}/asset/images/supply/off_icon2.png" /></td>
                                            <td width="80" align="left">品&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;种</td>
                                            <td class="blongsTxt" align="left">
                                            	#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.breedName eq "null"?"":purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.breedName}
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td class="border58" width="50%">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>
                                            <td width="30" align="center"><img src="#{request.contextPath}/asset/images/supply/off_icon3.png" /></td>
                                            <td width="80" align="left">报价时间</td>
                                            <td class="blongsTxt" align="left">#{purchaseQuoteInfoHome.purchaseQuoteInfo.quoteTimeStr}</td>
                                        </tr>
                                    </table>
                                </td>
                                <td class="border58" width="50%">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>
                                            <td width="30" align="center"><img src="#{request.contextPath}/asset/images/supply/off_icon4.png" /></td>
                                            <td width="80" align="left">采购单位</td>
                                            <td class="blongsTxt" align="left">
                                            	#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.enterpriseInfo.name}
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                          
                            <tr>
                                <td class="border58" colspan="2">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>
                                            <td width="30" align="center"><img src="#{request.contextPath}/asset/images/supply/off_icon5.png" /></td>
                                            <td width="80" align="left">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注</td>
                                            <td class="blongsTxt" align="left">
                                            	#{purchaseQuoteInfoHome.purchaseQuoteInfo.remark eq "null" ? "" : purchaseQuoteInfoHome.purchaseQuoteInfo.remark}
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td class="border58" width="50%"></td>
                            </tr>
                        </table>
                    </div>
                    </h:panelGroup>
                    <!-- 产品信息中部 结束 -->
                 
                </div>
                   <div class="grszRt clear">
                    <!-- 供应信息头部 开始 -->
                    <div class="grxxHt">
                        <h3>需求详情</h3>
                    </div>
                    <!-- 供应信息头部 结束 -->
                    <!-- 供应信息中部 开始 -->
                    <div class="grxxCt">
                        <table width="100%" cellpadding="0" cellspacing="0">
                            <tr>
                                <td class="border58" width="33%">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>                                   
                                            <td width="80" align="left">品&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;质</td>
                                            <td class="blongsTxt" align="left">
                                            	#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.standard.name}
                                            	 <h:outputText rendered="#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.localProduct}">
				                                   	<span style="padding-left: 10px;">地标产品</span>
				                                 </h:outputText>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td class="border58" width="33%">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>                                            
                                            <td width="80" align="left">采购价格</td>
                                            <td class="blongsTxt" align="left">
                                            	<h:outputText rendered="#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.minPrice != 0 or purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.maxPrice != 0}">
	                                            	#{purchaseProductInfoHome.getPriceDouble(purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.minPrice)}~
	                                            	#{purchaseProductInfoHome.getPriceDouble(purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.maxPrice)}元/#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.unitName}
                                            	</h:outputText>
                                            	<h:outputText rendered="#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.minPrice == 0 and purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.maxPrice == 0}">
                                            		面议
                                            	</h:outputText>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td class="border58">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>                                            
                                            <td width="80" align="left">规&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</td>
                                            <td class="blongsTxt" align="left">
                                            	#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.spec eq "null" ? "" : purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.spec}
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <!-- <tr>
                                <td class="border58" width="33%">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>                                   
                                            <td width="80" align="left">采购日期</td>
                                            <td class="blongsTxt" align="left">
                                            	#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.purchaseTimeStr}
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td class="border58" width="33%">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>                                            
                                            <td width="80" align="left">采购周期</td>
                                            <td class="blongsTxt" align="left">
                                            	#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.cycleTypeName}
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td class="border58">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>                                            
                                            <td width="80" align="left">配送方式</td>
                                            <td class="blongsTxt" align="left">
                                            	#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.deliverName}
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr> -->
                            <tr>
                            	<td class="border58" width="33%">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>                                   
                                            <td width="80" align="left">采购日期</td>
                                            <td class="blongsTxt" align="left">
                                            	#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.purchaseTimeStr}
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <!-- <td class="border58" width="33%">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>                                   
                                            <td width="80" align="left">包装要求</td>
                                            <td class="blongsTxt" align="left">
                                            	#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.packingName}
                                            </td>
                                        </tr>
                                    </table>
                                </td> -->
                                <td class="border58" width="33%">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>                                            
                                            <td width="80" align="left">追溯要求</td>
                                            <td class="blongsTxt" align="left">
                                            	#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.traceType}
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td class="border58">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>                                            
                                            <td width="80" align="left">产地要求</td>
                                            <td class="blongsTxt" align="left">
                                            	#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.areaIds}
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                               <td class="border58" colspan="3">
                                    <table width="100%" cellpadding="0" cellspacing="0">
                                        <tr>                                            
                                            <td width="80" align="left">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注</td>
                                            <td class="blongsTxt" align="left">
                                            	#{purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.remark eq "null" ? "" : purchaseQuoteInfoHome.purchaseQuoteInfo.purchaseProductInfo.remark}
                                            </td>
                                        </tr>
                                    </table>
                                </td> 
                            </tr>
                        </table>
                    </div>
                    <!-- 供应信息中部 结束 -->   
                </div>
                <div class="returnBtn">
                	<s:button view="/supply/Off.seam" value="返回" styleClass="btn btn-default" id="bn_left6" style="margin-left:10px" propagation="none">
						<f:param name="search" value="#{purchaseQuoteInfoHome.search}"/>
						<f:param name="page" value="#{purchaseQuoteInfoHome.page}"/>
					</s:button>
                </div>
                </td>
            </tr>
        </table>
    </div>
    <!-- 供应设置 结束 -->
</div>
<!-- right_c 结束 -->
</div>
<!--右侧结束-->

<!-- 我要报价 内容开始 -->
			    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			    <h:form id="from">
			      <div class="modal-dialog">
			      	<h:panelGroup id="baojia">
			        <div class="modal-content" style="width:580px; left:50%; margin-left:-290px; top:117px;">
			          <div class="modal-header">
			            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
			            <h4 class="modal-title" id="myModalLabel">报价信息<!-- <span id="plantName" style="font-size: 12px;" >aaa</span> --></h4>
			          </div>
			          <div class="modal-body">
			           <table width="100%" class="pop-td">
			             <tr>
			               <td class="off-pop">报价企业</td>
			               <td>#{purchaseProductInfoHome.findEnterpriseNameById(sessionTake.enterpriseInfoId)}</td>
			             </tr>
			             <tr>
			               <td class="off-pop">联&nbsp;&nbsp;系&nbsp;&nbsp;人</td>
			               <td>
			               		<input id="contactPerson" type="text" class="form-control nw200 fl" value="#{purchaseQuoteInfoHome.purchaseQuoteInfo.contacter}"/>
			              		<span class="star-r32">*</span>
			               </td>
			             </tr>
			             <tr>
			               <td class="off-pop">联系电话</td>
			               <td>
			               		<input id="contactPhone" type="text" class="form-control nw200 fl" value="#{purchaseQuoteInfoHome.purchaseQuoteInfo.phone}"/>
			               		<span class="star-r32">*</span>
			               </td>
			             </tr>
			             <tr>
			               <td class="off-pop">价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</td>
			               <td>
			               		<input id="purPrice" type="text" class="form-control nw200 fl" value="#{purchaseQuoteInfoHome.purchaseQuoteInfo.price}" style="color:#bfbfbf;"/>
			               		<span class="star-r32">*</span>
			               </td>
			             </tr>
			             <tr>
			               <td class="off-pop">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注</td>
			               <td>
			               		<textarea id="purRemark" class="form-control nw300" rows="3">#{purchaseQuoteInfoHome.purchaseQuoteInfo.remark eq "null" ? "" : purchaseQuoteInfoHome.purchaseQuoteInfo.remark}</textarea>
			               		<input type="hidden" value="#{purchaseQuoteInfoHome.purchaseProductInfoId}" id="purProId"/>
			               </td>
			             </tr>
			           </table>
			          </div>
			          <div class="modal-footer">
			            <button type="button" class="btn btn-success" onclick="submitSave();">提交</button>
			            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			          </div>
			        </div>
			    	</h:panelGroup>
			      </div>
			      </h:form>
			    </div>
    			<!-- 我要报价 内容结束 -->
</td>

<a4j:form>
<a4j:queue requestDelay="10" ignoreDupResponses="true"/>
	<a4j:jsFunction name="submitPriceInfo" action="#{purchaseProductInfoHome.submitPriceInfo}" data="#{purchaseProductInfoHome.callStr}" reRender="baojia" oncomplete="if(data == 'succ'){alert('修改报价成功！');jquery('#myModal').modal('hide')}else{alert('修改报价失败！');jquery('#myModal').modal('hide')} window.location.reload();" >
		<a4j:actionparam name="contactPerson" assignTo="#{purchaseProductInfoHome.contactPerson}"/>
		<a4j:actionparam name="contactPhone" assignTo="#{purchaseProductInfoHome.contactPhone}"/>
		<a4j:actionparam name="purPrice" assignTo="#{purchaseProductInfoHome.purPrice}"/>
		<a4j:actionparam name="purRemark" assignTo="#{purchaseProductInfoHome.purRemark}"/>
		<a4j:actionparam name="purchaseProId" assignTo="#{purchaseProductInfoHome.purchaseProductInfoId}"/>
	</a4j:jsFunction>
	<a4j:jsFunction name="delQuotedPrice" action="#{purchaseQuoteInfoHome.delQuotedPrice}" data="#{purchaseQuoteInfoHome.falg}"  oncomplete="delComplete(data)">
	</a4j:jsFunction>
	<a4j:jsFunction name="delBackListPage" action="#{purchaseQuoteInfoHome.delBackListPage}" >
	</a4j:jsFunction>
</a4j:form>

<script type="text/javascript">
//<![CDATA[
           
	function hdaccount(){
		jquery("#myModal").modal('show');
    	jquery('#myModal').on('shown.bs.modal', function () {
    		jquery('html').css({'overflow':'hidden'})
   		})
   		jquery('#myModal').on('hide.bs.modal', function () {
   			jquery('html').css({'overflow':'auto'})
   		})
    }
    
	//提交报价信息
    function submitSave(){
    	var purchaseProId = jquery("#purProId").val();
    	//联系人 contactPerson
    	var contactPerson = jquery("#contactPerson").val();
    	if(contactPerson.length > 30){
    		alert("联系人长度不可超过30！");
    		return false;
    	}
    	if(contactPerson == "" || contactPerson == null){
    		alert("联系人不可为空！");
    		return false;
    	}
    	//联系电话 contactPhone
    	var contactPhone = jquery("#contactPhone").val();
    	var reg = /^[\d-]{0,50}$/;
      	if(contactPhone == ""){
        	alert("联系电话不可为空!");
        	return false;
      	}
      	if(!reg.test(contactPhone)){
         	alert('联系电话只支持数字和"-"!');
         	return false;
      	}
    	//价格 purPrice
      	var purPrice = jquery("#purPrice").val();
    	var reg1 = new RegExp("^[0-9]*$");
    	if(isNaN(purPrice)){
    	    alert("价格必须输入数字!");
    	    return false;
    	}
    	if(purPrice == ""){
    		alert("价格不许为空!");
        	return false;
    	}
    	//备注 purRemark
      	var purRemark = jquery("#purRemark").val();
      	if(purRemark.length >= 200){
    		alert("备注长度不可超过200！");
    		return false;
    	}
      	submitPriceInfo(contactPerson,contactPhone,purPrice,purRemark,purchaseProId);
    }
	//删除报价
    function delPrice(){
		var flag = confirm("删除后渠道商将看不到您的报价信息，确定删除？");
		if(flag){
			delQuotedPrice();
		}
    }
	//删除报价回调
    function delComplete(data){
		if(data){
			delBackListPage();
		}else{
			alert("删除失败，请稍后再试!");
		}
    }
//]]>
</script>
</ui:define>
</ui:composition>