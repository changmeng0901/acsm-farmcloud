<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"	
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a="http://richfaces.org/a4j" 
    template="/layout/template_new.xhtml">

<ui:define name="body">
<td valign="top" width="100%">
	<div class="right_c">
		<div class="r_title">
			<div class="r_t_l">采销存&#160;&gt;&#160;&#160;<a href="#{request.contextPath}/contract/ContractList.seam">长期合同</a>&#160;&gt;&#160;&#160;<font size="3">需求明细</font></div>
            <div class="r_t_r">
           	<div class="est">
                	<ul style="float:right;">
                    	<li id="current2"  style=" padding:0 5px; ">
                    		<a class="zjjh08" href="javascript:void(0);" onclick="clickXuan(2)">
                    			<strong>日期排列</strong>
                    		</a>
                    	</li>
                     	<li id="current1" class="current" style=" padding:0 5px; background:url(../asset/images/lne_09.jpg) right center no-repeat;">
                    		<a class="zjjh08" style="float:right; " href="javascript:void(0);" onclick="clickXuan(1)">
                     			<strong>商品排列</strong>
                     		</a>
                     	</li>
                	</ul>
            	</div>    	
           </div>
		</div>
		<s:div id="contract">
		<div id="date" style="padding-top:30px; overflow:hidden;">
			<div style="width:173px; float:left;">
				<table cellpadding="0" cellspacing="0" class="khtable_01" width="173" height="80" style="border-bottom:none;">
					<tr>
					    <td rowspan="2" class="kh_td kh_th_font kh_th_bg" width="70" style="border-bottom:none;">序号</td>
					    <td rowspan="2" class="kh_td kh_th_font kh_th_bg" width="100" style="border-bottom:none;">名称</td>
					</tr>
           		</table>       
				<table cellpadding="0" cellspacing="0" class="khtable_01" width="173">
					<a:repeat value="#{contractHome.cartList}" var="_productInfo" rowKeyVar="_index">
					    <tr>
					        <td class="kh_td kh_td_font kh_leftbg" width="70">#{_index +1}</td>
					        <td class="kh_td kh_td_font kh_leftbg" width="100">#{_productInfo.name}</td>
					    </tr>
				  	</a:repeat>
				    <tr>
				    	<td class="kh_td kh_td_font kh_leftbg" colspan="2"><b>总计</b></td>
				    </tr>                           
				 </table>
			</div>
			<div id="scroll1" style="border-right:1px solid #ddd;">  
      			<table cellpadding="0" cellspacing="0">
            		<tr>
               			<a:repeat value="#{contractHome.dateInfoList}" var="_dateInfo" rowKeyVar="_index">
                			<td>
								<table cellpadding="0" cellspacing="0" class="khtable_02 date_index">
                        			<tr>
										<td colspan="3" class="kh_td kh_th_font #{_index % 2 == 0 ? 'kh_each_thbg':'kh_each_thbg02'}" height="40"> 
											<h:outputText value="#{_dateInfo.dateString}">
												<s:convertDateTime type="both" dateStyle="short" pattern="yyyy年MM月" />
											</h:outputText>
                            			</td>
                        			</tr>
			                        <tr>
			                            <td class="kh_td kh_th_font #{_index % 2 == 0 ? 'kh_each_thbg':'kh_each_thbg02'}" height="40">采购量(kg)</td>
			                            <td class="kh_td kh_th_font #{_index % 2 == 0 ? 'kh_each_thbg':'kh_each_thbg02'}">单价(元)</td>
			                            <td class="kh_td kh_th_font #{_index % 2 == 0 ? 'kh_each_thbg':'kh_each_thbg02'}">金额(元)</td>
			                        </tr>
                	  				<a:repeat value="#{contractHome.contractMap.get(_dateInfo.dateString)}" var="_contract" >
										<tr>
											<td class="kh_td kh_td_font #{_index % 2 == 0 ? 'kh_each_tdbg':'kh_each_tdbg02'}">
												<h:outputText value="#{_contract.purchases}"/>
											</td>
											<td class="kh_td kh_td_font #{_index % 2 == 0 ? 'kh_each_tdbg':'kh_each_tdbg02'}">
												<h:outputText value="#{_contract.unitPrice}"/>
							                </td>
							                <td class="kh_td all_Arial #{_index % 2 == 0 ? 'kh_each_tdbg':'kh_each_tdbg02'}"><h:outputText value="#{_contract.subtotal}"/></td>
           								</tr>
          							</a:repeat>
           							<tr>
						           		<td class="kh_td all_Arial #{_index % 2 == 0 ? 'kh_each_tdbg':'kh_each_tdbg02'}">#{_dateInfo.purchasesSum}</td>
						               	<td class="kh_td all_Arial #{_index % 2 == 0 ? 'kh_each_tdbg':'kh_each_tdbg02'}"></td>
						               	<td class="kh_td all_Arial #{_index % 2 == 0 ? 'kh_each_tdbg':'kh_each_tdbg02'}">#{_dateInfo.subtotalSum}</td>
						           	</tr>
								</table>
     						</td>
   						</a:repeat>
 					</tr>
    			</table>   
			</div> 
		</div>
		<div id="date2" style="padding-top:30px; overflow:hidden;display: none;">
			<div style="width:173px; float:left;*margin-top: 2px;">
				<table cellpadding="0" cellspacing="0" class="khtable_01" width="173" height="80" style="border-bottom:none;">
					<tr>
					    <td rowspan="2" class="kh_td kh_th_font kh_th_bg" width="70" style="border-bottom:none;">序号</td>
					    <td rowspan="2" class="kh_td kh_th_font kh_th_bg" width="100" style="border-bottom:none;">日期</td>
					</tr>
           		</table>       
				<table cellpadding="0" cellspacing="0" class="khtable_01" width="173">
					<a:repeat value="#{contractHome.dateInfoList}" var="_dateInfo" rowKeyVar="_index">
					    <tr>
					        <td class="kh_td kh_td_font kh_leftbg" width="70">#{_index +1}</td>
					        <td class="kh_td kh_td_font kh_leftbg" width="100"> 
					        	<h:outputText value="#{_dateInfo.dateString}">
									<s:convertDateTime type="both" dateStyle="short" pattern="yyyy年MM月" />
								</h:outputText>
					        </td>
					    </tr>
				  	</a:repeat>
				    <tr>
				    	<td class="kh_td kh_td_font kh_leftbg" colspan="2"><b>总计</b></td>
				    </tr>                           
				 </table>
			</div>
			<div id="scroll2" >
    			<h:panelGrid id="contract2" cellpadding="0" cellspacing="0" >
            		<tr>
               			<a:repeat value="#{contractHome.contractMap.get(contractHome.dateInfoList.get(0).dateString)}" var="_contract" rowKeyVar="_indexc" >
                			<td>
								<table cellpadding="0" cellspacing="0" class="khtable_02 ">
                        			<tr>
										<td colspan="3" class="kh_td kh_th_font #{_indexc % 2 == 0 ? 'kh_each_thbg':'kh_each_thbg02'}" height="40"> 
											#{_contract.productInfoId.name}
                            			</td>
                        			</tr>
			                        <tr>
			                            <td class="kh_td kh_th_font #{_indexc % 2 == 0 ? 'kh_each_thbg':'kh_each_thbg02'}" height="40">采购量(kg)</td>
			                            <td class="kh_td kh_th_font #{_indexc % 2 == 0 ? 'kh_each_thbg':'kh_each_thbg02'}">单价(元)</td>
			                            <td class="kh_td kh_th_font #{_indexc % 2 == 0 ? 'kh_each_thbg':'kh_each_thbg02'}">金额(元)</td>
			                        </tr>
                	  				<a:repeat value="#{contractHome.dateInfoList}" var="_dateInfo" rowKeyVar="_index">
										<tr>
           									<td class="kh_td kh_td_font #{_index % 2 == 0 ? 'kh_each_tdbg':'kh_each_tdbg02'} purchase_td2#{_indexc}">
												<h:outputText styleClass="purchases2#{_indexc}_#{_index}" value="#{contractHome.contractMap.get(_dateInfo.dateString).get(_indexc).purchases}"/>
											</td>
											<td class="kh_td kh_td_font #{_index % 2 == 0 ? 'kh_each_tdbg':'kh_each_tdbg02'}">
												<h:outputText styleClass="unitPrice2#{_indexc}_#{_index}" value="#{contractHome.getFloatbyTow(contractHome.contractMap.get(_dateInfo.dateString).get(_indexc).unitPrice)}"/>
							                </td>
							                <td class="kh_td all_Arial #{_index % 2 == 0 ? 'kh_each_tdbg':'kh_each_tdbg02'}">
							                	<h:outputText styleClass="sum2#{_indexc}_#{_index}" value="#{contractHome.getFloatbyTow(contractHome.contractMap.get(_dateInfo.dateString).get(_indexc).subtotal)}"/>
							                </td>
           								</tr>
          							</a:repeat>
           							<tr>
						           		<td class="kh_td all_Arial #{_indexc % 2 == 0 ? 'kh_each_tdbg':'kh_each_tdbg02'} purchasesSum2#{_indexc}">#{_dateInfo.purchasesSum}</td>
						               	<td class="kh_td all_Arial #{_indexc % 2 == 0 ? 'kh_each_tdbg':'kh_each_tdbg02'}"></td>
						               	<td class="kh_td all_Arial #{_indexc % 2 == 0 ? 'kh_each_tdbg':'kh_each_tdbg02'} subtotalSum2#{_indexc}">#{contractHome.getFloatbyTow(_dateInfo.subtotalSum)}</td>
						           	</tr>
								</table>
     						</td>
   						</a:repeat>
 					</tr>
    			</h:panelGrid>
			</div> 
		</div>                                
		</s:div>
		
		<table width="180" style="margin:35px auto 0 auto;">
			<tr>
				<td>
				<s:button id="cancel" propagation="end" view="/contract/ContractList.xhtml" styleClass="btn btn-default" value="返回" style="margin-left:10px" >
                	<f:param name="baseId" value="#{contractHome.baseId}"/>
                	<f:param name="pageNum" value="#{contractHome.pageNum}"/>
                </s:button>
		         </td>
			</tr>
		</table>
			   
		
		<div class="clear"></div>
	</div>
	<script type="text/javascript">
		jquery(document).ready(function(){  
			var onLoadWidth = document.body.clientWidth;
			jquery('#scroll1').css("width",(onLoadWidth-323)+ "px"); 
			jquery('#scroll2').css("width",(onLoadWidth-323)+ "px"); 
			jquery(".date_index").each(function(index2){
				var purchasesSum2=0;
				//计算总金额
				var subtotalSum2=0;
				jquery(".purchase_td2"+index2).each(function(indexc){
					var ph=jquery(".purchases2"+index2+"_"+indexc).text();
					var up=jquery(".unitPrice2"+index2+"_"+indexc).text();
					//alert(".sum"+index2+"_"+indexc);
					//计算总金额（横向）
					jquery(".sum2"+index2+"_"+indexc).text((ph*up).toFixed(2));
					purchasesSum2+=parseInt(ph);
					subtotalSum2+=parseInt((ph*up));
				});
				//纵向统计
				jquery(".purchasesSum2"+index2).text(purchasesSum2);
				jquery(".subtotalSum2"+index2).text(subtotalSum2.toFixed(2));
			});
		});
		jquery(window).resize(function(){
		   var onLoadWidth = document.body.clientWidth;
		   jquery('#scroll1').css("width",(onLoadWidth-323)+ "px");
		   jquery('#scroll2').css("width",(onLoadWidth-323)+ "px");
		});
		function clickXuan(obj){
			if(obj == 1){
				jquery("#current1").addClass("current");
				jquery("#current2").removeClass("current");
			    jquery("#date").css("display","");
			    jquery("#date2").css("display","none");
			}
			if(obj == 2){
				jquery("#current2").addClass("current");
				jquery("#current1").removeClass("current");
			    jquery("#date2").css("display","");
			    jquery("#date").css("display","none");
			}
		}
	</script>
</td>
	
</ui:define>
</ui:composition>
