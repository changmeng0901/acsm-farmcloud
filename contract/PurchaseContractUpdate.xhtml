<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"	
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a="http://richfaces.org/a4j" 
    template="/layout/template_new.xhtml">

<ui:define name="body">
	<td valign="top" >
	<style>
	.rich-calendar-exterior{*width:210px;}
		.rich-inplace-view{ border:none; border-bottom-width:0px;}
		.rich-inplace-view{ border-bottom-width:0px; border:1px solid #d5d5d5;}
		.dr-table-footercell {
		    background: none repeat scroll 0 0 #FFFFFF;
		    border-bottom: 1px solid #C0C0C0;
		    border-right: 1px solid #C0C0C0;
		    color: #000000;
		    font-family: Arial,Verdana,sans-serif;
		    font-size: 14px;
		    font-weight: bold;
		    height: 35px;
		    padding: 4px;
		    text-align: right;
		}
		.rich-mpnl-controls{top:5px;}
		.stripe3 th a{
		    color: #171717;
		    font-family: "宋体";
		    font-size: 12px;
		
		}
		.input-append.date .add-on i, .input-prepend.date .add-on i {
		    cursor: pointer;
		    height: 14px;
		    margin-left: -19px;
		    margin-top: 7px;
		    width: 14px;
		}
		.dr-table {
		    border-left: 1px solid #C0C0C0;
		    border-right: 1px solid #C0C0C0;
		}
		.dr-sb-shadow {
		    border: 1px solid;
		    height: auto;
		    position: absolute;
		    width: 100%;
		    z-index: 1;
		}
		.dr-pnl-b tr{
		 	height:26px; line-height:26px;
		}
		.dr-rich-tool-tip {
		    background-color: #FAE6B0;
		    border: 1px solid #E5973E;
		    display: none;
		    float: left;
		    font-family: Arial,Verdana,sans-serif;
		    font-size: 11px;
		    padding: 7px;
		    position: absolute;
		    min-height: 100px;
		}
		.dr-pnl{border-style:none;border:none; width: 100%; padding:0;}
		.dr-pnl-b{font-size:12px; width: 100%; padding:0;}
		.dr-sb-ext-decor-2 {
		    background-color: #FFFFFF;
		    border:1px solid #bed6f8;
		}
		.dr-sb-common-container {
		    text-align: center;
		}
		.dr-table-cell {
		    border-bottom: 1px solid #C0C0C0;
		    border-right: 1px solid #C0C0C0;
		    color: #000000;
		    font-family: Arial,Verdana,sans-serif;
		    background-color:
		    font-size: 11px;
		    padding: 4px;
		}
		.dr-sb-int-sel {
		    background-color: #BED6F8;
		    background-image:none;
		    color: #000000;
		    font-family: Arial,Verdana,sans-serif;
		    font-size: 11px;
		}
		.th1{width: 30%;}
		.th2{width: 30%;}
		.th3{width: 30%;}
		.search_table .input{width:157px;}
		.dr-pnl{background:none}
		.td_img_big{width:75px; height:75px; border:1px solid #f0f0f0; display:block;}
		.td_img{width:40px; height:40px; border:1px solid #f0f0f0; display:block;}
		.cath{ height:32px; line-height:32px; font-size:12px; text-align:center; border-left:1px solid #ccc; }
		.catd{ padding:5px 0; line-height:25px; font-size:12px; text-align:center;}
		.carp input{ width:45px; height:18px; text-align:center;border:1px solid #ccc;}
		.list_td {background: url("../asset/images/order/calls_y8.jpg") repeat-y scroll right center rgba(0, 0, 0, 0);min-height: 304px;}
			.lis2_table {width: 100%;}
			.right_b{height:auto;}
			.left_b{height:auto;}
			.dr-pnl{border:0px;}
			.dr-pnl{border-style:none;border:none; width: 100%; padding:0;}
		 
	</style>
	<div class="right_c">
		<div class="r_title">
			<div class="r_t_l cm_r_t_l"><span>计划&#160;&gt;&#160;&#160;<a href="#{request.contextPath}/map/PlantInfoList.seam">外采</a></span><em>&gt;</em><font size="3">选择商品</font><rich:messages styleClass="messages"></rich:messages></div>
<!--                         <div class="tabLink fr" style="margin:8px 0 0 5px;float: right;"> -->
<!--                         	<a class="link1 cur" href="#{request.contextPath}/contract/PurchaseContractList.seam">外采管理</a> -->
<!--                         	<span class="line"></span><a class="link2" href="#{request.contextPath}/contract/PurchaseMemberInfoListOne.seam">供货商管理</a> -->
<!--                         </div> -->
        </div>
	<table width="100%" cellpadding="0" cellspacing="0" style=" margin-top:-3px; *margin-top:-3px; _margin-top:-9px;">
		<tr>
        	<td><div class="j001"></div></td>
        	<td><div class="top_b_g"></div></td>
        	<td><div class="j002"></div></td>
   		</tr>
   		<tr>
   			<td height="100%"><div class="left_b"></div></td>
   			<td align="center" valign="top" >
   				<div class="rigtjr">
   					<div class="con_left">
						<div id="rightPanel" class="con_right">
							<div class="call_com">
							<div class="list_block">
								<div class="list_title list_title01">供货商基本信息</div>
                                <div class="list_ta">
									<div class="list_ta01">
										<div ></div>
									</div>
								</div>
								<div class="list_tc">
									<div >
							    		<!--添加供货商基本信息模板  -->
											<table width="100%" cellpadding="0" cellspacing="0" class="str_t">
												<tr class="alt">
													<td valign="middle" class="str_td">订购企业：</td>
													<td valign="middle" class="str_text"><h:outputText
														value="#{purchaseContractHome.memberInfo.realname}" /></td>
													<td class="str_td">邮编：</td>
													<td class="str_text">
														<h:outputText
														value="#{purchaseContractHome.memberInfo.homePort}" />
													</td>
												</tr>
												<tr >
													<td valign="middle" class="str_td">联系人：</td>
													<td valign="middle" class="str_text" ><h:outputText
														value="#{purchaseContractHome.memberInfo.nickName}" /></td>
													<td valign="middle" class="str_td">联系人电话：</td>
													<td valign="middle" class="str_text"><h:outputText
														value="#{purchaseContractHome.memberInfo.phone}" /></td>
												</tr>
												
												<tr class="alt">
													<td class="str_td">性&#160;&#160;&#160;&#160;&#160;&#160;别：</td>
													<td class="str_text">
														<h:outputText value="#{purchaseContractHome.memberInfo.sex==1?'男':''}"/>
														<h:outputText value="#{purchaseContractHome.memberInfo.sex==2?'女':''}"/>
														<h:outputText value="#{purchaseContractHome.memberInfo.sex==3?'其它':''}"/>
													</td>
													<td valign="middle" class="str_td">Email：</td>
													<td valign="middle" class="str_text">
														<h:outputText value="#{purchaseContractHome.memberInfo.email}" />
													</td>
												</tr>	
												<tr>
													<td valign="middle" class="str_td">地&#160;&#160;&#160;&#160;&#160;&#160;&#160;址：</td>
													<td valign="middle" class="str_text" colspan="3"><h:outputText
														value="#{purchaseContractHome.memberInfo.workAddress}" /></td>
												</tr>
												<tr class="alt">
													<td valign="middle" class="str_td">备&#160;&#160;&#160;&#160;&#160;&#160;&#160;注：</td>
													<td valign="middle" class="str_text" colspan="3"><h:outputText
														value="#{purchaseContractHome.memberInfo.remark}" /></td>
												</tr>
											</table>
									</div>
								</div>
								<div >
									<div >
										<div ></div>
									</div>
							   </div>
	                       <div class="clear"></div>
                           </div> 
                           
                        <div class="list_block">   
							<div class="list_title list_title02">订购时间范围选择</div>
								<div class="car_list">
									<table style="float:left; display:inline;" >
										<tr valign="middle">
											<td width="180" align="left" style="font-size: 16px;" >外采订购时间范围：</td>
											<td width="175"  align="left" >
												<div class="input-append date form_datetime " >
											    	<h:inputText  styleClass="new_time" id="beginTime" value="#{purchaseContractHome.beginTime}"/>
											    	<span class="add-on"><i class="icon-th"></i></span>
											    </div>
											</td>
											<td width="30" align="left"  style="font-size: 16px;" >至</td>
											<td width="175" align="left" >
												<div class="input-append date form_datetime " >
											    	<h:inputText  styleClass="new_time" id="endTime" value="#{purchaseContractHome.endTime}"/>
											    	<span class="add-on"><i class="icon-th"></i></span>
											    </div>
											</td>
										</tr>
										<tr valign="middle" style="height: 50px;">
											<td width="180" align="left" style="font-size: 16px;">外采签订时间：</td>
											<td width="175"  align="left">
												<div class="input-append date form_datetime2 " >
											    	<h:inputText  styleClass="new_time" id="signingTime" value="#{purchaseContractHome.signingTime}"/>
											    	<span class="add-on"><i class="icon-th"></i></span>
											    </div>
											</td>
											<td width="30" align="left"  style="font-size: 16px;" ></td>
											<td width="175"  align="left">
											</td>
										</tr>
									</table>
	                       		</div>
	                       	<div class="clear"></div>
	               		</div> 								    
                           
	                   <div class="list_block "> 
	                      <button id="divmyModal" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" style="display: none;"/>
					    	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
								    	<div class="modal-header">
								        	<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
								        		<h4 class="modal-title" id="myModalLabel">提示信息</h4>
								      		</div>
								      	<div class="modal-body" id="productMsg"></div>
								      	<div class="modal-footer">
								        	<button type="button" class="btn btn-primary" data-dismiss="modal">关闭</button>
								      	</div>
							    	</div>
							  	</div>
							</div>
							<div class="cpccxx">
								<div class="list_title3">产品添加购物车</div>
							</div>
	                        	 <div style="height: 40px;float: left;" >
                        		<div class="ui-widget">
                        			<table>
                        				<tr>
                        					<td style="font-size: 16px;font-family:'微软雅黑';width: 80px;">
                        					品种选择：
                        					</td>
                        					<td style="width: 200px;" align="center">
											<select id="combobox" class="selectpicker nw100" data-live-search="true">
	                                    		<ui:repeat value="#{contractHome.getPlantList()}" var="_plant" >
			                                        <option value="#{_plant.plantId}">#{_plant.name}</option>
		                                        </ui:repeat>
	                                        </select>
                        					</td>
                        					<td style="width: 50px;" valign="middle">
			                              	<a href="javascript:void(0);" onclick="if(!submitProduct()){return false;};" class="btn btn-success" style="margin-left:15px;display: block;">
					                    		添加
					                    	</a>
                        					</td>
                        				</tr>
                        			</table>
								</div>
	                        </div>
	                       	<div class="clear"></div>
	               		</div> 	
	                   
	                   <div class="list_block">   
								<div class="car_list">
									<rich:dataTable width="100%" id="cartList" var="_cartList" styleClass="car_table" value="#{purchaseContractHome.cartList}" 
							              onRowMouseOver="this.style.backgroundColor='#e5f6ec'" onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'" rowKeyVar="index">
								        <h:column headerClass="th1" >
								        	<f:facet name="header">商品编号</f:facet>
								            <center>
								            	<h:outputText value="#{_cartList.productCode}"/>
								            </center>
								        </h:column>
								        <h:column headerClass="th2">
								        	<f:facet name="header">商品</f:facet>
								        	<center>
								        		<h:outputText value="#{_cartList.name}"/>
							        		</center>
								        </h:column>
								        <h:column headerClass="th3">
								        	<f:facet name="header">商品规格</f:facet>
								            <center>
								            	<h:outputText value="Kg" />
								            </center>
								        </h:column>
								      
								        <rich:column styleClass="action" width="10%" >
								            <f:facet name="header">操作</f:facet>
							            	<table class="ps" align="center">
            		  							<tr>
                   									<td>
									            		<a href="javascript:void(0);" onclick="delOneProduct(#{index});">删除</a>
			            							</td>
		            							</tr>
	            							</table>
								        </rich:column>
								    </rich:dataTable>
								    <rich:panel id="totalPenal" style="width:100%;">
								    <table class="car_table"  width="100%" style="border-top: none; border-color: #ccc;">
								    	<tr>
		                                    <td colspan="11" style="border-bottom:none; padding-bottom:10px;">
		                                       <div class="car_dl"><a href="javascript:void(0);" onclick="if(confirm('确定要清空购物车？清空后商品采购详情无法还原！'))clearProductAll();">清空购物车</a></div>
		                                       <div class="car_ul">
		                                      
		                                       </div>
		                                    </td>
	                                    </tr>
								    </table>
								    </rich:panel>
	                                <div class="car_button">
	                                	<h:inputHidden id="carsize" value="#{sessionTake.cartList.size}"/>
								    	<h:form id="productCountFrom" style="wid" >
								    		<h:inputHidden id="beginTime" value="#{purchaseContractHome.beginTime}"/>
								    		<h:inputHidden id="endTime" value="#{purchaseContractHome.endTime}"/>
								    		<h:inputHidden id="signingTime" value="#{purchaseContractHome.signingTime}"/>
								    		<h:inputHidden name="contractId" value="#{purchaseContractHome.contractId}" />
											<s:button view="/contract/PurchaseContractList.xhtml" styleClass="btn btn-default" value="返回" id="cancel" propagation="end">
												<f:param name="baseId" value="#{purchaseContractHome.baseId}"/>
												<f:param name="pageNum" value="#{purchaseContractHome.pageNum}"/>
											</s:button>
								    		&#160;&#160;&#160;&#160;
											<h:commandButton id="persist" styleClass="btn btn-primary"  action="#{purchaseContractHome.cartEnd}" value="下一步" onclick="if(!getProductCheck()){return false;};">
												<f:param name="baseId" value="#{purchaseContractHome.baseId}"/>
												<f:param name="pageNum" value="#{purchaseContractHome.pageNum}"/>
											</h:commandButton>
								    	</h:form>
	                                </div>
	                       		</div>
	                       	<div class="clear"></div>
	               		</div> 								
					</div>
					</div>
                    </div>
				</div>
   			</td>
   			<td><div class="right_b"></div></td>
   		</tr>
   		<tr>
   			<td valign="top" width="21"><div class="j003"></div></td>
            <td><div class="bot_b_g"></div></td>
            <td valign="top" width="21"><div class="j004"></div></td>
   		</tr>
   	</table>
  	<a:form>
  		<a:queue requestDelay="10" ignoreDupResponses="true"/>
		<a:jsFunction name="clearOneProduct" action="#{purchaseContractHome.clearOneProduct}" reRender="cartList">
			<a:actionparam name="index" assignTo="#{purchaseContractHome.index}"/>
		</a:jsFunction>
		<a:jsFunction name="clearCartAll" action="#{purchaseContractHome.clearCartAll}" reRender="cartList"/>
		<a:jsFunction name="showListFiltel" action="#{purchaseContractHome.loadProductFind}" reRender="showPanel">
			<a:actionparam name="searchName" assignTo="#{purchaseContractHome.searchName}"/>
		</a:jsFunction>
		<a:jsFunction name="insertPE" action="#{purchaseContractHome.insertPE}" reRender="cartList,carsize" oncomplete="jquery('#login').hide();">
			<a:actionparam name="plantId" assignTo="#{purchaseContractHome.plantId}"/>
		</a:jsFunction>
	</a:form>
	
	
<script type="text/javascript">
//<![CDATA[
   jquery(".form_datetime").datetimepicker({
	    format: "yyyy-mm",
 		language:  'zh-CN',
        weekStart: 1,
        todayBtn:  1,
		autoclose: 1,
		todayHighlight: 1,
		startView: 3,
		minView: 3,
		forceParse: 0,
		pickerPosition: "bottom-left"
	 });
	 jquery(".form_datetime2").datetimepicker({
	    format: "yyyy-mm-dd",
	    autoclose: true,
		weekStart: 1,
		minView:2,
		language:  'zh-CN',
	    pickerPosition: "bottom-left"
	  });   
	  window.onload = function () {
	    jquery('.selectpicker').selectpicker();
	  };
    //添加选中商品到购物车
    function submitProduct(){
    	 var str = jquery("#combobox").val();
 		if (str != '') {
 			jquery("#login").show();
 			insertPE(str);
 	    	return true;
 		}else {
 			return false;
 		}
     }
    
 
  	//获得添加到购物车的商品数量
    function getProductCheck(){
    	var count = document.getElementById("carsize").value;
    	var beginTime = document.getElementById("beginTime").value;
        var endTime = document.getElementById("endTime").value;
        var signingTime = document.getElementById("signingTime").value;
        
        var arr = beginTime.split("-");
        var starttime = new Date(arr[0], arr[1]);
        var starttimes = starttime.getTime();

        var arrs = endTime.split("-");
        var lktime = new Date(arrs[0], arrs[1]);
        var lktimes = lktime.getTime();
        
      	if(count == 0){
      		document.getElementById("productMsg").innerHTML = "请至少添加一个商品到购物车!";
			jQuery("#divmyModal").click();
			return false;
        }

        if (starttimes >= lktimes) {
        	document.getElementById("productMsg").innerHTML = "外采订购开始时间不能大于等于外采订购结束时间!";
			jQuery("#divmyModal").click();
			return false;
        }
        if(beginTime == ""){
        	document.getElementById("productMsg").innerHTML = "外采订购开始时间不能为空!";
			jQuery("#divmyModal").click();
			return false;
        }
        if(endTime == ""){
        	document.getElementById("productMsg").innerHTML = "外采订购结束时间不能为空!";
			jQuery("#divmyModal").click();
			return false;
        }
        document.getElementById("productCountFrom:beginTime").value = beginTime;
        document.getElementById("productCountFrom:endTime").value = endTime;
        document.getElementById("productCountFrom:signingTime").value = signingTime;
        return true;
    }

	//清空购物车
	function clearProductAll(){
		clearCartAll();
	}

	//删除单个
	function delOneProduct(index){
		if(confirm('确定删除商品吗？删除后商品采购详情无法还原。')){
			clearOneProduct(index);
		}
	}

//]]>
</script>
</div>
</td> 
</ui:define>
</ui:composition>
