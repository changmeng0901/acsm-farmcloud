<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    template="/layout/template_new.xhtml">

<ui:define name="body">
	<link href="#{request.contextPath}/asset/css/message/select2.css" rel="stylesheet" />
	<link href="#{request.contextPath}/asset/css/message/jquery-picklist.css" rel="stylesheet" />	
	<link href="#{request.contextPath}/asset/css/message/xxgl.css" rel="stylesheet" />
	
	<script type="text/javascript" src="#{request.contextPath}/asset/js/message/jquery.ui.widget.js"></script>
	<script type="text/javascript" src="#{request.contextPath}/asset/js/message/jquery-picklist.js"></script>
	<script type="text/javascript" src="#{request.contextPath}/asset/js/message/select2.js"></script>
<style>
.bootstrap-select:not([class*="span"]):not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) {
   width: 120px;
   
}
 .select2-container-multi .select2-choices{min-height:33px;}
	
	</style>
<script type="text/javascript">
//<![CDATA[
	jquery = jQuery.noConflict();
	/* 模态框 */
	jquery(function()
	{
		jquery("#nonnumeric").pickList();
		jquery('#cm_close').click(function(){
			jquery('#myModal').slideUp(function(){
				jquery('.modal-backdrop ').slideUp(1000);
			});	
		});
	});
	//]]>	
</script>

<!-- 发件箱的js 开始 -->
<script>
//<![CDATA[
jQuery = jQuery.noConflict();
jQuery(document).ready(function() { 
	 jquery('.selectpicker').selectpicker();
	jQuery("#e15").select2({tags:[]});
    jQuery("#e15").on("change", function() { jQuery("#e15_val").html(jQuery("#e15").val());});
 });
//]]>
</script>
<!-- 发件箱js 结束 -->
<style>
.infoType select{ width:100%; height:35px; border-radius:4px; border:1px solid #dadada ;}
.infoType option{ padding:6px 3px;}
</style>
  
	<td valign="top">
	<h:form id="siteNewsform">


				 <!-- right_c 开始 -->
                 <div class="right_c" style="min-height:30px;">
                    <div class="r_title">
                        <div class="r_t_l cm_r_t_l"><a href="#{request.contextPath}#{sessionTake.urlTemp}">个人主页</a>&#160;&gt;&#160;&#160;<font size="3"><a href="#{request.contextPath}/message/SiteNewsList.seam">发件箱</a></font></div>
                    </div>
                    <div class="clear"></div> 
				
                 
                 	<div class="cm_noticeWap clear">
                    	<table class="cm_senderTab">
                        	<tbody>
                            	<tr>
                                    <td width="60" align="right" style="padding-right:15px;"><b style="color:#7dc196;">收件人</b></td>
                                    <td>
                                        <div>
                                        	<table style="width:100%">
                                            	<tr>
                                                	<td height="36"><input type="hidden" value="" style="width:100%;" id="e15" tabindex="-1" class="select2-offscreen cm_borderRN"/></td>
                                                    <td width="35"><input type="button" class="cm_tianjia" data-toggle="modal" onclick="changeInitial()" data-target="#myModal" /></td>
                                                    <input type="hidden" id="myid" name="myId" value=""/> 
                                                </tr>
                                            </table>                                
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td align="right" style="padding-right:15px;"><b style="display:block; padding-top:20px; font-family:'微软雅黑'; font-size:14px; line-height:36px;">主题</b></td>
                                    <td>
                                    	 <div>
                                        	<table style="width:100%">
                                            	<tr>
                                                	<td><h:inputText  class="cm_aboutNot" value="#{siteNewsHome.instance.title}" style="width:100%; zoom:1;" /></td>
                                                </tr>
                                            </table>                                
                                        </div>
                                    </td>
                                </tr>
                                 <tr>
                                    <td align="right" style="padding-right:15px; padding-top:20px;"><b style="display:block; font-family:'微软雅黑'; font-size:14px; line-height:36px;">消息类型</b></td>
                                    <td style=" padding-top:20px; margin-left:10px;">
                                    	 <div class="all_da all_w01" style="margin:0;">
                                        	<table>
                                            	<tr>
                                            	<td>
                                            	<h:selectOneMenu styleClass="selectpicker" layout="pageDirection" value="#{siteNewsHome.instance.dataDicId}">
													<f:selectItems value="#{goodsInfoConstant.getMessageTypeList()}"/>
												</h:selectOneMenu>
                                            	</td>
                                                </tr>
                                            </table>   
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                	<td align="right" style="padding-right:15px;"></td>
                                    <td>
                                    	<!--  <div class="cm_mailCon"><img src="img/textEx.jpg"/></div>-->
                                    	
                                    	<div style="display: block; padding:20px 0;">
										<h:inputTextarea  style="width:100%;height:400px; padding:20px 0;"  id="customContent" name="customContent"
											value="#{siteNewsHome.instance.content}">
										</h:inputTextarea>
										</div>
                                        <div class="cm_mailBtn">
                                        	 <h:commandButton id="save"
						                         	 value="发送"
						                         	 styleClass="btn btn-primary"
						                         action="#{siteNewsHome.persist}"
						                       disabled="#{!siteNewsHome.wired}"
						                       rendered="#{!siteNewsHome.managed}"
						                       onclick="return ynMess()"/>
                                        	
                                       	<button type="button" onclick="goBack()" class="btn btn-default">返回</button>
                                       	</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="height:30px; width:100%; padding-bottom:110px;"></div>
    
                    <div class="clear"></div>
                 </div>
   </h:form>
</td> 
                 <!-- right_c 结束 -->
		<script type="text/javascript" src="#{request.contextPath}/asset/js/kindeditor/kindeditor.js"></script>
		<script type="text/javascript" src="#{request.contextPath}/asset/js/kindeditor/lang/zh_CN.js"></script>
		<script type="text/javascript" src="#{request.contextPath}/asset/js/gantt/jquery-1.10.2.js"></script>
 <script type="text/javascript">
   //<![CDATA[
       function changeInitial(){
    	   jquery(".pickList_removeAll").click();
			var a=jquery("#e15").attr("value").split(",");
			for(var i=0;i<a.length;i++){
				jquery(".pickList_sourceList li").each(function(){
					if(a[i]==jquery(this).text()){
						jquery(this).attr("class","pickList_listItem ui-selected ui-state-highlight pickList_selectedListItem");
						jquery(".pickList_add").click();
					}
		    	});
			}

       }
       function goBack(){
			window.location.href="#{request.contextPath}/message/SiteNewsList.seam";
       }
       function preview(){
			jquery(".phon_div").empty().append(editor.html());
		}
		var editor;
		var param = "?param=param";//非此页面不需要
		KindEditor.ready(
			function(K) {
				editor = K.create('textarea[name="siteNewsform:customContent"]', {
				resizeType : 1,
				allowPreviewEmoticons : false,
				uploadJson : '#{request.contextPath}/asset/js/kindeditor/upload_json.jsp?directoryType=34&businessType=3&enterpriseId=' + #{sessionTake.getEnterpriseInfoId()},
				allowImageUpload : true,
				items:[
				        'source', '|', 'undo', 'redo', '|', 'preview', 'print', 'template', 'code', 'cut', 'copy', 'paste',
				        'plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright',
				        'justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript',
				        'superscript', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen', '/',
				        'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold',
				        'italic', 'underline', 'strikethrough', 'lineheight', 'removeformat',
				],
				afterChange : function() {
					jquery(".phon_div").empty().append(this.html());
            	}
			});
				jquery(".ke-edit-iframe ").contents().find(".ke-content").css("height","328")
		});
	//]]>
		</script>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-dialog" style="width:610px; margin:100px auto 0;">
    <div class="modal-content">
        <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal"> </button>
	        <h4 class="modal-title font14" id="myModalLabel">从联系人中选择</h4>
        </div>
        <div class="modal-body" style="padding-bottom:0;">
	        <h:selectManyMenu id="nonnumeric" multiple="multiple" name="nonnumeric">
				  <s:selectItems value="#{siteNewsHome.nameList()}" var="var" label="#{var[0]}" itemValue="#{var[1]}#{var[2]}"/>
			</h:selectManyMenu>
        </div>
        <div class="modal-footer" style="border-top:none; margin-top:5px;">
       		<button class="btn btn-primary" type="button" onclick="goinsertback()">保存</button><button class="btn btn-default" type="button" data-dismiss="modal">返回</button>
        </div>
    </div>
</div>
</div>
<script type="text/javascript">
//<![CDATA[
    var thing = {};
 	jquery = jQuery.noConflict();
    function goinsertback(){
        var shouname="";
    	jquery("#myModal").modal("hide");
    	jquery(".pickList_targetList li").each(function(){
        	
			thing[jquery(this).text()]=jquery(this).attr("data-value");
    		shouname+=jquery(this).text()+","
    	});
    	var sname=shouname.substring(0, shouname.length-1);
		jquery("#e15").attr("value",sname);
		jQuery("#e15").select2({tags:[]});
	}
    jquery("#siteNewsform").submit( function(){
    	var shouvalue="";
    	var arr = jquery("#e15").attr("value").split(',');
    	for(var i in arr){
				shouvalue+=thing[arr[i]]+",";
    	}
    	jquery("#myid").attr("value",shouvalue)
    }); 
    function ynMess(){
		if(jquery('.select2-search-choice').length ==0){
			alert("收件人不能为空！");
			return false;
		}
		if(jquery('.cm_aboutNot').val().length>100){
			alert("主题字数不能大于100！");
			return false;
		}
		return true;
    }
//]]>
</script>



</ui:define>

</ui:composition>
