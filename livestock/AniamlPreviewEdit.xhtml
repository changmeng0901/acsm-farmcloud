<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jstl/core"
    template="/layout/template_new2.xhtml">

<ui:define name="body">
<link type="text/css" href="#{request.contextPath}/asset/css/jquery-picklist.css" rel="stylesheet" />
<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/record/commons.css"/>
<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/record/resumePreviewEdit.css" />
<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/skinBlue.css"/>

<td valign="top">
<!-- #{newAnimalRecordHome.editResume()}  -->
	<div class="right_c" style="min-height:30px; padding-bottom:15px;">
   		<div class="r_title clear">
       		<div class="r_t_l fl">精准营销&#160;&gt;&#160;&#160;履历&#160;&gt;&#160;&#160;履历预览&#160;&gt;&#160;&#160;<font size="3">编辑   </font></div>
           	<div class="fr" style="margin-bottom:-1px;">
				<ul class="cm_resumeList clear">
					<li>
                   		<a href="#{request.contextPath}/record/ProductBaseInfoList.seam?lvliType=1"><img src="#{request.contextPath}/asset/images/cm_lsllIco01.jpg"/><span>履历设计</span></a>
                    </li>
                    <li>
                      		<a href="#{request.contextPath}/record/ProductBaseInfoList.seam?lvliType=2" class="borderBt" ><img src="#{request.contextPath}/asset/images/lvliyl-ico1.jpg"/><span>履历预览</span></a>
                    </li>
                    <li>
                    	<a href="#{request.contextPath}/record/UsedResume.seam?source=1" ><img src="#{request.contextPath}/asset/images/cm_lsllIco02.jpg" /><span>履历制作</span></a>
                    </li>
					<li>
                      	<a href="#{request.contextPath}/record/ResumeTracing.seam?source=1" ><img src="#{request.contextPath}/asset/images/cm_lsllIco05.png" /><span>履历追溯</span></a>
                    </li>
				</ul>
			</div>
		</div>
   	<!-- 履历预览编辑内容 --> 
     
       
       <!-- 履历基本信息 -->
       <div class="edit_title_wap clear">
       	<h3 class="text_title"><img src="#{request.contextPath}/asset/images/record/resumePreviewEdit_icon1.jpg" />履历基本信息</h3>
       </div>
       <h:form id="save" enctype="multipart/form-data">
	       <table class="edit_infor_table" cellpadding="0">
	       	<tr>
	           	<td class="td_lt" style="width:160px;"><img class="img_icon" src="#{request.contextPath}/asset/images/record/resumePreviewEdit_icon4.png" />履历名称</td>
	               <td class="td_rt" style="width:330px;">
	               	<h:outputText styleClass=" w220 fl" value="#{newAnimalRecordHome.livestockHistory.productName}" />
	               </td>
	               <td class="td_lt" rowspan="3">
	               	<dl class="crop_file_block clear">
	                   	<dt class="crop_lt">
							<img id="picture_animal" src="#{newAnimalRecordHome.animalImage}"/>
	                       </dt>
	                       <dd class="crop_rt">
	                       	<em class="text_name1">动物图片</em>
	                       	<p class="text_name2">修改履历中展示的动物图片</p>
	                       	<p class="text_name2">图片小于4M</p>
	                           <div class="sm_file_btn"><s:fileUpload id="entPicture" size="40"
									accept="image/png,image/jpeg,image/gif"
									contentType="image/png,image/jpeg,image/gif"
									fileName="#{newAnimalRecordHome.animalImageName}"
									data="#{newAnimalRecordHome.animalImageByte}"
									onchange="previewImage('picture_animal',this);">
								</s:fileUpload>更换图片</div>
	                       </dd>
	                   </dl>
	               </td>
	           </tr>
	           <tr>
	           	<td class="td_lt"><img class="img_icon" src="#{request.contextPath}/asset/images/livestock/dw.png" />动物名称</td>
	               <td class="td_rt">
	               	<h:inputText class="form-control w220 fl"  id="animalNameId"  value="#{newAnimalRecordHome.animalName}" />
	               </td>
	           </tr>
	           <tr>
	           	<td class="td_lt"><img class="img_icon" src="#{request.contextPath}/asset/images/record/resumePreviewEdit_icon6.png" />创建时间</td>
	               <td class="td_rt">
	               	<p class="text_edit"><h:outputText value="#{newAnimalRecordHome.livestockHistory.insertTime}"><f:convertDateTime pattern="yyyy-MM-dd" timeZone="GMT+8"/></h:outputText></p>
	               </td>
	           </tr>
	       </table>
       
	       <!-- 微信分享设置 -->
	       <div class="edit_title_wap clear">
	       	<h3 class="text_title"><img src="#{request.contextPath}/asset/images/record/resumePreviewEdit_icon2.jpg" />微信分享设置</h3>
	       </div>
	       <table class="edit_infor_table" cellpadding="0">
	       	<tr>
	           	<td class="td_lt" style="width:160px;"><img class="img_icon" src="#{request.contextPath}/asset/images/record/resumePreviewEdit_icon7.png" />分享标题</td>
	               <td class="td_rt">
	               	<div class="textarea400" style="height:34px">
	               		<h:inputText  class="form-control" type="text" value="#{newAnimalRecordHome.shareName}" id="shareNameId" onblur="look2()"/>
	                   </div>
	               </td>
	           </tr>
	           <tr>
	           	<td class="td_lt" align="top" style="line-height:120px;"><img class="img_icon" src="#{request.contextPath}/asset/images/record/resumePreviewEdit_icon8.png" />分享描述</td>
	               <td class="td_rt">
	               	<div class="textarea400">
	               		<h:inputTextarea styleClass="shareDescribe" value="#{newAnimalRecordHome.shareDescribe}" onblur="look()"></h:inputTextarea>
	                </div>
	                <p class="mt5" style="color:red">分享描述仅支持显示三行内容，请尽量将内容保持在三行内！</p>
	               </td>
	           </tr>
	           <tr>
	           	<td class="td_lt"><img class="img_icon" src="#{request.contextPath}/asset/images/record/resumePreviewEdit_icon9.png" />分享预览</td>
	               <td class="td_rt">
	               	<div class="share_preview_block">
	                   	<strong class="text_name" title="#{newAnimalRecordHome.shareName}">#{newAnimalRecordHome.shareName}</strong>
	                       <dl class="preview_dl">
	                       	<dt class="preview_dt">
	                           	<img id="picture_animal2" src="#{newAnimalRecordHome.animalImage}"/>
	                           </dt>
	                           <dd class="preview_dd" style="vertical-align: middle;">
	                           <div style="max-height:60px;line-height:20px;overflow:hidden;">
	                           	#{newAnimalRecordHome.shareDescribe}
	                           	</div>
	                           </dd>
	                       </dl>
	                   	<div class="share_people">
	                       	<img src="#{request.contextPath}/asset/images/record/resumePreviewEdit_icon10.jpg" />
	                       </div>
	                   </div>
	               </td>
	           </tr>
	       </table>
       
	       <!-- 农事记录设置 -->
	       <div class="edit_title_wap clear">
	       	<h3 class="text_title"><img src="#{request.contextPath}/asset/images/livestock/yzjl.png" />养殖记录设置</h3>
	       </div>
	       <div class="record_set_block">
	      	<ui:fragment rendered="#{newAnimalRecordHome.twiceShow}"> 
				<table class="edit_infor_table" cellpadding="0" style="margin:20px 0 0;"> 
		       		<tr>
		           		<td class="td_lt" style="width:75px;">我要购买</td>
		               	<td class="td_rt" style="width:210px;">
			               	<h:inputText styleClass=" form-control nw200" value="#{newAnimalRecordHome.twiceBuyName}" id="twiceBuyNameId"></h:inputText>
		               </td>
		               <td class="td_rt"><span class="fl colorGrey pl10" style="line-height:34px;">修改履历我要购买链接</span></td>
		           	</tr>
				</table>
	         </ui:fragment>
	           <select id="nonnumeric" name="nonnumeric" multiple="multiple">
		                    	<a4j:repeat  value="#{newAnimalRecordHome.showList}"  var="_var" rowKeyVar="_index">
		                    		<h:panelGroup rendered="#{_var[5]!=0}">
			                    		<option value="#{_var[0]}_#{_var[6]}">
			                    			#{_var[1]}-
			                    			<h:outputText value="#{_var[2]}" >
												<s:convertDateTime type="both" dateStyle="short" pattern="yyyy年MM月dd日 " />
										    </h:outputText>&nbsp;#{_var[3]}
			                    	    </option>
		                    		</h:panelGroup>
		                    		<h:panelGroup rendered="#{_var[5]==0}">
			                    		<option class="aaa" value="#{_var[0]}_#{_var[6]}" selected="selected">
		                    				#{_var[1]}-
			                    			<h:outputText value="#{_var[2]}">
												<s:convertDateTime type="both" dateStyle="short" pattern="yyyy年MM月dd日" />
										    </h:outputText>&nbsp;#{_var[3]}
			                    	    </option>
		                    		</h:panelGroup>
		                    	</a4j:repeat>
	                      </select>
	       		<h:inputHidden value="#{newAnimalRecordHome.editIdStr}" id="editIdStrId"/>
	       		<h:inputHidden value="#{newAnimalRecordHome.twiceBuyName}" id="twiceBuyName"/>
	       </div>
       
       
       <div style="padding:50px 0;text-align:center;">
       	
       	<h:commandButton action="#{newAnimalRecordHome.updateResume()}" styleClass="btn btn-success" onclick="return checkSubmit()" value="保存" ></h:commandButton>
       	<s:button view="#{request.contextPath}/record/ProductBaseInfoList.seam?lvliType=2" styleClass="btn btn-default" value="返回"/>
       </div>
       </h:form>
       <!-- 履历预览编辑内容 --> 
   </div>
   
<script type="text/javascript" src="#{request.contextPath}/asset/js/checkBox/icheck.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/jquery.ui.widget.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/jquery-picklist.js"></script>

<script type="text/javascript">
//<![CDATA[
jQuery(function(){
	var promptMessage = "#{newAnimalRecordHome.promptMessage}";
	if(promptMessage != ""){
		alert("图片大于4M!")
	}

	
	jQuery("#nonnumeric").pickList();
	jQuery('.pickList_listItem').css('overflow','hidden');
	jQuery('.pickList_listItem').each(function(){
		jQuery(this).attr('title',jQuery(this).text().replace(/[\n]/g,""));
	})

	jQuery('.shareDescribe').val(jQuery('.shareDescribe').val().replace(/<\/br\>/g,"\n"));
	
	var va=jQuery('.preview_dd div').text();
	jQuery('.preview_dd div').text("");
	jQuery('.preview_dd div').append(va);
});

function previewImage(id,file){
	var MAXWIDTH  = 0; 
	var MAXHEIGHT = 0;
	MAXWIDTH  = document.getElementById(id).offsetWidth; 
	MAXHEIGHT = document.getElementById(id).offsetHeight;
  	var div = document.getElementById(id);
  	if (file.files && file.files[0]){
		var img;
		div.innerHTML = '<img class=imghead id='+id+'>';
		img = document.getElementById(id);
      	img.onload = function(){
	        var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
	        img.width  =  rect.width;
	        img.height =  rect.height;
	        img.style.marginTop = rect.top+'px';
		}
		var reader = new FileReader();
		reader.onload = function(evt){img.src = evt.target.result;}
		reader.readAsDataURL(file.files[0]);
  	}else{//兼容IE
	    var sFilter='filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="';
	    file.select();
	    var src = document.selection.createRange().text;
	    var img;
	    if(typeParam == 1){
	    	div.innerHTML = '<img class=imghead id='+id+'>';
	           img = document.getElementById(id);
	           img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;
	           var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
	           status =('rect:'+rect.top+','+rect.left+','+rect.width+','+rect.height);
	           div.innerHTML = "<div class=divhead id='"+id+"' style='position:absolute; width:"+rect.width+"px;height:"+rect.height+"px;margin-top:"+rect.top+"px;"+sFilter+src+"\"'></div>";
	    }else{
    		TML = '<img class=imghead id='+id+'>';
           img = document.getElementById(id);
           img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;
           var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
           status =('rect:'+rect.top+','+rect.left+','+rect.width+','+rect.height);
           div.innerHTML = "<div class=divhead id='"+id+"' style='position:absolute; width:"+rect.width+"px;height:"+rect.height+"px;margin-top:"+rect.top+"px;"+sFilter+src+"\"'></div>";
    	}
  	}
  	if(id=='picture_animal'){
  		previewImage('picture_animal2',file);
  	}
}

function clacImgZoomParam( maxWidth, maxHeight, width, height ){
    var param = {top:0, left:0, width:maxWidth, height:maxHeight};
    return param;
}

function look(){
	jQuery('.preview_dd div').text("");
	jQuery('.preview_dd div').append(jQuery('.shareDescribe').val().replace(/[\n]/g,"</br>"));
	
}

function look2(){
	jQuery('.text_name').attr('title',jQuery('#save\\:shareNameId').val());
	jQuery('.text_name').text(jQuery('#save\\:shareNameId').val());
	
}

function checkSubmit(){
	var idStr = "";
	jQuery("#nonnumeric option").each(function(i){
		if(jQuery(this).attr("selected") == null){
			var obj = jQuery(this).val();
			idStr += obj + ",";
		}
	});
	jQuery('#save\\:editIdStrId').val(idStr);

	if(jQuery('#save\\:animalNameId').val()=="" || jQuery('#save\\:animalNameId').val().length>20){
		alert("动物名称不能为空并且不能大于20字");
		return false;
	}
	
	if(jQuery('.shareDescribe').val()=="" || jQuery('.shareDescribe').val().length>50){
		alert("分享描述不能为空并且不能大于50字");
		return false;
	}

	if(jQuery('#save\\:shareNameId').val()=="" || jQuery('#save\\:shareNameId').val().length>15){
		alert("分享标题不能为空并且不能大于15字");
		return false;
	}
	if(jQuery('#save\\:twiceBuyNameId').val()!=null){
		if(jQuery('#save\\:twiceBuyNameId').val().length>50){
			alert("我要购买不能大于50字");
			return false;
		}
		jQuery('#save\\:twiceBuyName').val(jQuery('#save\\:twiceBuyNameId').val());
	}
	jQuery('.shareDescribe').val(jQuery('.shareDescribe').val().replace(/[\n]/g,"</br>"));
}
//]]>
</script>
</td>  
 
</ui:define>
</ui:composition>
