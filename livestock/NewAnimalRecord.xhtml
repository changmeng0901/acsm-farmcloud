<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j"
    template="/layout/template_newtow_model.xhtml">
<ui:define name="head">
<script src="#{request.contextPath}/asset/js/easypiechart2.min.js"></script>
<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/app.css"/>
<link href="#{request.contextPath}/asset/css/bootstrap3.min.css" rel="stylesheet"/>
<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/style_new.css"/>
<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/materielAnalysis.css"/>
<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/lsll.css"/>
<link rel="stylesheet" type="text/css" media="screen" href="#{request.contextPath}/asset/css/record/commons.css"/>
<style>
.mt30{margin-top:30px;}
.warning_noData2 {background: rgba(0, 0, 0, 0) url("../asset/images/farmingIco20_1.png") no-repeat scroll center top;margin: 70px auto 220px;padding-top: 60px;text-align: center;width: 508px;}
.nav-tabs > li > a{background-color:#fff;color:#525252;}.nav-tabs > li > a, .nav-tabs > li > a:hover, .nav-tabs > li > a:focus{background-color: #fff;border-color:#fff;border-bottom: 1px solid #ddd;border-radius:4px 4px 0 0;color:#525252;}
.nav-tabs > li.active > a, .nav-tabs > li.active > a:hover, .nav-tabs > li.active > a:focus {background-color: #fff;border-color: #ddd #ddd transparent;color:#525252;}	
.nav > li > a{padding:10px 20px;color:#525252;font-size:14px;}
.text_viewcomment{padding:15px 0 10px;text-align:right;font-size:14px;color:#239df2;}
.returnBtn{text-align:center;}
.review_pane{padding:10px;border:1px solid #ddd;border-radius:4px;}
.review_pane td{padding:10px 0;border-bottom:1px solid #ddd;font-size:14px;}
.review_pane .star_pic{width:128px;height:20px;margin-right:7px;vertical-align:top;}
.review_pane .text_date{color:#999;}
.review_pane .text_comment{padding-top:10px;}
.review_pane .icon_delete,
.comment_table .icon_delete{cursor:pointer;}
.review_pane .pageModel_wap td{padding:0;border-bottom:0;}
/* 评论管理列表样式 */
.bootSelt180 .bootstrap-select{  width:180px;}
.bootSelt180 .bootstrap-select:not([class*="span"]):not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn){ width:180px;}
.comment_table .icheckbox_minimal-blue, 
.comment_table .icheckbox_minimal-blue.checked{margin-left:15px;}
 #placeholder canvas.flot-base{width:100%!important;}
#placeholder2 canvas.flot-base{width:100%!important;}
.rt_top{top:0px;}
</style>

</ui:define>
<ui:define name="body">
<td valign="top" width="100%">
<!-- #{newAnimalRecordHome.begin()} -->
	<div class="right_c">
    	<!-- 公用头部 开始 -->
		<div class="r_title clear">
			<div class="r_t_l fl">
				<s:link propagation="none"  view="#{sessionTake.urlTemp}" style="text-decoration:none;color:black;" value="履历 "></s:link>&#160;&gt;&#160;&#160;<font size="3">履历管理</font>
			</div>
			<div class="fr" style="margin-bottom:-1px;">
				<ul class="cm_resumeList clear" style="margin-bottom:0;">
			    	<li>
                    	<a  href="#{request.contextPath}/record/ProductBaseInfoList.seam?lvliType=1"><img src="#{request.contextPath}/asset/images/cm_lsllIco01.jpg"/><span>履历设计</span></a>
                    </li>
                    <li>
                    	<a  href="#{request.contextPath}/record/ProductBaseInfoList.seam?lvliType=2"  class="borderBt"><img src="#{request.contextPath}/asset/images/lvliyl-ico1.jpg"/><span>履历预览</span></a>
                    </li>
			        <li>
			        	<a href="#{request.contextPath}/record/UsedResume.seam?source=1"><img src="../asset/images/lsll/cm_lsllIco02.jpg" /><span style="font-size: 14px;">履历制作</span></a>
			        </li>
			         <li>
                       	<a href="#{request.contextPath}/record/ResumeTracing.seam?source=1" ><img src="#{request.contextPath}/asset/images/cm_lsllIco05.png" /><span>履历追溯</span></a>
                       </li>
				</ul>
			</div>
		</div>
		<!-- 公用头部 结束 -->
			
		<table width="100%" cellpadding="0" cellspacing="0" style="margin-top:35px; table-layout: fixed;">
        	<tr>
            	<td width="392" valign="top" class="pad_td">
                	<!--==========手机页面开始============-->
                	<div class="phon_bg">
                    	<div class="phon_div">
                        	<!--手机里的页面开始-->
                            <iframe name="myframe" id='aaa' src="#{request.contextPath}/livestock/#{newAnimalRecordHome.livestockHistory.livestockHistoryTemplateId.skinId.skinUrl}_show.seam?lhId=#{newAnimalRecordHome.livestockHistoryId}" frameborder="0" scrolling="auto" width="100%" height="100%" onload="if(!jQuery.browser.msie) {document.all['myframe'].style.height=myframe.document.body.scrollHeight}" ></iframe> 
                        </div>
					</div>
				</td>
                <!--右侧开始-->
                <td valign="top" >
                	<div class="pro_bg" style="margin-top:74px;">
                    	<div class="pro_png">
                    	<ui:fragment rendered="#{newAnimalRecordHome.livestockHistory.animalImage!=null}">
	                    	<img src="#{newAnimalRecordHome.livestockHistory.animalImage}@141h_141w.src" width="141" height="141"/>
						</ui:fragment>
						<ui:fragment rendered="#{newAnimalRecordHome.livestockHistory.animalImage==null}">
	                    	<img src="#{newAnimalRecordHome.livestockHistory.animalsArchivesInfoId.animalBreedId.imgSquareUrl}@141h_141w.src" width="141" height="141"/>
						</ui:fragment>
						</div>
                        <div class="pro_div3">
                        	<a class="pro_t_e"  style="width:270px"><strong style="width:100%;white-space: nowrap;" title="#{newAnimalRecordHome.livestockHistory.productName}">#{newAnimalRecordHome.livestockHistory.productName}</strong></a>
                        </div>
                            </div>
                        	<table width="95%" cellpadding="0" cellspacing="0">
                            	<tr>
                                	<td width="4"  class="ge_td1" valign="top"><img src="#{request.contextPath}/asset/images/bg_se_03.jpg" width="4" height="51" /></td>
                                    <td valign="top" align="center" class="ge_td1 getddiw"><img src="#{request.contextPath}/asset/images/picc_05.jpg" width="37" height="45" /></td>
                                    <td class="ge_td1 ge_td2" align="right" width="100">履历名称：</td>
                                    <td class="ge_td1 ge_td3">#{newAnimalRecordHome.livestockHistory.productName}</td>
                            	</tr>
                            	<tr>
                                	<td width="4"  class="ge_td1" valign="top"><img src="#{request.contextPath}/asset/images/bg_se_06.jpg" width="4" height="51" /></td>
                                    <td valign="top" align="center" class="ge_td1 getddiw"><img src="#{request.contextPath}/asset/images/picc_10.jpg" width="37" height="45" /></td>
                                    <td class="ge_td1 ge_td2" align="right" width="100" valign="top">创&#160;&#160;建&#160;&#160;人：</td>
                                    <td class="ge_td1 ge_td3">#{newAnimalRecordHome.livestockHistory.insertUser.name}</td>
                            	</tr>
                            	<tr>
                                	<td width="4"  class="ge_td1" valign="top"><img src="#{request.contextPath}/asset/images/bg_se_08.jpg" width="4" height="51" /></td>
                                    <td valign="top" align="center" class="ge_td1 getddiw"><img src="#{request.contextPath}/asset/images/picc_15.jpg" width="37" height="45" /></td>
                                    <td class="ge_td1 ge_td2" align="right" width="100">创建时间：</td>
                                    <td class="ge_td1 ge_td3">
                                    <h:outputText value="#{newAnimalRecordHome.livestockHistory.insertTime}">
								<s:convertDateTime type="both" dateStyle="short" pattern="yyyy-MM-dd" />
						    </h:outputText></td>
                            	</tr>
                            	<tr>
                                	<td width="4"  class="ge_td1" valign="top"><img src="#{request.contextPath}/asset/images/bg_se_10.jpg" width="4" height="51" /></td>
                                    <td width="100"  valign="top" align="center" class="ge_td1"><img src="#{request.contextPath}/asset/images/picc_21.jpg" width="37" height="45" /></td>
                                    <td class="ge_td1 ge_td2" align="right" width="100">使用模版：</td>
                                    <td class="ge_td1 ge_td3">#{newAnimalRecordHome.livestockHistory.animalsArchivesInfoId.name}</td>
                            	</tr>
                        	</table>
                        	
                        	
                        	
                        	 <ul id="myTab" role="tablist" class="nav nav-tabs mt30">
                                <li class="active ta1" onclick="oneTable(1)"><a>管理评论</a></li>
                                <li class="ta2" onclick="oneTable(2)"><a>二维码生成数量</a></li>
                                <li class="ta3" onclick="oneTable(3)"><a>履历查询数量</a></li>
                            </ul>
                            <div class="tab-content">
                                <div id="ReviewManage" class="tab-pane active">
                                <!-- 管理评论pane -->
                                    <p class="text_viewcomment">
                                        <a href="/record/CommentList.seam?pdId=#{newAnimalRecordHome.livestockHistoryId}&amp;typeAorP=2">查看全部履历评论&gt;&gt;</a>
                                    </p>
                                    <h:panelGroup id="commentIds">
                                	<div class="review_pane">
                                    	<table width="100%" cellpadding="0" cellspacing="0">
                                            <a4j:repeat value="#{newAnimalRecordHome.commentList}" var="var">
 												<tr class="tr_item">
	                                            	<td width="80%">
	                                                	<img class="star_pic" src="#{request.contextPath}/asset/images/record/icon_star#{var[1]}.jpg" />
	                                                    <span class="text_date">|&nbsp;&nbsp;<h:outputText value="#{var[3]}" ><f:convertDateTime  pattern="yyyy-MM-dd" timeZone="GMT+8" /></h:outputText></span>
	                                                    <p class="text_comment">#{var[2]}</p>
	                                                </td>
	                                                <td width="20%" align="right">
	                                                	<img class="icon_delete" onclick="deleteComment('#{var[0]}')" src="#{request.contextPath}/asset/images/record/icon_delect.png" />
	                                                </td>
                                            	</tr>                                            
                                            </a4j:repeat>
                                           
                                        </table>
                                        <div class="pageModel_wap" style="margin:20px 0 10px;">
                                        	<table cellspacing="0" cellpadding="0">
                                            	<tr>
                                                	<td>
                                                    	<div style="width:auto;">
                                                        	<table cellspacing="0" cellpadding="0" class="pageModel">
                                                                <tr>
                                                                    <td>
	                                                                    <ui:fragment rendered="#{not empty newAnimalRecordHome.commentList}">
	                                                                    	<ui:fragment rendered="#{newAnimalRecordHome.previousExists }">
	                                                                    		<span class="page_num page_first">
										                            				<a href="#" onclick="jump(0);return false;">首页</a>
									                            				</span>
									                           					<span class="page_num ">
										                            				<a href="#" onclick="jump(#{newAnimalRecordHome.previousFirstResult});return false;" class="no_n">
										                            				&lt;
										                            				</a>
										                           				</span>
	                                                                    	</ui:fragment>
	                                                                    	 <a4j:repeat var="_page" value="#{newAnimalRecordHome.pageList}" rowKeyVar="_index">
																				<span class="page_num #{!newAnimalRecordHome.previousExists &amp;&amp; _index ==0 ?'page_first ':''} #{newAnimalRecordHome.pageNum==_page?'page_Cur':''}">
																					<a href="#" onclick="jump(#{_page});return false;">
																						#{_page}
																					</a>
																				</span>
																			</a4j:repeat>
																			<ui:fragment rendered="#{newAnimalRecordHome.nextExists}">
													                            <span class="page_num ">
														                            <a href="#" class="no_d" onclick="jump(#{newAnimalRecordHome.nextFirstResult});return false;">
														                            &gt;
														                            </a>
													                            </span>
													                            <span class="page_num ">
																					 <a href="#" onclick="jump(#{newAnimalRecordHome.PAGE_COUNT});return false;">
																					 尾页
																					 </a>
																				</span>
																			</ui:fragment>
																			<span class="page_num page_last"><a>共#{newAnimalRecordHome.PAGE_COUNT}页</a></span>
	                                                                    </ui:fragment>
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                        
                                    </div>
								</h:panelGroup>
                                    
							<!-- 管理评论pane -->
                            </div>
                            <div id="CodeNum" class="tab-pane">
								<s:div styleClass="demo-container"  rendered="#{newAnimalRecordHome.zhuzhuang.length()==2}">
		                        	<div class="warning_noData2">
		                             	<em style=" color: #333;font-family: '微软雅黑';font-size: 18px;font-style: normal;">抱歉！暂无数据！</em>
		                             </div>
		                     	</s:div>
			                     <ui:fragment rendered="#{newAnimalRecordHome.zhuzhuang.length()==2}">
									<div class="demo-container" style="display:none;">
										<div id="placeholder" class="demo-placeholder" ></div>
									</div>
								</ui:fragment>
								<ui:fragment rendered="#{newAnimalRecordHome.zhuzhuang.length()!=2}">
									<div class="demo-container">
										<div id="placeholder" class="demo-placeholder" ></div>
									</div>
								</ui:fragment>
							</div>
                            <div id="ResumeReferNum" class="tab-pane ">
                            	<s:div styleClass="demo-container"  rendered="#{newAnimalRecordHome.quxian.length()==2}">
			                         	<div class="warning_noData2">
			                             	<em>抱歉！暂无查询记录！</em>
			                             </div>
			                     </s:div>
			                     <ui:fragment rendered="#{newAnimalRecordHome.quxian.length()==2}">
									<div class="demo-container" style="display:none;">
										<div id="placeholder2" class="demo-placeholder" ></div>
									</div>
								</ui:fragment>
								<ui:fragment rendered="#{newAnimalRecordHome.quxian.length()!=2}">
									<div class="demo-container">
										<div id="placeholder2" class="demo-placeholder" ></div>
									</div>
								</ui:fragment>
							</div>
						</div>
					</td>
				</tr>
			</table>
			<div class="clear"></div>
		</div>
		<!--right_c结束-->
		<div style="width:100%; height:32px; text-align:center; margin-top:15px;">
        	<s:button view="/record/ProductBaseInfoList.xhtml" styleClass="btn btn-default" value="返回" id="bn_left6" style="margin-left:10px" />
        </div>
                
		<a4j:form>
       		<a4j:jsFunction name="commentR" reRender="commentIds" action="#{newAnimalRecordHome.comments(newAnimalRecordHome.livestockHistoryId)}">
    			<a4j:actionparam name="pageNum" assignTo="#{newAnimalRecordHome.pageNum}"/>
      		</a4j:jsFunction>
       		<a4j:jsFunction name="delcomments" reRender="commentIds" action="#{newAnimalRecordHome.delComments()}" >
    			<a4j:actionparam name="commentId" assignTo="#{newAnimalRecordHome.commentId}"/>
    			<a4j:actionparam name="livestockHistoryId" assignTo="#{newAnimalRecordHome.livestockHistoryId}"/>
      		</a4j:jsFunction>
		</a4j:form>
                
<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../asset/js/excanvas.min.js"></script><![endif]-->
<script language="javascript" type="text/javascript" src="../asset/js/jquery.js"></script>
<script language="javascript" type="text/javascript" src="../asset/js/jquery.flot.js"></script>
<script language="javascript" type="text/javascript" src="../asset/js/jquery.flot.categories.js"></script>
<script language="javascript" type="text/javascript" src="../asset/js/jquery.flot.time.js"></script>
<link href="../asset/css/examples.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
//<![CDATA[

jQuery(document).ready(function(){
	
	
	jQuery(".width").each(function(index){
		if(index % 2 == 0){
			jQuery(this).addClass("width50");
		}else{
			jQuery(this).addClass("width51");
		}
	});
	
	 jQuery("#iframepage").load(function(){
	    	var iframeHeight = jQuery("#iframepage").contents().find("body").height();
			jQuery("#iframepage").css("height",iframeHeight+"px");
	    });
	    
	    usedcount();
	
})




jQuery(function() {
  	 if(document.body.clientWidth<=1017){
  		   jquery(".top").css("min-width","1003px");
             jquery(".content").css("min-width","1003px");
             jquery(".getddiw").attr("style","width:40px");
     	 }
		clickcount();	
     });

	function oneTable(num){
		if(num==1){
			jQuery('#ReviewManage').attr('class','tab-pane active');
			jQuery('#CodeNum').attr('class','tab-pane');
			jQuery('#ResumeReferNum').attr('class','tab-pane');
			jQuery('.ta1').attr('class','ta1 active');
			jQuery('.ta2').attr('class','ta2');
			jQuery('.ta3').attr('class','ta3');
		}else if(num==2){
       		jQuery('#ReviewManage').attr('class','tab-pane');
			jQuery('#CodeNum').attr('class','tab-pane active');
			jQuery('#ResumeReferNum').attr('class','tab-pane');
			jQuery('.ta1').attr('class','ta1');
			jQuery('.ta2').attr('class','ta2 active');
			jQuery('.ta3').attr('class','ta3');
			usedcount();
		}else{
        	jQuery('#ReviewManage').attr('class','tab-pane');
			jQuery('#CodeNum').attr('class','tab-pane');
			jQuery('#ResumeReferNum').attr('class','tab-pane active');
			jQuery('.ta1').attr('class','ta1');
			jQuery('.ta2').attr('class','ta2');
			jQuery('.ta3').attr('class','ta3 active');
			clickcount();
		}
	}

	function usedcount(){
		jQuery.plot("#placeholder", [{
	        data: #{newAnimalRecordHome.zhuzhuang},
	        label: "使用量",
	        bars: {
	                show: true,
	                barWidth: 0.6,
	                align: "center"
	            }
	        
	    }], {
	        series: {
	            bars: {
	                show: true,
	                barWidth: 0.6,
	                align: "center"
	    		},
	    		hoverable: true
	        },
	        yaxis:{
	        	min:"0",
	        	minTickSize:"1",
	        	tickDecimals:"null"
			},
	        xaxis: {
				mode: "categories",
              tickLength: 0
	        },
	        grid: { hoverable: true, clickable: true }
	    });
	 	var previousPoint = null, previousLabel = null;
		jQuery("#placeholder").bind("plothover", function (event, pos, item) {
			if (item) {
				if ((previousLabel != item.series.label) || (previousPoint != item.dataIndex)) {
					previousPoint = item.dataIndex;
					previousLabel = item.series.label;
					jQuery("#tooltip").remove();
					//console.log(item.datapoint);
					var x = item.datapoint[0];
					var y = item.datapoint[1];
	
					var date =  #{newAnimalRecordHome.zhuzhuang}[item.dataIndex][0] ;
					//console.log(item);
					showTooltip(item.pageX, item.pageY, date +" 使用量 : <strong>" + y + "</strong> 张");
				}
			} else {
				jQuery("#tooltip").remove();
				previousPoint = null;
			}
		});
		function showTooltip(x, y, contents) {
			jQuery("<div id='tooltip'>" + contents + "</div>").css({
				position: "absolute",
				display: "none",
				top: y + 5,
				left: x + 5,
				border: "1px solid #fdd",
				padding: "2px",
				"background-color": "#fee",
				opacity: 0.80
			}).appendTo("body").fadeIn(200);
		}
	}


	function clickcount(){
		jQuery.plot("#placeholder2", [
     			{ data: #{newAnimalRecordHome.quxian}, label: "点击量"},
     		], {
     			xaxis: {mode: "time",timeformat: "%y-%m-%d"},
     			yaxis:{min:"0",minTickSize:"1",tickDecimals:"null"},
     			series: {
     				lines: {
     					show: true
     				},
     				points: {
     					show: true
     				}
     			},
     			grid: {
     				hoverable: true,
     				clickable: true
     			},
     		});

     		function showTooltip(x, y, contents) {
     			jQuery("<div id='tooltip'>" + contents + "</div>").css({
     				position: "absolute",
     				display: "none",
     				top: y + 5,
     				left: x + 5,
     				border: "1px solid #fdd",
     				padding: "2px",
     				"background-color": "#fee",
     				opacity: 0.80
     			}).appendTo("body").fadeIn(200);
     		}

     		var previousPoint = null;
     		jQuery("#placeholder2").bind("plothover", function (event, pos, item) {
     			if (true) {
     				var str = "(" + pos.x.toFixed(2) + ", " + pos.y.toFixed(2) + ")";
     				jQuery("#hoverdata").text(str);
     			}
     			if (true) {
     				if (item) {
     					if (previousPoint != item.dataIndex) {
     						previousPoint = item.dataIndex;
     						jQuery("#tooltip").remove();
     						var x = item.datapoint[0].toFixed(2),
     						y = item.datapoint[1].toFixed(2);
     						var str1 = (x+"").split(".")[0];
     						var dat = new Date(parseInt(str1));
     						var str = dat.getFullYear()+"年"+(dat.getMonth()+1)+"月"+dat.getDate()+"日";
     						y = (y+"").split(".")[0];
     						showTooltip(item.pageX, item.pageY,str + " 点击量： " + y +"次");
     					}
     				} else {
     					jQuery("#tooltip").remove();
     					previousPoint = null;            
     				}
     			}
     		});

	}

	function jump(index){
		commentR(index);
	}

	function deleteComment(id){
		if(confirm('删除评论后无法还原，确定删除？')){
			jQuery("#aaa").contents().find("#anima"+id).remove();
			var favorableComment=0;// 好评
			var average=0;// 中评
			var poor=0;// 差评
			var all=0;
			jQuery("#aaa").contents().find(".score_list li").each(function(){
				all++;
				var len=jQuery(this).find(".star_score [src='/asset/images/star1_01.png']").length;
				if(len>3){
					favorableComment++;
				}
				if(len==3){
					average++;
				}
				if(len<3){
					poor++;
				}
			
			})
			if(all!=0){
				favorableComment=parseInt(favorableComment / all * 100);
				average=parseInt(average / all * 100);
				poor=parseInt(poor / all * 100);
				all=favorableComment+average+poor;
				if(all>100){
					var difference=all-100;
					if(poor>=difference){
						poor=poor-difference;
					}else if(average>=difference){
						average=average-difference;
					}else if(favorableComment>=difference){
						favorableComment=favorableComment-difference;
					}
				}else if(all<100){
					var difference=100-all;
					favorableComment=favorableComment+difference;
				}
			}
		
			jQuery("#aaa").contents().find('.color_ye span').text(favorableComment);
			jQuery("#aaa").contents().find('.color_gr').eq(1).text("("+favorableComment+"%");
			jQuery("#aaa").contents().find('.color_gr').eq(2).text("("+average+"%)");
			jQuery("#aaa").contents().find('.color_gr').eq(3).text("("+poor+"%)");
			jQuery("#aaa").contents().find('.ra_bar').eq(1).attr("styel","width:"+favorableComment+"%");
			jQuery("#aaa").contents().find('.ra_bar').eq(2).attr("styel","width:"+average+"%)");
			jQuery("#aaa").contents().find('.ra_bar').eq(3).attr("styel","width:"+poor+"%");
			delcomments(id,'#{newAnimalRecordHome.livestockHistoryId}')
	 	}
	}
	
	
//]]>
</script>
            </td>    
</ui:define>

</ui:composition>
