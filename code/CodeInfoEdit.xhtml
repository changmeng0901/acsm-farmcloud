<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    template="/layout/template_new2.xhtml">
	<ui:define name="body">
	<style>
	  .form-control{float:left;}
	  .nw100{width:100px;margin-right:10px;}
	  .bootstrap-select > .btn{ width:210px;}
	</style>
	<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/checkBox/skinBlue.css"/>
	<script type="text/javascript" src="#{request.contextPath}/asset/js/checkBox/icheck.js"></script>
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/asset/css/settings/EnterpriseSettings.css" />
    <script type="text/javascript" src="#{request.contextPath}/asset/js/EnterpriseLeftMenu.js"></script>
    
	   <td valign="top">
                <div class="inbentory_file_main">
                <!--左侧二级导航 -->
                <div class="inbentory_level_wap">
                    <div class="inbentory_level">
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_rkgl"></i>基础设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/user/UpdateEnterpriseSettings.seam?enterpriseId=#{sessionTake.enterpriseInfoId}','_self')" >
                            	<i class="icon_sed"></i>企业设置                   	
                            </li>
                            <!-- 管理版和以前的版本（标准、白金...)显示 -->
                            <h:panelGroup rendered="#{sessionTake.nowVersionService.basicService.basicServiceId==10 or sessionTake.nowVersionService.basicService.serviceType eq 1}">
                            	<li class="sed_item" onclick="window.open('#{request.contextPath}/user/ModuleSettings.seam','_self')" ><i class="icon_sed"></i>模块配置</li>
                            </h:panelGroup>
                            <li class="sed_item sed_cur" onclick="window.open('#{request.contextPath}/dictionary/DataDicinfoList.seam','_self')" ><i class="icon_sed"></i>字段管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/user/EnterpriseCommunityList.seam','_self')" ><i class="icon_sed"></i>角色管理</li>
                            <s:fragment rendered="#{enterpriseInfoHome.enterpriseInfo.govState}">
	                        	<li class="sed_item" onclick="window.open('#{request.contextPath}/user/AuditInformationList.seam','_self')" ><i class="icon_sed"></i>审核信息</li>
	                        </s:fragment>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/system/RecycleInfoList_1.seam','_self')" ><i class="icon_sed"></i>回收站</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_ckgl"></i>生产管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <h:panelGroup rendered="#{s:hasRole('certification')}">
                            	<li class="sed_item" onclick="window.open('#{request.contextPath}/map/CertificationList.seam','_self')" ><i class="icon_sed"></i>认证信息</li>
                            </h:panelGroup>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/message/TunnelGroupList.seam','_self')" ><i class="icon_sed"></i>分组管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/InputsInfoList.seam?goodsTypeInfoId=5','_self')" ><i class="icon_sed"></i>投入品信息</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_zkgl"></i>销售管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/GoodsInfoList.seam','_self')"><i class="icon_sed"></i>物料信息</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/product/ProductInfoList.seam','_self')" ><i class="icon_sed"></i>商品信息</li>
                        </ol>
                        <strong class="inben_first inben_first2">
                            <a href="javascript:;"><i class="icon_L icon_pdgl"></i>硬件管理设置</a><b class="b_arrow"></b>
                        </strong>
                        <ol class="inben_second">
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/device/DeviceList.seam','_self')"><i class="icon_sed"></i>设备管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/device/VideoList.seam','_self')" ><i class="icon_sed"></i>视频管理</li>
                            <li class="sed_item" onclick="window.open('#{request.contextPath}/farming/AmRfidInfoList.seam','_self')" ><i class="icon_sed"></i>RFID卡管理</li>
                        </ol>
                    </div>
                    <i class="collapse_btn"></i>
                </div>
                <!--左侧二级导航 -->
				<!--右侧 -->
                <div class="inbentory_content">
                <div class="right_c">
                	<div class="r_title">
                    	<div class="r_t_l"> 
                    	<font size="4">编号设置 </font>
                    	</div>
                    </div>
                    				<!--入库订单列表开始-->
                    <h:form id="codeInfo">
                   <!-- Modal -->
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal" class="modal fade in w600na" style="display: none;width:310px;top:15%;">
  <div class="modal-dialog" style="width:310px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
      	<p style="text-align:center;"><img src="#{request.contextPath}/asset/images/farmingIco20_1.png" alt="" /></p>
       	<p style="text-align:center;" id="spanValue">*号部分为必填项！</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">确认</button>
      </div>
    </div>
  </div>
</div>
 <!-- Modal -->
<div aria-hidden="false" aria-labelledby="mySubmitModalLabel" role="dialog" tabindex="-1" id="mySubmitModal" class="modal fade in w600na" style="display: none;width:310px;top:15%;">
  <div class="modal-dialog" style="width:310px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="mySubmitModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
      	<p style="text-align:center;"><img src="#{request.contextPath}/asset/images/farmingIco20_1.png" alt="" /></p>
       	<p style="text-align:center;" id="spanValue">
       		您是否希望将历史编号统一为现有编号规则？
		</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-dismiss="modal" onclick="submitCode('Y')">替换</button>
        <button type="button" class="btn btn-default" data-dismiss="modal" onclick="submitCode('N')">不替换</button>
      </div>
    </div>
  </div>
</div>
                	<div class="all_d3">
                    	<div class="all_da all_w01" style="display: block;">
                        	<table>
                                <tr>
                                    <td class="all_te">编号名称：</td>
                                    <td>
                                        <span style="font-size:13px;">#{codeInfoHome.instance.codeName}</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                    	<div class="all_da all_w01" style="width:555px; display: block;">
                        	<table>
                                <tr>
                                    <td class="all_te">编号规则：</td>
                                    <td colspan="3">
                                    	<h:inputText id="firstCode" maxlength="50" value="#{codeInfoHome.instance.firstCode}" styleClass="form-control nw100"/>
                                    	<input type="text" id="secondCode" maxlength="50" value="#{codeInfoHome.instance.enterpriseInfoId eq 1 ? codeInfoHome.getEnterpriseCode() : codeInfoHome.instance.secondCode}" class="form-control nw100"/>
                                    	<h:inputHidden id="hidSecondCode" value="#{codeInfoHome.instance.secondCode}" />
                                    	<span style="line-height: 25px;font-size:13px;" id="currentTime">#{codeInfoHome.currentTime}</span>
                                    	<span style="line-height: 25px;font-size:13px;" id="lastCode">#{codeInfoHome.instance.lastCode}</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da all_w01" style="display: block;">
                        	<table>
                                <tr>
                                    <td class="all_te">尾号位数：</td>
                                    <td>
                                        <h:selectOneMenu styleClass="selectpicker" id="lastCodeList" style="width: 266px;display:none;" value="#{codeInfoHome.instance.lastCode}" onchange="changeLastCode(this.value)">
                                    		<f:selectItem itemLabel="四位编号" itemValue="0001"/>
			                   				<f:selectItem itemLabel="五位编号" itemValue="00001"/>
			                   				<f:selectItem itemLabel="六位编号" itemValue="000001"/>
			                   			</h:selectOneMenu>
			                   			<h:inputHidden id="hidLastCode" value="#{codeInfoHome.instance.lastCode}" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="all_da" style="display: block;">
                        	<table>
                                <tr>
                                    <td class="all_te" style="line-height: 17px;padding-left:18px;">
                                    	<input type="checkbox"  id="dateFlag" name="dateFlag" value="#{codeInfoHome.instance.dateFlag}" onchange="changeDateFlag(this.value);"/>启用日期
                                    	<h:inputHidden id="hidDateFlag" value="#{codeInfoHome.instance.dateFlag}" />
                                    </td>
                                    <td id="cancelDateMsg" style="padding-left:15px;color:#3999E8;display:none;">*取消启用日期，则编号规则可能出现位数不同情况，例如编号为四位，当编号增长为9999后，新增一条后编号变为5位。</td>
                                </tr>
                            </table>
                        </div>
                        <div class="clear"></div>
                   </div>
                   
                    <div class="ckd_button"  style="text-align: center;margin-top:100px;">
                    	<h:inputHidden id="hidReplaceFlag" value="#{codeInfoHome.replaceFlag}" />
                    	<a href="javascript:void(0);" class="btn btn-primary" onclick="return checkSubmit()">提交</a>
                   	 	<h:commandButton id="editCodeBtn"  styleClass="btn btn-primary" value="提交" action="#{codeInfoHome.editCodeInfo()}" style="display:none;" />
                   	 	<s:link view="/dictionary/DataDicinfoList.seam?myType=codeinfo" styleClass="btn btn-default" value="返回" style="margin-left:10px;" ></s:link>
                    </div>
                    <!--按钮结束--> 
                    <div class="clear"></div>
                    </h:form>
                </div><!--right_c结束-->
               </div>
               </div>
				<!--入库订单列表结束-->
				 <a:form>
                	<a:queue  ignoreDupResponses="true"/>
				 	<a:jsFunction name="checkRepeatCode"  action="#{codeInfoHome.checkRepeatCode()}" data="#{codeInfoHome.messageStr}" oncomplete="checkRepeatCallBack(data)">
		           		<a:actionparam name="codeInfoId" assignTo="#{codeInfoHome.codeInfoId}"/>
		           		<a:actionparam name="firstCode" assignTo="#{codeInfoHome.firstCode}"/>
			   		</a:jsFunction>
				</a:form>
            </td>    
    <!--右边结束-->
 <!--添加按钮结束-->
<script type="text/javascript">
//<![CDATA[
      jquery(document).ready(function(){
          jquery('.selectpicker').selectpicker();
          jquery('input').iCheck({
      	    checkboxClass: 'icheckbox_minimal-blue',
      	    radioClass: 'iradio_minimal-blue',
      	    increaseArea: '20%' // optional
      	  });
      	  var dateFlag="#{codeInfoHome.instance.dateFlag}";
      	  if(dateFlag=="true"){
      		  jquery("#dateFlag").iCheck("check"); 
      		  jquery("#currentTime").css("display","");
      		  jquery('.selectpicker').selectpicker("val","0001")
      		  document.getElementById('codeInfo:lastCodeList').disabled = true; 
          }else{
        	  jquery("#dateFlag").iCheck("uncheck"); 
        	  jquery("#currentTime").css("display","none");
        	  jquery("#cancelDateMsg").css("display","");
        	  document.getElementById('codeInfo:lastCodeList').disabled = false;
          }
      	  jquery("#dateFlag").on("ifClicked", function(event){
	    		if (this.checked) {	    			
	    			document.getElementById('codeInfo:lastCodeList').disabled = false;
		    		jquery("#codeInfo\\:hidDateFlag").val("false");
	    			jquery("#currentTime").css("display","none");
	    			jquery("#cancelDateMsg").css("display","");
	    			//document.getElementById("spanValue").innerHTML = "取消启用日期，则编号规则可能出现位数不同情况，例如编号为四位，当编号增长为9999后，新增一条后编号变为5位。";
	  			    //jquery("#myModal").modal('show');	  			    
	    		}else{
	    			jquery('.selectpicker').selectpicker("val","0001")
	    			document.getElementById('codeInfo:lastCodeList').disabled = true;
	    			jquery("#codeInfo\\:hidDateFlag").val("true");
					jquery("#currentTime").css("display","");	
					jquery("#cancelDateMsg").css("display","none");			
		    	}
      	  });
      });
      function changeLastCode(lastCodeValue){
    	  jquery("#lastCode").html(lastCodeValue);
      }
      var reg = /^[A-Za-z]+$/; 	
      var reg1 = /^[0-9]+$/;	
      function checkSubmit(){
           var firstCode=jquery("#codeInfo\\:firstCode").val();
		   if(firstCode == ""){
			   document.getElementById("spanValue").innerHTML = "字母输入框不能为空，请修改后重新提交！";
			   jquery("#myModal").modal('show');
			   return false;
		   }else if(firstCode.length>4){
			   document.getElementById("spanValue").innerHTML = "字母输入框长度不能大于4，请修改后重新提交！";
			   jquery("#myModal").modal('show');
			   return false;
		   }else if (!reg.test(firstCode)){
			   document.getElementById("spanValue").innerHTML = "字母输入框只能输入字母，请修改后重新提交！";
			   jquery("#myModal").modal('show');
			   return false;
		   }
		   var secondCode = jquery("#secondCode").val();
		   if(secondCode == ""){
			   document.getElementById("spanValue").innerHTML = "第二个输入框不能为空，请修改后重新提交！";
			   jquery("#myModal").modal('show');
			   return false;
		   }else if(secondCode.length > 6){
			   document.getElementById("spanValue").innerHTML = "第二个输入框长度不能大于6，请修改后重新提交！";
			   jquery("#myModal").modal('show');
			   return false;
		   }else if (!reg1.test(secondCode)){
			   document.getElementById("spanValue").innerHTML = "第二个输入框只能输入数字，请修改后重新提交！";
			   jquery("#myModal").modal('show');
			   return false;
		   }
		   var lastCode=jquery("#codeInfo\\:lastCodeList").val(); 
		   jquery("#codeInfo\\:hidLastCode").val(lastCode);
		   jquery("#codeInfo\\:hidSecondCode").val(secondCode);
		   var codeId="#{codeInfoHome.instance.codeInfoId}";
		   checkRepeatCode(codeId,firstCode);
		   return true;
     }
     function checkRepeatCallBack(msg){
		if(null!=msg && ""!=msg){
			document.getElementById("spanValue").innerHTML =msg;
			jquery("#myModal").modal('show');
		}else{			
			jquery("#mySubmitModal").modal('show');			
	    }
     }
     function submitCode(replaceFlag){
    	 jquery("#codeInfo\\:hidReplaceFlag").val(replaceFlag);
    	 jquery("#login").show();
		 jquery("#codeInfo\\:editCodeBtn").click();
     }
  //]]>
	</script>
<!--鼠标移上去换色js开始-->
<style>
	.VMsgDiv{
		line-height: 75%;
		width: 100%;
		text-align: left;
		padding-top: 12px;
		color:#F97D26;
		margin-left:10px;
	}
	</style>
</ui:define>
</ui:composition>
