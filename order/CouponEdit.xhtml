<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    template="/layout/template_new.xhtml">
	<ui:define name="body">
	    <link rel="stylesheet" href="#{request.contextPath}/asset/css/order/CustomerInfor.css" type="text/css" />
		<!-- #{couponHome.begin()} -->
		<td valign="top">
            <div class="right_c" style="min-height:30px; padding-bottom:15px; padding-top:15px;">
            	<!-- 面包屑导航 开始 -->
                <div class="breadNav_wap mb15 clear">
                    <div class="breadNav_lt">采销存&gt;<a href="#">订单管理</a><span>&gt;</span><a href="RedPacketManage.html">红包管理</a><span>&gt;</span><strong>添加红包</strong></div>
                    <div class="breadNav_rt" style="margin-bottom:-1px; margin-top:1px;">
                        <ul class="resumeList clear">
                             <li>
	                            <a href="#{request.contextPath}/orderManage/OrderOperateList.seam"><img src="../asset/images/orderManage/resumeIco50.jpg" /><span>订单管理</span></a>
	                        </li>
	                        <li>
	                    		<a href="#{request.contextPath}/order/MemberInfoListOne.seam"><img src="../asset/images/orderManage/resumeIco51.jpg" /><span>客户管理</span></a>
	                        </li>
	                        <li>
	                    		<a href="#{request.contextPath}/card/CardInfoList.seam?cardType=0"><img src="../asset/images/orderManage/resumeIco51.jpg" /><span>会员卡管理</span></a>
	                        </li>
	                        <li class="cur">
                                <a class="borderBt" href="#{request.contextPath}/order/CouponList.seam"><img src="../asset/images/order/resumeIco150.jpg" /><span>红包管理</span></a>
                            </li>
                        </ul>
                    </div>
                </div>
                <!-- 添加红包内容 -->
                <h:form id="save">
                <table class="messageTable" width="100%" cellpadding="0" cellspacing="0" style="width:760px; margin:40px auto 20px; font-size:12px;">
                	<tr>
                    	<td class="pr10" align="right" width="110">红包名称</td>
                        <td width="262">
                        	<span class="bootTxt220">
                            <h:inputText styleClass="form-control" value="#{couponHome.instance.name}" id="nameId"/>
                            <h:inputHidden styleClass="form-control" value="#{couponHome.instance.id}" id="idId"/>
                            </span>
                            <span class="star_red">*</span>
                        </td>
                        <td class="pr10" align="right" width="110">面额</td>
                        <td>
                        	<span class="bootTxt220">
                            <h:inputText styleClass="form-control" value="#{couponHome.instance.price}" id="priceId"/>
                            </span>
                            <span class="star_red"><i>元</i>*</span>
                        </td>
                    </tr>
                    <tr>
                    	<td class="pr10" align="right" width="110">数量上限</td>
                        <td width="262">
                        	<span class="bootTxt220">
                            <h:inputText styleClass="form-control" value="#{couponHome.instance.amount}" id="amountId"/>
                            </span>
                            <span class="star_red"><i>个</i>*</span>
                        </td>
                        <td class="pr10" align="right" width="110">有效期</td>
                        <td>
                        	<span class="bootTxt220">
                            <h:inputText styleClass="form-control" value="#{couponHome.instance.validity}" id="validityId"/>
                            </span>
                            <span class="star_red"><i>天</i>*</span>
                        </td>
                    </tr>
                    <tr>
                    	<td class="pr10" align="right" width="110">领取生效日期</td>
                        <td width="262">
                        	<div class="bootData220">
                                <div class="input-append date form_datetime " style="position:relative;" >
                                <h:inputText size="26" readonly="#{facesContext.renderResponse}" value="#{couponHome.instance.startTime}" style="border-radius:4px;" id="startTimeId"/>
                                <span class="add-on" style="position:absolute; right:10px; top:10px;"><i class="icon-th" style="margin:0;"></i></span>
                                </div>
                            </div>
                            <span class="star_red">*</span>
                        </td>
                        <td class="pr10" align="right" width="110">领取失效日期</td>
                        <td>
                        	<div class="bootData220">
                                <div class="input-append date form_datetime " style="position:relative;" >
                                <h:inputText size="26" readonly="#{facesContext.renderResponse}"  value="#{couponHome.instance.endTime}" style="border-radius:4px;" id="endTimeId"/>
                                <span class="add-on" style="position:absolute; right:10px; top:10px;"><i class="icon-th" style="margin:0;"></i></span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                    	<td class="pr10" align="right" width="110">使用条件</td>
                        <td colspan="3">
                        	<span style="float:left; width:20px;line-height:34px;">满</span>
                        	<span class="bootTxt220" style="width:200px;">
                            <h:inputText styleClass="form-control" value="#{couponHome.instance.useCondition}" id="useConditionId"/>
                            </span>
                            <span class="star_red"><i>元</i></span>
                        </td>
                    </tr>
                    <tr>
                    	<td class="pr10" align="right" width="110">使用规则</td>
                        <td colspan="3">
                        	<span class="bootTextarea fl">
                        		<h:inputTextarea value="" styleClass="form-control area_textarea" style="width:500px;" id="usageRuleId"/>
                        		<h:inputHidden value="#{couponHome.instance.usageRule}" id="usageRuleIdH"/>
                        	</span>
                            <span class="star_red" style="line-height:96px;">*</span>
                        </td>
                    </tr>
                </table>
                <!-- 添加红包内容 结束  -->
                <div style="margin:50px 0 100px;" class="mes_mailBtn">
                	<h:inputHidden value="#{couponHome.instance.baseId}" id="baseids"/>
                	<button type="button" onclick="checkSubmit()" class="btn btn-primary" >提交</button>
                    <h:commandButton id="persist" value="提交" styleClass="btn btn-primary sav" action="#{couponHome.persist}" rendered="#{!couponHome.managed}"  style="display:none;"/>
		            <h:commandButton id="update" value="提交" styleClass="btn btn-primary sav" action="#{couponHome.update}" rendered="#{couponHome.managed}" style="display:none;"/>
           			<s:button view="/order/CouponList.seam" styleClass="btn btn-default" value="返回" id="bn_left6" style="margin-left:10px">
           				<f:param name="pageNum" value="#{couponHome.pageNum}" />
           			</s:button>
                </div>
                </h:form>
            </div>
		</td> 
<a:form>
		<a:jsFunction name="nameverification" action="#{couponHome.nameVerification}" data="#{couponHome.verification}" oncomplete="huidiao(data)">
			<a:actionparam name="name" assignTo="#{couponHome.name}"/>
			<a:actionparam name="conid" assignTo="#{couponHome.conid}"/>
		</a:jsFunction>
	</a:form>
<script>
//<![CDATA[
jquery(function(){
	jquery('#save\\:usageRuleId').val(jquery('#save\\:usageRuleIdH').val().replace(/<\/br\>/g,"\n"));
	jquery('#selectBaseDiv .siteSelection .siteSeleBd').attr("style","display:none;");
	jquery('#selectBaseDiv .siteSelection .siteSeleBd').attr("class","");
	if(jquery('#save\\:baseids').val()!='' && jquery('#selected'+jquery('#save\\:baseids').val()).length>0){
		jquery('.siteSeleHd').text(jQuery('#selected'+jquery('#save\\:baseids').val()).find('a').text())
	}

	if(jquery('#save\\:startTimeId').val()==""){
		jquery('#save\\:startTimeId').val(new Date().Format("yyyy-MM-dd"))
	}
	if(jquery('#save\\:usageRuleId').val()==""){
		jquery('#save\\:usageRuleId').val('1、每次活动、每个手机号限领一次；\n2、红包金额只限购买果蔬抵现使用，不返还现金、不找零；\n3、每个红包限使用单次订单；\n4、红包金额不可转让，不可与其他优惠重复使用；\n5、本次活动最终解释权归{#{couponHome.ei.name}}所有。\n如您想下次使用红包，可查看：\n1、您领取红包手机的短信 \n2、拨打客服电话{#{couponHome.ei.contactPhone}}进行咨询使用')
	}
	// 时间插件
	jquery(".form_datetime").datetimepicker({
		format: "yyyy-mm-dd",  
		autoclose: true,
		weekStart: 1,
		language:  'zh-CN',
		startView: 3,
		minView: 2,
		maxView: 2,		
		pickerPosition: "bottom-left"
	});
	
});


Date.prototype.Format = function (fmt) { //author: meizz 
    var o = {
        "M+": this.getMonth() + 1, //月份 
        "d+": this.getDate(), //日 
        "h+": this.getHours(), //小时 
        "m+": this.getMinutes(), //分 
        "s+": this.getSeconds(), //秒 
        "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
        "S": this.getMilliseconds() //毫秒 
    };
    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
    for (var k in o)
    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
    return fmt;
}

function checkSubmit(){
	var flag=false;
	if(jquery('#save\\:endTimeId').val()!=""){
		var sta=jquery('#save\\:startTimeId').val().split('-');
		var star=sta[0];
		if(sta[1].length==1){
			star+=0+sta[1];
		}else{
			star+=sta[1];
		}
		if(sta[2].length==1){
			star+=0+sta[2];
		}else{
			star+=sta[2];
		}
		var en=jquery('#save\\:endTimeId').val().split('-');
		var ent=en[0];
		if(en[1].length==1){
			ent+=0+en[1];
		}else{
			ent+=en[1];
		}
		if(en[2].length==1){
			ent+=0+en[2];
		}else{
			ent+=en[2];
		}
		if(parseInt(star)>=parseInt(ent)){
			flag=true;
		}
        
	}
	
	var regDNum = /^[1-9]\d*$/;
	if(jquery('#save\\:nameId').val()=='' || jquery('#save\\:nameId').val().length>10){
		document.getElementById("topSpanValue").innerHTML = "红包名称不能为空并且不能大于10个字！";
		jquery("#topModel").modal('show');
	}else if(!regDNum.test(jquery('#save\\:priceId').val()) || jquery('#save\\:priceId').val()=='' || jquery('#save\\:priceId').val()>10000){
		document.getElementById("topSpanValue").innerHTML = "面额不能为空并且不能大于10000的正整数！";
		jquery("#topModel").modal('show');
	}else if(!regDNum.test(jquery('#save\\:amountId').val()) || jquery('#save\\:amountId').val()=='' || jquery('#save\\:amountId').val()>100000){
		document.getElementById("topSpanValue").innerHTML = "数量上限不能为空并且不能大于100000的正整数！";
		jquery("#topModel").modal('show');
	}else if(!regDNum.test(jquery('#save\\:validityId').val()) || jquery('#save\\:validityId').val()=='' || jquery('#save\\:validityId').val()>100){
		document.getElementById("topSpanValue").innerHTML = "有效期上限不能为空并且不能大于100的正整数！";
		jquery("#topModel").modal('show');
	}else if(flag){
		document.getElementById("topSpanValue").innerHTML = "生效日期不能大于失效日期！";
		jquery("#topModel").modal('show');
	}else if(jquery('#save\\:useConditionId').val()!="" && (!regDNum.test(jquery('#save\\:useConditionId').val())  || jquery('#save\\:useConditionId').val()>100000)){
		document.getElementById("topSpanValue").innerHTML = "使用条件为不能大于100000的正整数！";
		jquery("#topModel").modal('show');
	}else if(jquery('#save\\:usageRuleId').val()=='' || jquery('#save\\:usageRuleId').val().length>300){
		document.getElementById("topSpanValue").innerHTML = "使用规则不能为空并且不能大于300字！";
		jquery("#topModel").modal('show');
	}else{
		nameverification(jquery('#save\\:nameId').val(),jquery('#save\\:idId').val());
	}
	
}
function huidiao(obj){
	if(obj){
		jquery('#save\\:usageRuleIdH').val(jquery('#save\\:usageRuleId').val().replace(/[\n]/g,"</br>"));
		jquery('.sav').click();
	}else{
		document.getElementById("topSpanValue").innerHTML = "该红包已经存在，请修改红包名称后重新提交！";
		jquery("#topModel").modal('show');
	}
}
//]]>
</script>
	</ui:define>
</ui:composition>
