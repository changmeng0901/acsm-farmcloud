<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    template="/layout/template_new.xhtml">
	<ui:define name="body">
	    <link rel="stylesheet" href="#{request.contextPath}/asset/css/order/CustomerInfor.css" type="text/css" />
	    <style>
	    .fPicture .delete {position: absolute;right: 0;top: 0;display: none;width: 34px;height: 34px;cursor: pointer;}
		.fPicture:hover .delete{display: block;}
	    </style>
		<!-- #{detailsCouponHome.begin()} -->
		<td valign="top">
            <div class="right_c" style="min-height:30px; padding-bottom:15px; padding-top:15px;">
            	<!-- 面包屑导航 开始 -->
                <div class="breadNav_wap mb15 clear">
                    <div class="breadNav_lt"><a href="#">采销存</a><span>&gt;</span><a href="RedPacketManage.html">订单管理</a><span>&gt;</span><a href="RedPacketManage.html">红包管理</a><span>&gt;</span><strong>添加红包</strong></div>
                    <div class="breadNav_rt" style="margin-bottom:-1px; margin-top:1px;">
                        <ul class="resumeList clear">
                             <li>
	                            <a href="#{request.contextPath}/orderManage/OrderOperateList.seam"><img src="../asset/images/orderManage/resumeIco50.jpg" /><span>订单管理</span></a>
	                        </li>
	                        <li>
	                    		<a href="#{request.contextPath}/order/MemberInfoListOne.seam"><img src="../asset/images/orderManage/resumeIco51.jpg" /><span>客户管理</span></a>
	                        </li>
	                        <li>
	                    		<a href="#{request.contextPath}/card/CardInfoList.seam?cardType=0"><img src="../asset/images/orderManage/resumeIco51.jpg" /><span>会员卡管理</span></a>
	                        </li>
	                        <li class="cur">
                                <a class="borderBt" href="#{request.contextPath}/order/CouponList.seam"><img src="../asset/images/order/resumeIco150.jpg" /><span>红包管理</span></a>
                            </li>
                        </ul>
                    </div>
                </div>
                <!-- 添加红包内容 -->
                <h:form id="save"  enctype="multipart/form-data">
	                <div class="setContent">
	                    <table width="100%" cellpadding="0" cellspacing="0">
	                        <tr>
	                            <td width="85" class="item">LOGO</td>
	                            <td width="370">
	                            <!-- logo -->
		                            <div class="filing">
		                                <div class="fPicture" style="display:#{not empty detailsCouponHome.instance.logoUrl ?'':'none'}">
		                                	<img class="fimg" src="#{detailsCouponHome.instance.logoUrl}" id="logoId" width="126" height="125" />	                                	                                   
		                                    <i class="delete" onclick="delLogoImg(0);">
		                                        <img class="fimg" src="#{request.contextPath}/asset/images/settings/fileImg_delet5.jpg"/>
		                                    </i>
		                                </div>
		                                <div class="filepic">
		                                    <s:fileUpload id="loginSuccess" size="30" styleClass="upload"
												accept="image/png,image/jpeg,image/gif"
												contentType="image/png,image/jpeg,image/gif"
												fileName="#{detailsCouponHome.instance.logoName}"
												data="#{detailsCouponHome.instance.logoByte}" onchange="previewImage('logoId',this,'0');">
											</s:fileUpload>
		                                </div>
		                            </div>
		                           <p class="redTip">图片标准：160x60（像素）支持格式：jpg,gif,png,jpeg,bmp,3gp</p>
		                           <h:inputHidden value="#{detailsCouponHome.logoNameHave}" id="logoNameHaveId"/>
		                        <!-- logo -->
	                            </td>
	                        </tr>
	                        <tr>
	                            <td class="item">一句话简介</td>
	                            <td>
	                            	<h:inputText value="#{detailsCouponHome.instance.briefIntroduction}" styleClass="txtInput" id="briefIntroductionId"/>
	                            </td>
	                        </tr>
	                        <tr>
	                            <td class="item">背景图</td>
	                            <td>
	                                <div class="filing">
		                                <div class="fPicture" style="display:#{not empty detailsCouponHome.instance.backgroundUrl ?'':'none'}">
		                                	<img class="fimg" src="#{detailsCouponHome.instance.backgroundUrl}" id="backgroundId" width="126" height="125" />	                                	                                   
		                                    <i class="delete" onclick="delLogoImg(1);">
		                                        <img class="fimg" src="#{request.contextPath}/asset/images/settings/fileImg_delet5.jpg"/>
		                                    </i>
		                                </div>
		                                <div class="filepic">
		                                    <s:fileUpload id="background" size="30" styleClass="upload"
												accept="image/png,image/jpeg,image/gif"
												contentType="image/png,image/jpeg,image/gif"
												fileName="#{detailsCouponHome.instance.backgroundName}"
												data="#{detailsCouponHome.instance.backgroundByte}" onchange="previewImage('backgroundId',this,'1');">
											</s:fileUpload>
		                                </div>
		                            </div>
		                           <p class="redTip">图片标准：160x60（像素）支持格式：jpg,gif,png,jpeg,bmp,3gp</p>
		                           <h:inputHidden value="#{detailsCouponHome.backgroundNameHave}" id="backgroundNameHaveId"/>
	                            </td>
	                        </tr>
	                        <tr>
	                            <td class="item">咨询电话</td>
	                            <td>
	                            	<h:inputText value="#{detailsCouponHome.instance.telPhone}" styleClass="txtInput" id="telPhoneId"/>
	                            </td>
	                        </tr>
	                        <tr>
	                            <td class="item">标题</td>
	                            <td>
	                            	<h:inputText value="#{detailsCouponHome.instance.title}" styleClass="txtInput" id="titleId"/>
	                            </td>
	                        </tr>
	                    </table>
	                    <div class="btns">
		                    <h:commandButton id="persist" value="提交" styleClass="btn btn-primary sav" action="#{detailsCouponHome.persist}" rendered="#{detailsCouponHome.instance.id==null}" onclick="if(!saveall())return false;"/>
				            <h:commandButton id="update" value="提交" styleClass="btn btn-primary sav" action="#{detailsCouponHome.update}" rendered="#{detailsCouponHome.instance.id!=null}" onclick="if(!saveall())return false;"/>
		           			<s:button view="/order/CouponList.seam" styleClass="btn btn-default" value="返回" id="bn_left6" style="margin-left:10px">
		           			</s:button>
	                    </div>
	                </div>
                </h:form>
            </div>
		</td> 
<script>
//<![CDATA[
jquery(function(){
	var promptMessage ='#{detailsCouponHome.promptMessage}';
	if(promptMessage!=""){
		alert(promptMessage);
	}
})
           
           
function saveall(){
	jquery("#save\\:logoNameHaveId").val(jquery("#logoId").attr("src"));
	jquery("#save\\:backgroundNameHaveId").val(jquery("#backgroundId").attr("src"));
	
	if(jQuery("#save\\:briefIntroductionId").val().length>15){
		alert("一句话简介最多为15字！");
		return false;
	}
	
	var reg =/(^(\d{3,4}-)?\d{7,8}$)|(^(13|15|17|18)[0-9]{9}$)/;
	if(jQuery("#save\\:telPhoneId").val()!='' &&!reg.test(jQuery("#save\\:telPhoneId").val())){
		alert("请输入正确的咨询电话	！");
		return false;
	}

	if(jQuery("#save\\:titleId").val().length>15){
		alert("标题最多为15字！");
		return false;
	}
	
	return true;
}
           
           
function delLogoImg(num){
	jquery(".fPicture").eq(num).css("display","none");
	if(num==0){
		jquery("#logoId").attr("src","");
	}else{
		jquery("#backgroundId").attr("src","");
	}
}

function previewImage(id,file,num){
 	var MAXWIDTH  = 0; 
  	var MAXHEIGHT = 0;
	 MAXWIDTH  = document.getElementById(id).offsetWidth; 
     MAXHEIGHT = document.getElementById(id).offsetHeight;
     MAXWIDTH  = jquery('#logoId').attr('width'); 
     MAXHEIGHT = jquery('#logoId').attr('height');
    var div = document.getElementById(id);
  	if (file.files && file.files[0]){
      var img;
	      div.innerHTML = '<img class=imghead id='+id+'>';
	      img = document.getElementById(id);
      img.onload = function(){
        var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
        img.width  =  rect.width;
        img.height =  rect.height;
        img.style.marginTop = rect.top+'px';
      }
      var reader = new FileReader();
      reader.onload = function(evt){img.src = evt.target.result;}
      reader.readAsDataURL(file.files[0]);
   }else{ //兼容IE
        var sFilter='filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="';
        file.select();
        var src = document.selection.createRange().text;
        var img;
	    	div.innerHTML = '<img class=imghead id='+id+'>';
	           img = document.getElementById(id);
	           img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;
	           var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
	           status =('rect:'+rect.top+','+rect.left+','+rect.width+','+rect.height);
	           div.innerHTML = "<div class=divhead id='"+id+"' style='position:absolute; width:"+rect.width+"px;height:"+rect.height+"px;margin-top:"+rect.top+"px;"+sFilter+src+"\"'></div>";
  }
  jquery(".fPicture").eq(num).css("display","");
}

function clacImgZoomParam( maxWidth, maxHeight, width, height ){
    var param = {top:0, left:0, width:maxWidth, height:maxHeight};
    return param;
}
//]]>
</script>
	</ui:define>
</ui:composition>
