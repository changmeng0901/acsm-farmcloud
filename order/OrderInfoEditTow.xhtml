<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich" 
    xmlns:a="http://richfaces.org/a4j"  
    template="/layout/order_template_new.xhtml">

<ui:define name="body">
<link rel="stylesheet" type="text/css" media="screen" href="#{request.contextPath}/asset/css/bootstrap-select.min.css"/>
	 <link href="#{request.contextPath}/asset/css/datetimepicker.css" rel="stylesheet"/>
	 	<link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/checkBox/skinBlue.css"/>
	
    <script type="text/javascript" src="#{request.contextPath}/asset/new/bootstrap-select.min.js"></script>
	<script type="text/javascript" src="#{request.contextPath}/asset/new/bootstrap-datetimepicker.js"></script>
	<script type="text/javascript" src="#{request.contextPath}/asset/new/bootstrap-datetimepicker.zh-CN.js"></script>
		<script type="text/javascript" src="#{request.contextPath}/asset/js/checkBox/icheck.js"></script>
<td valign="top" >
	<style>
		input[type=radio]{vertical-align:middle};
		.fap_div{text-align:left;font-family:"宋体"; padding-left:40px;}
		.rich-inplace-view{ border:none; border-bottom-width:0px;}
		.rich-inplace-view{ border-bottom-width:0px; border:1px solid #d5d5d5;}
		.dr-table-footercell {
		    background: none repeat scroll 0 0 #FFFFFF;
		    border-bottom: 1px solid #C0C0C0;
		    border-right: 1px solid #C0C0C0;
		    color: #000000;
		    font-family: Arial,Verdana,sans-serif;
		    font-size: 14px;
		    font-weight: bold;
		    height: 35px;
		    padding: 4px;
		    text-align: right;
		}
		.stripe3 th a{
		    color: #171717;
		    font-family: "宋体";
		    font-size: 12px;
		
		}
		.dr-table {
		    border-left: 1px solid #C0C0C0;
		    border-right: 1px solid #C0C0C0;
		}
		.dr-sb-shadow {
		    border: 1px solid;
		    height: auto;
		    position: absolute;
		    width: 100%;
		    z-index: 1;
		}
		.dr-pnl-b tr{
		 	height:26px; line-height:26px;
		}
		.dr-rich-tool-tip {
		    background-color: #FAE6B0;
		    border: 1px solid #E5973E;
		    display: none;
		    float: left;
		    font-family: Arial,Verdana,sans-serif;
		    font-size: 11px;
		    padding: 7px;
		    position: absolute;
		    min-height: 100px;
		}
		.dr-pnl{border-style:none;border:none; width: 100%; padding:0;}
		.dr-pnl-b{font-size:12px; width: 100%; padding:0;}
		.dr-sb-ext-decor-2 {
		    background-color: #FFFFFF;
		    border:1px solid #bed6f8;
		}
		.dr-sb-common-container {
		    text-align: center;
		}
		.dr-table-cell {
		    border-bottom: 1px solid #C0C0C0;
		    border-right: 1px solid #C0C0C0;
		    color: #000000;
		    font-family: Arial,Verdana,sans-serif;
		    background-color:
		    font-size: 11px;
		    padding: 4px;
		}
		.dr-sb-int-sel {
		    background-color: #BED6F8;
		    background-image:none;
		    color: #000000;
		    font-family: Arial,Verdana,sans-serif;
		    font-size: 11px;
		}
		.search_table .input{width:157px;}
		.dr-pnl{background:none}
		.td_img_big{width:75px; height:75px; border:1px solid #f0f0f0; display:block;}	
		.td_img{width:40px; height:40px; border:1px solid #f0f0f0; display:block;}
		.list_td {background: url("../asset/images/order/calls_y8.jpg") repeat-y scroll right center rgba(0, 0, 0, 0);}
			.lis2_table {width: 100%;}
			.right_b{height:auto;}
			.left_b{height:auto;}
			.list_block {margin-bottom:0px;}
			.dr-pnl{border:0px;}
			.dr-pnl{border-style:none;border:none; width: 100%; padding:0;}
			.st_6td{text-align:left;}
		
		.input-append.date .add-on i, .input-prepend.date .add-on i {
	    cursor: pointer;
	    height: 14px;
	    margin-left: -19px;
	    margin-top: 7px;
	    width: 14px;
		}
		
		 .fr{float:right;}
		  .r_ulli1{float:right;}
		 .address{width: 450px;} 
	</style>
	
	<div class="right_c">
						<!-- Modal -->
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal" class="modal fade in w600na" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="productMsg">*号部分为必填项！</span>
        
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
      </div>
    </div>
  </div>
</div>
		<div class="r_title">
        	<div class="r_t_l">
			<s:link propagation="none"  view="#{sessionTake.urlTemp}" style="text-decoration:none;color:black;" value="订单管理"></s:link>
			&#160;&gt;&#160;&#160;<font size="3">配送信息</font><rich:messages styleClass="messages"></rich:messages></div>
			<div class="r_t_r">
                   <ul>
                     <li>
						<a href="#" style="text-decoration:none;color:black;" >
	                 		<img src="#{request.contextPath}/asset/images/newlvli_05.jpg" width="11" height="9" />
	              			订单打印历史记录
	              		</a>
        			</li>
                     		<li style="border-right:1px solid #ccc;">
						<a href="#" style="text-decoration:none;color:black;" >
	                 		<img src="#{request.contextPath}/asset/images/pass_03.jpg" width="11" height="9" />
	              			处理历史记录
	              		</a>
        			</li>
        			<li style="border-right:1px solid #ccc;">
						<a href="#{request.contextPath}/order/MemberInfoListOne.seam" style="text-decoration:none;color:black;" >
	                 		<img src="#{request.contextPath}/asset/images/index_06_07.jpg" width="11" height="9" />
	              			客户管理
	              		</a>
        			</li>
				</ul>
	        </div>
        </div>

	<table width="100%" cellpadding="0" cellspacing="0" style=" margin-top:-3px; *margin-top:-3px; _margin-top:-9px;">
		<tr>
        	<td><div class="j001"></div></td>
        	<td><div class="top_b_g"></div></td>
        	<td><div class="j002"></div></td>
   		</tr>
   		<tr>
   			<td align="center" valign="top" >
   				<div class="rigtjr">
   					<div class="con_left">
						<div id="rightPanel" class="con_right">
							<div class="call_com">
								<div class="list_block">   
									<div class="list_title list_title01">客户基本信息</div>
									
								<div >
									<div class="list_td">
							    		<!--添加客户基本信息模板  -->
											<ui:include src="/order/MemberInfoTemplate.xhtml" >
											</ui:include>
									</div>
								</div>
							
	                       <div class="clear"></div>
                           </div> 
                           <h:form id="submitOrderSearch">
                   			<div style="margin-bottom: 10px"></div>
                   				<rich:panel id="deliverAddressTable" style="border:none;">
	                   				<div class="list_block">
	                   					<div id="consigneesLocation" class="list_title list_title03">收货人信息</div>
	                   					
	                   						
	                        				<div class="people_02">
                               					<h:panelGroup id="mydel">
	                           				<ul>
	                           					<a:repeat id="deliverAddresseList" var="_d" value="#{generateOrderDetailsHome.deliverAddresseList}" rowKeyVar="rowIndex">
                               						<s:fragment rendered="#{_d.lastUsed == true}">
                               							<li class="on_more" id="addressLi#{rowIndex}">
					                                    	<table width="100%">
					                                        	<tr>
					                                                <td width="20">
					                                                	<input class="check_box" type="radio" name="delivery" id="delivery#{_d.deliverAddressId}" value="#{_d.deliverAddressId}" checked="checked" onclick="closeDiv(#{rowIndex},#{_d.deliverScope});"/>
					                                                </td>
					                                                <td align="left">
					                                                    <span class="address"><h:outputText value="#{stringUtil.shortString(_d.address,30)}" title="#{_d.address}"/></span>
					                                                    <span class="font_name">收件人:#{_d.consignee}</span>
					                                                    <span class="font_name">联系方式:#{_d.phone}</span>
					                                                    <span class="delete"  style="#{_d.addressMode eq 0?'':'display:none;'}">
					                                                    	<a href="javascript:void(0);" onclick="updateAddress(#{rowIndex},#{_d.deliverAddressId});">修改</a>
					                                                    	<a onclick="del(#{_d.deliverAddressId});return false;" href="#">删除</a>
				                                                    	</span>
					                                                </td>
					                                            </tr>
					                                        </table>
			                                   			</li>
                               						</s:fragment>
                               						<s:fragment rendered="#{_d.lastUsed == false}">
                               							<li id="addressLi#{rowIndex}">
					                                    	<table width="100%">
					                                        	<tr>
					                                                <td width="20">
					                                                	<input class="check_box" type="radio" name="delivery" id="delivery#{_d.deliverAddressId}" value="#{_d.deliverAddressId}" onclick="closeDiv(#{rowIndex},#{_d.deliverScope});"/>
					                                                </td>
					                                                <td align="left">
					                                                    <span class="address"><h:outputText value="#{stringUtil.shortString(_d.address,30)}" title="#{_d.address}"/></span>
					                                                    
					                                                    <span class="font_name">收件人:#{_d.consignee}</span>
					                                                    <span class="font_name">联系方式:#{_d.phone}</span>
					                                                    <span class="delete" style="#{_d.addressMode eq 0?'':'display:none;'}">
					                                                    	<a href="javascript:void(0);" onclick="updateAddress(#{rowIndex},#{_d.deliverAddressId});">修改</a>
					                                                   		<a onclick="del(#{_d.deliverAddressId});return false;" href="#">删除</a>
					                                                    </span>
					                                                </td>
					                                            </tr>
					                                        </table>
			                                   			</li>
                               						</s:fragment>
                           						</a:repeat>
                           						<s:fragment rendered="#{generateOrderDetailsHome.deliverAddresseList.size() > 0}">
                           							<li>
				                                    	<table width="100%">
				                                        	<tr>
				                                                <td width="20">
				                                                	<input type="radio" name="delivery" id="delivery0" value="0" onclick="clcarAreaCallBack();"/>
				                                                </td>
				                                                <td align="left">
				                                                    <span class="address">添加新地址...</span>
				                                                </td>
				                                            </tr>
				                                        </table>
		                                   			</li>
                           						</s:fragment>
                           						<s:fragment rendered="#{generateOrderDetailsHome.deliverAddresseList.size() == 0}">
                           							<li>
				                                    	<table width="100%">
				                                        	<tr>
				                                                <td width="20">
				                                                	<input type="radio" name="delivery" id="delivery0" value="0" checked="checked" onclick="clcarAreaCallBack();"/>
				                                                </td>
				                                                <td align="left">
				                                                    <span class="address">添加新地址...</span>
				                                                </td>
				                                            </tr>
				                                        </table>
		                                   			</li>
                           						</s:fragment>
	                           				</ul>
	                           				</h:panelGroup>
	                               			<div style="padding-left:100px; padding-top:20px; display: none;" id="addDeliverAddressDiv">
	                               				<div class="message" style="display: none;">
		   											<span class="label_new"><font color="FF6600"></font>配送范围：</span>
	                                       			<div class="field" >
	                                           			<span class="span_area" style="display: block;">
															<h:selectOneMenu class="selectpicker" id="deliverScope" style="width:146px;" value="#{generateOrderDetailsHome.deliverScope}">
																<f:selectItem itemLabel="五环内" itemValue="1"></f:selectItem>
																<f:selectItem itemLabel="五环外" itemValue="2"></f:selectItem>
															</h:selectOneMenu>
	                                           			</span>
		    										</div>
	                               				</div>
	                                   			<div class="message">
	                                           		<span class="label_new"><font color="FF6600" style="margin-right: 5px;">*</font>收&#160;货&#160;人：</span>
	                                       			<div class="field">
	                                       				 <h:inputText id="consignee" styleClass="form-control nw221" value="#{generateOrderDetailsHome.consignee}"/>
	                                         		</div>
	                               				</div>
	                                   			<div class="message">
	                                           		<span class="label_new"><font color="FF6600" style="margin-right: 5px;">*</font>手&#160;&#160;&#160;机：</span>
                                          			<div class="field">
                                          				<h:inputText id="phone" styleClass="form-control nw221" value="#{generateOrderDetailsHome.phone}" />
                                            		</div>
                                  				</div>
                                  				<div class="message">
	                                           		<span class="label_new"><font color="FF6600"></font>邮&#160;&#160;&#160;编：</span>
                                          			<div class="field">
                                          				<h:inputText styleClass="form-control nw221" id="zipCode" value="#{generateOrderDetailsHome.zipCode}" />
                                            		</div>
                                  				</div>
                                  				<div class="message">
	                                           		<span class="label_new"><font color="FF6600"></font>固定电话：</span>
                                          			<div class="field">
                                          				<h:inputText styleClass="form-control nw221" id="tel" value="#{generateOrderDetailsHome.tel}" />
                                            		</div>
                                  				</div>
                                  				<div class="message" style="height:95px;">
	                                       			<span class="label_new"><font color="FF6600" style="margin-right: 5px;">*</font>详细地址：</span>
	                                       			<div class="field">
	                                       				<h:inputTextarea id="address" styleClass="form-control nw420" rows="3" value="#{generateOrderDetailsHome.address}" />                				
                                         			</div>
	                           					</div>
                                  				<input type="hidden" id="deliverAddId" value=""/>
	                                   			<div class="message">
	                                   				<a style="float:left; margin-left:20px; margin-top:10px;" href="javascript:void(0);" class="zzbutton" onclick="if(!saveAddress())return false;">
                   										<img src="../asset/images/sale.jpg" width="91" height="25"/>
                   									</a>
                                  				</div>
	                               				<div class="clear"></div>
                              				</div>
	                           			</div>
	                   				</div>
                   				</rich:panel>
                   			<div style="margin-bottom: 10px"></div>
						    	<div class="list_block">   
									<div class="list_title list_title04">配送方式</div>
										<dl class="psfs">
		                                	<dd style="background:none;">
		                                		<table>
		                                			<tr >
		                                				<td style="width: 400px;"><span><div style="float: left;">配送时间：</div>
		                                				 <div class="input-append date form_datetime " style="float: left;">
													    <h:inputText id="deliverDate" readonly="#{facesContext.renderResponse}" styleClass="new_time" value="#{generateOrderDetailsHome.deliverDate}"/>
													    <span class="add-on"><i class="icon-th"></i></span>
													    </div>
		                                				</span></td>
		                                				<td style="width: 300px;">
			                                				<h:selectOneMenu value="#{generateOrderDetailsHome.timeSlot}" id="deliverSlot" class="deliverSlot selectpicker" style="width:140px;">
																<f:selectItem itemLabel="全天" itemValue="0"></f:selectItem>
																<f:selectItem itemLabel="上午" itemValue="1"></f:selectItem>
																<f:selectItem itemLabel="下午" itemValue="2"></f:selectItem>
															</h:selectOneMenu>
														</td>
		                                			</tr>
		                                		</table>
		                                    </dd>
		                                    <dd style="color:#999999; background:none;">提示客户：我们会努力按照您指定的时间配送，但因天气、交通等各类因素影响，您的订单有可能会有延误现象！</dd>
		                                </dl>
		                                <dl class="psfs">
		                                	<dd style="width:60px; height:69px; line-height:69px; float:left; background:none;">
		                                		备注：
		                                	</dd>
		                                	<dd style="float:left; padding-left:0px; background:none;">
		                                		<h:inputTextarea id="orderRemark" styleClass="big2" cols="90" rows="8" value="#{generateOrderDetailsHome.orderRemark}" />
		                                    </dd>
		                                </dl>
			                       <div class="clear"></div>
			                   </div>
		                   		<div class="list_block">   
						    		<rich:panel id="payPanel" style="border:none;">
									<div class="list_title list_title05">收款方式</div>
										<dl class="psfs" style="background: url(../images/list_line_07.jpg) repeat-x scroll center bottom rgba(0, 0, 0, 0);" >
	                                		<dt>
	                                			<input type="radio" name="payMode" id="payMode1" value="1" checked="checked" data="1"/>余额支付
	                                			<span class="spafo">帐户余额支付</span>
                                			</dt>
	                               		</dl>
	                                	<dl class="psfs" >
	                                		<dt style=" background:none;"><input type="radio" name="payMode" id="payMode2" value="2" data="2"/>货到付款</dt>
		                                    <dd id="payTypeDd1" style="display: none; background:none;">
		                                    	<span style="margin-left:20px;">
		                                    		<input type="radio" name="payType" id="payType1" value="1"/>现金支付
		                                    	</span>
		                                    </dd>
		                                    <dd id="payTypeDd2" style="display: none; background:none;">
		                                    	<span style="margin-left:20px;"><input type="radio" name="payType" id="payType2" value="2"/>POS支付</span>
		                                    </dd>
		                                    <dd id="payTypeDd3" style="display: none; background:none;">
	                                    		<span style="margin-left:20px;"><input type="radio" name="payType" id="payType3" value="3"/>支票支付</span>
	                                    	</dd>
	                               		</dl>
										<dl class="psfs">
	                                		<dt>
	                                			<input type="radio" name="payMode" id="payMode9" value="9" data="1"/>转账
	                                			<span class="spafo">帐户转账支付</span>
                                			</dt>
	                                	</dl>
	                                	<s:fragment rendered="false">
										<dl class="psfs">
		                                	<dt>
		                                		<input type="radio" name="payMode" id="payMode5" value="5" data="5"/>赊销
		                                		<span class="spafo">赊销帐户金额</span>
	                                		</dt>
		                                </dl>
		                                </s:fragment>
		                                </rich:panel>
		                                <dl class="psfs" >
		                                <dd id="saleDayPanel" style="display: none;">
		                               	<table>
	                                		<tr>
	                                		  <td>
	                                		  	<span>赊销日期：&#160;&#160;</span>
	                                			</td>
	                                		   <td>
	                                			<rich:inputNumberSpinner value="#{generateOrderDetailsHome.saleTime}" id="saleDay" style="height:20px" maxValue="60" ></rich:inputNumberSpinner> 
	                                		   </td>
	                                		   <td>
	                                		     <span class="spafo">天</span>
	                                		   </td>
	                                		</tr>
	                                	</table>
		                               </dd>
		                               </dl>
		                               <dl class="psfs" id="lipin">
	                                		<dt>
	                                			<input type="radio" name="payMode" id="payMode10" value="10" checked="checked" data="10"/>礼品赠送
	                                			<span class="spafo"></span>
                                			</dt>
	                               		</dl>
	                               	<div style="margin-bottom: 10px"></div>
			                       	<div class="clear"></div>
		                   		</div>
		                   		<div class="list_block">   
									<div class="list_title list_title07">商品清单</div>            
									<div class="car_list">
										<rich:dataTable width="100%" id="cartList" var="_cartList" styleClass="car_table" value="#{generateOrderDetailsHome.cartList}" 
								              onRowMouseOver="this.style.backgroundColor='#e5f6ec'" onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">
									        <h:column>
									        	<f:facet name="header">商品编号</f:facet>
									            <center>
									            	<h:outputText value="#{_cartList.productCode}"/>
									            </center>
									        </h:column>
									        <h:column>
									        	<f:facet name="header">商品</f:facet>
									            <center>
									            	<h:outputText value="#{_cartList.name}"/>
									            </center>
									        </h:column>
									        <h:column>
									        	<f:facet name="header">类型</f:facet>
									            <center>
									            	<h:outputText value="商品" rendered="#{_cartList.shoppingType == 1}"/>
									            	<h:outputText value="礼品卡" rendered="#{_cartList.shoppingType == 2 and _cartList.type == 1}"/>
									            	<h:outputText value="宅配卡" rendered="#{_cartList.shoppingType == 2 and _cartList.type == 2}"/>
									            	<h:outputText value="储值卡" rendered="#{_cartList.shoppingType == 2 and _cartList.type == 3}"/>
									            </center>
									        </h:column>
									        <h:column>
									        	<f:facet name="header">商品数量</f:facet>
									            <center>
									            	<h:outputText value="#{_cartList.storageNum}"/>
									            </center>
									        </h:column>
									        <h:column>
									        	<f:facet name="header">商品规格</f:facet>
									            <center>
									            	<h:outputText value="#{_cartList.productUnit}" rendered="#{_cartList.shoppingType == 1}"/>
									            	<h:outputText value="张" rendered="#{_cartList.shoppingType == 2}"/>
									            </center>
									        </h:column>
									        <h:column>
									        	<f:facet name="header">商品原价</f:facet>
									            <center>
									            	￥<h:outputText value="#{_cartList.productPrice}"><f:convertNumber pattern="#0.00"/></h:outputText>
									            </center>
									        </h:column>
									        <h:column>
									        	<f:facet name="header">商品单价</f:facet>
									            <center>
									            	￥<h:outputText value="#{_cartList.unitPrice}"><f:convertNumber pattern="#0.00"/></h:outputText>
									            </center>
									        </h:column>
									        <h:column>
									        	<f:facet name="header">折扣</f:facet>
									            <center>
									            	<h:outputText value="#{_cartList.discount}"></h:outputText>%
									            </center>
									        </h:column>
									        <h:column>
									        	<f:facet name="header">商品总价</f:facet>
									            <center>
									            	￥<h:outputText value="#{_cartList.total}"><f:convertNumber pattern="#0.00"/></h:outputText>
									            </center>
									        </h:column>
									    </rich:dataTable>
										<table class="car_table"  width="100%" style="border-top: none; border-color: #ccc;">
									    	<tr>
			                                    <td colspan="11" style="border-bottom:none; padding-bottom:10px;">
			                                       <div class="car_ul">
			                                       <ul>
			                                           <li>共#{generateOrderDetailsHome.totalNum}件商品</li>
			                                           <li>
			                                           		<span class="car_span">商品金额：</span>
			                                           		<span class="car_text2">￥</span>
		                                           			<span class="list_font car_span">
					                                            <b>
					                                           		<h:outputText styleClass="zz" value="#{generateOrderDetailsHome.productAccount}"><f:convertNumber pattern="#0.00"/></h:outputText>
																</b>
															</span>
													   </li>
			                                           <li>
				                                           <span class="car_span">运费：</span>
				                                           <span class="car_text2">￥</span>
				                                           <b style="float:right; margin-right:-17px;">
				                                           <h:inputText value="0.00" rendered="#{s:hasRole('freight_edit')}" styleClass="list_font car_span form-control" id="deliverAccount" style="width:80px;"/>
				                                           <h:outputText value="0.00" rendered="#{!s:hasRole('freight_edit')}" style="margin-right:29px;"/>
				                                           </b>
			                                           </li>
			                                          
			                                       </ul>
			                                       </div>
			                                    </td>
		                                    </tr>
		                                    <tr>
			                                    <td align="right"  style="background:#e5f6fd; height:35px; line-height:35px; padding-right:20px;" colspan="11">
			                                    	应付总额：<span class="car_text4">￥</span>
			                                    	<span class="car_text3">
			                                    		<h:outputText id="showTotal" value="#{generateOrderDetailsHome.total}"></h:outputText>
			                                    	</span>
			                                    </td>
		                                    </tr>
									    </table>
                                		<div class="car_button">
                                			
                                				<h:inputHidden id="orderInfoOrderInfoId" value="#{generateOrderDetailsHome.orderInfoOrderInfoId}"/>
												<h:inputHidden id="submitInvoiceId" value="#{generateOrderDetailsHome.invoiceId}"/>
												<h:inputHidden id="submitContractId" value="#{generateOrderDetailsHome.contractId}"/> 
												<h:inputHidden id="submitOrderRemark" value="#{generateOrderDetailsHome.orderRemark}"/> 
												<h:inputHidden id="submitInvoiceFlag" value="#{generateOrderDetailsHome.invoiceFlag}"/> 
												<h:inputHidden id="submitContractFlag" value="#{generateOrderDetailsHome.contractFlag}"/> 
												<h:inputHidden id="payMode" value="#{generateOrderDetailsHome.payMode}"/> 
												<h:inputHidden id="payType" value="#{generateOrderDetailsHome.payType}"/> 
												<h:inputHidden id="saleTime" value="#{generateOrderDetailsHome.saleTime}"/> 
												<h:inputHidden id="timeSlot" value="#{generateOrderDetailsHome.timeSlot}"/> 
												<h:inputHidden id="deliverScopes" value="#{generateOrderDetailsHome.deliverScope}"/> 
												<h:inputHidden id="deliverAccounts" value="#{generateOrderDetailsHome.deliverAccount}"/>
												<h:inputHidden id="deliverAddId" value="#{generateOrderDetailsHome.deliverAddId}"/> 
												<h:inputHidden id="total" value="#{generateOrderDetailsHome.total}"/> 
												<h:inputHidden id="discountMoney" value="#{generateOrderDetailsHome.discountMoney}"/> 
												<s:button id="cancel" styleClass="btn btn-default" value="上一步" propagation="end" view="/order/OrderInfoEdit.xhtml"/>
												&#160;
												<h:commandButton id="save" onclick="if(!saveOrders()){return false;};" styleClass="btn btn-primary" value="提交订单" action="#{generateOrderDetailsHome.submitOrder}" />
                                		</div>
                                		
                        			</div>
             					</div>
             					</h:form>
							</div>	
						</div>
                   	</div>
                    <div class="clear"></div>
				</div>
			</td>
		</tr>
   	</table>
<script src="../asset/js/utils.js" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
           
    jquery("#submitOrderSearch\\:deliverAccount").blur(function(){
        var num=jquery("#submitOrderSearch\\:deliverAccount").val();
 		var zznum = /^(\d+\.\d{1,2}|\d+)$/;
 		var myFlag = zznum.test(num);
 		if (!myFlag) {
 	 		alert("运费必须为数值！")
 			jquery("#submitOrderSearch\\:deliverAccount").val(0.00);
 		}
       var mon=parseFloat(jquery('.zz').text())+parseFloat(jquery('#submitOrderSearch\\:deliverAccount').val());
       jquery('#submitOrderSearch\\:deliverAccounts').attr('value',parseFloat(jquery('#submitOrderSearch\\:deliverAccount').val()).toFixed(2));
       document.getElementById("submitOrderSearch:showTotal").innerHTML =mon.toFixed(2);
       jquery('#submitOrderSearch\\:total').attr('value',mon.toFixed(2));
       jquery('#submitOrderSearch\\:discountMoney').attr('value',0);
       
    });
           var delScope;
           jquery(document).ready(function(){
               var flag = #{generateOrderDetailsHome.deliverAddresseList.size() > 0};
               if (flag) {
               	jquery("#addDeliverAddressDiv").css("display", "none");
       		}else {
       			jquery("#addDeliverAddressDiv").css("display", "");
       		}
               var contractFlag = #{generateOrderDetailsHome.contractFlag};
               if (contractFlag == true) {
           		jquery("#contractTr").css("display", "");
       		}else {
       			jquery("#contractTr").css("display", "none");
       		}

               var flag = #{generateOrderDetailsHome.invoiceInfoList.size() > 0};
               if (flag) {
               	jquery("#addInvoiceDiv").css("display", "none");
       		}else {
       			jquery("#addInvoiceDiv").css("display", "");
       		}

       		var oldPayMode = #{generateOrderDetailsHome.payMode};
       		if (oldPayMode != 2 && oldPayMode != 3 && oldPayMode != 4) {
       			jquery("input[name='payMode']:checked").removeAttr("checked");
       			jquery("#payMode" + oldPayMode).iCheck("check"); 
       			jquery("#payTypeDd1").css("display", "none");
       			jquery("#payTypeDd2").css("display", "none");
       			jquery("#payTypeDd3").css("display", "none");
       		}else {
       			jquery("input[name='payMode']:checked").removeAttr("checked");
       			jquery("#payMode" + oldPayMode).iCheck("check"); 
       			var oldPayType = #{generateOrderDetailsHome.payType};
       			jquery("#input[name='payType']:checked").removeAttr("checked");
       			jquery("#payType" + oldPayType).iCheck("check"); 
       			jquery("#payTypeDd1").css("display", "");
       			jquery("#payTypeDd2").css("display", "");
       			jquery("#payTypeDd3").css("display", "");
       			
       		}
          		var accountFlag = #{generateOrderDetailsHome.accountFlag};
              	var productAccount = #{generateOrderDetailsHome.productAccount};
              	var deliverAccount = 0;

              	var mon=parseFloat(jquery('.zz').text());
                
  				document.getElementById("submitOrderSearch:showTotal").innerHTML = mon.toFixed(2);
              	
               })
 	del = function(id){
		if(confirm('确定删除?')){
	 		deleted(id);
	 		return true;
	 	}
	 	return false;
	}
    function checkDeliverScope(deliverScope){
    	var accountFlag = #{generateOrderDetailsHome.accountFlag};
    	var productAccount = #{generateOrderDetailsHome.productAccount};
    	var deliverAccount = 0;
    }

   

   

    function showAddDiv(deliverAddId){
		jquery("#addDeliverAddressDiv").css("display", "");
		jquery(".on_more").removeClass("on_more");
    }



    function clcarAreaCallBack(){
    	document.getElementById('submitOrderSearch:deliverScope').value = "1"
	    document.getElementById('submitOrderSearch:consignee').value = "";
		document.getElementById('submitOrderSearch:phone').value = "";
	    document.getElementById('submitOrderSearch:tel').value = "";
		document.getElementById('submitOrderSearch:address').value = "";
		document.getElementById('submitOrderSearch:zipCode').value = "";
		document.getElementById('deliverAddId').value = "";
    	showAddDiv("2");
    }

    function delAddress(deliverAddId){
    	deleteAddress(deliverAddId);
	}
	//修改配送地址
	var index;
	var deliId;
	
	function putAddressComplete(data){
		var data = eval("(" + data + ")");
		if (data != null && data != '') {
			document.getElementById('submitOrderSearch:consignee').value = data.consignee;
			document.getElementById('submitOrderSearch:phone').value = data.phone;
			document.getElementById('submitOrderSearch:tel').value = data.tel;
			document.getElementById('submitOrderSearch:zipCode').value = data.zipCode;
			document.getElementById('submitOrderSearch:address').value = data.address;
			document.getElementById('submitOrderSearch:deliverScope').value = data.deliverScope;
		}
		 showAddDiv('2');
		 jquery(".on_more").removeClass("on_more");
		 jquery("#addressLi" + index).addClass("on_more");
		 jquery("#delivery"+deliId).attr("checked",true);
	}
    

    function delAddressComplete(data){
		var flag = #{generateOrderDetailsHome.deliverAddresseList.size() > 0};
        if (flag) {
        	jquery("#addDeliverAddressDiv").css("display", "none");
		}else {
			jquery("#addDeliverAddressDiv").css("display", "");
		}
	}
    
    function saveAddress(){
    	jquery('.zzbutton').removeAttr('onclick');
        var consignee = document.getElementById('submitOrderSearch:consignee').value;
        var phone = document.getElementById('submitOrderSearch:phone').value;
        var tel = document.getElementById('submitOrderSearch:tel').value;
        var zipCode = document.getElementById('submitOrderSearch:zipCode').value;
        var address = document.getElementById('submitOrderSearch:address').value;
        var deliverScope = document.getElementById('submitOrderSearch:deliverScope').value;//加配送范围
        var address =  document.getElementById('submitOrderSearch:address').value;
        delScope = deliverScope; 
        
        checkDeliverScope(delScope);//计算运费

        if (consignee == '') {
			document.getElementById("productMsg").innerHTML = "请填写收货人信息...";
			jquery("#myModal").modal('show');
			jquery('.zzbutton').attr('onclick','if(!saveAddress())return false;');
			return false;
		}
        if (phone == '') {
			document.getElementById("productMsg").innerHTML = "请填写手机信息...";
			jquery("#myModal").modal('show');
			jquery('.zzbutton').attr('onclick','if(!saveAddress())return false;');
			return false;
		}

		if (phone == ''){
			document.getElementById("productMsg").innerHTML = "手机号码不能为空...";
			jquery("#myModal").modal('show');
			jquery('.zzbutton').attr('onclick','if(!saveAddress())return false;');
			return false;
		}

		var mobileData = /^((0{0,1}(14[0-9]|13[0-9]|15[0-9]|18[0-9]|17[0-9])[0-9]{8})+)$/;
		var phoneFlag = mobileData.test(phone);
		if (!phoneFlag) {
			document.getElementById("productMsg").innerHTML = "手机号码格式不正确...";
			jquery("#myModal").modal('show');
			jquery('.zzbutton').attr('onclick','if(!saveAddress())return false;');
			
			return false;
		}

        //if (zipCode == '') {
			//alert("请填写邮编信息...");
			//return false;
		//}

        if (isNaN(zipCode)) {
			document.getElementById("productMsg").innerHTML = "邮编必须为数字...";
			jquery("#myModal").modal('show');
			jquery('.zzbutton').attr('onclick','if(!saveAddress())return false;');
			
			return false;
		}
		
        if (address == '') {
			document.getElementById("productMsg").innerHTML = "请填写地址信息...";
			jquery("#myModal").modal('show');
			jquery('.zzbutton').attr('onclick','if(!saveAddress())return false;');
			return false;
		}else if(address.length > 50){
			document.getElementById("productMsg").innerHTML = "地址信息字数长度不能超过50！";
			
			jquery("#myModal").modal('show');
			jquery('.zzbutton').attr('onclick','if(!saveAddress())return false;');
			return false;
		}
        var deliverAddId = document.getElementById('deliverAddId').value;
        if('' == deliverAddId){
        	addNewAddress(consignee, phone, tel, zipCode, address,Number(deliverScope));//如果deliverAddId为空则走添加方法
        }else{
        	updateNewsAddress(Number(deliverAddId),consignee, phone, tel, zipCode, address,Number(deliverScope));//如果deliverAddId不为空则走更新方法
        }
		return true;
	}
    function addAddressComplete(data){
		var flag = #{generateOrderDetailsHome.deliverAddresseList.size() > 0};
        if (flag) {
        	jquery("#addDeliverAddressDiv").css("display", "none");
		}else {
			jquery("#addDeliverAddressDiv").css("display", "");
		}
        refreshAddress();
        jquery('.zzbutton').attr('onclick','if(!saveAddress())return false;');
        
	}
    function updateAddressComplete(){
    	refreshAddress();
	}
    function updateAddress(obj,deliverAddId){
		index = obj;
		deliId = deliverAddId;
		jquery(".on_more").removeClass("on_more");
		jquery("#addressLi" + obj).addClass("on_more");
		document.getElementById('deliverAddId').value = deliverAddId;
		upAddress(Number(deliverAddId));//查询配送地址
	}
    function closeDiv(obj,scope){
    	delScope = scope;
		jquery("#addDeliverAddressDiv").css("display", "none");
		jquery("#consignee").val("");
		jquery("#phone").val("");
		jquery("#tel").val("");
		jquery("#zipCode").val("");
		jquery("#address").val("");
		jquery(".on_more").removeClass("on_more");
		jquery("#addressLi" + obj).addClass("on_more");
		checkDeliverScope(delScope);//计算运费（原来在 配送范围 的onchange事件中）
    }
jquery("input[name='payMode']:radio").on("ifChecked",function(event){
var flag = document.getElementById("payMode1").checked;
        
        var fg = document.getElementById("payMode10").checked;
		var obj = jquery(this).attr("data");
    	if (obj == 2) {
    		jquery("#payTypeDd1").css("display", "");
			jquery("#payTypeDd2").css("display", "");
			jquery("#payTypeDd3").css("display", "");
			jquery("#saleDayPanel").css("display", "none");
		} else if (obj == 5) {
			jquery("#payTypeDd1").css("display", "none");
			jquery("#payTypeDd2").css("display", "none");
			jquery("#payTypeDd3").css("display", "none");
			jquery("#saleDayPanel").css("display", "");
		}else {
			jquery("#payTypeDd1").css("display", "none");
			jquery("#payTypeDd2").css("display", "none");
			jquery("#payTypeDd3").css("display", "none");
			jquery("#saleDayPanel").css("display", "none");
		}

		if(obj == 10){
			document.getElementById("submitOrderSearch:total").value = 0;
			document.getElementById("submitOrderSearch:discountMoney").value = 0;
			document.getElementById("submitOrderSearch:deliverAccount").value = "0.00";
			document.getElementById("submitOrderSearch:showTotal").innerHTML = "0.00";
			document.getElementById("submitOrderSearch:deliverScopes").value = 1;
			document.getElementById("submitOrderSearch:deliverAccounts").value = 0;
		}else{
			var accountFlag = #{generateOrderDetailsHome.accountFlag};
	    	var productAccount = #{generateOrderDetailsHome.productAccount};
	    	var deliverAccount = 0;
		}
	});
    function saveOrders(){
       
    	var deliveryId = jquery("input[name='delivery']:checked").val();
		if (deliveryId == 0 || deliveryId == null) {
			document.getElementById("productMsg").innerHTML = "请选择配送地址信息....";
			jquery("#myModal").modal('show');
			return false;
		}
        var orderRemark = document.getElementById("submitOrderSearch:orderRemark").value;
        document.getElementById("submitOrderSearch:submitOrderRemark").value = orderRemark;
        
        document.getElementById("submitOrderSearch:deliverAddId").value = deliveryId;

        var payMode = jquery("input[name='payMode']:checked").val();
        document.getElementById("submitOrderSearch:payMode").value = payMode;
        var payType = jquery("input[name='payType']:checked").val();
        document.getElementById("submitOrderSearch:payType").value = payType;

        var deliverDate = jquery("#submitOrderSearch\\:deliverDate").val();

        
        var deliverDate1 = document.getElementById("submitOrderSearch:deliverDate").value;
		if(deliverDate1 = undefined || deliverDate1 == null || deliverDate1 == ""){
			document.getElementById("productMsg").innerHTML = "请选择配送日期!";
			jquery("#myModal").modal('show');
			return false;
		}
        document.getElementById("submitOrderSearch:deliverDate").value = deliverDate;
        
        var timeSlot = jquery(".deliverSlot").val();
        document.getElementById("submitOrderSearch:timeSlot").value = timeSlot;
        jquery('#submitOrderSearch\\:total').val(jquery('#submitOrderSearch\\:showTotal').text());
    	return true;
	}

	//yyd添加
	function closeMethod(){
		   var deliveryId = jquery("input[name='delivery']:checked").val();
		   var deliverDate = document.getElementById("submitOrderSearch:deliverDate").value;
			if (deliveryId == 0 || deliveryId == null) {
				jquery("input[name='delivery']")[0].onFocus();
				return false;
			}
		   if(deliverDate == ""){
			   document.getElementById("submitOrderSearch:deliverDate").focus();
			   return false;
			}
		}
	//]]>	
</script>
<script type="text/javascript">
				jquery(".form_datetime").datetimepicker({
			    format: "yyyy-mm-dd",
			    autoclose: true,
				 weekStart: 1,
				  //startDate: "2014-08-14 10:00",
				 language:  'zh-CN',
				 minView:2,
			    pickerPosition: "bottom-left"
			    });
			  window.onload = function () {
			    jquery('.selectpicker').selectpicker();
			  };
			  
			  function initAddress(){
				  jquery("input[name=delivery]").iCheck({
					    checkboxClass: 'icheckbox_minimal-blue',
					    radioClass: 'iradio_minimal-blue',
					    increaseArea: '20%' // optional
					  });
				  jquery(".check_box").on('ifChecked', function(event){
					  jquery(this).click()
					})
					 jquery("#delivery0").on('ifChecked', function(event){
						 clcarAreaCallBack();
					})
			  }
			  jquery(document).ready(function(){
				  jquery("input").iCheck({
					    checkboxClass: 'icheckbox_minimal-blue',
					    radioClass: 'iradio_minimal-blue',
					    increaseArea: '20%' // optional
					  });
				  
				  jquery(".check_box").on('ifChecked', function(event){
					  jquery(this).click()
					})
					 jquery("#delivery0").on('ifChecked', function(event){
						 clcarAreaCallBack();
					})
			  });
			</script>
</div>
</td>
	<a:form>
   		<a:queue requestDelay="10" ignoreDupResponses="true"/>
		<a:jsFunction name="addNewAddress" action="#{generateOrderDetailsHome.addNewAddress}" oncomplete="addAddressComplete(data);" >
			<a:actionparam name="consignee" assignTo="#{generateOrderDetailsHome.consignee}"/>
			<a:actionparam name="phone" assignTo="#{generateOrderDetailsHome.phone}"/>
			<a:actionparam name="tel" assignTo="#{generateOrderDetailsHome.tel}"/>
			<a:actionparam name="zipCode" assignTo="#{generateOrderDetailsHome.zipCode}"/>
			<a:actionparam name="address" assignTo="#{generateOrderDetailsHome.address}"/>
			<a:actionparam name="deliverScope" assignTo="#{generateOrderDetailsHome.deliverScope}"/>
		</a:jsFunction>
		<a:jsFunction name="updateNewsAddress" action="#{generateOrderDetailsHome.updateNewAddress}" oncomplete="updateAddressComplete();" >
			<a:actionparam name="deliverAddId" assignTo="#{generateOrderDetailsHome.deliverAddId}"/>
			<a:actionparam name="consignee" assignTo="#{generateOrderDetailsHome.consignee}"/>
			<a:actionparam name="phone" assignTo="#{generateOrderDetailsHome.phone}"/>
			<a:actionparam name="tel" assignTo="#{generateOrderDetailsHome.tel}"/>
			<a:actionparam name="zipCode" assignTo="#{generateOrderDetailsHome.zipCode}"/>
			<a:actionparam name="address" assignTo="#{generateOrderDetailsHome.address}"/>
			<a:actionparam name="deliverScope" assignTo="#{generateOrderDetailsHome.deliverScope}"/>
		</a:jsFunction>
		<a:jsFunction name="deleteAddress" action="#{generateOrderDetailsHome.deleteAddress}" oncomplete="delAddressComplete(data);" >
			<a:actionparam name="deliverAddId" assignTo="#{generateOrderDetailsHome.deliverAddId}"/>
		</a:jsFunction>
		<a:jsFunction name="upAddress" action="#{generateOrderDetailsHome.getDeliverAddress}" data="#{generateOrderDetailsHome.delAddress}" oncomplete="putAddressComplete(data);" >
			<a:actionparam name="deliverAddId" assignTo="#{generateOrderDetailsHome.deliverAddId}"/>
		</a:jsFunction>
		<a:jsFunction name="refreshAddress" action="#{generateOrderDetailsHome.refreshAddress}" reRender="deliverAddressTable" oncomplete="initAddress();jquery('#submitOrderSearch\\:deliverScope').selectpicker()">
		</a:jsFunction>
	</a:form>
	<a:form >
		<a:jsFunction name="deleted"  action="#{generateOrderDetailsHome.deleteObj}" reRender="mydel">
			<a:actionparam name="id" assignTo="#{generateOrderDetailsHome.deleteId}"/>
		</a:jsFunction>
	</a:form>
		<style>
	  .ts_div2{width:240px; height: 125px; border: 1px solid #81C5E9; margin: 0px auto; padding: 0 15px 15px;  background: url(#{request.contextPath}/asset/images/tck_bg_14.jpg) #ffffff repeat-x scroll center top;}
	  .dr-mpnl-shadow{background:none;}
	  .dr-mpnl-pnl{background:none; border:none;}
	  .dr-mpnl-pnl-b{padding:0;}
	  .dr-mpnl-shadow{top:0; left:0;}
	  .rich-picklist-source-items{margin:0;}
	  .ui-selectmenu{*float:left;}
	  
	</style>
</ui:define>
</ui:composition>
