<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"	
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a="http://richfaces.org/a4j" 
    template="/layout/order_template_new.xhtml">

<ui:define name="body">
<link rel="stylesheet" type="text/css" media="screen" href="#{request.contextPath}/asset/css/bootstrap-select.min.css"/>
	 <link href="#{request.contextPath}/asset/css/datetimepicker.css" rel="stylesheet"/>
	 <link rel="stylesheet" type="text/css" href="#{request.contextPath}/asset/css/checkBox/skinBlue.css"/>
	<script type="text/javascript" src="#{request.contextPath}/asset/js/checkBox/icheck.js"></script>
    <script type="text/javascript" src="#{request.contextPath}/asset/new/bootstrap-select.min.js"></script>
	<script type="text/javascript" src="#{request.contextPath}/asset/new/bootstrap-datetimepicker.js"></script>
	<script type="text/javascript" src="#{request.contextPath}/asset/new/bootstrap-datetimepicker.zh-CN.js"></script>
	<td valign="top" >
	<style>
		.rich-inplace-view{ border:none; border-bottom-width:0px;}
		.rich-inplace-view{ border-bottom-width:0px; border:1px solid #d5d5d5;}
		.dr-table-footercell {
		    background: none repeat scroll 0 0 #FFFFFF;
		    border-bottom: 1px solid #C0C0C0;
		    border-right: 1px solid #C0C0C0;
		    color: #000000;
		    font-family: Arial,Verdana,sans-serif;
		    font-size: 14px;
		    font-weight: bold;
		    height: 35px;
		    padding: 4px;
		    text-align: right;
		}
		.rich-mpnl-controls{top:5px;}
		.stripe3 th a{
		    color: #171717;
		    font-family: "宋体";
		    font-size: 12px;
		
		}
		.dr-table {
		    border-left: 1px solid #C0C0C0;
		    border-right: 1px solid #C0C0C0;
		}
		.dr-sb-shadow {
		    border: 1px solid;
		    height: auto;
		    position: absolute;
		    width: 100%;
		    z-index: 1;
		}
		.dr-pnl-b tr{
		 	height:26px; line-height:26px;
		}
		.dr-rich-tool-tip {
		    background-color: #FAE6B0;
		    border: 1px solid #E5973E;
		    display: none;
		    float: left;
		    font-family: Arial,Verdana,sans-serif;
		    font-size: 11px;
		    padding: 7px;
		    position: absolute;
		    min-height: 100px;
		}
		.dr-pnl{border-style:none;border:none; width: 100%; padding:0;}
		.dr-pnl-b{font-size:12px; width: 100%; padding:0;}
		.dr-sb-ext-decor-2 {
		    background-color: #FFFFFF;
		    border:1px solid #bed6f8;
		}
		.dr-sb-common-container {
		    text-align: center;
		}
		.dr-table-cell {
		    border-bottom: 1px solid #C0C0C0;
		    border-right: 1px solid #C0C0C0;
		    color: #000000;
		    font-family: Arial,Verdana,sans-serif;
		    background-color:
		    font-size: 11px;
		    padding: 4px;
		}
		.dr-sb-int-sel {
		    background-color: #BED6F8;
		    background-image:none;
		    color: #000000;
		    font-family: Arial,Verdana,sans-serif;
		    font-size: 11px;
		}
		.th1{width: 10%;}
		.th2{width: 10%;}
		.th3{width: 10%;}
		.th4{width: 10%;}
		.th5{width: 10%;}
		.th6{width: 10%;}
		.th7{width: 12%;}
		.th8{width: 10%;}
		.search_table .input{width:157px;}
		.dr-pnl{background:none}
		.td_img_big{width:75px; height:75px; border:1px solid #f0f0f0; display:block;}
		.td_img{width:40px; height:40px; border:1px solid #f0f0f0; display:block;}
		.cath{ height:32px; line-height:32px; font-size:12px; text-align:center; border-left:1px solid #ccc; }
		.catd{ padding:5px 0; line-height:25px; font-size:12px; text-align:center;}
		.carp input{ width:45px; height:18px; text-align:center;border:1px solid #ccc;}
		.list_td {background: url("../asset/images/order/calls_y8.jpg") repeat-y scroll right center rgba(0, 0, 0, 0);min-height: 304px;}
		.list_sale{background: url("../asset/images/order/calls_y8.jpg") repeat-y scroll right center rgba(0, 0, 0, 0);float:left;}
		.list_sale2{
			background: url("../asset/images/order/sale.png") no-repeat scroll 0 0 rgba(0, 0, 0, 0);
		    border-bottom: 1px solid #dadada;
		    height: 16px;
		    line-height: 15px;
		    padding-bottom: 8px;
		}
			.lis2_table {width: 100%;}
			.right_b{height:auto;}
			.left_b{height:auto;}
			.dr-pnl{border:0px;}
			.dr-pnl{border-style:none;border:none; width: 100%; padding:0;}
		 
		 .dr-pnl-b .catd .icheckbox_minimal-blue{float:left; margin:7px 10px;}
		 .cathAll01 .icheckbox_minimal-blue{float:left; margin:7px 10px;}
		 
		 .fr{float:right;}
		 .r_ulli1{float:right;}
	</style>
	
	<div class="right_c">
		<div class="r_title">
        	<div class="r_t_l"><s:link propagation="none"  view="#{sessionTake.urlTemp}" style="text-decoration:none;color:black;" value="订单管理"></s:link>
            &#160;&gt;&#160;&#160;<font size="3">
			选择商品 </font><rich:messages styleClass="messages"></rich:messages></div>
			 <div class="r_t_r">
                   <ul>
                     <li>
						<a href="#" style="text-decoration:none;color:black;" >
	                 		<img src="#{request.contextPath}/asset/images/newlvli_05.jpg" width="11" height="9" />
	              			订单打印历史记录
	              		</a>
        			</li>
		               <li style="border-right:1px solid #ccc;">
						<a href="#{request.contextPath}/record/ProcessRecordList.seam" style="text-decoration:none;color:black;" >
		                		<img src="#{request.contextPath}/asset/images/pass_03.jpg" width="11" height="9" />
		             			处理历史记录
		             		</a>
		      			</li>
		      			<li style="border-right:1px solid #ccc;">
						<a href="#{request.contextPath}/order/MemberInfoListOne.seam" style="text-decoration:none;color:black;" >
		                		<img src="#{request.contextPath}/asset/images/index_06_07.jpg" width="11" height="9" />
		             			客户管理
		             		</a>
		      			</li>
				</ul>
	        </div>
        </div>
	<table width="100%" cellpadding="0" cellspacing="0" style=" margin-top:-3px; *margin-top:-3px; _margin-top:-9px;">
		<tr>
        	<td><div class="j001"></div></td>
        	<td><div class="top_b_g"></div></td>
        	<td><div class="j002"></div></td>
   		</tr>
   		<tr>
   			<td height="100%"><div class="left_b"></div></td>
   			<td align="center" valign="top" >
   				<div class="rigtjr">
   					<div class="con_left">
						<div id="rightPanel" class="con_right">
							<div class="call_com">
							<div class="list_block">
								<div class="list_title list_title01">客户基本信息</div>
                                <div class="list_ta">
									<div class="list_ta01">
										<div ></div>
									</div>
								</div>
								<div class="list_tc">
									<div class="list_td">
							    		<!--添加客户基本信息模板  -->
											<ui:include src="/order/MemberInfoTemplate.xhtml" >
											</ui:include>
									</div>
								</div>
								<div >
									<div >
										<div ></div>
									</div>
							   </div>
	                       <div class="clear"></div>
                           </div> 
                           
                           <div class="list_block">
								<div class="list_title list_sale2">销售人</div>
                                <div class="list_ta">
									<div class="list_ta01">
										<div ></div>
									</div>
								</div>
									<div class="list_sale">
										<h:outputText value="#{orderInfoHome.farmerInfoName}" />
									</div>
								<div >
									<div >
										<div ></div>
									</div>
							   </div>
	                       <div class="clear"></div>
                           </div> 
	                   <div class="list_block "> 
	                      <h:form id="memberInfo"  enctype="multipart/form-data">
<!-- Modal -->
<div aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal" class="modal fade in w600na" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">提示框</h4>
      </div>
      <div class="modal-body">
       <span id="productMsg">*号部分为必填项！</span>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
      </div>
    </div>
  </div>
</div>
							<div class="list_title list_title02">商品信息</div>
	                        	<div style="width: 98%;height: 40px;" >
	                        		<span style="float: left; margin-left: 15px; font-size: 14px; margin-top: 2px;">名称/编号：</span>
	                        		<input type="text" id="searchName" value="" class="form-control nw300 srarchfont" style="float: left;"/>
	                        		<a href="javascript:void(0);" onclick="searchButton();" class="btn btn-primary" style="float: left;margin-left:10px;">
	                        			搜索
	                        		</a>
	                        	</div>
	                        	</h:form>
	                        	<rich:spacer height="30" />
	                        	<rich:panel style="width:100%;" id="showPanel">
	                        		<div style="width:99%; margin:0 auto; padding-right:12px; [;text-align:left;]; background: url(../asset/images/order/next_bg_24.jpg) repeat-x; color:#4e4d4d; border-top:1px solid #ccc; border-right:1px solid #ccc; float: left;">	
					           	 		<table width="100%" border="0" cellpadding="0" cellspacing="0" style=" border-collapse:collapse; width:99.2%; width: -moz-calc(100% - 16px); float:left;">
											<tr>
							                	<th width="5%" class="cath cathAll01">
							                	<input type="checkbox" name="productCheckAll" id="productCheckAll" value="0" style="vertical-align:middle"/>&#160;</th>
							                    <th width="5%" class="cath">类型</th>
							                    <th width="15%" class="cath">商品名称</th>
							                    <th width="15%" class="cath">商品编号</th>
							                    <th width="15%" class="cath">商品规格</th>
							                    <th width="15%" class="cath">商品库存</th>
							                    <th width="15%" class="cath">商品价格</th>
							                    <th width="15%" class="cath">促销价格</th>
								    		</tr>
							        	</table>
							        	<div style="width:101%; height:298px; overflow-y:auto; overflow-x:auto; margin:0 auto; border:1px solid #ccc; border-right:0px solid #ccc;">	
										<table width="100%" border="0" cellpadding="0" cellspacing="0" id="showProduct">
											<a:repeat value="#{orderInfoHome.showProductList}" var="_showProduct">
												<tr>
								                	<td class="catd" width="5%">
								                		<input type="checkbox" onclick="selectedOne();" name="productCheck" id="productCheck" value="#{_showProduct.shoppingId},#{_showProduct.shoppingType}|" style="vertical-align:middle"/>&#160;
								                	</td>
								                	
								                    <td class="catd" width="5%">
								                    	<h:outputText value="商品" rendered="#{_showProduct.shoppingType == 1}"/>
										                <h:outputText value="礼品卡" rendered="#{_showProduct.shoppingType == 2 and _showProduct.type == 1}"/>
										                <h:outputText value="宅配卡" rendered="#{_showProduct.shoppingType == 2 and _showProduct.type == 2}"/>
										                <h:outputText value="储值卡" rendered="#{_showProduct.shoppingType == 2 and _showProduct.type == 3}"/>
								                    </td>
								                    <td class="catd" width="15%">
								                    	<h:outputText value="#{_showProduct.name}"/>
								                    </td>
								                    <td class="catd" width="15%">
								                    	<h:outputText value="#{_showProduct.productCode}"/>
								                    </td>
								                    <td class="catd" width="15%">
								                    	<h:outputText value="#{_showProduct.productUnit}"/>
								                    </td>
								                    <td class="catd" width="15%">
								                    	<h:outputText value="#{_showProduct.storageNum}"/>
								                    </td>
								                    <td class="catd" width="15%">
								                    	<s:fragment rendered="#{_showProduct.promotionPrice == 0}">
										            		￥<h:outputText value="#{_showProduct.productPrice}"><f:convertNumber pattern="#0.00"/></h:outputText>
										            	</s:fragment>
										            	<s:fragment rendered="#{_showProduct.promotionPrice != 0}">
										            		￥<h:outputText style="text-decoration:line-through;" value="#{_showProduct.productPrice}"><f:convertNumber pattern="#0.00"/></h:outputText>
										            	</s:fragment>
								                    </td>
								                    <td class="catd" width="15%">
								                    	<s:fragment rendered="#{_showProduct.promotionPrice != 0}">
								                    		￥<h:outputText value="#{_showProduct.promotionPrice}"><f:convertNumber pattern="#0.00"/></h:outputText>
								                    	</s:fragment>
								                    	<s:fragment rendered="#{_showProduct.promotionPrice == 0}">
								                    		-
								                    	</s:fragment>
								                    </td>
								                </tr>
											</a:repeat>
						                </table>
									</div>     
									</div>
									
						            <rich:spacer height="20px"/>
					            </rich:panel>
					            <h:form id="refreshShowFrom">
							    	<a:commandLink id="refreshShow" action="#{orderInfoHome.refreshShow}" reRender="showPanel" eventsQueue="eventsQueue" ></a:commandLink>
						    	</h:form>
						    	<div style="width:98%;">
						    		<a class="btn btn-success" style="float: right; margin-right: 20px;margin-top: 20px;" href="javascript:void(0);" onclick="if(!submitProduct()){return false;};">
                                	添加
                               		</a>
						    	</div>
	                       	<div class="clear"></div>
	               		</div> 	
	                   
	                   
	                   
	                   
	                   <div class="list_block">   
							<div class="list_title list_title02">购物车信息</div>
								<div class="car_list">
									<rich:dataTable width="100%" id="cartList" var="_cartList" styleClass="car_table" value="#{orderInfoHome.cartList}" 
							              onRowMouseOver="this.style.backgroundColor='#e5f6ec'" onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'" rowKeyVar="index">
								        <h:column headerClass="th1" >
								        	<f:facet name="header">商品编号</f:facet>
								            <center>
								            	<h:outputText value="#{_cartList.productCode}"/>
								            </center>
								        </h:column>
								        <h:column headerClass="th2">
								        	<f:facet name="header">商品</f:facet>
								        	<center>
								        		<h:outputText value="#{_cartList.name}"/>
							        		</center>
								        </h:column>
								        <h:column headerClass="th3">
								        	<f:facet name="header">类型</f:facet>
								            <center>
								            	<h:outputText value="商品" rendered="#{_cartList.shoppingType == 1}"/>
								            	<h:outputText value="礼品卡" rendered="#{_cartList.shoppingType == 2 and _cartList.type == 1}"/>
								            	<h:outputText value="宅配卡" rendered="#{_cartList.shoppingType == 2 and _cartList.type == 2}"/>
								            	<h:outputText value="储值卡" rendered="#{_cartList.shoppingType == 2 and _cartList.type == 3}"/>
								            </center>
								        </h:column>
								        <h:column headerClass="th4">
								            <f:facet name="header">商品数量</f:facet>
								            <center>
							                    <table width="100%" border="0" cellpadding="0">
				                                    <tr>
					                                    <td width="35%" align="right"><a href="javascript:void(0);" onclick="updateNum(#{_cartList.shoppingId},#{_cartList.storageNum},#{_cartList.shoppingType},2);"><img src="../asset/images/order/no_24.jpg" width="15" height="15" /></a></td>
					                                    <td width="30%" class="carp" align="center" valign="middle">
					                                    	<input onclick="document.getElementById('productCountFrom:productCount').disabled = true;" onblur="updateNum(#{_cartList.shoppingId},this.value,#{_cartList.shoppingType},3);" style="text-align：center;" id="number#{_cartList.productCode}" type="text" value="#{_cartList.storageNum}"/>
					                                    </td>
					                                    <td width="35%" align="left"><a href="javascript:void(0);" onclick="updateNum(#{_cartList.shoppingId},#{_cartList.storageNum},#{_cartList.shoppingType},1);document.getElementById('productCountFrom:productCount').disabled = true;"><img src="../asset/images/order/no_27.jpg" width="15" height="15" /></a></td>
				                                    </tr>
			                                    </table>
								            </center>
								        </h:column>
								        <h:column headerClass="th5">
								        	<f:facet name="header">商品规格</f:facet>
								            <center>
								            	<h:outputText value="#{_cartList.productUnit}" rendered="#{_cartList.shoppingType == 1}"/>
								            	<h:outputText value="张" rendered="#{_cartList.shoppingType == 2}"/>
								            </center>
								        </h:column>
								        <h:column headerClass="th6">
								        	<f:facet name="header">商品原价</f:facet>
								            <center>
								            	￥<h:outputText  value="#{_cartList.productPrice}"><f:convertNumber pattern="#0.00"/></h:outputText>
								            </center>
								        </h:column>
								        <h:column headerClass="th6">
								        	<f:facet name="header">商品单价</f:facet>
								            <center>
								            	￥<input id="priceInput#{_cartList.shoppingId}" class="zcalculate" onclick="document.getElementById('productCountFrom:productCount').disabled = true;" onblur="updateDiscount(1,#{_cartList.shoppingId},this.value,#{_cartList.shoppingType},this,#{_cartList.productPrice});" style="text-align：center; width:45px; height:18px; text-align:center;border:1px solid #ccc;" type="text"  value="#{_cartList.unitPrice}"/>
								            </center>
								        </h:column>
								         <h:column headerClass="th7">
								        	<f:facet name="header">折扣率</f:facet>
								            <center>
								            	<input id="discountInput#{_cartList.shoppingId}" onclick="document.getElementById('productCountFrom:productCount').disabled = true;" onblur="updateDiscount(2,#{_cartList.shoppingId},this.value,#{_cartList.shoppingType},this,#{_cartList.productPrice});" style="text-align：center; width:45px; height:18px; text-align:center;border:1px solid #ccc;" type="text" value="#{_cartList.discount}"/>%
								            </center>
								        </h:column>
								        <h:column headerClass="th8">
								        	<f:facet name="header">单品总价</f:facet>
								            <center>
								            	￥<h:outputText value="#{_cartList.total}"><f:convertNumber pattern="#0.00"/></h:outputText>
								            </center>
								        </h:column>
								        <rich:column styleClass="action" width="8%" >
								            <f:facet name="header">操作</f:facet>
							            	<table class="ps" align="center">
            		  							<tr>
                   									<td>
									            		<a href="javascript:void(0);" onclick="delOneProduct(#{index});">删除</a>
			            							</td>
		            							</tr>
	            							</table>
								        </rich:column>
								    </rich:dataTable>
								    <rich:panel id="totalPenal" style="width:100%;">
								    <table class="car_table"  width="100%" style="border-top: none; border-color: #ccc;">
								    	<tr>
		                                    <td colspan="11" style="border-bottom:none; padding-bottom:10px;">
		                                       <div class="car_dl"><a href="javascript:void(0);" onclick="if(confirm('确定要清空购物车？清空后商品采购详情无法还原！'))clearProductAll();">清空购物车</a></div>
		                                       <div class="car_ul">
		                                       <ul>
		                                           <li>共#{orderInfoHome.totalNum}件商品</li>
		                                           <li>
		                                           		<span class="car_span">商品总额：</span>
		                                           		<span class="car_text2">￥</span>
	                                           			<span class="list_font car_span">
				                                            <b>
				                                           		<h:outputText value="#{orderInfoHome.total}"><f:convertNumber pattern="#0.00"/></h:outputText>
															</b>
														</span>
												   </li>
		                                       </ul>
		                                       </div>
		                                    </td>
	                                    </tr>
	                                    <tr>
		                                    <td align="right"  style="background:#e5f6fd; height:35px; line-height:35px; padding-right:20px;" colspan="11">
		                                    	应付金额(不含运费)：<span class="car_text4">￥</span>
		                                    	<span class="car_text3">
		                                    		<h:outputText value="#{orderInfoHome.discountTotal}"><f:convertNumber pattern="#0.00"/></h:outputText>
		                                    	</span>
		                                    </td>
	                                    </tr>
								    </table>
								    </rich:panel>
								    <h:form id="refreshCartFrom">
								    	<a:commandLink id="refreshCart" action="#{orderInfoHome.refreshCart}" reRender="cartList"  eventsQueue="eventsQueue" ></a:commandLink>
							    	</h:form>
							    	<h:form id="refreshTotalFrom">
								    	<a:commandLink id="refreshToral" action="#{orderInfoHome.refreshCart}" reRender="totalPenal"  eventsQueue="eventsQueue" ></a:commandLink>
							    	</h:form>
	                                <div class="car_button">
	                                	
								    	<h:form id="productCountFrom" style="wid" >
								    		<s:button id="cancel" style="margin-right:10px;" styleClass="btn btn-default" value="返回" propagation="end" view="/order/MemberInfoList.xhtml"/>
									    	<a:commandButton value="下一步" styleClass="btn btn-primary" id="productCount" action="#{orderInfoHome.getProductCount}" data="#{orderInfoHome.productCount}" oncomplete="getProductCheck(data)" >
											</a:commandButton>
								    	</h:form>
	                                </div>
	                       		</div>
	                       	<div class="clear"></div>
	               		</div> 								
					</div>
					</div>
                    </div>
				</div>
   			</td>
   			<td><div class="right_b"></div></td>
   		</tr>
   		<tr>
   			<td valign="top" width="21"><div class="j003"></div></td>
            <td><div class="bot_b_g"></div></td>
            <td valign="top" width="21"><div class="j004"></div></td>
   		</tr>
   	</table>
  	<a:form>
  		<a:queue requestDelay="10" ignoreDupResponses="true"/>
		<a:jsFunction name="modifyProductNum" action="#{orderInfoHome.modifyProductNum}" reRender="cartList,totalPenal" ignoreDupResponses="true" oncomplete="document.getElementById('productCountFrom:productCount').disabled = false;">
			<a:actionparam name="productId" assignTo="#{orderInfoHome.productId}"/>
			<a:actionparam name="num" assignTo="#{orderInfoHome.num}"/>
			<a:actionparam name="shoppingType" assignTo="#{orderInfoHome.shoppingType}"/>
		</a:jsFunction>
		<a:jsFunction name="cartEnd" action="#{orderInfoHome.cartEnd}">
		<a:actionparam name="farmerInfoId" assignTo="#{orderInfoHome.farmerInfoId}"/>
		</a:jsFunction>
		<a:jsFunction name="cartEnd2" action="#{orderInfoHome.cartEnd}">
		</a:jsFunction>
		<a:jsFunction name="clearOneProduct" action="#{orderInfoHome.clearOneProduct}" oncomplete="refreshCartAction();" >
			<a:actionparam name="index" assignTo="#{orderInfoHome.index}"/>
		</a:jsFunction>
		<a:jsFunction name="clearCartAll" action="#{orderInfoHome.clearCartAll}" oncomplete="refreshCartAction();" ></a:jsFunction>
		<a:jsFunction name="showListFiltel" action="#{orderInfoHome.showListFiltel}" ignoreDupResponses="true" oncomplete="searchOnComplete();" >
			<a:actionparam name="searchName" assignTo="#{orderInfoHome.searchName}"/>
		</a:jsFunction>
		
		<a:jsFunction name="addCheckedProduct" action="#{orderInfoHome.addCheckedProduct}" reRender="cartList,totalPenal" oncomplete="beginActio();">
			<a:actionparam name="resultTree" assignTo="#{orderInfoHome.resultTree}"/>
		</a:jsFunction>
		
		<a:jsFunction name="modifyDiscount" action="#{orderInfoHome.modifyDiscount}" ignoreDupResponses="true" oncomplete="refreshCartAction();document.getElementById('productCountFrom:productCount').disabled = false;">
			<a:actionparam name="productId" assignTo="#{orderInfoHome.productId}"/>
			<a:actionparam name="unitPrice" assignTo="#{orderInfoHome.unitPrice}"/>
			<a:actionparam name="discount" assignTo="#{orderInfoHome.discount}"/>
			<a:actionparam name="shoppingType" assignTo="#{orderInfoHome.shoppingType}"/>
		</a:jsFunction>
	</a:form>
	
	
<script type="text/javascript">
//<![CDATA[
           
    //function onkey(event){
			//alert("s3");
			//var downKey = event.KeyCode();
			//alert(downkey);
        //}
           
    //+-数量 1为+ 2为-
	function updateNum(productId, num, shoppingType, type){
		if (type == 1) {
			var number = num+1;
			modifyProductNum(productId,number, shoppingType);
		}else if(type == 2){
			if (num > 1) {
				
				var number = num-1;
				modifyProductNum(productId,number, shoppingType);
			}else {
				document.getElementById("productMsg").innerHTML = "至少购买一个商品...";
				jquery("#myModal").modal('show');
				refreshCartAction();
			}
		}else if (type == 3) {
			modifyProductNum(productId,num,shoppingType);
		}
	}

	//修改折扣信息
	function updateDiscount(priceOrDiscount,productId, discount, shoppingType,obj,productPrice){
		//alert("updateDiscount");
		if(priceOrDiscount == 1){//修改的是单价
			if(!isNaN(discount) && !isNaN(productPrice) && parseFloat(productPrice) > 0){
				var dis = discount/productPrice*100;
				var disTwo = dis.toFixed();
				jquery("#discountInput"+productId).val(disTwo);
				modifyDiscount(productId, parseFloat(discount).toFixed(2), parseFloat(disTwo), shoppingType);
			}else{
				jquery("#discountInput"+productId).val(100);
				modifyDiscount(productId, parseFloat(discount).toFixed(2), 100, shoppingType);
			}
		}else{//修改的是折扣率
			discount = parseInt(discount);
			if(!isNaN(discount) && !isNaN(productPrice)){
				if (Number(discount) > 100 || Number(discount) < 0) {
					document.getElementById("productMsg").innerHTML = "请输入0-100的数字...";
					jquery("#myModal").modal('show');
					return false;
				}else {
					var dis = discount/100*productPrice;
					var disTwo = dis.toFixed(2);
					jquery("#priceInput"+productId).val(disTwo);
					modifyDiscount(productId,parseFloat(disTwo), parseFloat(discount).toFixed(), shoppingType);
				}
			}else {
				document.getElementById("productMsg").innerHTML = "请输入0-100的数字...";
				jquery("#myModal").modal('show');
				return false;
			}
		}
		return false;
		
		
	}
           
    //添加选中商品到购物车
    function submitProduct(){
        var str = "";
    	jquery("input[name='productCheck']:checked").each(function(){
          	str += jquery(this).val();
      	});
		if (str != '') {
			var values = '{"resultDatas":[';
			var temp = str.split("|"); 
			for ( var i = 0; i < temp.length-1; i++) {
				var splitStr = temp[i].split(","); 
				var pid = splitStr[0];
				var type = splitStr[1];
				values += '{"pid":' + pid + ', "type":' + type + '},';
			}
	    	values = values.substring(0, values.length-1) + ']}';
	    	addCheckedProduct(values);
	    	return true;
		}else {
			document.getElementById("productMsg").innerHTML = "请选择至少一个商品...";
			jquery("#myModal").modal('show');
			return false;
		}
		
    	
    }
    
    //全选事件
    function selectedAll(obj){
		jquery("input[name='productCheck']").prop("checked", obj.checked);
	}
  	//单选事件
    function selectedOne(){
    	var str = "";
    	jquery("input[name='productCheck']:checked").each(function(){
          	str += jquery(this).val();
      	});
      	
      	if (str == '') {
      		jquery("#productCheckAll").removeAttr("checked");
		}
	}

  	//获得添加到购物车的商品数量
    function getProductCheck(count){
      	if(count == 0){
      		document.getElementById("productMsg").innerHTML = "请至少添加一个商品到购物车!";
			jquery("#myModal").modal('show');
			return false;
        }
        var farId = jquery("#farmerInfoId").val();
        if(farId != "org.jboss.seam.ui.NoSelectionConverter.noSelectionValue" && farId > 0){
        	cartEnd(farId);
        }else{
        	cartEnd2();
         }
       
      	
    }
           
    //搜索商品
    function searchButton(){
		var searchName = jquery("#searchName").val();
		showListFiltel(searchName);
    }

  	//搜索商品回调
    function searchOnComplete(){
    	document.getElementById("refreshShowFrom:refreshShow").click();
    }
           
	//联动赋值
	function assignProductId(productAction){
		document.getElementById("choiceProductSearch:productId").value = productAction.getSelectedItems().pluck('shoppingId');
		document.getElementById("choiceProductSearch:shoppingType").value = productAction.getSelectedItems().pluck('shoppingType');
	}


	//清空购物车
	function clearProductAll(){
		//if(confirm('确定删除吗？')){
		clearCartAll();
		//}
	}

	//删除单个
	function delOneProduct(index){
		if(confirm('确定删除吗？')){
		clearOneProduct(index);
		}
	}

	//修改数量
	function updateProductNum(productId, num, shoppingType){
		if (!isNaN(num)) {
			modifyProductNum(productId,num, shoppingType);
		}else {
			document.getElementById("productMsg").innerHTML = "商品数量必须为数字...";
			jquery("#myModal").modal('show');
			refreshCartAction();
		}
	}

	//修改数量回调
	function modifyNumComplete(data){
		document.getElementById("choiceProductSearch:productId").value = ""; 
		refreshCartAction();
	}

	//刷新
	function refreshCartAction(){
		document.getElementById("refreshCartFrom:refreshCart").click();
		document.getElementById("refreshTotalFrom:refreshToral").click();
	}
	
	jquery(document).ready(function(){
		jquery('input').iCheck({
		    checkboxClass: 'icheckbox_minimal-blue',
		    radioClass: 'iradio_minimal-blue',
		    increaseArea: '20%' // optional
		  });
		jquery('input[name=productCheckAll]').on("ifClicked", function(event){
			if (this.checked) {
				jquery("input[name='productCheck']").iCheck("uncheck"); 
			} else {
				jquery("input[name='productCheck']").iCheck("check"); 
			}
		});
		})
		
//]]>
</script>
<script type="text/javascript">
  window.onload = function () {
    jquery('.selectpicker').selectpicker();
  };
//  function beginActio(){
//		jquery('.zcalculate').each(function(){
// 			document.getElementById(this.id).onblur();
// 		});
//	  }
</script>

</div>
</td> 
</ui:define>
</ui:composition>
