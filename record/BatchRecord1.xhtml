<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jstl/core"
    template="/layout/template.xhtml">

<ui:define name="body">
<td valign="top" >
<!-- #{batchRecordHome.work()} -->
<script type="text/javascript" src="#{request.contextPath}/asset/js/tab.js"></script>
<script type="text/javascript">
//<![CDATA[
jquery(function(){
    jquery(".piltd").jTab({
        menutag: ".piltd .aaaa",
        boxtag: ".piliangbox > div",
        cur: 0,
		callback:"selectTab(index)"
		
    });
});

function selectTab(index){
	for(var i = 0;i<3;i++){
		if(index==i){
			jquery(".aaaa:eq("+i+")").attr("class","pila_bg_on"+(i+1)+" aaaa");
			jquery(".bbbb:eq("+i+")").attr("class","pil_bule bbbb");
		}else{
			jquery(".aaaa:eq("+i+")").attr("class","pila_bg_"+(i+1)+" aaaa");
			jquery(".bbbb:eq("+i+")").attr("class","pil_hui bbbb");
		}
	}
}
//]]>
</script>
<style>
       .box_back{background:url(../asset/images/bg_png3.png) repeat; position:absolute; z-index:800; display:none;}
       </style>
       <div class="box_back" id="login" style="display:none;left:0px;top:0px;position: fixed;width:100%;height:100%;">
                      	 <div id="login2" style="width:80px; height:60px; margin:220px auto 0 auto;">
                      	 <img src="../asset/images/loginda.gif" />
                      	 </div>
                      	 <div id="login2" style="width:115px; margin:0px auto 0 auto;">
                      	 <h2>
                      	 请耐心等待!</h2> 
					  	</div>
					</div>
<div class="right_c">
                	<div class="r_title">
                    	<div class="r_t_l">精准营销&#160;&gt;&#160;&#160;履历&#160;&gt;&#160;&#160;<font size="3">履历管理</font></div>
                    </div>
                    
					<table width="100%" cellspacing="0" cellpadding="0" style="margin-top:50px;">
						<tbody><tr>
							<td width="40%" class="piltd">
                            	<div class="pila_bg_on1 aaaa" style="cursor:pointer">空签</div>
								<div class="pil_bule bbbb"></div>
                            </td>
							<td width="20%" class="piltd">
                                <div class="pila_bg_2 aaaa" style="cursor:pointer">根据模版生成履历</div>
								<div class="pil_hui bbbb"></div>
                            </td>
							<td width="40%" class="piltd">
                                <div class="pila_bg_3 aaaa" style="cursor:pointer">自定义关系生成履历</div>
								<div class="pil_hui bbbb"></div>
                            </td>
						</tr>
						<tr>
                    
                    </tr></tbody></table>	

				<!--编辑页面开始-->
					<div class="piliangbox">
                        <!--空签-->
                        <div style="display: block;">
                            <div style="display:none;" class="help_box">空签：无任何对应关系。仅提供数量。 </div>
                            <div class="pilin_box1">
                                <div class="print_img"><img width="136" height="148" src="#{request.contextPath}/asset/images/print_img.jpg"/></div>
                                <h:form>
                                <table cellspacing="0" cellpadding="0" class="print_table">
                                    <tbody><tr>
                                        <td class="print_font">数量：</td>
                                        <td>
                                            <table cellspacing="0" cellpadding="0">
                                                <tbody><tr>
                                                    <td><img width="7" height="30" src="#{request.contextPath}/asset/images/text_left.jpg"/></td>
                                                    <td><input type="text" class="print_input06" id="total" name="total"/></td>
                                                    <td><img width="7" height="30" src="#{request.contextPath}/asset/images/text_right.jpg" style="float:left;"/></td>
                                                 </tr>
                                             </tbody></table>       
                                        </td>
                                        <td class="print_font">张</td>
                                    </tr>
                                    <tr>
                                        <td align="center" colspan="3">
                                         <script type="text/javascript">
											var total = 100000;
											function check1 (){
												var a = document.getElementById("total");
												if(a.value==""){
													alert("请填写生成张数!");
												}
												if(parseInt(a.value)>total){
													alert("超过生成最大限制["+total+"]!");
													return false;
												}
												jquery("#login").show();
												return true;
											}
                                         </script>
                                        <h:commandButton onclick="if(!check1())return false;" action="#{batchRecordHome.createBlank}" style="background-image:url('#{request.contextPath}/asset/images/shengc.jpg');width:77px;height:32px;cursor: pointer;"/>
                                        &#160;&#160;
                                        <s:button view="/record/BatchRecordList.xhtml" styleClass="edit_back" id="bn_left6" style="background:url('#{request.contextPath}/asset/images/re_43.jpg') bottom no-repeat; width:77px;height:32px; cursor:pointer" />
                                        </td>
                                    </tr>
                                </tbody></table>
                                </h:form>
                                <div class="clear"></div>
                            </div>
                         </div>   
                        <!--空签end-->
                        <!--根据模版生成履历ben-->
                         <div style="display: none;">
                            <div class="pilin_box2">
                                 <div class="help_box">根据模板生成：第一步选择模板，第二步显示出该模板的所有履历，提供编辑数量的输入框，用户定义好数量后。生成批量二维码，并由系统建立
        好与履历间的关系。</div>
        <h:form id="model">
        
                                <table cellspacing="0" cellpadding="0" style="margin-top:10px;">
                                    <tbody><tr>
                                        <td align="right" class="">选择模版：</td>
                                        <td align="left" class="tc_strong">
                                                <div class="uboxstyle2">
                                <h:selectOneMenu  id="model" style="width:146px;" immediate="true" value="#{batchRecordHome.pmi}"  valueChangeListener="#{batchRecordHome.pmiChange}">
									<s:selectItems value="#{batchRecordHome.pmiList}" var="var" label="#{var.name}" />
									<s:convertEntity />
									<a:support event="onchange" reRender="pr" eventsQueue="default" ajaxSingle="true" bypassUpdates="true"/>
								</h:selectOneMenu>
                                                </div>
                                        </td>
                                    </tr>
                                </tbody></table>
                                <s:span id="pr">
                                <h:inputHidden value="#{batchRecordHome.modeStr}" id="modeStr"/>
                                <table width="100%" cellspacing="0" cellpadding="0" class="pil_table">
                                    <tbody><tr>
                                        <td width="5" height="4"><img width="5" height="4" src="#{request.contextPath}/asset/images/table_d_40.jpg"/></td>
                                        <td style="border-top:1px solid #e1e1e1;border-right:1px solid #e1e1e1; background:#f0f5fb;"></td>
                                        <td style="border-top:1px solid #e1e1e1;border-right:1px solid #e1e1e1; background:#f0f5fb;border-right:none;"></td>
                                        <td width="5" height="4"><img width="5" height="4" src="#{request.contextPath}/asset/images/table_d_43.jpg"/></td>
                                    </tr>
                                    <tr>
                                        <th width="5" height="4" style="border-right:none;" class="pil_bg ze_bt_le"></th>
                                        
                                        <th class="pil_bg">履历名称</th>
                                        <th class="pil_bg" style="border-right:none;">打印数量</th>
                                        <th width="5" height="4" class="pil_bg pil_btri"></th>
                                    </tr>
                                    <a4j:repeat value="#{batchRecordHome.prList}" var="obj" >
                                    <tr>
                                        <td width="5" height="4" style="border-right:none;" class="pil_bg2 ze_bt_le"></td>
                                        <td class="pil_bg2">#{obj.plantName}
                                        <input type="hidden" value="#{obj.productInfoId}" class="model"></input>
                                        </td>
                                        <td class="pil_bg2" style="border-right:none;">
                                            <table cellspacing="0" cellpadding="0" class="pil_ta_t">
                                                <tbody><tr>
                                                    <td><input type="text" class="pli_input model#{obj.productInfoId}"/></td>
                                                    <td>&#160;张</td>
                                                </tr>
                                            </tbody></table> </td>
                                        <td width="5" height="4" class="pil_bg2 pil_btri"></td>
                                    </tr>
                                    </a4j:repeat>
                                </tbody></table> 
                                </s:span> 
                                <div class="pli_butdiv">
                                <h:commandButton  action="#{batchRecordHome.createModelRecord}" onclick="if(!modelSubmit())return false;" style="background-image:url('#{request.contextPath}/asset/images/shengc.jpg');width:77px;height:32px;cursor: pointer;"/>&#160;&#160;
                                <s:button view="/record/BatchRecordList.xhtml" styleClass="edit_back" id="bn_left6" style="background:url('#{request.contextPath}/asset/images/re_43.jpg') bottom no-repeat; width:77px;height:32px; cursor:pointer" />
                                </div>        
                                </h:form>
                                <div class="clear"></div>          
                            </div>
                         	<div class="clear"></div>          
                        </div>
                        <!--根据模版生成履历end-->
                         <!--自定义关系生成履历ben-->
                        <div style="display: none;">
                            <div class="pilin_box2">
                                <table width="100%" cellspacing="0" cellpadding="0" style="table-layout:fixed;">
                                	<tbody><tr>
                                    	<td>
                                			<div style="margin-top:0;" class="help_box">自定义关系方式：用户可以自己定义 从num1到num2对应到某个履历间的关系。例如，1到1000是对应19号棚西红柿。(请设置履历起止编码)</div>
                                    	</td>
                                        <td width="60">
                                			<div class="pli_tj"><a href="#" onclick="#{rich:component('lv')}.show();jquery('#index').val('');return false;"><img width="44" height="30" src="#{request.contextPath}/asset/images/tj_03.jpg"/></a></div>
                                    	</td>
                                </tr></tbody></table>    
                                <h:form>
                                <s:span id="custom">
                                <table width="100%" cellspacing="0" cellpadding="0" class="pil_table">
                                    <tbody><tr>
                                        <td width="5" height="4"><img width="5" height="4" src="#{request.contextPath}/asset/images/table_d_40.jpg"/></td>
                                        <td style="border-top:1px solid #e1e1e1;border-right:1px solid #e1e1e1; background:#f0f5fb;"></td>
                                        <td style="border-top:1px solid #e1e1e1;border-right:1px solid #e1e1e1; background:#f0f5fb;"></td>
                                        <td style="border-top:1px solid #e1e1e1;border-right:1px solid #e1e1e1; background:#f0f5fb;"></td>
                                        <td style="border-top:1px solid #e1e1e1;border-right:1px solid #e1e1e1; background:#f0f5fb;"></td>
                                        <td style="border-top:1px solid #e1e1e1; background:#f0f5fb;" width="5%"></td>
                                        <td width="5" height="4"><img width="5" height="4" src="#{request.contextPath}/asset/images/table_d_43.jpg"/></td>
                                    </tr>
                                    <tr>
                                        <th width="5" height="4" style="border-right:none;" class="pil_bg ze_bt_le"></th>
                                         <th class="pil_bg">起始编码</th>
                                        <th class="pil_bg">结束编码</th>
                                         <th class="pil_bg">模版名称</th>
                                        <th class="pil_bg">履历名称</th>
                                        <th style="border-right:none;" width="5%" class="pil_bg"></th>
                                        <th width="5" height="4" class="pil_bg pil_btri"></th>
                                    </tr>
            					<a4j:repeat value="#{batchRecordHome.customList}" var="var"  rowKeyVar="_index">
                                    <tr class="xx" aa="#{_index}">
                                        <td width="5" height="4" style="border-right:none;" class="pil_bg2 ze_bt_le"></td>
                                        <td class="pil_bg2">
                                          <h:inputText value="#{var.start}" styleClass="pli_input check start#{_index}" >
                                          <a:support event="onblur"  eventsQueue="default" />
                                          </h:inputText>
                                        </td>
                                        <td class="pil_bg2">
                                           <h:inputText value="#{var.end}" styleClass="pli_input check end#{_index}">
                                           <a:support event="onblur"  eventsQueue="default" />
                                           </h:inputText>
                                        </td>
                                        <td class="pil_bg2">#{var.pr.phoneModelInfoId.name}</td>
                                        <td class="pil_bg2 prid" aa="#{var.pr.productInfoId}">#{var.pr.plantName}</td>
                                        <td style="border-right:none;" class="pil_bg2">
		                                <a href="#" onclick="deleteItem(#{var.id},this)" class="list_delete"/>
                                        </td>
                                        <td width="5" height="4" class="pil_bg2 pil_btri"></td>
                                    </tr>
            					 </a4j:repeat>
                                </tbody></table>  
                                </s:span>
                                <div class="pli_butdiv">
                                <h:commandButton  action="#{batchRecordHome.createCustomRecord}" onclick="if(!customSubmit())return false;" style="background-image:url('#{request.contextPath}/asset/images/shengc.jpg');width:77px;height:32px;cursor: pointer;"/>&#160;&#160;
                                <s:button view="/record/BatchRecordList.xhtml" styleClass="edit_back" id="bn_left6" style="background:url('#{request.contextPath}/asset/images/re_43.jpg') bottom no-repeat; width:77px;height:32px; cursor:pointer" />
                                </div>  
                                </h:form>      
                                <div class="clear"></div>  
                            </div>
                            <div class="clear"></div>  
                        </div>    
                        <!--自定义关系结束-->
                  		
                   </div><!--pinliangbox-->
				<!--编辑页面结束-->
            <div class="clear"></div>
		</div>
		<style>
		.dr-mpnl-pnl-b{padding:0px;font-size:14px;font-weight:bold;}
		</style>
		<rich:modalPanel id="lv" autosized="true" headerClass="modalHeader"  style=" margin-top:-100px;">
		<div class="tck_div" style="width:450px;">
       <div class="tck_ti" style="right:0px"><div style="float:left;margin-top:2px;">自定义关系履历</div>
       <h:outputLink value="#" style="margin-right:-13px"
                onclick="#{rich:component('lv')}.hide();refresh(); return false;">
                    <img src="../images/close_17.jpg" width="20" height="20"/>
                </h:outputLink>
                </div>
       <a4j:form id="lvform" ajaxSubmit="true" >
               	<table class="tck_table" style="width:450px; line-height:0px; padding:0px; margin-top:15px;">
                    <tr>
                    	<td align="left" widt="79" class="font_td">模版：</td>
                        <td  >
                        <input type="hidden" value="" id="index" name="index"/>
                        <select  id="lvform:pmi2" name="pmi2" style="width:146px;"  onchange="pmiChange2(this.value)" >
									<a4j:repeat value="#{batchRecordHome.pmiList}" var="var" >
										<option value="#{var.id}">#{var.name}</option>
									</a4j:repeat> 
						</select>
                        </td>
                    </tr>
                    <tr>
                    	<td align="left" class="font_td">履历：</td>
                        <td  >
                        
                        <select  id="lvform:pr2" name="pr2" style="width:146px;" >
									<a4j:repeat value="#{batchRecordHome.prList2}" var="var" >
										<option value="#{var.productInfoId}">#{var.plantName}</option>
									</a4j:repeat> 
                        </select>
                        </td>
                    </tr>
                    <tr>
                    	<td align="left" class="font_td">起始编码：</td>
                        <td  class="tc_strong">
                        <strong>
                        <h:inputText value="#{batchRecordHome.start_}" id="start_"/>
                        </strong>
                        </td>
                    </tr>
                    <tr>
                    	<td align="left" class="font_td">结束编码：</td>
                        <td  class="tc_strong">
                        <strong>
                        <h:inputText value="#{batchRecordHome.end_}" id="end_"/>
                        </strong>
                        </td>
                    </tr>
                    <tr>
                    	<td colspan="3" align="center" valign="bottom">
		          <a4j:commandButton  eventsQueue="mainQueue" onclick="if(!customOneSubmit())return false;" value="添加" style="width:74px;height:26px" image="../images/safe.jpg" action="#{batchRecordHome.addList}" 
		                	reRender="custom"
		                	oncomplete="#{rich:component('lv')}.hide();refresh();"
		                	/>
		          &#160; 
		          <h:outputLink value="#" onclick="#{rich:component('lv')}.hide(); refresh();return false;"><img class="er_buttton" src="../images/button_17.jpg" width="74" height="26" />
                </h:outputLink>
                        </td>
                    </tr>
                </table>
               
       </a4j:form>
       </div>
   </rich:modalPanel>
   <a4j:form id="formid" >
    <a4j:queue requestDelay="10" ignoreDupResponses="true" id="mainQueue"/>
   <a4j:jsFunction name="pmiChange2"  eventsQueue="mainQueue"  action="#{batchRecordHome.pmiChange2}" data="#{batchRecordHome.re_str}" oncomplete="link(data)">
   <a4j:actionparam name="param1" assignTo="#{batchRecordHome.changeId}"/>
</a4j:jsFunction>
<a4j:jsFunction name="deleteItem_next"   eventsQueue="mainQueue" action="#{batchRecordHome.deleteItem}" >
   <a4j:actionparam name="deleteId" assignTo="#{batchRecordHome.deleteId}"/>
</a4j:jsFunction>
</a4j:form>
		<script type="text/javascript" src="#{request.contextPath}/asset/js/form/jquery-ui.js"></script>
<script type="text/javascript" src="#{request.contextPath}/asset/js/form/jquery-ui-select.js"></script>
		<script type="text/javascript">
		//<![CDATA[
		 jquery("select").selectmenu({style:'dropdown'});
		 function deleteItem(id,obj){
			 deleteItem_next(id);
			 jquery(obj).closest("tr").remove();
			 }
		function modelSubmit(){
			var str = "";
			var t = 0;
			jquery(".model").each(function(){
				var temp = jquery(this).val();
				if(jquery(".model"+temp).val()!=""){
					str+=temp+"_"+jquery(".model"+temp).val()+"ii";
					t += parseInt(jquery(".model"+temp).val());
				}
			});
			if(t>total){
				alert("超过生成最大限制["+total+"]!");
				return false;
			}
			jquery("#model\\:modeStr").val(str);
			return true;
		}
		function link(data){
			jquery("#lvform\\:pr2").empty().append(data);
			jquery("#lvform\\:pr2").selectmenu("destroy").selectmenu({style:'dropdown'});
		}

		function customSubmit(){
			var x = true;
			var t = 0;
			jquery(".xx").each(function(index){
				var aa = jquery(this).attr("aa");
				var start = jquery(".start"+index).val();
				var end = jquery(".end"+index).val();
				var bo = false;
				var length  = jquery(".xx").length;
				if(parseInt(start)>=parseInt(end)){
					jquery(".start"+index).focus();
					alert("起始编码要小于结束编码!");
					x = false;
					return false;
				}
				t+= (parseInt(end)-parseInt(start));
				for(var i = 0;i<length;i++){
					if(i==aa)
						continue;
					var a = jquery(".start"+i).val();
					var b = jquery(".end"+i).val();
					if(parseInt(start)>=parseInt(a)&&parseInt(start)<=parseInt(b)){
						bo = true;
						jquery(".start"+index).focus();
						alert("和已存在起止编码["+a+"--->"+b+"]冲突!");
						x = false;
						break;
					}
					if(parseInt(end)>=parseInt(a)&&parseInt(end)<=parseInt(b)){
						bo = true;
						jquery(".end"+index).focus();
						alert("和已存在起止编码["+a+"--->"+b+"]冲突!");
						x = false;
						break;
					}
				}
				if(bo){
					return false;
				}
			});
			if(t>total){
				alert("超过生成最大限制["+total+"]!");
				return false;
			}
			return x ;
		}

		function customOneSubmit(){
			var x = true;
			var start = jquery("#lvform\\:start_").val();
			var end = jquery("#lvform\\:end_").val();
			start=parseInt(start);
			end = parseInt(end);
			var pid = jquery("#lvform\\:pr2").val();
			if(false){
				jquery(".prid").each(function(){
					if(jquery(this).attr("aa")==pid){
						alert("履历已存在!");
						x = false;
						return false;
					}
				});
			}
			if(isNaN(start)){
				alert("起始编码请填写整字!");
				jquery("#lvform\\:start_").focus();
				return false;
			}
			if(isNaN(end)){
				alert("结束编码请填写整字!");
				jquery("#lvform\\:end_").focus();
				return false;
			}
			if(start>=end){
				alert("起始编码要小于结束编码!");
				jquery("#lvform\\:start_").focus();
				return false;
			}
			jquery("#lvform\\:start_").val(start);
			jquery("#lvform\\:end_").val(end);
			jquery(".xx").each(function(index){
				
				var bo = false;
				var length  = jquery(".xx").length;
				for(var i = 0;i<length;i++){
					var a = jquery(".start"+i).val();
					var b = jquery(".end"+i).val();
					if(parseInt(start)>=parseInt(a)&&parseInt(start)<=parseInt(b)){
						bo = true;
						jquery(".start"+index).focus();
						alert("和已存在起止编码["+a+"--->"+b+"]冲突!");
						x = false;
						break;
					}
					if(parseInt(end)>=parseInt(a)&&parseInt(end)<=parseInt(b)){
						bo = true;
						jquery(".end"+index).focus();
						alert("和已存在起止编码["+a+"--->"+b+"]冲突!");
						x = false;
						break;
					}
				}
				if(bo){
					return false;
				}
			});
			return x ;
		}


		function refresh(){
			jquery("#lvform\\:start_").val("");
			jquery("#lvform\\:end_").val("");
			jquery("#lvform\\:pmi2")[0].selectedIndex = 0;
			jquery("#lvform\\:pmi2").trigger("onchange");
			jquery("#lvform\\:pmi2").selectmenu("destroy").selectmenu({style:'dropdown'});
		}
		jquery("#lvform\\:start_").attr("autocomplete","off");
		jquery("#lvform\\:end_").attr("autocomplete","off");
		//]]>
		</script>
		</td>
</ui:define>

</ui:composition>
